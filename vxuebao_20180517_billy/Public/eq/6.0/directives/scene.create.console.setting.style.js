angular.module("scene.create.console.setting.style").directive("styleInput",["multiCompResize","$rootScope",function(e,t){return{restrict:"AE",link:function(e,o,i){var r=$("#inside_"+e.elemDef.id+" > .element-box");$("#inside_"+e.elemDef.id,"#nr"),e.$watch(function(){return $(o).val()},function(a,s){if(a!=s){if("borderWidth"==i.cssItem){r.css({borderStyle:e.model.borderStyle,borderWidth:$(o).val()});var d={width:r.width(),height:r.height()};if(4==e.elemDef.type){var n=r.find("img"),l=n.width()/n.height(),h=d.width/d.height;l>=h?(n.outerHeight(d.height),n.outerWidth(d.height*l),n.css("marginLeft",-(n.outerWidth()-d.width)/2),n.css("marginTop",0)):(n.outerWidth(d.width),n.outerHeight(d.width/l),n.css("marginTop",-(n.outerHeight()-d.height)/2),n.css("marginLeft",0)),e.elemDef.properties.imgStyle.marginTop=n.css("marginTop"),e.elemDef.properties.imgStyle.marginLeft=n.css("marginLeft"),e.elemDef.properties.imgStyle.width=n.outerWidth(),e.elemDef.properties.imgStyle.height=n.outerHeight()}}if("borderRadius"==i.cssItem&&r.css({borderRadius:e.model.borderRadius}),"opacity"==i.cssItem&&r.css({opacity:(100-$(o).val())/100}),"backgroundColor"==i.cssItem&&r.css({backgroundColor:$(o).val()}),"color"==i.cssItem&&(r.css({color:$(o).val()}),"h"==e.elemDef.type)){var c=r.find("svg");c.find("g").length?c.find("g").attr("fill",$(o).val()):c.children().attr("fill",$(o).val())}"borderStyle"==i.cssItem&&(r.css({borderStyle:e.model.borderStyle}),t.$broadcast("hisChange")),"borderColor"==i.cssItem&&r.css({borderColor:e.model.borderColor}),"padding"==i.cssItem&&r.css({paddingTop:e.model.paddingTop,marginTop:-e.model.paddingBottom}),"lineHeight"==i.cssItem&&r.css({lineHeight:e.model.lineHeight}),"transform"==i.cssItem&&(r.parents("li").css({transform:"rotateZ("+e.model.transform+"deg)"}),t.$broadcast("boxOuter")),"boxShadow"==i.cssItem&&(e.tmpModel.boxShadowX=-Math.sin(e.tmpModel.boxShadowDirection*Math.PI/180)*e.tmpModel.boxShadowSize,e.tmpModel.boxShadowY=Math.cos(e.tmpModel.boxShadowDirection*Math.PI/180)*e.tmpModel.boxShadowSize,r.css({boxShadow:Math.round(e.tmpModel.boxShadowX)+"px "+Math.round(e.tmpModel.boxShadowY)+"px "+e.tmpModel.boxShadowBlur+"px "+e.tmpModel.boxShadowColor}))}})}}}]).directive("angleKnob",function(){return{restrict:"AE",templateUrl:"scene/console/angle-knob.tpl.html",link:function(e,t,o){function i(e,t){var o=Math.sqrt((e-28)*(e-28)+(t-28)*(t-28))/28,i=28+(e-28)/o,r=28+(t-28)/o;s.css({top:Math.round(r),left:Math.round(i)})}function r(e,t){var o=e-28,i=28-t,r=180*Math.atan(o/i)/Math.PI;return t>28&&(r+=180),28>=t&&28>e&&(r+=360),Math.round(r)}var a=$(t).find(".sliderContainer"),s=$(t).find(".sliderKnob");e.$watch(function(){return e.tmpModel.boxShadowDirection},function(e){s.css({top:28-28*Math.cos(e*Math.PI/180),left:28+28*Math.sin(e*Math.PI/180)})}),0!==e.tmpModel.boxShadowDirection&&s.css({top:28-28*Math.cos(e.tmpModel.boxShadowDirection*Math.PI/180),left:28+28*Math.sin(e.tmpModel.boxShadowDirection*Math.PI/180)}),a.bind("mousedown",function(t){t.stopPropagation();var o=a.offset().left,s=a.offset().top;i(t.pageX-o,t.pageY-s);var d=r(t.pageX-o,t.pageY-s);e.tmpModel.boxShadowDirection=d,e.$apply(),$(this).bind("mousemove",function(t){t.stopPropagation(),i(t.pageX-o,t.pageY-s);var a=r(t.pageX-o,t.pageY-s);e.tmpModel.boxShadowDirection=a,e.$apply()}),$(this).bind("mouseup mouseleave",function(e){$(this).unbind("mousemove"),$(this).unbind("mouseup mouseleave")})})}}});