angular.module("app.directives.qrcode",[]).directive("qrCode",function(){return{restrict:"A",scope:{qrUrl:"@"},link:function(e,n,t){e.$watch("qrUrl",function(e,t){$("canvas",n).length>0&&$("canvas",n).remove(),e&&(e=e.replace(PREFIX_HOST,PREFIX_HOST_ARRAY[parseInt(10*Math.random(),10)%4]),$(n).qrcode({render:"canvas",width:180,height:180,text:e+(/\?/.test(e)?"&":"?")+"eqrcode=1"}))})}}}).directive("qrCodeSize",function(){return{restrict:"A",scope:{qrUrl:"@"},link:function(e,n,t){var r=parseInt(t.qrCodeSize,10);e.$watch("qrUrl",function(e,t){$("canvas",n).length>0&&$("canvas",n).remove(),e&&(e=e.replace(PREFIX_HOST,PREFIX_HOST_ARRAY[parseInt(10*Math.random(),10)%4]),$(n).qrcode({render:"canvas",width:r,height:r,text:e+(/\?/.test(e)?"&":"?")+"eqrcode=1"}))})}}}).directive("downloadCanvas",function(){return{restrict:"EA",link:function(e,n,t){e.$on("download.canvas",function(t,r){var a;$.each($(n).find(".qr-size"),function(e,n){$(n).attr("qr-code-size")==r&&(a=$(n).find("canvas").get(0))}),r==$(n).find(".qr-size").attr("qrCodeSize")&&console.log(r);var c=document.createElement("a"),i=document.createEvent("MouseEvents"),o=a.toDataURL("image/png");i.initEvent("click",!0,!0),c.download=e.scene.code+".png",c.href=o,c.dispatchEvent(i)})}}});