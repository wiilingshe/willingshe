angular.module("scene.preview").directive("sceneView",["sceneService","sceneViewService","sceneDataParseService",function(e,n,a){return{scope:{sceneId:"@",sceneName:"@",sceneCover:"@",sceneDescription:"@"},restrict:"A",templateUrl:BASE_URL+"templates/scene.preview.tpl.html",link:function(e,s,t,i){function o(s,i){n.getSceneData(t.sceneId).then(function(t){t.data.success&&(s&&(s=parseInt(s,10)-1,t.data.list[s].elements=i.obj.elements,t.data.list[s].properties=i.obj.properties),e.$parent.scene.property.activityPageId?n.getActivityPage(e.$parent.scene.property.activityPageId).then(function(e){t.data.list.push(e.data.obj),a.parse(t.data)}):a.parse(t.data))})}function c(){p(),s.find(".password-numbers>span").click(d),s.find(".password-operation>span").click(p),s.find(".verifyCode").show()}function r(){s.find(".password-numbers>span").unbind("click"),s.find(".password-operation>span").unbind("click"),s.find(".verifyCode").hide()}function d(n){p($(n.target).text()),4==l.pass.length&&(e.$parent.scene.accessCode==l.pass?r():p())}function p(e){e&&"object"!=typeof e?l.pass+=e:l.pass="",s.find(".password-indicator li").each(function(e,n){e<l.pass.length?$(n).addClass("active"):$(n).removeClass("active")})}var l={play:!1};e.sceneId&&(e.$parent.mginData==angular.toJson(e.$parent.tpl)?o():o(e.$parent.pageNum,$.extend(!0,{},e.$parent.tpl))),e.$watch("sceneId",function(e,n){e!=n&&o()}),s.on("$destroy",function(){utilSound.pause()}),e.$on("changeView",function(e,n,a){n||a?s.find(".wechat-share").show():s.find(".wechat-share").hide(),s.find(".loading").hide(),r()}),e.$on("showLoading",function(e,n,a){n?(a?s.find(".loadbg").css({background:"url("+PREFIX_FILE_HOST+a+")","background-size":"70px 42px"}):s.find(".loadbg").css("background",""),s.find(".loading").show(),s.find(".wechat-share").hide()):s.find(".loading").hide(),r()}),e.$on("processBar",function(e,n){n?s.find(".progress").show():s.find(".progress").hide()}),e.$on("passPanelSwitch",function(e,n){n?c():r()}),s.on("$destroy",function(){clearInterval(eqShow.progressInterval),a.app.pauseAutoFlip()})}}}]);