!function(t,e){t.completeEffect=function(t){return!t.find(".lock").get(0)}}(window,jQuery),!function(t,e){function n(t,n){completeEffect(e(".z-current"))&&(Y="started",O.length||(O=d.find(".main-page")),n||(j?(t=event,m={x:t.touches[0].pageX-d.offset().left,y:t.touches[0].pageY-d.offset().top}):m={x:t.pageX-d.offset().left,y:t.pageY-d.offset().top}))}function i(t,n){if(Y="turning",U&&U.obj.property.autoFlip&&U.obj.property.autoFlipTime&&c(),n||(j?(t=event,x={x:t.touches[0].pageX-d.offset().left,y:t.touches[0].pageY-d.offset().top}):x={x:t.pageX-d.offset().left,y:t.pageY-d.offset().top}),v=x.x-m.x,0>v){if(I){I=!1,j&&u?k=!0:m.y>=d.height()/2?w=!0:m.y<d.height()/2&&(b=!0),z=e(".z-current").get(0);var i=e(z).find(".m-img").attr("id").substring(4);h=e("#flip"+i),Z||(X=e(z).parent(".flip-mask").get(0).nextElementSibling&&e(e(z).parent(".flip-mask").get(0).nextElementSibling).find(".main-page").get(0)?e(e(z).parent(".flip-mask").get(0).nextElementSibling).find(".main-page").get(0):!!S&&O.first().get(0)),X&&(e(X).find(".m-img").attr("id").substring(4),e(z).parent(".flip-mask").css({zIndex:100,display:"block"}),e(X).addClass("z-active").parent(".flip-mask").css({zIndex:99,display:"block"}),f(X),completeEffect(e(X))||e("#audio_btn").css("opacity",0),w?(e(".z-current").css({top:h.height()-d.height()+"px",left:"0"}),h.css({top:"-"+(h.height()-d.height())+"px"}),e(".turning").css({transformOrigin:"0% 100% 0px",left:d.width()+"px",top:d.height()+"px"})):b?e(".turning").css({top:"0",left:d.width()+"px",transformOrigin:"0% 0% 0px"}):k&&(e(".z-current").css({top:0,left:e(this).width()-d.width()+"px"}),h.css({top:0,left:-(h.width()-d.width())+"px"}),e(".turning").css({transformOrigin:"0% 100% 0px",left:d.width()+"px",top:0})))}}else if(v>0&&I){I=!1,y=!0,z=e(".z-current").get(0);var i=e(z).find(".m-img").attr("id").substr(4);h=e("#flip"+i),Z||(X=e(z).parent(".flip-mask").get(0).previousElementSibling&&e(e(z).parent(".flip-mask").get(0).previousElementSibling).find(".main-page").get(0)?e(e(z).parent(".flip-mask").get(0).previousElementSibling).find(".main-page").get(0):!!S&&O.last().get(0)),X&&(f(X),completeEffect(e(X))||e("#audio_btn").css("opacity",0),e(z).parent(".flip-mask").css({display:"block"}),e(X).addClass("z-active").parent(".flip-mask").css({zIndex:99,display:"block"}),e(".turning").css({top:"0",left:"0",transformOrigin:"0% 0% 0px"}))}X&&a(x)}function r(t,e){if(!X)return Y="feeling",w=!1,b=!1,k=!1,y=!1,void(I=!0);Y="leaving";var n,i,r,s;e?(n=t.x,i=t.y):j?(n=x.x-d.offset().left,i=x.y-d.offset().top):(n=t.pageX-d.offset().left,i=t.pageY-d.offset().top),w?(C=16,r=-d.width(),s=d.height(),E=setInterval(function(){n=C>=n-r?n:n-C,i=C>=s-i?i:i+C,a({x:n,y:i}),C>=n-r&&C>=s-i&&(clearInterval(E),o())},10)):b?(C=16,r=-d.width(),s=0,E=setInterval(function(){n=C>=n-r?n:n-C,i=C>=i-s?i:i-C,a({x:n,y:i}),C>=n-r&&C>=i-s&&(clearInterval(E),o())},1)):k?(C=5,r=-d.width(),E=setInterval(function(){n=C>=n-r?n:n-C,a({x:n,y:i}),C>=n-r&&(clearInterval(E),o())},1)):y&&(C=3,r=d.width(),s=0,E=setInterval(function(){n=C>=r-n?n:n+C,a({x:n,y:i}),C>=r-n&&(clearInterval(E),o())},1))}function a(t){w||b?(M=d.width()-t.x,w?q=Math.abs(d.height()-t.y):b&&(q=t.y),T=q/M,P=q/Math.sqrt(M*M+q*q),B=Math.sqrt(1-P*P),N=Math.sqrt(M*M+q*q)/2,Q=N*T,A=Math.sqrt(Q*Q+N*N),L=A/T,F=180*Math.atan(T)/Math.PI>0?180*Math.atan(T)/Math.PI:0,D=(d.width()-A)*B,G=(d.width()-A)*P*B,H=(d.width()-A)*(1-P*P),D>=1&&(w?(F>1?e(".turning").css({width:A+"px",height:L+"px",backgroundColor:"#ff0000",background:"-webkit-linear-gradient("+(180-F)+"deg, #fff 10%, #d1cfc7 40%, #f2eee2 50%, transparent 50%, transparent 100%)",transform:"translateX(-"+(A-3)+"px) translateY(-"+(L-3)+"px) rotate("+2*F+"deg) scaleX(-1)"}):s(t),J="0% 100% 0px",K="rotate(-"+(90-F)+"deg) translateY("+D+"px)",R="rotate("+(90-F)+"deg) translateY(-"+G+"px) translateX(-"+H+"px)"):b&&(F>1?e(".turning").css({width:A+"px",height:L+"px",backgroundColor:"#000",background:"-webkit-linear-gradient(-"+(180-F)+"deg, #fff 10%, #d1cfc7 40%, #f2eee2 50%, transparent 50%, transparent 100%)",transform:"translateX(-"+(A-2)+"px) rotate(-"+2*F+"deg) scaleX(-1)"}):s(t),J="0% 0% 0px",K="rotate("+(90-F)+"deg) translateY(-"+D+"px)",R="rotate(-"+(90-F)+"deg) translateY("+G+"px) translateX(-"+H+"px)"),h.css({zIndex:100,transformOrigin:J,transform:K}),e(X).parent(".flip-mask").css({zIndex:99,display:"block"}),e(X).css({zIndex:1e3}),e(z).css({transformOrigin:J,transform:R}))):k?(e(".turning").css({width:(d.width()-t.x)/2+"px",height:d.height()+"px",left:t.x+"px",background:"-webkit-linear-gradient(left, #fff 0% , #d1cfc7 15%, #f2eee2 85%, #fff 100%)"}),h.css({transformOrigin:"0% 50% 0px",left:0,transform:"translateX(-"+(h.width()-t.x)+"px)"}),e(z).css({transformOrigin:"0% 50% 0px",transform:"translateX("+(h.width()-t.x)+"px)"})):y&&(h.css({zIndex:100,transformOrigin:"0% 50% 0px",transform:"translateX("+t.x+"px)"}),e(z).css({transformOrigin:"0% 50% 0px",transform:"translateX(-"+t.x+"px)"}),e(".turning").css({width:d.width()-t.x+"px",height:d.height()+"px",left:-(d.width()-2*t.x)+"px",background:"-webkit-linear-gradient(left, #fff 0% , #d1cfc7 15%, #f2eee2 85%, #fff 100%)"}))}function s(t){e(".turning").css({width:(d.width()-t.x+6)/2+"px",height:d.height()+"px",top:0,left:t.x+2+"px",background:"-webkit-linear-gradient(left, #fff 0% , #d1cfc7 10%, #f2eee2 90%, #fff 100%)",transform:"",border:0})}function o(){var t=U.list;U.obj.property.autoFlip&&U.obj.property.autoFlipTime&&g(),utilSound.pause();var n=e("#report0");n.length&&n.remove(),Y="feeling",w=!1,b=!1,k=!1,y=!1,I=!0,v=0,e(".flip-mask").css({transform:"",top:0,left:0,zIndex:0}),e(z).removeClass("z-current").css({transform:"",top:0,left:0}),e(X).removeClass("z-active").addClass("z-current").css({transform:""}),e(".turning").css({width:0,height:0,top:0,left:0,transform:"",background:"none"}),z=X;var i=e(X).find(".m-img").attr("id").substring(4);e("#flip"+i).css({zIndex:100}),e("#audio_btn").css("opacity",1),X=null;var r=e(z).find(".m-img").attr("id").substring(4);t[r-1].elements&&t[r-1].elements.length&&e.each(t[r-1].elements,function(t,n){"d"==n.type&&eqShow.getShowCount(U.obj.id).then(function(t){var i=eqShow.fixedNum(t);e("#"+n.id).find(".counter-number").text(i)})}),$||eqShow.showProgressBar(U,e("#nr").find(".main-page")),$=!0}function f(t){if(t){var n=e(t).find(".m-img").attr("id").substring(4);e(t).find("li").each(function(t){for(var i=0;i<U.list[n-1].elements.length;i++)U.list[n-1].elements[i].id==parseInt(e(this).attr("id").substring(7),10)&&eqxCommon.animation(e(this),U.list[n-1].elements[i],"view")})}}function p(){"turning"!=Y&&"leaving"!=Y&&(m={x:0,y:d.height()},n(m,"mock"),Y="turning",e(".main-page").css({width:d.width()+"px",height:d.height()+"px"}),x={x:0,y:d.height()},y=!0,E=setInterval(function(){x.x++,i(x,"mock"),x.x<=250&&(clearInterval(E),r(x,"mock"))},1))}function l(){"turning"!=Y&&"leaving"!=Y&&(m={x:d.width(),y:d.height()},n(m,"mock"),Y="turning",e(".main-page").css({width:d.width()+"px",height:d.height()+"px"}),x={x:d.width(),y:d.height()},j&&u?k=!0:w=!0,W=setInterval(function(){x.x-=5,x.y-=5,i(x,"mock"),x.x<=200&&(clearInterval(W),r(x,"mock"),S||X||c())},1))}function g(){_=setInterval(function(){return completeEffect(e(".z-current"))?void l():void c()},1e3*V)}function c(){clearInterval(_)}var d=e(".nr"),h=null,u=isAndroid(),m={},x={},v=0,w=!1,b=!1,k=!1,y=!1,I=!0,z=null,X=null,S=!1,j=mobilecheck(),E=null,O=[],Y="feeling",C=0,F=0,M=0,q=0,T=0,P=0,B=0,N=0,Q=0,A=0,L=0,D=0,G=0,H=0,J=0,K=0,R=0,U=null,V=0,W="",Z=!1;t.turnBook=function(t){U=t,U.obj.property.autoFlip&&U.obj.property.autoFlipTime&&(V=U.obj.property.autoFlipTime,g()),S=U.obj.property.triggerLoop,e('<div class="turning"></div>').appendTo(".nr"),e(".main-page").css({width:e(".nr").width()+"px",height:e(".nr").height()+"px"}),d.on(j?"touchstart":"mousedown",function(t){"feeling"==Y&&(n(t),e(".main-page").css({width:d.width()+"px",height:d.height()+"px"}))}).on(j?"touchmove":"mousemove",function(t){("started"==Y||"turning"==Y)&&i(t)}).on(j?"touchend":"mouseup mouseleave",function(t){return Z=!1,e(".z-current").get(0)?0==v?(I=!0,void(Y="feeling")):void("turning"==Y&&r(t)):void 0})};var $=!1;t.flipBookScroll=function(t){Z=!0;for(var n,i=0,r=U.list.length;r>i;i++)t==U.list[i].id&&(n=U.list[i].num);n||(n=t),z=e(".z-current").get(0);var a=e(z).find(".m-img").attr("id").substring(4),s=e(z).parent(".flip-mask").siblings(".flip-mask").find(".main-page").find("#page"+n);s&&(X=e(s).parent(".main-page").get(0),a>n?p():n>a&&l())},e(document).on("bookFlipPre",function(t){p()}),e(document).on("bookFlipNext",function(t){l()})}(window,jQuery);