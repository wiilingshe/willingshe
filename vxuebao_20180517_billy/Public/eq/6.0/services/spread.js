angular.module("services.spread",["services.scene"]),angular.module("services.spread").factory("SpreadService",["$http","sceneService","$rootScope",function(e,t,a){var n={},s=function(e){var t=new Date;return t.setDate(t.getDate()+e),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.getTime()};return n.getDataBySceneId=function(t,a,n,s,i,r,c){var d="index.php?c=Stat&id="+t;r&&(d+=(/\?/.test(d)?"&":"?")+"user="+r),c&&(d+=(/\?/.test(d)?"&":"?")+"extId="+c),a&&(d+="&startDate="+a),n&&(d+="&endDate="+n),s&&(d+="&pageSize="+s),i&&(d+="&pageNo="+i);var o=new Date;return d+="&time="+o.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+d})},n.getActivities=function(){var t=new Date;return e({withCredentials:!0,method:"GET",url:PREFIX_URL+"m/u/promotion/list?type=pc&time="+t.getTime()})},n.getActivityDetail=function(t){var a=new Date;return e({withCredentials:!0,method:"GET",url:PREFIX_URL+"m/u/promotion?code="+t+"&time="+a.getTime()})},n.updateName=function(t){var a=PREFIX_URL+"m/scene/expand/save";return e({withCredentials:!0,method:"POST",url:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},a.branchid,n.getSceneDetail=function(e,n){t.getSceneDetail(e,n).then(function(e){a.$broadcast("scene.detail",e.data.obj,n)},function(){})},n.getSceneData=function(e,t,i,r,c){var d=s(t),o=s(i),u=i-t;n.getDataBySceneId(e,d,o,u,0,r,c).then(function(t){a.$broadcast("scene.data",t.data.list,e,d,o,r)},function(){})},n.expandWebs=[],n.getWebList=function(t,s,i){var r="m/scene/expand/list";t&&(r+=(/\?/.test(r)?"&":"?")+"id="+t),i&&(r+=(/\?/.test(r)?"&":"?")+"user="+i),r+=(/\?/.test(r)?"&":"?")+"showPv="+s,r+=(/\?/.test(r)?"&":"?")+"time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+r}).then(function(e){e.data.success&&(n.expandWebs=e.data.list,a.$broadcast("webs.update"))},function(e){})},n.deleteWeb=function(t){var s=PREFIX_URL+"m/scene/expand/delete";e({withCredentials:!0,method:"POST",url:s,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)}).then(function(e){e.data.success&&(n.expandWebs.splice(t.index,1),a.$broadcast("webs.update"))},function(e){})},n.queryRegion=function(t,n){var s=PREFIX_URL+"m/scene/pv/region?id="+t+"&startDate="+n,i={id:t,startDate:n};e({withCredentials:!0,method:"GET",url:s,data:$.param(i)}).then(function(e){e.data.success&&a.$broadcast("region.update",e.data.obj)})},n.getShareWayList=function(t){var n=PREFIX_URL+"m/scene/social/share/status?id="+t;e({withCredentials:!0,method:"GET",url:n}).then(function(e){e.data.success&&a.$broadcast("shareway.update",e.data.list)})},n.activeShareWay=function(t,n){var s=PREFIX_URL+"m/scene/share?sceneId="+t+"&type="+n;e({withCredentials:!0,method:"POST",url:s,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(e){e.data.success&&a.$broadcast("active.shareway",n)})},n.applyShareWay=function(t,n,s){var i=PREFIX_URL+"m/scene/share/setting/save";t&&(i+=(/\?/.test(i)?"&":"?")+"id="+t),n&&(i+=(/\?/.test(i)?"&":"?")+"type="+n),s&&(i+=(/\?/.test(i)?"&":"?")+"value="+s),e({withCredentials:!0,method:"POST",url:i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(e){e.data.success&&a.$broadcast("apply.scene.share",e.data)})},n}]);