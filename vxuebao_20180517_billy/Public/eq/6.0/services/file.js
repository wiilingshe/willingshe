angular.module("services.file",["services.i18nNotifications","services.staticRes","services.dataCache"]),angular.module("services.file").factory("fileService",["$rootScope","$http","i18nNotifications","staticResService","dataCacheService",function(e,t,a,i,r){function s(e){var a="m/base/file/recently/used?fileType="+e;return a+=(/\?/.test(a)?"&":"?")+"time="+(new Date).getTime(),t({withCredentials:!0,method:"GET",url:PREFIX_URL+a})}function o(e,a){var i="index.php?c=statics&a=history_save&fileIds="+e+"&fileTypes="+a;return i+=(/\?/.test(i)?"&":"?")+"time="+(new Date).getTime(),t({withCredentials:!0,method:"GET",url:PREFIX_URL+i})}function c(){var e=[{color:"#6366C3"},{color:"#29A1D6"},{color:"#332E42"},{color:"#DBF3FF"},{color:"#434A54"},{color:"#000000"},{color:"#F1F03E"},{color:"#FCF08E"},{color:"#972D53"},{color:"#724192"},{color:"#967BDC"},{color:"#EC87C1"},{color:"#D870AF"},{color:"#F6F7FB"},{color:"#666C78"},{color:"#ABB1BD"},{color:"#CCD0D9"},{color:"#E6E9EE"},{color:"#48CFAE"},{color:"#36BC9B"},{color:"#3BAEDA"},{color:"#50C1E9"},{color:"#AC92ED"},{color:"#4B89DC"},{color:"#4B89DC"},{color:"#5D9CEC"},{color:"#8DC153"},{color:"#ED5564"},{color:"#DB4453"},{color:"#FB6E52"},{color:"#FFCE55"},{color:"#F6BB43"},{color:"#E9573E"},{color:"#9FF592"},{color:"#A0D468"}];return e}function n(t){P.sysCategoryList="1"==t?i.getTpTypes():i.getBgTypes(),e.$broadcast("sysCategory.update")}function l(t){P.sysMusicList="2"==t?i.getAudioTypes():i.getSoundTypes(),e.$broadcast("sysMusic.update")}function d(a){var i="index.php?c=upfile&a=systag&type=11";a&&(i+="&bizType="+a);var s=i,o=r.get("sysTag",i);return o?(P.sysTagList=o.list,void e.$broadcast("sysTag.update")):(i+=(/\?/.test(i)?"&":"?")+"time="+(new Date).getTime(),void t({withCredentials:!0,method:"GET",url:PREFIX_URL+i}).then(function(t){t.data.success&&(P.sysTagList=t.data.list,r.push("sysTag",s,t.data),e.$broadcast("sysTag.update"))}))}function p(e,a,i,s,o,c,n){return e+="pageNo="+(a?a:1),e+="&pageSize="+(i?i:10),e+="&fileType="+s,(o||0===o)&&(e+="&bizType="+o),c&&(e+="&tagId="+c),n&&(e+="&delete=1"),""!=searchVal&&(e+="&key="+searchVal),r.contains("fileService1",e)?r.asyncGet("fileService1",e):(r.setAsyncUrl(e),e+="&time="+Date.now(),t({withCredentials:!0,method:"GET",url:PREFIX_URL+e}))}function u(a,i,s,o,c,n){if(o=o.toString(),"0"===o?categoryUrl=PREFIX_URL+"index.php?c=upfile&a=getfiletype&filetype=bgType":"1"===o&&(categoryUrl=PREFIX_URL+"index.php?c=upfile&a=getfiletype&filetype=tpType"),"pure"!=c){if("1"==o&&(s=21),a+="pageNo="+(i?i:1),a+="&pageSize="+(s?s:10),a+="&fileType="+o,(c||0===c)&&(a+="&bizType="+c),n&&(a+="&tagId="+n),""!=searchVal){var l="pageNo="+i;oldSearchPage!=l&&(searchUrl=searchUrl.replace(oldSearchPage,l),oldSearchPage=l),a=searchUrl}var d=r.get("fileService",a);if(d)return P.imgList=d.list,P.totalItems=d.map.count,P.pageNo=d.map.pageNo,void e.$broadcast("imgList.update");var p=a;a+="&time="+Date.now(),t({withCredentials:!0,method:"GET",url:PREFIX_URL+a}).then(function(t){t.data.success&&(P.imgList=t.data.list,P.totalItems=t.data.map.count,P.pageNo=t.data.map.pageNo,r.push("fileService",p,t.data),e.$broadcast("imgList.update"))})}else i*s<=b.length?P.imgList=b.slice((i-1)*s,i*s):P.imgList=b.slice((i-1)*s,b.length),P.totalItems=b.length,P.pageNo=i,e.$broadcast("imgList.update")}function g(e,t,a,i,r){var s="index.php?c=upfile&a=syslist&";return p(s,e,t,a,i,r)}function h(e,t,a,i,r){var s="index.php?c=upfile&a=syslist&";u(s,e,t,a,i,r)}function f(e,t,a,i,r,s){var o="index.php?c=upfile&a=userList&";return p(o,e,t,a,i,r,s)}function y(e,t,a,i,r){var s="index.php?c=upfile&a=userList&";u(s,e,t,a,i,r)}function m(a){var i="index.php?c=upfile&a=delete",r={id:a};t({withCredentials:!0,method:"POST",url:PREFIX_URL+i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(r)}).then(function(t){t.data.success&&e.$broadcast("files.delete")})}function T(e,a){var i,r="index.php?c=upfile&a=delete";return i=a?{id:e,backup:a}:{id:e},t({withCredentials:!0,method:"POST",url:PREFIX_URL+r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(i)})}function F(e,a){var i="m/base/file/recycle/list?pageNo="+e+"&pageSize="+a;return t({withCredentials:!0,method:"GET",url:PREFIX_URL+i})}function C(e){var a="m/base/file/revoke?id="+e;return t({withCredentials:!0,method:"GET",url:PREFIX_URL+a})}function w(a){var i="index.php?c=tag&a=create",r={tagName:a};t({withCredentials:!0,method:"POST",url:PREFIX_URL+i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(r)}).then(function(t){P.tagList.push({id:t.data.obj,name:a}),e.$broadcast("tagList.update")},function(e){$scope.authError="创建失败"})}function E(){var a="index.php?c=tag&a=my&time"+(new Date).getTime();t({withCredentials:!0,method:"GET",url:PREFIX_URL+a}).then(function(t){t.data.success&&(P.tagList=t.data.list,e.$broadcast("tagList.update"))})}function L(a,i){var r="index.php?c=tag&a=delete",s={id:a};t({withCredentials:!0,method:"POST",url:PREFIX_URL+r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(s)}).then(function(t){t.data.success&&(P.tagList.splice(i,1),e.$broadcast("tagList.delete"))})}function v(a,i){var r="index.php?c=tag&a=set",s={tagId:a,fileIds:i};t({withCredentials:!0,method:"POST",url:PREFIX_URL+r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(s)}).then(function(t){t.data.success&&e.$broadcast("tag.assign")})}function R(a,i){var r="m/base/file/tag/unset",s={tagId:a,fileIds:i};t({withCredentials:!0,method:"POST",url:PREFIX_URL+r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(s)}).then(function(t){t.data.success&&e.$broadcast("tag.unbind")})}function U(e,a,i,s){var o="index.php?c=upfile&a=syslist";if("0"===i&&"2"===s&&(o="index.php?c=upfile&a=userList&"),o+="&pageNo="+(e?e:1),o+="&pageSize="+(a?a:12),i&&"all"!=i&&(o+="&bizType="+(i?i:-1)),o+="&fileType="+(s?s:-1),r.contains("mySounds",o))return r.asyncGet("mySounds",o);r.setAsyncUrl(o);var c=new Date;return o+="&time="+c.getTime(),t({withCredentials:!0,method:"GET",url:PREFIX_URL+o})}function S(e){var a="index.php?c=page&a=crop";return t({withCredentials:!0,method:"POST",url:PREFIX_URL+a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(e)})}function I(e,a){var i="/index.php?c=upfile&a=userList&pageNo="+e+"&pageSize="+a+"&fileType=5&time="+(new Date).getTime();return t({method:"POST",url:PREFIX_URL+i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})}var P={pageNo:1,totalItems:0,sysCategoryList:[],getSysCategory:n,sysTagList:[],getSysMusicCategory:l,userRecycle:F,fileRevoke:C,sysMusicList:[],getSysTagByCatId:d,imgList:[],getSystemFiles:g,getUserFiles:f,getSystemFiles1:h,getUserFiles1:y,tagList:[],createTag:w,getTagList:E,deleteTag:L,assignTag:v,unbindTag:R,deleteFile:m,deleteFile1:T,getFileByCategory:U,getBgColorList:c,cropImage:S,getFilesHistory:s,saveFilesHistory:o,getMyvideo:I,getPictures:u},b=c();return P}]);