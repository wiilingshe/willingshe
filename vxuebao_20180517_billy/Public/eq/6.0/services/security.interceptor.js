angular.module("security.interceptor",["security.retryQueue"]).factory("securityInterceptor",["$injector","$location","securityRetryQueue",function(e,n,t){return function(r){return r.then(null,function(i){return 401===i.status&&(r=t.pushRetryFn("unauthorized-server",function(){return e.get("$http")(i.config)})),403===i.status&&(alert("对不起，您没有查看此内容的权限"),n.path("/home")),r})}}]).config(["$httpProvider",function(e){e.responseInterceptors.push("securityInterceptor");var n=[PREFIX_URL+"login",PREFIX_URL+"index.php?c=scene&a=createpage&id=",PREFIX_URL+"m/scene/pageList",PREFIX_URL+"index.php?c=upfile&a=upload",PREFIX_URL+"m/c/group/create",PREFIX_URL+"index.php?c=scene&a=my",PREFIX_URL+"index.php?c=scene&a=syslist",PREFIX_URL+"index.php?c=scene&a=saveSettings",PREFIX_URL+"m/scene/stat"];e.interceptors.push(["$q",function(e){var t=0;return{request:function(r){var u=r.url;for(i=0;i<n.length;i++)0===u.indexOf(n[i])&&($("#loading").show(),t++);return r||e.when(r)},response:function(r){var u=r.config.url;for(i=0;i<n.length;i++)0===u.indexOf(n[i])&&(t--,t||$("#loading").hide());return r||e.when(r)}}}])}]);