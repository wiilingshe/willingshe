angular.module("services.file.upload",["angularFileUpload","services.file"]).factory("uploaderService",["$rootScope","$http","$interval","FileUploader","fileService","$translate",function(e,a,n,i,t,l){var r,o={};return o.uploader=function(a,t){var o=6;(2==a||4==a)&&(r=PREFIX_URL+"index.php?c=upfile&a=upload&bizType=0&fileType="+a);var u,p=new i({url:r,withCredentials:!0,queueLimit:o,onAfterAddingAll:function(a){e.$broadcast("uploadfiles.add"),p.uploadAll()},onSuccessItem:function(i,t,l,r){function o(){n.cancel(u)}var u=n(function(){var n=null;i.progress>=100&&(n=4==a?{id:t.obj.id,src:t.obj.path,name:t.obj.name,size:t.obj.size}:2==a?{id:t.obj.id,url:t.obj.path,name:t.obj.name,size:t.obj.size}:{tmbPath:t.obj.tmbPath,id:t.obj.id,path:t.obj.path,name:t.obj.name},e.$broadcast("thumbnailList.update",n),o())},100)}}),s=t||5145728;return"0"==a||"1"==a?u="|jpg|png|jpeg|bmp|gif|svg+xml|webp|":"4"!=a&&"2"!=a||(u="|wav|mp3|mpeg|"),p.filters.push({name:"imageFilter",fn:function(e,a){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!==u.indexOf(n)}}),p.filters.push({name:"imageSizeFilter",fn:function(e,a){var n=e.size;return console.log(s),n>=s&&alert(l.instant("upload.SIZE_TIP1")+s/1024/1024+l.instant("upload.SIZE_TIP2")),s>n}}),p.filters.push({name:"fileNameFilter",fn:function(e,a){return e.name.length>50&&alert(l.instant("upload.NAME_LENGTH")),e.name.length<=50}}),p},o}]);