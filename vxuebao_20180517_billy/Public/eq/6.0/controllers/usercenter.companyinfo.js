angular.module("usercenter.companyinfo",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.companyinfo").controller("companyInfoCtrl",["$scope","$modal","userinfo","usercenterService","i18nNotifications",function(e,n,o,i,c){e.companyUserInfo={},e.designerUserInfo={},e.companyUserInfo.nick=o.nick,e.type=o.type,e.pid={};var s=function(){i.getDesignerUserInfo().then(function(n){e.designerUserInfo=n.data.obj}),i.getProvince().then(function(n){e.provinces=n.data})},t=function(){i.getCompanyInfo().then(function(n){e.companyUserInfo=n.data.obj})};e.getProvinceInfo=function(n,o){if(e.pid=n,e.name=o,e.cities=[],console.log("a.pid "+e.pid+"11111"),void 0==e.pid)e.cities=[],e.designerUserInfo.proid="",e.designerUserInfo.proname="";else{e.designerUserInfo.proid=e.pid,e.designerUserInfo.proname=e.name;var i=PREFIX_URL+"index.php?c=Designer&a=getcity&pid="+e.pid;$.get(i,function(n){n=JSON.parse(n),e.cities=n,e.$apply(),console.log(e.cities)})}},e.getCityInfo=function(n,o){e.designerUserInfo.cityid=n,e.designerUserInfo.cityname=o,console.log("a.cid "+n),console.log("a.name "+o)},e.clearProvinceInfo=function(){e.$apply(function(){e.designerUserInfo.proid="",e.designerUserInfo.proname=""})},e.clearCityInfo=function(){e.$apply(function(){e.designerUserInfo.cityid="",e.designerUserInfo.cityname=""})},e.checkEmail=function(n){var o=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return n.email&&!o.test(n.email)?(e.authError="请正确填写邮箱",!1):(e.authError="",!0)},2==e.type&&(t(),e.title="企业会员基本信息"),1==e.type||12==e.type&&(e.title="个人用户基本信息"),3==e.type&&(e.title="高级用户基本信息"),22==e.type&&(s(),e.title="设计师基本信息"),e.saveUserInfo=function(n){n.id=o.id,i.saveUserInfo(n).then(function(o){o.data.success&&(e.$close(n),c.pushForCurrentRoute("save.success","notify.success"))})},e.saveCompanyInfo=function(n){return!!e.checkEmail(n)&&(n.nick=e.companyUserInfo.nick,void i.saveCompanyInfo(n).then(function(o){o.data.success?(c.pushForCurrentRoute("account.success","notify.success"),e.$close(n)):e.codeError=o.data.msg}))},e.saveDesignerInfo=function(n){return!!e.checkEmail(n)&&(n.nick=e.designerUserInfo.nick,void i.saveDesignerInfo(n).then(function(o){o.data.success?(c.pushForCurrentRoute("account.success","notify.success"),e.$close(n)):e.codeError=o.data.msg}))},e.cancel=function(){e.$close()},e.invoice=function(){n.open({windowClass:"six-contain",templateUrl:BASE_URL+"templates/usercenter.console.invoice.tpl.html",controller:"InvoiceCtrl",scope:e,resolve:{userinfo:function(){return{}}}}).result.then(function(e){},function(){})}}]);