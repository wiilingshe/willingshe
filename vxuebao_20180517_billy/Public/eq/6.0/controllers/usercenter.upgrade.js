angular.module("usercenter.upgrade",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.upgrade").controller("UsercenterupgradeCtrl",["$rootScope","$scope","$window","$translate","usercenterService","security","$modal","ModalService","i18nNotifications","$timeout","user",function(e,r,c,o,t,n,a,s,i,u,m){function d(){0===l?(r.isCodeAccessiable=!1,r.codeTip=o.instant("usercenter.account.CODE_TIP1"),l=60):(r.isCodeAccessiable=!0,r.codeTip=o.instant("usercenter.account.CODE_TIP2")+"("+l+")",u(function(){l--,d()},1e3))}r.companyInfo={id:m.id},r.checkName=function(e){return e.name?countCharacters(e.name)>40?(r.nameError="企业名称不能超过40个字符",!1):(r.nameError="",!0):(r.nameError="请填写企业名称",!1)},r.checkEmail=function(e){var c=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return e.email&&!c.test(e.email)?(r.emailError="请正确填写邮箱",!1):e.email?(r.emailError="",!0):(r.emailError="请填写企业邮箱",!1)},r.checkcontacts=function(e){return e.contacts?countCharacters(e.contacts)>30?(r.contactsError="联系人不能超过30个字符",!1):(r.contactsError="",!0):(r.contactsError="请填写联系人",!1)},r.checkCode=function(e){return e.code?(r.codeError="",!0):(r.codeError="请输入手机验证码",!1)},r.getCode=function(e){return e.mobile?(r.telError="",void t.companyMobile(e.mobile).then(function(e){e.data.success?d():r.telError=e.data.msg})):(r.telError="请填写手机号码",!1)};var l=60;r.checkFormFormat=function(e){return!!(r.checkName(e)&&r.checkEmail(e)&&r.checkcontacts(e)&&r.checkCode(e))},r.upgradeCompanyMessage=function(c){r.checkFormFormat(c)&&t.saveCompanyInfo(c).then(function(o){o.data.success?(i.pushForCurrentRoute("account.success","notify.success"),e.$broadcast("companyState"),r.$close(c.mobile)):r.codeError=o.data.msg})},r.quXiao=function(){r.$dismiss()}}]);