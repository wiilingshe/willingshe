angular.module("message",[]),angular.module("message").controller("MessageCtrl",["$scope","$rootScope","usercenterService",function(e,t,a){e.toPage=1,e.currentPage=1,e.pageSize=6,e.branchs=[{name:"其他",value:"0"},{name:"系统公告",value:"1"},{name:"审核通知",value:"2"}],e.getNewsType=function(){e.getUserMsg(e.type)},e.getUserMsg=function(){e.unread=0;var t={pageNo:e.toPage,pageSize:e.pageSize,type:e.type&&e.type.value?e.type.value:null};a.getNewMessage(t).then(function(t){angular.forEach(t.data.list,function(t,a){0==t.bizType?t.type="其他":1==t.bizType?t.type="系统公告":2==t.bizType&&(t.type="审核通知"),1==t.status&&e.unread++}),e.Msgs=t.data.list,e.msgCount=t.data.map.count,e.msgNumPages=Math.ceil(e.msgCount/e.pageSize),e.currentPage=t.data.map.pageNo})},e.getUserMsg(),e.pageChanged=function(t){return e.selected&&(e.selected=!e.selected),e.toPage=t,1>t||t>e.msgCount/6+1?void alert("此页超出范围"):void e.getUserMsg()},e.selected=!1,e.news={};var n,s=[];e.selectAllMsg=function(t){s=[],n=null,e.selected=!e.selected,e.selected?(angular.forEach(t,function(t,a){1==t.status&&s.push(t.id),e.news[t.id]=t,e.news[t.id].show=!0}),n=s.join()):(angular.forEach(t,function(t,a){e.news[t.id]=t,e.news[t.id].show=!1}),s=[],n=null)},e.selectMsg=function(t){if(e.news[t.id]=t,e.news[t.id].show=!e.news[t.id].show,e.news[t.id].show)1==t.status&&s.push(t.id);else if(s.length>0)for(var a=0;a<s.length;a++)s[a]==t.id&&s.splice(a,1);n=s.join()},e.setRead=function(u){n?a.setRead(n).then(function(a){200==a.data.code&&(t.$broadcast("minusCount",s.length),e.newMsgCount=0,angular.forEach(u,function(t,a){for(var n=0;n<s.length;n++)parseInt(s[n])==parseInt(t.id)&&(s.splice(n,1),t.status=0,e.unread>0&&e.unread--)}))}):alert("没有未读信息！")}}]);