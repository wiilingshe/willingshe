angular.module("usercenter.relRegisterAccount",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.relRegisterAccount").controller("RelRegisterAccountCtrl",["$rootScope","$scope","$window","$stateParams","usercenterService","security","$modal","ModalService","$location","userinfo","i18nNotifications","localizedMessages","$translate",function(e,r,s,t,n,c,a,u,o,i,l,E,g){r.user=i,r.user.agreement=!0;var R=!1;r.cancel=function(){r.$dismiss("cancel")},r.registerAccount=function(){if(r.userNotExist&&r.checkUsername()&&r.checkPassword()&&r.checkRepeatPassword())if(r.user.password===r.user.repeatPassword&&r.user.agreement){if(R)return;R=!0,n.relAccount(i.id,r.user.email,r.user.password,!0).then(function(e){if(R=!1,200==e.data.code){l.pushForCurrentRoute("email.save.success","notify.success"),/qq/gi.test(r.user.loginName)&&(r.relType="qq"),/weixin/gi.test(r.user.loginName)&&(r.relType="weixin"),/weibo/gi.test(r.user.loginName)&&(r.relType="weibo");var s={type:r.relType,email:angular.copy(r.user.email)};r.$close(s)}else r.relErr=e.data.msg},function(e){R=!1,r.regErr=E.get("register.error.serverError",{exception:x}),r.$dismiss()})}else r.user.password!=r.user.repeatPassword?r.regErr=E.get("register.error.match"):r.regErr=E.get("register.error.agreement")},r.checkUsername=function(){if(r.user.email){if(/^[-_a-z0-9\.@]{6,40}$/g.test(r.user.email))return r.checkUniqueness(r.user.email),!0;r.usernameError=g.instant("usercenter.account.REG_ACCOUNT_ERR2")}else r.usernameError=g.instant("usercenter.account.REG_ACCOUNT_ERR1");return!1},r.checkUniqueness=function(e){c.checkUniqueness(e).success(function(e){r.userNotExist=e.success,r.userNotExist?r.usernameError=null:r.usernameError=g.instant("usercenter.account.REG_ACCOUNT_ERR3")})},r.checkPassword=function(){if(r.user.password){if(/^[a-zA-Z0-9]{6,16}$/g.test(r.user.password))return r.passError=null,!0;r.passError=g.instant("usercenter.account.REG_PWD_ERR2")}else r.passError=g.instant("usercenter.account.REG_PWD_ERR1");return!1},r.checkRepeatPassword=function(){if(r.user.repeatPassword){if(r.user.repeatPassword==r.user.password)return r.rPassError="",!0;r.rPassError=g.instant("usercenter.account.REG_PWD_ERR4")}else r.rPassError=g.instant("usercenter.account.REG_PWD_ERR3");return!1}}]);