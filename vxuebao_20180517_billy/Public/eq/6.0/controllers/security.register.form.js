angular.module("security.register.form",["services.localizedMessages","app.directives.register","security.thirdparty"]),angular.module("security.register.form").controller("RegisterFormController",["$scope","$timeout","security","localizedMessages","$location","$http","$window","thirdpartyService","regMsg",function(e,r,s,t,o,i,n,a,c){c?e.user=c:e.user={},e.user.agreement=!0,e.regErr="注册一个有效的账号，更好体验功能";var u=!1;e.openWeibo=function(){alert("新浪微博注册功能即将开放")},e.register=function(){var r={loginName:e.user.email,password:e.user.password};e.userNotExist&&e.checkUsername()&&e.checkPassword()&&e.checkRepeatPassword()&&l&&l.then(function(){if(e.user.password===e.user.repeatPassword&&e.user.agreement){if(u)return;u=!0;var o="";location.hash.indexOf("?")>=0&&(o=location.hash.replace("#/home/register","")),s.register($.param(r),o).then(function(r){u=!1,r&&(e.regErr=r.msg)},function(r){u=!1,e.regErr=t.get("register.error.serverError",{exception:r})})}else e.user.password!=e.user.repeatPassword?e.regErr=t.get("register.error.match"):e.regErr=t.get("register.error.agreement")})};var l=null;e.checkUniqueness=function(r){l=s.checkUniqueness(r).success(function(r){e.userNotExist=r.success,e.userNotExist?e.usernameError=null:e.usernameError="账号已存在，请重新填写"})},e.checkIconUser="",e.checkIconPass="",e.checkIconRePass="",e.checkUsername=function(){if(e.user.email){if(/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(e.user.email))return e.checkUniqueness(e.user.email),!0;e.usernameError="账号为6-40个字符(英文字母或数字，只支持小写)以及-_@.的组合"}else e.usernameError="账号不能为空";return!1},e.checkPassword=function(){if(e.user.password){if(/^[a-zA-Z0-9]{6,16}$/g.test(e.user.password))return e.passError=null,!0;e.passError="密码为6~16个字符(英文字母或数字，区分大小写)"}else e.passError="密码不能为空";return!1},e.checkRepeatPassword=function(){if(e.user.repeatPassword){if(e.user.repeatPassword==e.user.password)return e.rPassError="",!0;e.rPassError="两次密码输入不一致，请重新输入"}else e.rPassError="确认密码不能为空";return!1},e.openLogin=function(){o.path("/home/login",!1)},e.reset=function(){e.user={}},e.openThirdPatyWindow=function(e){s.cancelRegister(),a.openThirtyPartyWindow(e)}}]).controller("BindingController",["$rootScope","$scope","$timeout","security","localizedMessages","$location","$http","$window",function(e,r,s,t,o,i,n,a){r.qq_url="https://graph.qq.com/oauth2.0/authorize?response_type=token&client_id="+client_id+"&redirect_uri="+redirect_uri+"&display=pc",r.weibo_url="https://api.weibo.com/oauth2/authorize?client_id=3508809852&response_type=token&redirect_uri="+PREFIX_HOST}]);