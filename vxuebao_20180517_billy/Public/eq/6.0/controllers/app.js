angular.module("app",["ui.router","security.authorization","ui.select","pascalprecht.translate","oc.lazyLoad","services.config","services.i18nNotifications","services.usercenter","app.directives.rightclick"]),angular.module("app").config(["$stateProvider","$locationProvider","securityAuthorizationProvider","uiSelectConfig","$translateProvider","$provide","$httpProvider",function(e,n,o,t,s,a,i){t.theme="bootstrap",s.useStaticFilesLoader({prefix:PREFIX_URL+"assets/languages/",suffix:".json"});var r="zh-CN";"en-US"==r&&$(document.body).addClass("en"),s.preferredLanguage(r),i.interceptors.push(["$translate","$rootScope",function(e,n){var o=r.replace("-","_");return n.$on("$translateChangeSuccess",function(){o=e.use(),o&&(o=o.replace("-","_"))}),{request:function(e){return o&&(e.headers["Accept-Language"]=o),e||$q.when(e)},response:function(e){return e||$q.when(e)}}}])}]),angular.module("app").run(["security","$rootScope","configService",function(e,n,o){n.CLIENT_CDN=CLIENT_CDN,n.PREFIX_FILE_HOST=PREFIX_FILE_HOST,n.PREFIX_SERVER_HOST=PREFIX_URL,n.PREFIX_CLIENT_HOST=PREFIX_HOST,n.PREFIX_S3_URL=PREFIX_S3_URL,e.requestCurrentUser(),n.tuijian_url=tuijian_url,n.tuijian_pic_url=tuijian_pic_url,n.your_demain_beian=your_demain_beian,n.your_demain=your_demain,n.your_huisi_pic_url=your_huisi_pic_url,n.logoSrc=CLIENT_CDN+"assets/images/logo.png",o.getLogo().then(function(e){try{n.logoSrc=e.data}catch(e){n.logoSrc=CLIENT_CDN+"assets/images/logo.png"}},function(){n.logoSrc=CLIENT_CDN+"assets/images/logo.png"}),n.load2=function(){$("#eq_main").scroll(function(){s=$("#eq_main").scrollTop(),s>100?$(".scroll").css("display","block"):$(".scroll").css("display","none")})},n.appIconDown=!0,n.downApp=function(){n.appIconDown=!1},n.closeDown=function(){n.appIconDown=!0},n.appIconDown=!0,n.downApp=function(){n.appIconDown=!1},n.closeDown=function(){n.appIconDown=!0},n.appIconDown=!0,n.downApp=function(){n.appIconDown=!1},n.closeDown=function(){n.appIconDown=!0},n.goTop=function(){$("#eq_main").scrollTop(0)},n.$on("$stateChangeSuccess",function(e,o){o.$$state&&(n.feedBackUrl=o.$$state.feedBackUrl)})}]),angular.module("app").run(["$state","$rootScope","$location",function(e,n,o){n.$on("$locationChangeStart",function(){n.branchid&&o.search("branchid",n.branchid),$(".modal").remove(),$(".modal-backdrop").remove()});var t=o.path;o.path=function(s,a){if(a===!1){var i=e.current;h=n.$on("$locationChangeSuccess",function(){e.current=i,h()})}return t.apply(o,[s])}}]),angular.module("app").run(["$templateCache",function(e){e.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n    <ol class="carousel-indicators" ng-show="slides.length > 1">\n        <li ng-repeat="slide in slides track by $index" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="prev eqf-chevron-small-left" ng-click="prev()" ng-show="slides.length > 1"></a>\n    <a class="next eqf-chevron-small-right" ng-click="next()" ng-show="slides.length > 1"></a>\n</div>\n')}]),angular.module("app").controller("AppCtrl",["$translate","$window","$rootScope","$location","$state","$modal","security","$stateParams","$timeout","i18nNotifications","usercenterService","$modalStack","$ocLazyLoad",function(e,n,t,s,a,i,r,c,u,l,p,d,h){function g(){return sessionStorage.getItem("sysMsgHasRead")}function f(e){p.getNewMessage(e).then(function(e){for(var n=0;n<e.data.list.length;n++)1==e.data.list[n].status&&1==e.data.list[n].bizType&&(t.sysMsgs.length<6&&t.sysMsgs.push(e.data.list[n]),t.sysNewCount++),1==e.data.list[n].status&&(t.newMsgs.length<6&&t.newMsgs.push(e.data.list[n]),t.newMsgCount++)})}t.newMsgCount=0,t.sysNewCount=0,t.openSysMsg=!1,t.openSysMsgDialog=!g(),t.closeSysMsgDialog=function(){t.openSysMsgDialog=!t.openSysMsgDialog,sessionStorage.setItem("sysMsgHasRead","true")},t.notifications=l,t.removeNotification=function(e){l.remove(e)},n.setValue=function(e){t.thirdpartyLoginParam=e,t.$apply()},t.$watch("thirdpartyLoginParam",function(e,n){h.load("services/security.thirdparty").then(function(){e&&(e.state&&/WECHAT_STATE/.test(e.state)?o.weiChatLogin(e.code).then(function(e){200==e.data.code&&(s.path("main"),r.setLoginSuccess(!0))}):o.qqLogin(e.access_token,e.expires_in))})}),t.$on("$locationChangeStart",function(e){if("/home/login"!=s.path()||r.currentUser?0!==s.path().indexOf("/home/register")||r.currentUser||r.showRegister(m):r.showLogin(),r.isAuthenticated()&&("/home"==s.path()||"/home/login"==s.path())&&s.path("main"),s.search().resetToken){var n=s.search().resetToken;r.requestResetPassword(n)}var o=d.getTop();o&&d.dismiss(o.key)}),t.openLogin=function(){s.path("/home/login",!1)};var m;t.openRegister=function(e){m=e,s.path("/home/register",!1)},t.isAuthenticated=r.isAuthenticated,s.search().branchid&&(t.branchid=s.search().branchid),t.sysMsgs=[],t.newMsgs=[],t.$watch(function(){return r.currentUser},function(e){e&&(t.user=e,t.user=e,t.userProperty=e,t.isEditor=r.isEditor(),t.isEditor=r.isEditor(),t.isAdvancedUser=r.isAdvancedUser(),t.isAdvancedUser=r.isAdvancedUser(),t.isVendorUser=r.isVendorUser(),t.isVendorUser=r.isVendorUser(),t.$broadcast("currentUser",e),r.isAuthenticated()&&(("/home"==s.path()||"/home/login"==s.path())&&s.path("main"),f({})))},!0),t.$on("addBranch",function(e,n){for(var o=0;o<t.userbranches.length;o++)if(n.id==t.userbranches[o].id)return;t.userbranches.unshift(n)}),t.showBoardsDropdown=function(){t.isProjectsDropdownVisible=!0},t.hideBoardsDropdown=function(){t.isProjectsDropdownVisible=!1};var w=$(document);w.scroll(function(){var e=w.scrollTop();e>180?$(".header-contain",w).addClass("head-shadow"):$(".header-contain",w).removeClass("head-shadow")}),t.$watch("branchid",function(){t.hideOpea=!!t.branchid}),t.openReg=function(){i.open({windowClass:"request_contain",templateUrl:"usercenter/request_reg.tpl.html",controller:"UsercenterrequestCtrl",resolve:{}}).result.then(function(){},function(){})},t.login=function(){r.showLogin()},t.register=function(){r.showRegister()},t.showToolBar=function(){return s.$$path.indexOf("/scene/create")<0},t.showPanel=function(){$("#helpPanel").stop().animate({right:"0"},500)},t.hidePanel=function(){$("#helpPanel").stop().animate({right:"-120"},500)},t.suggestionUrl="http://bbs.e.wesambo.com/forum.php?mod=forumdisplay&fid=45",t.feedbackUrl="http://bbs.e.wesambo.com/forum.php?mod=forumdisplay&fid=46",t.qqChatUrl="http://shang.qq.com/wpa/qunwpa?idkey=4a2d63670009360b878aa9a1e1437ef4caec132f74a0e2c4df4a686168cc73dc",t.helpUrl="http://bbs.e.wesambo.com/forum.php",t.createSkillUrl="http://bbs.e.wesambo.com/forum.php?gid=37",t.safeApply=function(e){var n=this.$root.$$phase;"$apply"==n||"$digest"==n?e&&"function"==typeof e&&e():this.$apply(e)},t.changeLanguage=function(n){e.use(n),window.localStorage.setItem("preferredLanguage",n),a.reload(),"en-US"===n?$(document.body).addClass("en"):$(document.body).removeClass("en")}}]).filter("fixnum",["$translate",function(e){return function(n){var o=n;return n>=1e4&&1e8>n?o=(n/1e4).toFixed(1)+e.instant("UNIT1"):n>=1e8&&(o=(n/1e8).toFixed(1)+e.instant("UNIT2")),o}}]);