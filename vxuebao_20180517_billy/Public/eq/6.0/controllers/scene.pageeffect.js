angular.module("scene.pageeffect.fall",[]),angular.module("scene.pageeffect.fall").controller("fallEffectCtrl",["$scope","$translate",function(e,a){e.fallingName="福字";var t=e.properties;e.fallings=[{name:"福字",path:"assets/images/create/fallings/fuzi1.png",rotate:180,vy:3},{name:"红包",path:"assets/images/create/fallings/hongbao2.png",rotate:180,vy:3},{name:"绿枫叶",path:"assets/images/create/fallings/lvfengye.png",rotate:180,vy:3},{name:"星星",path:"assets/images/create/fallings/xing.png",rotate:180,vy:3},{name:"雪花",path:"assets/images/create/fallings/snow.png",rotate:0,vy:1}],t&&t.fallingObject?(e.controlView.effectType="fallingObject",e.falling=t.fallingObject,angular.forEach(e.fallings,function(a,t){a.path==e.falling.src.path&&(e.falling.src=a)})):e.falling={src:e.fallings[0],density:2},e.changeImg=function(a){e.falling.src=a,e.fallingName=a.name},e.$on("save.falling.effect",function(){t={},t.fallingObject=e.falling,e.$close({properties:t,name:"落物",value:"fallingObject"})})}]),angular.module("scene.pageeffect.finger",[]),angular.module("scene.pageeffect.finger").controller("fingerEffectCtrl",["$scope","$translate",function(e,a){e.fingerBgName="粉红回忆",e.fingerName="粉色指纹";var t,c=e.properties;e.fingerZws=[{name:"粉色指纹",path:"assets/images/create/fingers/zhiwen1.png"},{name:"白色指纹",path:"assets/images/create/fingers/zhiwen2.png"},{name:"蓝色指纹",path:"assets/images/create/fingers/zhiwen3.png"}],e.fingerBackgrounds=[{name:"粉红回忆",path:"assets/images/create/fingers/bg1.jpg"},{name:"深蓝花纹",path:"assets/images/create/fingers/bg2.jpg"},{name:"淡绿清新",path:"assets/images/create/fingers/bg3.jpg"},{name:"深紫典雅",path:"assets/images/create/fingers/bg4.jpg"},{name:"淡紫水滴",path:"assets/images/create/fingers/bg5.jpg"},{name:"蓝白晶格",path:"assets/images/create/fingers/bg6.jpg"},{name:"蓝色水滴",path:"assets/images/create/fingers/bg7.jpg"},{name:"朦胧绿光",path:"assets/images/create/fingers/bg8.jpg"},{name:"灰色金属",path:"assets/images/create/fingers/bg9.jpg"}],c&&c.finger?(e.controlView.effectType="finger",e.finger=c.finger,angular.forEach(e.fingerZws,function(a,t){a.path==e.finger.zwImage.path&&(e.finger.zwImage=a)}),angular.forEach(e.fingerBackgrounds,function(a,t){a.path==e.finger.bgImage.path&&(e.finger.bgImage=a)})):e.finger={zwImage:e.fingerZws[0],bgImage:e.fingerBackgrounds[0]},t=angular.copy(e.finger.bgImage),e.changeImg=function(a){e.finger.bgImage=a,e.replaceImg(e.finger)},e.changeFingerType=function(a){e.finger.zwImage=a,e.fingerName=a.name},e.replaceImg=function(a){return a.bgImage?(e.fingerBgName=a.bgImage.name,void(t=angular.copy(e.finger.bgImage))):(e.fingerBgName="自定义",void e.$emit("select.effect.image","finger"))},e.$on("replace.effect.image",function(a,c,n){"finger"==n&&(e.finger.bgImage||(e.finger.bgImage={}),e.finger.bgImage.path=PREFIX_FILE_HOST+c.data,e.fingerBackgrounds[0].name||e.fingerBackgrounds.shift(),e.fingerBackgrounds.unshift(e.finger.bgImage),t=angular.copy(e.finger.bgImage))}),e.$on("cancel.effect.replace",function(a,c){"finger"==c&&angular.forEach(e.fingerBackgrounds,function(a,c){t.name?t.name==a.name&&(e.finger.bgImage=a):a.name||(e.finger.bgImage=a)})}),e.$on("save.finger.effect",function(){c={},c.finger=e.finger,e.$close({properties:c,name:"指纹",value:"finger"})})}]).directive("fingerMove",function(){function e(e,a,t){a.css({animation:"move 2s ease 0","animation-iteration-count":"infinite"})}return{restrict:"EA",link:e}}),angular.module("scene.pageeffect.fireworks",[]),angular.module("scene.pageeffect.fireworks").controller("fireWorksCtrl",["$scope","$translate",function(e,a){var t=e.properties;t&&t.effect&&"fireWorks"==t.effect.name&&(e.controlView.effectType="fireWorks",e.controlView.effectIndex=5),e.$on("save.fireworks.effect",function(){t={},t.effect={name:"fireWorks"},e.$close({properties:t,name:"烟花",value:"effect"})})}]),angular.module("scene.pageeffect.money",[]),angular.module("scene.pageeffect.money").controller("moneyEffectCtrl",["$scope","$translate",function(e,a){var t=e.properties;t&&t.effect&&"money"==t.effect.name?(e.controlView.effectType="money",e.money={tip:t.effect.tip}):e.money={tip:"握紧钱币，数到手抽筋吧"},e.$on("save.money.effect",function(){t={},t.effect={name:"money",tip:e.money.tip},e.$close({properties:t,name:"数钱",value:"effect"})})}]),angular.module("scene.pageeffect.none",[]),angular.module("scene.pageeffect.none").controller("noneEffectCtrl",["$scope","$translate",function(e,a){var t=e.properties;t&&t.effect&&"none"==t.effect.name&&(e.controlView.effectType="none"),e.$on("save.none.effect",function(){t={},t.effect={name:"none"},e.$close({name:"无"})})}]),angular.module("scene.pageeffect.scratch",["common.directives.inputNumber","scene.pageeffect.filter"]),angular.module("scene.pageeffect.scratch").controller("scratchEffectCtrl",["$scope","$rootScope","$translate","i18nNotifications",function(e,a,t,c){var n,r=e.properties;e.scratchName="水滴",e.scratches=[{name:"水滴",path:"assets/images/create/waterdrop.jpg"},{name:"细沙",path:"assets/images/create/sand.jpg"},{name:"花瓣",path:"assets/images/create/flowers.jpg"},{name:"金沙",path:"assets/images/create/goldsand.jpg"},{name:"白雪",path:"assets/images/create/snowground.jpg"},{name:"模糊",path:"assets/images/create/mohu.jpg"},{name:"落叶",path:"assets/images/create/leaves.jpg"},{name:"薄雾",path:"assets/images/create/smoke.png"}],r&&(r.image||r.scratch)?(e.controlView.effectType="scratch",(r.image||r.scratch)&&(r.scratch?(e.scratch=r.scratch,r.scratch.percentage.value&&(e.scratch.percentage=r.scratch.percentage.value),r.scratch.opacity||(e.scratch.opacity=.2)):r.image&&(e.scratch={image:r.image,percentage:r.percentage.value},r.tip&&(e.scratch.tip=r.tip),e.scratch.opacity=.2),angular.forEach(e.scratches,function(a,t){e.scratch.image.name==a.name&&(e.scratch.image=a)}),e.scratch.image.name||e.scratches.unshift(e.scratch.image))):e.scratch={image:e.scratches[0],percentage:.15,opacity:.2};var s=e.$watch("scratch.opacity",function(t,c){a.$broadcast("show.scratch.draw",e.scratch)},!0);setTimeout(function(){n=angular.copy(e.scratch.image),a.$broadcast("show.scratch.draw",e.scratch,!1)},0),e.$on("$destroy",function(){s()}),e.changeImg=function(a){e.scratch.image=a,e.replaceImage(e.scratch)},e.replaceImage=function(t){return t.image?(e.scratchName=t.image.name,n=angular.copy(e.scratch.image),void a.$broadcast("show.scratch.draw",t,!1)):(e.scratchName="自定义",void e.$emit("select.effect.image","scratch"))},e.$on("replace.effect.image",function(t,c,r){"scratch"==r&&(e.scratch.image||(e.scratch.image={}),e.scratch.image.path=PREFIX_FILE_HOST+c.data,e.scratches[0].name||e.scratches.shift(),e.scratches.unshift(e.scratch.image),n=angular.copy(e.scratch.image),a.$broadcast("show.scratch.draw",e.scratch,!1))}),e.$on("cancel.effect.replace",function(a,t){"scratch"==t&&angular.forEach(e.scratches,function(a,t){n.name?n.name==a.name&&(e.scratch.image=a):a.name||(e.scratch.image=a)})}),e.$on("save.scratch.effect",function(){return r={},r.scratch=e.scratch,r.scratch.percentage>1?void c.pushForCurrentRoute("scratch.percentage.overflow","notify.success"):(a.$broadcast("clear.scratch.interval"),void e.$close({properties:r,name:"涂抹",value:"scratch"}))})}]).directive("scratchEffect",function(){function e(e,c,n){var r=new Image;e.$on("show.scratch.draw",function(e,t,c){r.onload=function(){a(this,t)},r.src=t.image.path}),e.$on("change.scratch.opacity",function(e,a){$(".scratch-img").css({opacity:1-parseFloat(a).toFixed(2)})}),e.$on("clear.scratch.interval",function(e){clearInterval(t)})}function a(e,r){t&&clearInterval(t);var s='<canvas class="scratchCanvas" style="position:absolute; top: 0; left: 0;" width="196" height="308"></canvas>',o=$(".scratch-img");o.empty(),o.append(s),c=o.find("canvas").get(0);try{if(c)if(c.getContext){var f=c.getContext("2d");f?(console.log("Context 2D available."),n=c.getContext("2d"),n.lineCap="round",n.lineJoin="round",n.lineWidth=20,n.globalAlpha=1-parseFloat(r.opacity).toFixed(2),n.drawImage(e,0,0,c.width,c.height),n.globalCompositeOperation="destination-out"):console.log("Context 2D not available.")}else console.log("Context not supported.");else console.log("Canvas not found.")}catch(e){console.log(e)}var i=130,g=80;t=setInterval(function(){n.moveTo(i,g),i>=70&&140>=g?(n.lineTo(i-2,g+2),n.stroke(),i-=2,g+=2):120>=i&&165>=g?(n.lineTo(i+2,g+1),n.stroke(),i+=2,g+=1):i>=70&&215>=g?(n.lineTo(i-2,g+2),n.stroke(),i-=2,g+=2):(clearInterval(t),a(e,r))},50)}var t,c,n;return{restrict:"EA",link:e}}),angular.module("scene.pageeffect.snow",[]),angular.module("scene.pageeffect.snow").controller("snowEffectCtrl",["$scope","$translate",function(e,a){var t=e.properties;t&&t.effect&&"snowFly"==t.effect.name&&(e.controlView.effectType="snowFly"),e.$on("save.snow.effect",function(){t={},t.effect={name:"snowFly"},e.$close({properties:t,name:"飘雪",value:"effect"})})}]),angular.module("scene.pageeffect.console",["scene.pageeffect.scratch","scene.pageeffect.finger","scene.pageeffect.money","scene.pageeffect.fall","scene.pageeffect.snow","scene.pageeffect.fireworks","scene.pageeffect.none","scene.pageeffect.filter"]),angular.module("scene.pageeffect.console").controller("pageEffectCtrl",["$scope","$rootScope","$modal","$translate","properties","sceneService",function(e,a,t,c,n,r){e.properties=n,e.controlView={},e.effectList=[{type:"scratch",name:"涂抹",src:"assets/images/create/waterdrop.jpg"},{type:"finger",name:"指纹",src:"assets/images/create/fingers/zhiwen1.png"},{type:"money",name:"数钱",src:"assets/images/create/money_thumb1.jpg"},{type:"fallingObject",name:"环境",src:"assets/images/create/falling.png"},{type:"snowFly",name:"飘雪",src:"assets/images/create/snowfly.png"},{type:"fireWorks",name:"烟花",src:"assets/images/create/fireworks.jpg"}],n&&(!n||n.scratch||n.finger||n.fallingObject||n.effect)||(n={},e.controlView.effectType="scratch",e.controlView.effectIndex=0),e.selectEffect=function(a,t){e.controlView.effectType=a.type,e.controlView.effectIndex=t},e.confirm=function(){switch(e.controlView.effectType){case"scratch":e.$broadcast("save.scratch.effect");break;case"finger":e.$broadcast("save.finger.effect");break;case"money":e.$broadcast("save.money.effect");break;case"fallingObject":e.$broadcast("save.falling.effect");break;case"snowFly":e.$broadcast("save.snow.effect");break;case"fireWorks":e.$broadcast("save.fireworks.effect")}},e.$on("select.effect.image",function(e,c){t.open({windowClass:"console img_console",templateUrl:BASE_URL+"templates/scene.console.bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:0}}}}).result.then(function(e){var t={type:3,properties:{src:e.data}};e.height/e.width>=1008/642&&e.height/e.width<=1.578125?a.$broadcast("replace.effect.image",e,c):r.openCropModal(t,function(e){var t={data:e.src};a.$broadcast("replace.effect.image",t,c)},function(){a.$broadcast("cancel.effect.replace",c)})},function(e){a.$broadcast("cancel.effect.replace",c)})}),e.cancel=function(){a.$broadcast("clear.scratch.interval"),e.$dismiss()},e.clearPageEffect=function(){e.$broadcast("save.none.effect")}}]);