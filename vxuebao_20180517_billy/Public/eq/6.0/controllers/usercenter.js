angular.module("usercenter",["usercenter.transfer","usercenter.upgrade","usercenter.request","services.usercenter","services.localizedMessages","security.service","app.directives.addelement","services.modal","usercenter.relAccount","usercenter.branch","services.i18nNotifications","security.thirdparty","usercenter.branch.reset","usercenter.checkMobil","usercenter.relRegisterAccount","userCenter.userGuide","usercenter.tab","usercenter.privilege"]),angular.module("usercenter").controller("UserCenterCtrl",["$rootScope","$scope","$window","$stateParams","usercenterService","security","$modal","ModalService","$location","$filter","fixnumFilter","i18nNotifications","thirdpartyService","$translate","$timeout",function(e,n,t,o,r,s,i,c,a,l,u,f,d,p,m){n.PREFIX_FILE_HOST=PREFIX_FILE_HOST,n.PREFIX_SERVER_HOST=PREFIX_URL,n.PREFIX_CLIENT_HOST=PREFIX_HOST,n.isActive="usercenter",n.isVendorUser=s.isVendorUser(),n.editInfo={isEditable:!1},n.isDomainAccessable=s.isAllowToAccess(s.accessDef.ACCESS_DOMAIN_BIND),n.isAllowedHistory=s.isAllowToAccess(s.accessDef.USERCENTER_HISTORY),n.isAllowedApply=s.isAllowToAccess(s.accessDef.APPLY_XIUKE),n.password={},n.pageSize=5,n.XdpageNo=1,n.XdtoPage="",n.pageNo=1,n.toPage=n.XdcurrentPage=1,n.branchToPage=1,n.viewControl={tab:o.id},n.showTab=function(e){a.path("/usercenter/"+e,!1),n.viewControl.tab=e},n.currentUser=s.currentUser,n.getUserXd=function(){r.getUserXd().then(function(e){e.data.success&&(n.xdCounts=e.data.obj)})},n.getUserXd(),n.getUserInfo=function(){r.getUserInfo().then(function(e){n.userinfo=e.data.obj,n.master=angular.copy(n.userinfo),n.url="我做的企业秀，用的是微学宝，免费好用，你试试吧：\r\n"+PREFIX_HOST+"/#/home/register?u="+n.userinfo.id;var t=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;"eqs"!=n.userinfo.loginName.substr(0,3)||t.test(n.userinfo.loginName)||(n.userinfo.noRel="未绑定",/(_qq)$/.test(n.userinfo.loginName)&&(n.qqRel=!0),/(_weixin)$/.test(n.userinfo.loginName)&&(n.wxRel=!0),/(_weibo)$/.test(n.userinfo.loginName)&&(n.wbRel=!0)),/qq/gi.test(n.userinfo.relType)&&(n.qqRel=!0),/weixin/gi.test(n.userinfo.relType)&&(n.wxRel=!0),/weibo/gi.test(n.userinfo.relType)&&(n.wbRel=!0),a.search().bindemail&&n.relAccount(),4==n.userinfo.type})},n.getUserInfo(),n.editMessage=function(){var e,t,o;4==n.userinfo.type?(e="/Public/eq/6.0/templates/usercenter.console.serverinfo.html",t="ApplyCtrl",o="服务会员基本信息"):(e="/Public/eq/6.0/templates/usercenter.console.companyinfo.html",t="companyInfoCtrl"),i.open({windowClass:"six-contain",templateUrl:e,controller:t,scope:n,resolve:{userinfo:function(){return{nick:n.userinfo.nick,type:n.userinfo.type,id:n.userinfo.id,title:o,name:n.userinfo.name}}}}).result.then(function(e){4==n.userinfo.type?(n.applyInfo=e.status,n.userinfo.nick=e.applyInfoNew.nick):n.userinfo.nick=e.nick},function(){})},n.copyCode=function(){var e,n;e=$(".invitation-contain span"),n=e.html(),clipboard.setData("text/plain",n)},n.tabid=o.id,n.customerUpload=function(){i.open({windowClass:"img_console console",templateUrl:"/Public/eq/6.0/templates/scene.console.bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1}}}}).result.then(function(t){if(t.width/t.height===1){n.userinfo.headImg=t.data;var o={headImg:t.data,id:n.userinfo.id};return void r.saveUserInfo(o).then(function(o){o.data.success&&(n.editInfo.isEditable=!1,e.$broadcast("headImg.change",t.data))})}i.open({windowClass:"console seven-contain",templateUrl:"/Public/eq/6.0/templates/scene.console.imageCrop.tpl.html",controller:"imageCropCtrl",backdrop:"static",resolve:{obj:function(){return{type:"square",properties:{src:t.data}}}}}).result.then(function(t){n.userinfo.headImg=t.src;var o={headImg:t.src,id:n.userinfo.id};r.saveUserInfo(o).then(function(t){t.data.success&&(n.editInfo.isEditable=!1,e.$broadcast("headImg.change",t.data.obj.headImg))})},function(e){})},function(e){})},n.domain=function(){i.open({windowClass:"six-contain",templateUrl:"/Public/eq/6.0/templates/usercenter.domain.tpl.html",controller:"UserCenterCtrl",resolve:{param:function(){return{value:n.domainMess}}}}).result.then(function(){getDomainMess()},function(){})},n.applyShow=function(){i.open({windowClass:"six-contain",templateUrl:"/Public/eq/6.0/templates/usercenter.console.serverinfo.html",controller:"ApplyCtrl",backdrop:"static",invoice:!0,resolve:{userinfo:function(){return{status:n.applyInfo,id:n.userinfo.id,title:"申请成为秀客获取服务商账号",invoice:!0}}}}).result.then(function(e){n.applyInfo=e},function(){})},m(function(){("4"==n.userinfo.type||"1"==n.userinfo.type)&&r.getUserStatus().then(function(e){n.applyInfo=e.data.map.status})},300),n.know=function(){n.xiudian=!1},n.buyXd=function(){i.open({windowClass:"console six-contain",templateUrl:"?c=pay",controller:"BuyXdController",resolve:{getUserXd:function(){return function(){n.getUserXd(),n.getXdlog(n.XdtoPage)}}}}).result.then(function(){},function(){})}}]).controller("BuyXdController",["$scope","$modal","usercenterService","ModalService","getUserXd",function(e,n,t,o,r){e.confirm=function(){t.getPayXdQrCode(10,1).then(function(t){if(e.$close(),t.data.success){var s=t.data.obj;n.open({windowClass:"console",templateUrl:"/Public/eq/6.0/templates/usercenter.payment.tpl.html",controller:"PayMentCtrl",resolve:{qrCodeUrl:function(){return s},type:function(){return 10},money:function(){return["500元"]},method:function(){return"buyXd"},counts:function(){}}}).result.then(function(){r()},function(){})}else o.openMsgDialog({msg:t.data.msg})})},e.cancel=function(){e.$close()}}]);