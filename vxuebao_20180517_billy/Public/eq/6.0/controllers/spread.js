angular.module("spread",["app.directives.pieChart","app.directives.numChangeAnim","spread.tab","app.directives.qrcode","app.directives.switchInput","app.directives.copyButton","app.spread.console","security.login.toolbar","ui.bootstrap","scene.preview"]),angular.module("spread").controller("SpreadCtrl",["$scope","$rootScope","$location","$stateParams","sceneService","sceneViewService",function(e,t,s,a,n,c){e.status=t.user.company_ext.data_permiss,e.viewControl={},e.viewControl.tab=a.tab,e.sceneId=a.sceneId;var o,i=t.branchid;e.$watch("user",function(e){e&&(o=t.user&&t.user.domain?"http://"+t.user.domain:t.PREFIX_CLIENT_HOST,r())},!0),e.getMyScene=r,e.sceneSettings=function(t){t&&t.stopPropagation(),s.path("scene/create/"+e.sceneId).search({pageId:1,openSetting:"show"})};var r=function(){c.getSceneData(e.sceneId).then(function(t){t.data.list[0].properties&&t.data.list[0].properties.longpage&&t.data.list[0].properties.longpage.islongpage?e.islongpage=t.data.list[0].properties.longpage.islongpage:e.islongpage=!1,e.sceneDetailPromise=n.getSceneDetail(e.sceneId,i),e.sceneDetailPromise.then(function(t){e.scene=t.data.obj,e.url=e.selectedUrl=o+"/v-"+e.scene.code,e.scene.accessCode?e.sceneStadus="加密访问":1==e.scene.status?e.sceneStadus="开放访问":e.sceneStadus="关闭访问"})})};e.showShare=function(t){e.viewControl.tab=t,e.viewControl.subtab||(e.viewControl.subtab="socialShare"),s.path("spread/share/"+a.sceneId+"/socialShare",!1)},e.showStatistics=function(t){e.viewControl.tab=t,s.path("spread/statistics/"+a.sceneId,!1)},e.dataCollect=function(t){e.viewControl.tab=t,s.path("spread/dataCollect/"+a.sceneId,!1)},e.openScene=function(t,s){s?n.openScene(e.scene.id).then(function(t){t.data.success&&(e.scene.status=1)}):n.closeScene(e.scene.id).then(function(t){t.data.success&&(e.scene.status=2)})}}]);