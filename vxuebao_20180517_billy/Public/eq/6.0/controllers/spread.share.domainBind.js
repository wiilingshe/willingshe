angular.module("spread.share.domainBind",["services.usercenter","services.i18nNotifications"]),angular.module("spread.share.domainBind").controller("DomainBindCtrl",["$scope","$rootScope","usercenterService","$translate","i18nNotifications",function(e,n,r,t,a){e.showController={},e.goStep=function(n){e.showController.step=n},e.bindDomain=function(){e.showController.agreeBind=!0},e.reApply=function(){e.isShowBindPanel=!0,e.showController.agreeBind=!1};var s=function(){r.getDomain().then(function(n){if(n.data.success)if(e.domainInfo=n.data.obj,e.model.day=n.data.obj.typeList[0],e.typeIndex=0,n.data.obj.id){e.isShowBindPanel=!1,e.domainInfo.ipAddress="202.173.11.90";var r=e.status=n.data.obj.status;1===r?(e.domainMes=t.instant("usercenter.server.DOMAIN_STATUS1"),e.unbind=!1,e.domainInfo.restTime=Math.floor((e.domainInfo.endDate-e.domainInfo.startDate)/864e5)):2===r?(e.domainMes=t.instant("usercenter.server.DOMAIN_STATUS2"),e.unbind=!1):3===r?(e.domainMes=t.instant("usercenter.server.DOMAIN_STATUS3"),e.unbind=!0):4===r?e.domainMes=t.instant("usercenter.server.DOMAIN_STATUS4"):(new Date).getTime()>n.data.obj.endDate&&(e.status=5,e.domainMes=t.instant("usercenter.server.DOMAIN_STATUS5"),e.unbind=!0)}else e.isShowBindPanel=!0})};s(),e.getUserXd=function(){r.getUserXd().then(function(n){n.data.success&&(e.xdCounts=n.data.obj)})},e.getUserXd(),e.model||(e.model={});var o=e.model;e.checkDomainFormat=function(n){return n.url?(e.domainFormatErr="",!0):(e.domainFormatErr=t.instant("usercenter.server.WRITE_DNS"),!1)},e.checkDayFormat=function(n){return n.day?(e.dayFormatErr="",!0):(e.dayFormatErr=t.instant("usercenter.server.WRITE_DATE"),!1)},e.checkAppIdAndSecret=function(n){return n.appId&&!n.secretId?(e.appIdFormatErr=t.instant("usercenter.serverWRITE_APPSECRET"),!1):!n.appId&&n.secretId?(e.appSecretErr=t.instant("usercenter.server.WRITE_APPID"),!1):(e.appIdFormatErr="",e.appSecretErr="",!0)},e.submit=function(){if(e.checkDomainFormat(o)&&e.checkDayFormat(o)&&e.checkAppIdAndSecret(o))if(e.cost=o.day.label,e.xdCounts>=parseInt(e.cost,10)){var n={url:o.url,buyTime:o.day.value,appId:o.appId,secretId:o.secretId};r.bindDomain(n).then(function(n){n.data.success?(alert(t.instant("usercenter.server.DNS_COMMIT")),e.status=2,e.isShowBindPanel=!1,e.domainInfo.ipAddress="202.173.11.90",e.domainInfo.url=o.url):e.actionerror=n.data.msg},function(){alert(t.instant("usercenter.server.SERVER_ERROR"))})}else a.pushForCurrentRoute("xd.insufficient","notify.success")},e.switchDomainType=function(n){e.typeIndex=n}}]);