angular.module("usercenter.trash",[]),angular.module("usercenter.trash").controller("TrashCtrl",["$location","$rootScope","$scope","usercenterService","ModalService","$translate","fileService","MineService","sceneService","dataCacheService",function(e,t,n,a,s,r,c,i,o,g){n.PREFIX_CLIENT_HOST=PREFIX_HOST;var u=t.branchid;n.scene={type:null},n.pageSize=12,n.sceneCurrent={page:"",total:""},n.imageCurrent={page:"",total:""},n.historyTab={page:{}};var l=function(e){n.sceneHistory=e,"scene"==e?n.historyTab={pages:{currentPage:n.sceneCurrent.page,totalItems:n.sceneCurrent.total,pageSize:12}}:n.historyTab={pages:{currentPage:n.imageCurrent.page,totalItems:n.imageCurrent.total,pageSize:21}}};n.getMyScenes=function(e,t){n.sceneHistory=t,i.getMyHistoryScenes(e,n.pageSize,u).then(function(e){if(e.data.list&&e.data.list.length>0){n.myScenes=e.data.list;for(var a=0;a<n.myScenes.length;a++)n.myScenes[a].time=new Date(n.myScenes[a].delTime).getTime()+2592e5,n.myScenes[a].history=Math.round((n.myScenes[a].time-(new Date).getTime())/1e3/60/60/24);n.sceneCurrent.total=e.data.map.count,n.sceneCurrent.page=e.data.map.pageNo}else n.sceneTotalItems=0,n.sceneCurrent.total=0,n.sceneCurrent.page>1?n.getMyScenes(--n.sceneCurrent.page,"scene"):n.myScenes=[];l(t)})},n.getMyScenes(1,"scene"),n.deleteScene=function(e,t){s.openConfirmDialog({msg:"确定彻底删除此微课?"},function(){o.deleteSceneById(e,t).then(function(){n.getMyScenes(n.historyTab.pages.currentPage,"scene")})})},n.revoke=function(e){o.revoke(e).then(function(){n.getMyScenes(n.historyTab.pages.currentPage,"scene")})},n.$on("images.update",function(e,t,a){n.images=t.list;for(var s=0;s<n.images.length;s++)n.images[s].time=new Date(n.images[s].delTime).getTime()+2592e5,n.images[s].history=Math.round((n.images[s].time-(new Date).getTime())/1e3/60/60/24);n.imageCurrent.total=t.map.count,n.imageCurrent.page=t.map.pageNo,l(a)}),n.getImages=function(e,a){n.sceneHistory=a,c.userRecycle(e,21).success(function(e){e.success?t.$broadcast("images.update",e,a):alert(e.msg)}).error(function(){alert("网络连接超时，请稍后重试")})},n.$on("file.delete",function(e){n.getImages(n.historyTab.pages.currentPage,"image")}),n.deleteImg=function(e,t){s.openConfirmDialog({msg:"确定彻底删除此图片?"},function(){n.deleteFile(e,t)})},n.deleteFile=function(e,n){c.deleteFile1(e,n).success(function(e){e.success?t.$broadcast("file.delete"):alert(e.msg)}).error(function(){alert("网络连接超时，请稍后重试")})},n.imageRevoke=function(e){c.fileRevoke(e).success(function(e){e.success?(n.getImages(n.historyTab.pages.currentPage,"image"),g.clear("fileService")):alert(e.msg)}).error(function(){alert("网络连接超时，请稍后重试")})},n.pageChanged=function(e){return 1>e||e>n.historyTab.pages.totalItems/10+1?void alert(r.instant("main.customer.PAGE_OVERFLOW")):void("scene"==n.sceneHistory?n.getMyScenes(e,"scene"):n.getImages(e,"image"))}}]);