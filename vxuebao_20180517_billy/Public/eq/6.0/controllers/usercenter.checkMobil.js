angular.module("usercenter.checkMobil",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.checkMobil").controller("CheckMobileCtrl",["$rootScope","$scope","$window","usercenterService","$modal","ModalService","$location","$timeout","userinfo","i18nNotifications","$translate",function(e,c,n,o,r,t,s,i,u,a,l){function E(){0===d?(c.isCodeAccessiable=!1,c.codeTip=l.instant("usercenter.account.CODE_TIP1"),d=60):(c.isCodeAccessiable=!0,c.codeTip=l.instant("usercenter.account.CODE_TIP2")+"("+d+")",i(function(){d--,E()},1e3))}switch(c.title=u.title,c.userinfo=u,c.userinfo.code="",c.title){case l.instant("usercenter.account.REL_MOBILE"):c.dec=l.instant("usercenter.account.REL_MOBILE_DEC");break;case l.instant("usercenter.account.VALIDATE_MOBILE"):c.dec=l.instant("usercenter.account.VALIDATE_MOBILE_DEC");break;case l.instant("usercenter.account.CHANGE_MOBILE"):c.dec=l.instant("usercenter.account.CHANGE_MOBILE_DEC")}c.checkMobile=function(){return/^1\d{10}$/.test(c.userinfo.phone)?(c.mobileError="",!0):($(".mobile").focus(),c.mobileError=l.instant("usercenter.account.MOBILE_ERROR1"),!1)},c.checkCode=function(){return c.userinfo.code?(c.codeError="",!0):($(".code").focus(),c.codeError=l.instant("usercenter.account.CODE_ERROR"),!1)},c.getCode=function(){c.userinfo.phone?(c.mobileError="",o.relMobileCode(c.userinfo.phone).then(function(e){e.data.success?E():c.relErr=e.data.msg})):(c.mobileError=l.instant("usercenter.account.MOBILE_ERROR2"),$(".mobile").focus())};var d=60;c.relAccount=function(){c.checkMobile()&&c.checkCode()&&(c.mobileError="",c.codeError="",o.relMobile(c.userinfo.phone,c.userinfo.password,c.userinfo.code).then(function(e){e.data.success?t.openMsgDialog({msg:e.data.msg},function(){c.$close(c.userinfo.phone)}):c.relErr=e.data.msg}))},c.cancel=function(){c.$dismiss()}}]);