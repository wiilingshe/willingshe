angular.module("spread.share.socialShare",["app.directives.disableKeydown"]),angular.module("spread.share.socialShare").controller("SocialShareCtrl",["$rootScope","$scope","$stateParams","$modal","i18nNotifications","sceneSettingCache","SpreadService","pageTplService",function(e,s,t,i,c,a,n,o){s.obj={},s.qrcodeList=[{type:1,name:"小（256px）",size:256},{type:2,name:"中（512px）",size:512},{type:3,name:"大（1024px）",size:1024}],s.shareList=[{id:1,type:"sina",icon:"eqf-weibo",title:"新浪微博",class:"sina"},{id:2,type:"tencent",icon:"eqf-txweibo",title:"腾讯微博",class:"tencent"},{id:3,type:"qqzone",icon:"eqf-QQzone",title:"qq空间",class:"qqzone"},{id:4,type:"timeline",icon:"eqf-friend",title:"微信朋友圈",class:"timeline"},{id:5,type:"yixin",icon:"eqf-yixin",title:"易信",class:"yixin"},{id:6,type:"tieba",icon:"eqf-tieba",title:"百度贴吧",class:"tieba"},{id:7,type:"laiwang",icon:"eqf-laiwang",title:"来往",class:"laiwang"}],s.downloadQrcode=function(s){e.$broadcast("download.canvas",s.size)},s.$on("shareway.update",function(e,t){$.each(s.shareList,function(e,s){$.each(t,function(e,t){t.type==s.id&&1==t.status&&(s.isLighted=!0)})})}),s.activeShareWay=function(e){n.activeShareWay(s.sceneId,e)},s.$on("active.shareway",function(e,t){$.each(s.shareList,function(e,s){t==s.id&&(s.isLighted=!0)})}),s.$watch("scene",function(e,t){e&&(-1==e.status?s.tip="审核被拒绝不能申请":-2==e.status&&(s.tip="审核中不能申请"),0==e.applyTemplate?s.obj.applySample=!1:1==e.applyTemplate?s.obj.applySample=!0:2==e.applyTemplate||-1==e.applyTemplate,s.obj.publishTime=e.publishTime,0==e.isShow?s.obj.applyShow=!1:1==e.isShow?s.obj.applyShow=!0:2==e.isShow||-1==e.isShow,3==e.isTpl&&(s.obj.applyCompTpl=!0),a.sceneTagsPromise.then(function(t){var i=t.data.list||[];s.sceneTags=[],angular.forEach(i,function(t){e.type==t.bizType&&s.sceneTags.push(t)}),e.tagId&&$.each(s.sceneTags,function(t,i){e.tagId==i.id&&(s.obj.sceneTag=i)})}),a.sceneTplPricesPromise.then(function(t){s.tplPrices=t.data.list||[],$.each(s.tplPrices,function(t,i){e.price==i.value&&(s.obj.tplPrice=i)})}))},!0),s.applyFunc=function(e,t,i,a){if(e){if(2==t&&(1==s.scene.isShow||2==s.scene.isShow))return c.pushForCurrentRoute("already.apply.discovery","notify.success"),void $.each(s.sceneTags,function(e,t){s.scene.type==t.id&&(s.obj.sceneTag=t)});if(1==t&&(1==s.scene.applyTemplate||2==s.scene.applyTemplate))return c.pushForCurrentRoute("already.apply.sample","notify.success"),void $.each(s.tplPrices,function(e,t){s.scene.price==t.value&&(s.obj.tplPrice=t)});if(3==t)return-1==s.scene.status?void c.pushForCurrentRoute("scene.deny.apply","notify.success"):-2==s.scene.status?void c.pushForCurrentRoute("scene.incheck.apply","notify.success"):s.scene.accessCode?void c.pushForCurrentRoute("scene.accessCode.apply","notify.success"):s.scene.promIds?(c.pushForCurrentRoute("already.apply.activity","notify.success"),void $.each(s.activities,function(e,t){s.scene.promIds==t.id&&(s.obj.selectedActivity=t)})):void(window.localStorage&&localStorage.getItem("hideApplyActivityTip")?p(e,t,i,a):s.showApplyTip=!0);p(e,t,i,a)}},s.switchApplyActivityTip=function(e,s,t,i,c){c&&window.localStorage&&localStorage.setItem("hideApplyActivityTip",!0),p(e,s,t,i)},s.$on("apply.scene.share",function(e,s){s.success&&c.pushForCurrentRoute("scene.apply.success","notify.success")});var p=function(e,t,a,n){e&&i.open({windowClass:"console six-contain",templateUrl:"spread/console/apply.tpl.html",controller:"ApplyConsoleCtrl",resolve:{applyObj:function(){return{sceneId:s.sceneId,type:t,value:a,id:n,sceneType:s.scene.type}}}}).result.then(function(e){var i=e.value;c.pushForCurrentRoute("scene.apply.success","notify.success"),2==t?($.each(s.sceneTags,function(e,t){i==t.id&&(s.obj.sceneTag=t)}),s.scene.isShow=1):1==t?($.each(s.tplPrices,function(e,t){i==t.value&&(s.obj.tplPrice=t)}),s.scene.applyTemplate=1):3==t?e.src&&(s.appliedImgSrc=e.src):4==t&&(s.scene.isTpl=3)},function(){2==t?s.obj.applyShow=!1:1==t?s.obj.applySample=!1:3==t?s.obj.selectedActivity=null:4==t&&(s.obj.applyCompTpl=!1)})};s.applyCompTpl=function(e,t){e&&n.applyShareWay(s.sceneId,t)},s.closeActivityModal=function(){s.showApplyTip=!1,s.obj.selectedActivity=null}}]);