angular.module("usercenter.tab.server",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.tab.server").controller("ServerTabCtrl",["$scope","$rootScope","usercenterService","$translate",function(e,r,n,t){e.showController={},e.goStep=function(r){e.step=r},e.bindDomain=function(){e.showController.agreeBind=!0},e.reApply=function(){e.isShowBindPanel=!0,e.showController.agreeBind=!1};var a=function(){n.getDomain().then(function(r){if(r.data.success)if(e.domainInfo=r.data.obj,e.model.day=r.data.obj.typeList[0],r.data.obj.id){e.isShowBindPanel=!1,e.domainInfo.ipAddress="202.173.11.90";var n=e.status=r.data.obj.status;switch(n){case 1:e.domainMes=t.instant("usercenter.server.DOMAIN_STATUS1"),e.unbind=!1,e.domainInfo.restTime=Math.floor((e.domainInfo.endDate-e.domainInfo.startDate)/864e5);break;case 2:e.domainMes=t.instant("usercenter.server.DOMAIN_STATUS2"),e.unbind=!1;break;case 3:e.domainMes=t.instant("usercenter.server.DOMAIN_STATUS3"),e.unbind=!0;break;case 4:e.domainMes=t.instant("usercenter.server.DOMAIN_STATUS4");break;default:(new Date).getTime()>r.data.obj.endDate&&(e.status=5,e.domainMes=t.instant("usercenter.server.DOMAIN_STATUS5"),e.unbind=!0)}}else e.isShowBindPanel=!0})};a(),e.model||(e.model={});var s=e.model;e.checkDomainFormat=function(r){return r.url?(e.domainFormatErr="",!0):(e.domainFormatErr=t.instant("usercenter.server.WRITE_DNS"),!1)},e.checkDayFormat=function(r){return r.day?(e.dayFormatErr="",!0):(e.dayFormatErr=t.instant("usercenter.server.WRITE_DATE"),!1)},e.checkAppIdAndSecret=function(r){return r.appId&&!r.secretId?(e.appIdFormatErr=t.instant("usercenter.serverWRITE_APPSECRET"),!1):!r.appId&&r.secretId?(e.appSecretErr=t.instant("usercenter.server.WRITE_APPID"),!1):(e.appIdFormatErr="",e.appSecretErr="",!0)},e.submit=function(){if(e.checkDomainFormat(s)&&e.checkDayFormat(s)&&e.checkAppIdAndSecret(s))if(e.cost=s.day.label,e.xdCounts>=parseInt(e.cost,10)){var r={url:s.url,buyTime:s.day.value,appId:s.appId,secretId:s.secretId};n.bindDomain(r).then(function(r){r.data.success?(alert(t.instant("usercenter.server.DNS_COMMIT")),e.status=2,e.isShowBindPanel=!1,e.domainInfo.ipAddress="202.173.11.90",e.domainInfo.url=s.url):e.actionerror=r.data.msg},function(){alert(t.instant("usercenter.server.SERVER_ERROR"))})}else e.xiudian=!0}}]);