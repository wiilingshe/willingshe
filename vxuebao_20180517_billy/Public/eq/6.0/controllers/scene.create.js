angular.module("scene.create").controller("CreateSceneCtrl",["$timeout","$compile","$rootScope","$scope","$stateParams","$state","$location","sceneService","pageTplService","$modal","ModalService","security","$window","i18nNotifications","historyService","panStateTracker","selectService","continueUrl","triggerService","staticResService","dataCacheService","fileService","storageService","$element","gridGuide","sceneViewService","$interval",function(e,t,n,o,a,s,c,l,r,p,u,g,d,f,m,h,b,v,y,S,T,w,P,C,j,I,A){function N(){var e=!1;return angular.forEach(o.tpl.obj.elements,function(t){6==(""+t.type).charAt(0)&&(e=!0)}),e}function F(e,t,a,i){sessionStorage.setItem("pageid",o.pages[e-1].id),o.loading=!0,o.pageId=o.pages[e-1].id,l.getSceneByPage(o.pageId,t,a).then(function(i){if(o.font=i.data.obj.scene.font,o.loading=!1,o.tpl=i.data,H=o.tpl.obj.properties,H&&H.trigger&&y.setTrigger(o.tpl.obj.id,H.trigger),delete o.tpl.obj.scene,o.sceneId=o.tpl.obj.sceneId,o.controlView.showBgTag=!1,angular.forEach(o.tpl.obj.elements,function(e,t){3==e.type&&(o.controlView.showBgTag=!0,o.currentBgDef=e)}),H)if(H.image||H.scratch)o.effectName="涂抹";else if(H.finger)o.effectName="指纹";else if(H.effect)switch(H.effect.name){case"money":o.effectName="数钱";break;case"snowFly":o.effectName="飘雪";break;case"fireWorks":o.effectName="烟花";break;case"none":o.effectName="无"}else H.fallingObject&&(o.effectName="环境");(t||a)&&(c.$$search={},c.search("pageId",++e),o.getPageNames()),o.pageNum=e,$("#nr").empty();var s=angular.copy(o.tpl.obj);s.elements=m.addPage(s.id,s.elements),l.templateEditor.parse({def:o.tpl.obj,appendTo:"#nr",mode:"edit"}),o.originData=JSON.stringify(o.tpl),n.$broadcast("dom.changed"),n.$broadcast("switchBox",o.showPhone),o.editLoading=!1},function(){o.loading=!1})}function B(){f.pushForCurrentRoute("scene.save.success.nopublish","notify.success")}window.isEmpty=function(e){for(var t in e)return!1;return!0},o.loading=!1,o.PREFIX_FILE_HOST=PREFIX_FILE_HOST,o.tpl={},o.originData="",o.font=[],o.editLoading=!0;var E,D="",L=21,O=1,x=0,M=!1;if(o.templateType=1,o.controlView={},o.showSearch=!0,o.completeHtml2Canvas=null,o.lastPageTypes=[{name:"微学宝尾页",value:"eqFree"},{name:"微学宝底标",value:"eqLink"},{name:"去掉微学宝展示",value:"eqHide"}],o.pageTpl={},o.isAppEditor=!1,o.tabid="template",o.$watch("user",function(e){if(e)for(var t=0;t<e.roleIdList.length;t++)13==e.roleIdList[t]&&(o.isAppEditor=!0),(4==e.roleIdList[t]||12==e.roleIdList[t]||13==e.roleIdList[t])&&(o.isTplEditor=!0)},!0),o.refreshTpl=function(){x>O&&!M&&(M=!0,o.getPageTpls(++O))},o.showPhone="false"!=P.get("create.phoneView"),o.showPhoneTip="false"!=P.get("create.showPhoneTip"),o.switchPhone=function(){o.showPhone=!o.showPhone,n.$broadcast("switchBox",o.showPhone),P.push("create.phoneView",o.showPhone),P.get("create.showPhoneTip")||(P.push("create.showPhoneTip",!1),o.showPhoneTip=!1)},o.$on("switchBox",function(e,t){t?$(".edit_wrapper").append($('<div ng-if="showPhone" class="phone"><h4 class="name">'+o.scene.name+"</h4> </div>")):$(".workspace .phone").remove()}),o.createComp=function(e,t){return o.sceneSetting.showFlag=!1,"6"==e&&N()?void u.openMsgDialog({msg:"当前页面的提交按钮已经存在，请不要重复添加。"}):void l.createComp(e,null,t)},o.$on("hisChange",function(){m.addPageHistory(o.tpl.obj.id,o.tpl.obj.elements)}),r.getPageTagLabel(11001).then(function(e){o.tplFormatList=e.data.list}),r.getPageTagLabel(11003).then(function(e){o.tplInteractionList=e.data.list}),r.getPageTagLabel(11002).then(function(e){o.tplStyleList=e.data.list}),o.getPageTplTypestemp=function(e,t,n,a){r.getPageTplTypestemp(e,t,n,a).then(function(e){if(M=!1,e.data.list&&e.data.list.length>0){o.pageTpls=O>1?o.pageTpls.concat(e.data.list):e.data.list,x=Math.ceil(e.data.map.count/n);var t=e.config.url.split("&time")[0];T.contains(t)||(T.push("pageTpl",T.getAsyncUrl(),e),T.setAsyncUrl())}else o.pageTpls=[],x=0})},o.enterPress=function(e){var t=e||window.event;13==t.keyCode&&o.getPageTpls()},o.getPageTpls=function(e){var t="";e||(e=O=1);for(var n in o.pageTpl)"name"!=n&&o.pageTpl[n]&&(t+=o.pageTpl[n]+",");""!==t&&(t=t.substr(0,t.length-1)),o.pageTpl.name&&""!==o.pageTpl.name&&(o.showSearch=!1),o.getPageTplTypestemp(t,o.pageTpl.name,L,e)},o.getPageTpls(),o.resetTplFilter=function(){o.pageTpl.name=null,o.showSearch=!0,o.getPageTpls()},o.support=function(){return(!window.sessionStorage||"false"!==sessionStorage.getItem("checkSuport"))&&(!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/)||navigator.userAgent.match(/Chrome/))&&((!navigator.userAgent.match(/iPad/)||!navigator.userAgent.match(/CriOS/))&&(v.setUrl(c.path()),c.path("scene/support"),!0)))},!o.support()){o.createCompGroup=function(e,t){o.sceneSetting.showFlag=!1,"g101"==e&&N()&&(u.openMsgDialog({msg:"当前页面的提交按钮已经存在，本操作将会删除已添加的按钮。"}),angular.forEach(o.tpl.obj.elements,function(e){6==(""+e.type).charAt(0)&&($("#nr").find("#inside_"+e.id).remove(),b.deleteElement(e.id),l.deleteElement(e.id))})),l.createCompGroup(e,null,t)},o.isRadioCheckboxRatingAccessable=g.isAllowToAccess(g.accessDef.RADIO_CHECKBOX_RATING),o.isInteractionAccessable=g.isAllowToAccess(g.accessDef.INTERACTION),o.isInteractionCounterAccessable=g.isAllowToAccess(g.accessDef.INTERACTION_COUNTER),o.updateCompPosition=l.updateCompPosition,o.updateCompAngle=l.updateCompAngle,o.updateCompSize=l.updateCompSize,o.openAudioModal=l.openAudioModal,o.openTriggerMode=l.openTriggerMode,o.$on("dom.changed",function(e){t($("#nr"))(o),n.$broadcast("boxOuter"),o.container=C.find(".edit_wrapper"),j.grid.init(o.container),j.guide.init(o.container)});var k=null;o.$on("showCropPanel",function(e,a){var i=$(".content").eq(0);k?(n.$broadcast("changeElemDef",a),k.show()):k=t("<div crop-image></div>")(o),i.append(k)}),o.openPageEffectModal=function(e){var t=angular.copy(e);p.open({windowClass:"console six-contain effect-console",templateUrl:BASE_URL+"templates/scene.console.pageeffect.tpl.html",controller:"pageEffectCtrl",resolve:{properties:function(){return t}}}).result.then(function(e){o.tpl.obj.properties||(o.tpl.obj.properties={}),o.tpl.obj.properties.scratch=null,o.tpl.obj.properties.finger=null,o.tpl.obj.properties.fallingObject=null,o.tpl.obj.properties.effect=null,"无"!=e.name&&(o.tpl.obj.properties[e.value]=e.properties[e.value]),o.effectName=e.name},function(){n.$broadcast("clear.scratch.interval")})};var H,U=null;o.$on("showStylePanel",function(e,n){var a=$(".content").eq(0);U?U.show():"style"==n.activeTab?U=t('<div style-modal active-tab="style"></div>')(o):"anim"==n.activeTab?U=t('<div style-modal active-tab="anim"></div>')(o):"trigger"==n.activeTab&&(U=t('<div style-modal active-tab="trigger"></div>')(o)),a.append(U)}),o.$on("hideStylePanel",function(e){U&&U.hide()}),o.refreshPage=function(e,t){return o.completeHtml2Canvas?void o.completeHtml2Canvas.then(function(){o.refreshPage(e,t)}):(parseInt(t,10),$("#nr").empty(),l.templateEditor.parse({def:o.tpl.obj,appendTo:"#nr",mode:"edit"}),n.$broadcast("dom.changed"),void n.$broadcast("switchBox",o.showPhone))},o.navTo=function(e,t){o.editLoading=!0,o.controlView.pageList=!0,o.isTplEditor&&(o.pageLabelAll.length=0,o.pageIdTag=e.id,o.getPageTagLabel()),e.id!=o.tpl.obj.id&&(o.setEditableStatus(),o.controlView.showBgTag=!1,o.saveUsedFiles(function(){o.saveScene(null,function(){F(t+1),c.$$search={},c.search("pageId",e.num)})}),h.clear())},o.saveUsedFiles=function(e){var t=[];$.extend(t,o.tpl.obj.elements);for(var n=JSON.parse(o.originData).obj.elements,a=0;a<t.length;a++){var i=t[a];if(i.sound||i.type+""=="3"||i.type+""=="4")for(var s=0;s<n.length;s++){var c=n[s];if(i.id==c.id){i.type+""!="3"&&i.type+""!="4"?!i.sound||c.sound&&c.sound.id==i.sound.id||T.pushUsedFile(2,i.sound.id):i.properties.id!=c.properties.id&&T.pushUsedFile(1,i.properties.id);break}s==n.length-1&&(i.type+""!="3"&&i.type+""!="4"?T.pushUsedFile(2,i.sound.id):T.pushUsedFile(1,i.properties.id))}}var l=T.getUsedFiles();T.clearUsedFiles(),l?w.saveFilesHistory(l.file,l.type).then(function(){e&&e()}):e&&e()},o.stopCopy=function(){copied=!1},o.getOriginPageName=function(e){D=e.name},o.getPageNames=function(){var e=a.sceneId;l.getPageNames(e).then(function(e){o.pages=e.data.list,angular.forEach(o.pages,function(e,t){e.name||(e.name="第"+(t+1)+"页")}),F(c.search().pageId?c.search().pageId:o.pages[0].num)})},o.scene=null,l.getSceneDetail(a.sceneId,n.branchid).then(function(e){o.scene=l.getCurrentScene(),o.sceneSetting.oldBgAudio=o.scene.bgAudio,o.getPageNames()}),o.editableStatus=[],o.setEditableStatus=function(e,t,n){if(void 0!==e)o.editableStatus[e]=t;else for(var a=0;a<o.editableStatus.length;a++)o.editableStatus[a]=!1},o.savePageNames=function(e,t){e.name||(e.name="第"+(t+1)+"页"),o.tpl.obj.name=e.name,D!=e.name&&l.savePageNames(o.tpl.obj).then(function(e){f.pushForCurrentRoute("page.change.success","notify.success")})},o.removeScratch=function(e){e.stopPropagation(),o.tpl.obj.properties.scratch=null,o.tpl.obj.properties.finger=null,o.tpl.obj.properties.fallingObject=null,o.tpl.obj.properties.effect=null},o.$on("text.click",function(n,a){$("#btn-toolbar").remove(),$("body").append(t("<toolbar></toolbar>")(o));var i=$(a).offset().top;e(function(){$("#btn-toolbar").css("top",i-50),$("#btn-toolbar").show(),$("#btn-toolbar").bind("click mousedown",function(e){e.stopPropagation()}),$(a).wysiwyg_destroy(),$(a).wysiwyg(),$(a).trigger("dblclick").focus(),setTimeout(function(){if(window.getSelection){var e=window.getSelection();e.modify("move","left","documentboundary"),e.modify("extend","right","documentboundary")}})})}),o.updatePosition=function(e){var t,n,a=o.tpl.obj.elements,i=[];for(n=0;n<a.length;n++)if("3"==a[n].type){a[n].num=0,i.push(a[n]),a.splice(n,1);break}for(t=0;t<e.length;t++)for(n=0;n<a.length;n++)if(a[n].num==e[t]){a[n].num=t+1,i.push(a[n]),a.splice(n,1);break}o.tpl.obj.elements=i},o.updateEditor=function(){$("#nr").empty(),l.templateEditor.parse({def:o.tpl.obj,appendTo:"#nr",mode:"edit"}),t($("#nr"))(o)},o.findMultilFont=function(){I.getSceneData(a.sceneId).then(function(e){var t=e.data.list,e=[];null==o.font&&(o.font=[]);for(var n=0;n<t.length;n++)for(var a=0;a<t[n].elements.length;a++)"x"==t[n].elements[a].type&&e.push($(t[n].elements[a].content).css("font-family"));if(e.length>0)for(var a=0;a<e.length;a++)o.font.indexOf(e[a])<0&&e[a]&&o.font.push(e[a]);o.tpl.obj&&(o.tpl.obj.font=o.font)})},Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1},Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)};var R=!1;o.saveScene=function(e,t){if(!o.scene.name&&e&&!o.sceneSetting.showFlag)return void u.openMsgDialog({msg:"尚未设置标题，请设置后再执行此操作",btn:"去设置"},function(){o.sceneSetting.showFlag=!0});if(!R){if(o.findMultilFont(),o.sceneSetting.showFlag)return void o.sceneSetting.saveSceneSetting().then(function(){o.saveScene(e,t)});if(o.sceneSetting.oldBgAudio!=o.scene.bgAudio)return void l.saveSceneSettings(o.scene).then(function(){w.saveFilesHistory(o.scene.bgAudio?o.scene.bgAudio.id:0,2).then(function(){T.clear("fileService1")}),o.sceneSetting.oldBgAudio=o.scene.bgAudio,o.saveScene(e,t)});if(o.completeHtml2Canvas)return void o.completeHtml2Canvas.then(function(){o.saveScene(e,t)});if(R=!0,o.originData==JSON.stringify(o.tpl))return t&&t(),e&&(!o.scene.publishTime||o.scene.updateTime>o.scene.publishTime?B():f.pushForCurrentRoute("scene.save.success.published","notify.success")),void(R=!1);delete o.tpl.obj.scene,l.resetCss(),l.saveScene(o.tpl.obj).then(function(n){return e&&o.saveUsedFiles(),R=!1,n.data.success?(o.scene.updateTime=(new Date).getTime(),o.originData=angular.toJson(o.tpl),E&&(l.recordTplUsage(E),E=null),t&&t(),void(e&&B())):void alert("保存失败，服务器忙碌请稍后再试。")},function(){R=!1,alert("保存失败，服务器忙碌请稍后再试。")})}},o.publishScene=function(){return"true"!=n.user.company_ext.is_audit?o.scene.name||o.sceneSetting.showFlag?2!=o.scene.status||o.allowPublish?o.sceneSetting.showFlag?void o.sceneSetting.saveSceneSetting().then(function(){o.publishScene()}):o.sceneSetting.oldBgAudio!=o.scene.bgAudio?void l.saveSceneSettings(o.scene).then(function(){o.scene.bgAudio?w.saveFilesHistory(o.scene.bgAudio.id,2).then(function(){T.clear("fileService1"),o.sceneSetting.oldBgAudio=o.scene.bgAudio,o.publishScene()}):(o.sceneSetting.oldBgAudio=o.scene.bgAudio,o.publishScene())}):o.completeHtml2Canvas?void o.completeHtml2Canvas.then(function(){o.publishScene()}):!o.allowPublish&&o.scene.publishTime&&o.scene.updateTime<=o.scene.publishTime&&o.originData==angular.toJson(o.tpl)?void c.path("spread/share/"+o.sceneId+"/socialShare"):void o.saveUsedFiles(function(){o.saveScene(null,function(){l.publishScene(o.tpl.obj.sceneId).then(function(e){e.data.success&&(f.pushForNextRoute("scene.publish.success","notify.success"),c.path("spread/share/"+o.sceneId+"/socialShare"))})})}):void u.openConfirmDialog({msg:"当前微课为不允许访问状态，发布微课将重新对外开放访问 ",confirmName:"坚持发布",cancelName:"保存退出"},function(){o.allowPublish=!0,o.publishScene()},function(){o.saveScene(null,function(){c.path("spread/share/"+o.sceneId+"/socialShare")})}):void u.openMsgDialog({msg:"尚未设置标题，请设置后再执行此操作",btn:"去设置"},function(){o.sceneSetting.showFlag=!0}):void u.openMsgDialog({msg:"您的课件尚未通过审核，不能发布！",btn:"确定"})},o.exitScene=function(){JSON.parse(o.originData),c.$$search={},o.originData==angular.toJson(o.tpl)?c.path("main"):u.openConfirmDialog({msg:"是否保存更改内容？",confirmName:"保存",cancelName:"不保存"},function(){o.saveScene(),c.path("main")},function(){c.path("main")})},o.duplicatePage=function(){o.saveScene(null,function(){F(o.pageNum,!1,!0)})},o.insertPage=function(){o.saveUsedFiles(function(){o.saveScene(null,function(){F(o.pageNum,!0,!1)})}),$("#pageList").height()>=360&&e(function(){var e=document.getElementById("pageList");e.scrollTop=e.scrollHeight},200)},o.deletePage=function(e){e.stopPropagation(),u.openConfirmDialog({msg:"确定删除此页，删除后将不可恢复？"},function(){if(1!=o.pages.length&&!o.loading){o.loading=!0,o.action=!1;for(var e=0;e<o.tpl.obj.elements.length;e++){var t=o.tpl.obj.elements;5==t[e].type.toString()[0]&&(o.action=!0)}o.action===!0?u.openConfirmDialog({msg:"确定删除此页，将同时删除该微课已收集的数据?"},function(){_()}):_()}})};var _=function(){l.deletePage(o.tpl.obj.id).then(function(){o.loading=!1,c.$$search={},o.pages.length==o.pageNum?(o.pages.pop(),c.search("pageId",--o.pageNum),F(o.pageNum,!1,!1)):(o.pages.splice(o.pageNum-1,1),c.search("pageId",o.pageNum),F(o.pageNum,!1,!1))},function(){o.loading=!1})};o.removeBG=function(e){var t,a=o.tpl.obj.elements;for(t=0;t<a.length;t++)if(3==a[t].type){a.splice(t,1);var i;for(i=t;i<a.length;i++)a[i].num--;break}n.$broadcast("remove.scene.bg")},o.removeBGAudio=function(e){e.stopPropagation(),o.scene.bgAudio=null},$(".scene_title").on("paste",function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain")||prompt("Paste something..");document.execCommand("insertText",!1,t)}),o.myName=[{name:"我的"}],o.myCompany=[{name:"企业"}],o.creatCompanyTemplate=function(){var e=$.extend(!0,{},o.tpl.obj);if(e.islong=0,delete e.scene,n.user){var t=parseInt(n.user.companyTplId,10);t?e.sceneId=t:n.companySceneId?e.sceneId=n.companySceneId:e.sceneId=null,l.saveCompanyTpl(e).then(function(e){e.data.success&&(f.pushForCurrentRoute("companytpl.setting.success","notify.success"),n.companySceneId=e.data.obj,o.getPageTplsByCompanyType())})}else o.myCompanyTpls=[]},n.$on("saveCompanyTemplate",function(){o.creatCompanyTemplate()});var V=null;o.getPageTplsByCompanyType=function(){if(o.myCompanyTpls=[],o.myCompany[0].active=!0,!V)if(n.companySceneId)V=n.companySceneId;else{var e=parseInt(n.user.companyTplId,10);e&&(V=n.companySceneId=e)}V?l.previewScene(V).then(function(e){o.myCompanyTpls=e.data.list,o.tabid="company"}):o.tabid="company"},o.setTplTab=function(){o.tabid="template"},o.creatMyTemplate=function(){var e=$.extend(!0,{},o.tpl.obj);if(e.islong=0,delete e.scene,n.user){var t=JSON.parse(n.user.property);t&&t.myTplId?e.sceneId=t.myTplId:n.mySceneId?e.sceneId=n.mySceneId:e.sceneId=null,l.saveMyTpl(e).then(function(e){f.pushForCurrentRoute("mytpl.setting.success","notify.success"),n.mySceneId=e.data.obj,o.getPageTplsByMyType()})}else o.myPageTpls=[]},o.$on("saveMyTemplate",function(){o.creatMyTemplate()});var J=null;o.getPageTplsByMyType=function(){if(o.myPageTpls=[],o.myName[0].active=!0,!J)if(n.mySceneId)J=n.mySceneId;else{var e=JSON.parse(n.user.property);e&&e.myTplId&&(J=n.mySceneId=e.myTplId)}J?l.previewScene(J).then(function(e){o.myPageTpls=e.data.list,o.tabid="myCollection"}):o.tabid="myCollection"},o.$on("myPageList.update",function(e,t,n,a){if("my-tpl"==t)for(i=0;i<o.myPageTpls.length;i++)o.myPageTpls[i].id==a&&o.myPageTpls.splice(i,1);if("company-tpl"==t)for(i=0;i<o.myCompanyTpls.length;i++)o.myCompanyTpls[i].id==a&&o.myCompanyTpls.splice(i,1)}),o.$on("myPageList.delete",function(e,t,o){"company-tpl"==t&&21==n.user.type&&(o.context.firstElementChil$scope.outerHTML="")}),o.insertPageTpl=function(e){o.loading=!0;var t=function(e){l.getSceneTpl(e).then(function(e){o.controlView.showBgTag=!1,o.loading=!1,E=e.data.obj.id,o.tpl.obj.elements=l.getElements(),$("#nr").empty(),m.addPageHistory(o.tpl.obj.id,o.tpl.obj.elements),l.templateEditor.parse({def:o.tpl.obj,appendTo:"#nr",mode:"edit"}),angular.forEach(o.tpl.obj.elements,function(e,t){3==e.type&&(o.controlView.showBgTag=!0,o.currentBgDef=e)}),n.$broadcast("dom.changed"),n.$broadcast("switchBox",o.showPhone)},function(){o.loading=!1})};o.tpl.obj.elements&&o.tpl.obj.elements.length>0?u.openConfirmDialog({msg:"页面模板会覆盖编辑区域已有组件，是否继续？",confirmName:"是",cancelName:"取消"},function(){t(e)}):t(e)},o.chooseThumb=function(){p.open({windowClass:"console img_console",templateUrl:BASE_URL+"templates/scene.console.bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:"0"}}}}).result.then(function(e){o.tpl.obj.properties||(o.tpl.obj.properties={}),o.tpl.obj.properties.thumbSrc=e.data},function(){o.tpl.obj.properties.thumbSrc=null})},$(window).bind("beforeunload",function(){return"请确认您的微课已保存"}),o.$on("$destroy",function(){$(window).unbind("beforeunload"),m.clearHistory(),l.setCopy(!1),utilPictures.clearInterval()}),o.sortableOptions={placeholder:"ui-state-highlight ui-sort-position",containment:"#containment",update:function(e,t){var n=t.item.sortable.dropindex+1,a=o.pages[t.item.sortable.index].id;o.saveScene(null,function(){l.changePageSort(n,a).then(function(e){F(n,!1,!1,!0),c.$$search={},c.search("pageId",n),o.pageNum=n})})}},o.$on("history.changed",function(){o.canBack=m.canBack(o.tpl.obj.id),o.canForward=m.canForward(o.tpl.obj.id)}),o.back=function(){return o.completeHtml2Canvas?void o.completeHtml2Canvas.then(function(){o.back()}):(o.controlView.showBgTag=!1,void l.historyBack())},o.forward=function(){return o.completeHtml2Canvas?void o.completeHtml2Canvas.then(function(){o.forward()}):void l.historyForward()},o.openEffects=function(){o.tpl.obj.properties&&(o.tpl.obj.properties.scratch||o.tpl.obj.properties.finger||o.tpl.obj.properties.fallingObject||o.tpl.obj.properties.effect)||o.openPageEffectModal(o.tpl.obj.properties)},o.openBgPanel=function(){o.controlView.showBgTag||o.createComp("3")},o.openAudioPanel=function(){o.scene.bgAudio||o.openAudioModal()},o.closeOtherPanel=function(e){var t=!o.$eval(e);o.showBackgroundPanel=!1,o.showMusicPanel=!1,o.showEffectsPanel=!1,o.gridGuideSetting.showFlag=!1,o.$broadcast("hideBgOption"),o.showBgOptionPanel=!1,o.$eval(e+"="+t)},o.removeAudio=function(e){o.scene.bgAudio=null},o.sceneSetting={showFlag:!1,oldBgAudio:null},o.settingScene=function(){o.sceneSetting.showFlag=!0},"show"==c.search().openSetting&&e(function(){o.sceneSetting.showFlag=!0},100),o.$on("show.edit.bg",function(e,t){o.controlView.showBgTag=!0,o.currBgSrc=t}),o.gridGuideSetting={showFlag:!1},o.replaceBg=function(e){l.openBgModal(e),$("#nr").find(".wrapper-background").css({animation:"","animation-fill-mode":""})}}}]);