angular.module("visitor",["services.visitor"]),angular.module("visitor").controller("VisitorCtrl",["$rootScope","$http","$scope","$translate","showService","$location","usercenterService","visitorService",function(e,r,i,t,n,o,s,a){i.childCat="visitor",i.visitorId="12",i.pageNo=1,i.pageSize=12,i.visitorXq=function(e){o.path("/show/visitor/"+e)};var d=function(e){s.getAPPlyMessage(e).then(function(r){"province"===e?i.serverLabel=r.data.list:"company_industry"===e?i.cateLabel=r.data.list:"payType"===e&&(i.payLabel=r.data.list)})};d("province"),d("company_industry"),d("payType"),i.getLimitedServeRegion=function(e){return i.serverLabel.indexOf(e)<8},i.getOtherServeRegion=function(e){return i.serverLabel.indexOf(e)>=8&&(i.moreArea=!0),i.serverLabel.indexOf(e)>=8},i.getLimitedCateRegion=function(e){return i.cateLabel.indexOf(e)<11},i.getOtherCateRegion=function(e){return i.cateLabel.indexOf(e)>=11&&(i.moreLabel=!0),i.cateLabel.indexOf(e)>=11},a.getRecommendVisitor().then(function(e){if(i.recommendVisitor=e.data.obj,i.recommendVisitor.represent1){var r=i.recommendVisitor.represent1,t=r.substring(0,r.indexOf("_")),n=r.substring(r.indexOf("_")+1,r.length);i.work1Code=t,i.work1Name=n}if(i.recommendVisitor.represent2){var o=i.recommendVisitor.represent2,s=o.substring(0,o.indexOf("_")),a=o.substring(o.indexOf("_")+1,o.length);i.work2Code=s,i.work2Name=a}if(i.recommendVisitor.represent3){var d=i.recommendVisitor.represent3,l=d.substring(0,d.indexOf("_")),g=d.substring(d.indexOf("_")+1,d.length);i.work3Code=l,i.work3Name=g}i.recommendVisitor.headImg&&(0===i.recommendVisitor.headImg.indexOf("http://")?i.recommendVisitor.headImg=i.recommendVisitor.headImg:i.recommendVisitor.headImg=PREFIX_FILE_HOST+i.recommendVisitor.headImg)});var l={pay:null,addr:null,good:null};i.serverAll="all",i.cateAll="all",i.payAll="all",i.serverWu=function(e,r){i[r]="all","province"==e?(l.addr=null,i.currentServer=null):"company_industry"==e?(l.good=null,i.currentCate=null):"payType"==e&&(l.pay=null,i.currentPay=null),g(l.addr,l.pay,l.good,i.pageNo,i.pageSize)},i.subServer=function(e){i.currentServer=e,i.serverAll=null,l.addr=e.id,g(l.addr,l.pay,l.good,i.pageNo,i.pageSize)},i.subLabel=function(e){i.currentCate=e,i.cateAll=null,l.good=e.id,g(l.addr,l.pay,l.good,i.pageNo,i.pageSize)},i.subPay=function(e){i.currentPay=e,i.payAll=null,l.pay=e.id,g(l.addr,l.pay,l.good,i.pageNo,i.pageSize)},i.totalItems=0;var g=function(){a.getVisitorList(l.addr,l.pay,l.good,i.pageNo,i.pageSize).then(function(e){i.visitorList=e.data.list,i.totalItems=e.data.map.count,i.currentPage=e.data.map.pageNo,i.toPage=e.data.map.pageNo;for(var r=0;r<i.visitorList.length;r++){if(i.visitorList[r].represent1){var t=i.visitorList[r].represent1,n=t.substring(0,t.indexOf("_")),o=t.substring(t.indexOf("_")+1,t.length);i.visitorList[r].represent1Code=n,i.visitorList[r].represent1Name=o}if(i.visitorList[r].represent2){var s=i.visitorList[r].represent2,a=s.substring(0,s.indexOf("_")),d=s.substring(s.indexOf("_")+1,s.length);i.visitorList[r].represent2Code=a,i.visitorList[r].represent2Name=d}if(i.visitorList[r].represent3){var l=i.visitorList[r].represent3,g=l.substring(0,l.indexOf("_")),p=l.substring(l.indexOf("_")+1,l.length);i.visitorList[r].represent3Code=g,i.visitorList[r].represent3Name=p}i.visitorList[r].headImg&&(0===i.visitorList[r].headImg.indexOf("http://")?i.visitorList[r].headImg=i.visitorList[r].headImg:i.visitorList[r].headImg=PREFIX_FILE_HOST+i.visitorList[r].headImg)}})};g(),i.pageChanged=function(e){return i.pageNo=e,1>e||e>i.totalItems/12+1?void alert(t.instant("show.OVER_PAGE_NUMBER")):void g(l,e,i.pageSize)}}]);