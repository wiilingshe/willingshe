angular.module("usercenter.relEmail",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.relEmail").controller("RelEmailCtrl",["$rootScope","$scope","$window","$stateParams","usercenterService","security","$modal","ModalService","$location","userinfo","i18nNotifications","$translate",function(e,r,t,n,a,s,c,i,o,u,l,E){switch(r.title=u.title,r.userinfo=u,r.title){case E.instant("usercenter.account.REL_EMAIL"):r.dec=E.instant("usercenter.account.REL_EMAIL_DESC");break;case E.instant("usercenter.account.VALIDATE_EMAIL"):r.dec=E.instant("usercenter.account.VALIDATE_EMAIL_DESC");break;case E.instant("usercenter.account.CHANGE_EMAIL"):r.dec=E.instant("usercenter.account.CHANGE_EMAIL")}r.checkEmailFormat=function(e){var t=/^([a-zA-Z0-9]+[_|\_|\.|-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[\.|-]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return t.test(r.userinfo.email)?(r.emailFormatErr="",!0):(r.emailFormatErr=E.instant("usercenter.account.REL_EMAIL_TIP"),!1)},r.checkPassFormat=function(e){return e.password?(r.passFormatErr="",!0):(r.passFormatErr=E.instant("usercenter.account.PASSWORD_ERROR"),$(".email-pwd").focus(),!1)},r.relEmail=function(e){r.checkEmailFormat(e)&&r.checkPassFormat(e)&&(r.firstRel=null!=r.userinfo.checkEmail,a.relEmail(r.userinfo.email,r.userinfo.password,r.firstRel).then(function(e){200==e.data.code?(r.relErr="",i.openMsgDialog({msg:"申请绑定成功,已向您的邮箱发送验证邮件,请注意查收。"},function(){r.$dismiss()})):(r.firstRel=!0,r.relErr=e.data.msg)},function(e){}))},r.checkUpperCase=function(){/[A-Z]/g.test(r.userinfo.email)&&(r.userinfo.email=r.userinfo.email.toLowerCase(),r.relErr=E.instant("usercenter.account.EMAIL_TIP"))},r.cancel=function(){r.$dismiss()}}]);