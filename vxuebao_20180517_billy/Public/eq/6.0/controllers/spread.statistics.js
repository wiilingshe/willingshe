angular.module("spread.statistics").controller("StatisticsCtrl",["$translate","$scope","$stateParams","SpreadService","$rootScope","security",function(a,e,t,n,s,i){e.PREFIX_FILE_HOST=PREFIX_FILE_HOST,e.PREFIX_CLIENT_HOST=PREFIX_HOST,e.PREFIX_SERVER_HOST=PREFIX_URL,e.spreadViewGridOptions={},e.spreadMobileGridOptions={},e.spreadClickGridOptions={},e.sceneDeviceData=[],e.expandWebs=[],e.totalItems=0,e.page={currentPage:1},e.startDay=1,e.toPage="",e.dataPieChart=[];var d=s.branchid;e.isAllowedToAccessExpandWebsite=i.isAllowToAccess(i.accessDef.EXPAND_WEBSITE),e.viewStyle="line",e.dataLineChartDataOption={data:[[],[]],xAxis:[]},e.dataMobileChartOption={data:[[],[],[],[]],xAxis:[]},e.contentDataOption={data:[[],[]],xAxis:[]},e.showLine=function(){e.viewStyle="line"},e.showPie=function(){e.viewStyle="pie"},e.$on("scene.detail",function(t,n,s){if(e.scene=n,e.scene)switch(e.scene.type){case 101:e.sceneType=a.instant("main.spread.expand.SCENE_TYPE1");break;case 102:e.sceneType=a.instant("main.spread.expand.SCENE_TYPE2");break;case 103:e.sceneType=a.instant("main.spread.expand.SCENE_TYPE3");break;case 104:e.sceneType=a.instant("main.spread.expand.SCENE_TYPE4");break;case 105:e.sceneType=a.instant("main.spread.expand.SCENE_TYPE5")}}),e.$on("scene.data",function(a,t,n,s,i,d){e.stats=t,r(n,s,i,d)});var r=function(a,t,n,s){e.pageView=0,e.spreadClickGridOptions.data=e.stats,e.xAxisData=[],e.viewLineChartData=[],e.dataLineChartData=[],e.dataLineChartFriendGroup=[],e.dataLineChartFriends=[],e.dataLineChartFriend=[],e.dataLineChartOther=[],e.viewLineTel=[],e.viewLineTab=[],e.dataPieChart=[];for(var i=0,d=0,r=0,p=0,o=0,c=0;c<e.stats.length;c++)e.xAxisData.push(e.stats[c].STAT_DATE),e.viewLineChartData.push(e.stats[c].SHOW),e.dataLineChartData.push(e.stats[c].DATA),e.dataLineChartFriendGroup.push(e.stats[c].S_WX_TIMELINE),e.dataLineChartFriends.push(e.stats[c].S_WX_GROUP),e.dataLineChartFriend.push(e.stats[c].S_WX_SINGLE),e.viewLineTel.push(e.stats[c].TEL),e.viewLineTab.push(e.stats[c].LINK),e.dataOthers=e.stats[c].S_MOBILE-e.stats[c].S_WX_TIMELINE-e.stats[c].S_WX_SINGLE-e.stats[c].S_WX_GROUP,e.dataLineChartOther.push(e.dataOthers),e.pageView+=e.stats[c].SHOW,i+=e.stats[c].S_MOBILE,d+=e.stats[c].S_WX_TIMELINE,r+=e.stats[c].S_WX_SINGLE,p+=e.stats[c].S_WX_GROUP;e.spreadMobile=!0,i=1,i>0?(o=i-d-r-p,e.dataPieChart=[{value:d,name:"微信朋友圈"},{value:p,name:"微信群"},{value:r,name:"微信朋友"},{value:o,name:"其他访问"}]):e.spreadMobile=!1,e.dataLineChartDataOption={data:[e.viewLineChartData,e.dataLineChartData],xAxis:e.xAxisData},e.dataMobileChartOption={data:[e.dataLineChartFriendGroup,e.dataLineChartFriends,e.dataLineChartFriend,e.dataLineChartOther],xAxis:e.xAxisData},e.contentDataOption={data:[e.viewLineTel,e.viewLineTab],xAxis:e.xAxisData},$(".myGrid1").height(50*(e.stats.length+1)+1),$(".myGrid1 .ui-grid-viewport").height(50*e.stats.length+1)};if(e.getAllStats=function(a,t,s){e.model={startTime:t,endTime:s},n.getSceneData(a,t,s,d,e.expandId)},e.$on("webs.update",function(a){e.expandWebs=n.expandWebs}),e.viewExpandDetail=function(a,t){e.selectIndex=t,e.expandId=a,e.model?e.getAllStats(e.scene.id,e.model.startTime,e.model.endTime):e.getAllStats(e.scene.id,-6,1)},t.sceneId){var p=new Date;p=new Date(p.getTime()-864e5)}e.$on("region.update",function(a,t){for(var n=0;n<t.data.length;n++)switch((t.data[n].name.indexOf("省")>-1||t.data[n].name.indexOf("市")>-1)&&(t.data[n].name=t.data[n].name.substr(0,t.data[n].name.length-1)),t.data[n].name){case"内蒙古自治区":t.data[n].name="内蒙古";break;case"广西壮族自治区":t.data[n].name="广西";break;case"西藏自治区":t.data[n].name="西藏";break;case"新疆维吾尔自治区":t.data[n].name="新疆";break;case"香港特别行政区":t.data[n].name="香港";break;case"宁夏回族自治区":t.data[n].name="宁夏";break;case"澳门特别行政区":t.data[n].name="澳门"}if(t.max>0){var s=t.max.toString();t.max=(parseInt(s[0],10)+1)*Math.pow(10,s.length-1)}e.mapOption={data:t.data,maxValue:t.max},e.totalItems=t.data.length,e.totalItems>10?e.pageData=e.mapOption.data.slice(0,9):e.pageData=t.data}),e.changeMap=function(a){if(a!=e.startDay){e.startDay=a;var t=new Date;t=new Date(t.getTime()-864e5*a)}}}]);