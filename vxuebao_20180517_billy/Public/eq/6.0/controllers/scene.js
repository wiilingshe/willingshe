angular.module("scene",["services.scene","services.staticRes","app.directives.addelement"]),angular.module("scene").controller("SceneCtrl",["$window","$scope","$rootScope","$location","$translate","sceneService","$modal","ModalService","usercenterService","staticResService","$ocLazyLoad",function(e,t,n,a,l,o,r,p,c,s,i){t.PREFIX_FILE_HOST=PREFIX_FILE_HOST,t.PREFIX_CLIENT_HOST=PREFIX_HOST,t.isActive="scene",t.scene={type:null},t.totalItems=0,t.currentPage=1,t.toPage="",t.tabindex=0,t.childcat=0,t.order="new",t.pageSizeList=11;var g=0;t.pageNoNum=1,t.blankSample=!0,t.pageTplTypesList=[{type:"101",name:"行业"},{type:"102",name:"个人"},{type:"103",name:"企业"},{type:"104",name:"节假"},{},{}],t.getCompanyTpl=function(e,n){t.childcat=1;var a=11;t.childCatrgoryList=[],o.getCompanyTpls(t.pageNoNum,a).then(function(e){e.data.list&&e.data.list.length>0?(t.tpls=e.data.list,t.totalItems=e.data.map.count+1,t.currentPage=e.data.map.pageNo,t.allPageCount=e.data.map.count,t.toPage=""):t.tpls=[]})},t.pageChanged=function(e){return t.tplLoading=!0,u.targetPage=e,t.pageNoNum=e,t.toPage=e,t.pageNoNum>1?(t.blankSample=!1,t.pageSizeList=12):(t.blankSample=!0,t.pageSizeList=11),1>e||e>t.totalItems/11+1?void alert("此页超出范围"):void(1==t.childcat?t.getCompanyTpl(e,t.pageSizeList):t.getPageTpls(1,u.sceneType,u.tagId,e,t.pageSizeList,u.order))},t.preview=function(e){var t=PREFIX_HOST+"/v-"+e;window.open(t,"_blank")},t.getStyle=function(e){return{"background-image":"url("+PREFIX_FILE_HOST+e+")","background-size":"cover"}},t.previewScene=function(e){n.tplObj=e,a.path("/v-"+e.code)},t.createScene=function(e,n){if(n&&n.price){var a=parseFloat(n.price)||0;a&&a>t.userXd?p.openMsgDialog({msg:'当前选择需要消耗微币<font color="#ff6e6e">'+a+'</font>个<br/>微币余额不足(<font color="#ff6e6e">'+(t.userXd||0)+'</font>个)<span class="get-xd"><a href="http://bbs.e.wesambo.com/forum.php?mod=viewthread&tid=297&extra=page%3D1" target = "_blank">获取微币</a></span>'}):p.openConfirmDialog({msg:'当前选择需要消耗微币<font color="#ff6e6e">'+a+'</font>个<br/>微币余额为<font color="#ff6e6e">'+(t.userXd||0)+"</font>个"},function(){i.load("controllers/scene.create.new").then(function(){r.open({windowClass:"login-container six-contain",templateUrl:"/Public/eq/6.0/templates/scene.createNew.tpl.html",controller:"SceneNewCtrl",resolve:{items:function(){return{fileType:e,tpl:n}}}})})})}else i.load("controllers/scene.create.new").then(function(){r.open({windowClass:"login-container six-contain",templateUrl:"/Public/eq/6.0/templates/scene.createNew.tpl.html",controller:"SceneNewCtrl",resolve:{items:function(){return{fileType:e,tpl:n}}}})})},n.tplId&&c.getUserXd().then(function(e){t.userXd=e.data.obj||0}).then(function(){t.createScene(n.tplId)}).then(function(){n.tplId=null}),t.getStyle=function(e){return{"background-image":"url("+PREFIX_FILE_HOST+e+")"}},t.show=function(e){console.log(e.target),$(e.target).children(".cc").css("display","block")},t.pageTplTypes=s.getSceneType(),t.filterTpl=function(e,n){t.selete=!0,e?u.order=1:u.order=2,t.getPageTpls(null,u.sceneType,u.tagId,g,t.pageSizeList,u.order)};var u={sceneType:null,tagId:"",order:"",pageNo:"0",targetPage:""},d={},f=[];t.getPageTplsByType=function(e){u.sceneType=e,t.childcat=e,t.categoryId=0,d[e]?(f=d[e],f.length&&(m(),t.getPageTpls(1,u.sceneType,f[0].id,g,11,u.order))):o.getPageTplTypesTwo(e,e).then(function(n){f=d[e]=n.data.list,f.length&&(m(),t.getPageTpls(1,u.sceneType,f[0].id,g,11,u.order))})};var m=function(){var e,n=null,a=[];for(var l in f)f[l].groupId!==n&&(e=[],n=f[l].groupId,a.push(e)),e.push(f[l]);a.splice(4,1),a.length?t.newArrayGroupCat=a:t.newArrayGroupCat=[]};t.allpage=function(e){u.sceneType=e,t.childcat=0,t.getPageTpls(1,null,null,1,12,u.order),t.newArrayGroupCat=[],t.blankSample=!0},t.freeTplChoice="",t.freeTpl=function(e){t.freeTplChoice=e,t.tplnew(t.order)},t.getPageTpls=function(e,n,a,l,r,p){t.categoryId=a,u.tagId=a;var c=t.freeTplChoice?t.freeTplChoice+"=1":"";o.getPageTpls(e,n,a,l,r,p,c)},t.tplLoading=!0,t.getPageTpls(1,null,null,1,12),t.$on("getSampleList",function(e,n){if(n.list&&n.list.length>0){t.tpls=n.list,t.totalItems=n.map.count,t.currentPage=n.map.pageNo,t.allPageCount=n.map.count,t.toPage=n.map.pageNo;for(var a=0;a<t.tpls.length;a++)t.tpls[a].avatar&&(0===t.tpls[a].avatar.indexOf("http://")?t.tpls[a].avatar=t.tpls[a].avatar:t.tpls[a].avatar=PREFIX_FILE_HOST+t.tpls[a].avatar)}else t.tpls=[],t.totalItems=0,t.blankSample=!1;t.tplLoading=!1}),t.name=null,t.EnterPress=function(e,n){var a=e||window.event;13==a.keyCode&&t.submit(n)},t.searchButton=!0;var T={};t.submit=function(e){t.name=e,o.getPageTpls(1,null,null,g,t.pageSizeList,u.orderby,null,e),t.searchButton=!1,T.refresh=!0},t.changeName=function(e){t.searchButton=!0,""===e&&T.refresh&&o.getPageTpls(1,null,null,g,t.pageSizeList,u.orderby,null,e)},t.clearSearch=function(){t.searchButton=!0,t.name="",o.getPageTpls(1,null,null,g,t.pageSizeList,u.orderby,null)},t.userScene=function(e){o.getPageTpls(1,null,null,g,t.pageSizeList,u.orderby,null,null,e)}}]);