window.searchVal="",window.searchUrl="",window.oldSearchPage="pageNo=1",window.categoryUrl="",window.music=null,window.mytplList=[],!function(window,angular,undefined){function fallingObject(e,t){function n(e){e.clearRect(0,0,d,u);for(var t=0;t<g.length;t++)e.save(),e.translate(g[t].x,g[t].y),e.scale(g[t].scale,g[t].scale),e.rotate(g[t].rotate),e.fillRect(0,0,f,f),e.restore()}function i(){Math.random()<.02*s.density&&o(),r()}function r(){for(var e=0;e<g.length;e++)g[e].x+=g[e].vx,g[e].y+=g[e].vy,g[e].vy+=g[e].g;for(var t=0,e=0;e<g.length;e++)g[e].y<u-f&&g[e].x>-f&&g[e].x<d&&(g[t++]=g[e]);for(;g.length>t;)g.pop();g.length>m&&(g.length=m)}function o(){var e=.5*Math.random()+.3,t={x:Math.ceil(Math.random()*d),y:-f,g:.02*e*s.src.vy,vx:.05*Math.pow(-1,Math.ceil(1e3*Math.random())),vy:.01*e*s.src.vy,color:"yellow",scale:e,rotate:Math.pow(-1,Math.ceil(1e3*Math.random()))*Math.random()*(s.src.rotate||0)*Math.PI/180};g.push(t)}var a=e[t-1];if(a.properties){var s=a.properties.fallingObject||{};renderPage(eqShow,t,e);for(var c=0;c<e[t-1].elements.length;c++){var l=eqShow.selectElement(e[t-1].elements[c].id);eqxCommon.bindTrigger(l,e[t-1].elements[c])}var d=$(".m-img").width(),u=$(".m-img").height(),p=document.createElement("canvas");p.width=d,p.height=u,$(p).prependTo("#page"+t+" .edit_wrapper").attr("class","cas page_effect").attr("id","can"+t).attr("style","z-index: 0");var h=p.getContext("2d"),g=[],f=60,m=20,v=new Image;v.src=s.src.path,v.onload=function(){h.beginPath(),pattern=h.createPattern(v,"repeat"),h.fillStyle=pattern,h.closePath(),eqShow.stopFallingObject=setInterval(function(){n(h),i()},20)}}}function QR8bitByte(e){this.mode=QRMode.MODE_8BIT_BYTE,this.data=e}function QRCode(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=new Array}function QRPolynomial(e,t){if(e.length==undefined)throw new Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(var i=0;i<e.length-n;i++)this.num[i]=e[i+n]}function QRRSBlock(e,t){this.totalCount=e,this.dataCount=t}function QRBitBuffer(){this.buffer=new Array,this.length=0}function RainyDay(e,t){if(this===window)return new RainyDay(e,t);this.img=e.image;var n={opacity:1,blur:10,crop:[0,0,this.img.naturalWidth,this.img.naturalHeight],enableSizeChange:!0,parentElement:document.getElementsByTagName("body")[0],fps:30,fillStyle:"#8ED6FF",enableCollisions:!0,gravityThreshold:3,gravityAngle:Math.PI/2,gravityAngleVariance:0,reflectionScaledownFactor:5,reflectionDropMappingWidth:200,reflectionDropMappingHeight:200,width:this.img.clientWidth,height:this.img.clientHeight,position:"absolute",top:0,left:0};for(var i in n)"undefined"==typeof e[i]&&(e[i]=n[i]);this.options=e,this.drops=[],this.canvas=t||this.prepareCanvas(),this.prepareBackground(),this.prepareGlass(),this.reflection=this.REFLECTION_MINIATURE,this.trail=this.TRAIL_DROPS,this.gravity=this.GRAVITY_NON_LINEAR,this.collision=this.COLLISION_SIMPLE,this.setRequestAnimFrame()}function Drop(e,t,n,i,r){this.x=Math.floor(t),this.y=Math.floor(n),this.r=Math.random()*r+i,this.rainyday=e,this.context=e.context,this.reflection=e.reflected}function BlurStack(){this.r=0,this.g=0,this.b=0,this.next=null}function CollisionMatrix(e,t,n){this.resolution=n,this.xc=e,this.yc=t,this.matrix=new Array(e);for(var i=0;e+5>=i;i++){this.matrix[i]=new Array(t);for(var r=0;t+5>=r;++r)this.matrix[i][r]=new DropItem(null)}}function DropItem(e){this.drop=e,this.next=null}function randomRange(e,t){return Math.random()*(t-e)+e}function mobilecheck(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function isWeixin(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)}function isAndroid(){var e=navigator.userAgent,t=(navigator.appVersion,e.indexOf("Android")>-1||e.indexOf("Linux")>-1);return t}function tabletCheck(){var e=/ipad|android|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase());return e}function countCharacters(e){var t=0;if(!e)return 0;for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);i>=1&&126>=i||i>=65376&&65439>=i?t++:t+=2}return t}function playVideo(e){if(e&&e.bgAudio){var t=$("#media"),n=$("#audio_btn"),i=($("#yinfu"),"");e.bgAudio.url?i=0==e.bgAudio.url.indexOf("http://")?e.bgAudio.url:PREFIX_FILE_HOST+e.bgAudio.url:!e.bgAudio.url&&e.bgAudio.src&&(i=0==e.bgAudio.src.indexOf("http://")?e.bgAudio.src:PREFIX_FILE_HOST+e.bgAudio.src),t.attr("src",i),n.addClass("video_exist"),t.bind("canplay",function(){t.get(0).play()}).bind("play",function(){n.addClass("rotate")}).bind("pause",function(){n.removeClass("rotate")});var r=mobilecheck()?"touchend":"click";$("#audio_btn").show().on(r,function(e){e.stopPropagation(),$(this).hasClass("rotate")?t.get(0).pause():(t.get(0).play(),utilSound.pause())})}}function renderPage(e,t,n){e.templateParser("jsonParser").parse({def:n[t-1],appendTo:"#page"+t,mode:"view"});var i,r,o=1,a=$(".z-current").width(),s=$(".z-current").height();imageWidth=$(".m-img").width(),imageHeight=$(".m-img").height(),a/s>=320/486?(o=s/486,i=(a/o-320)/2):(o=a/320,r=(s/o-486)/2),window!=window.top&&$(".phoneBox .nr").css({width:"100%",height:"100%",overflow:"hidden","transform-origin":"top left",transform:"scale("+o+")"}),r&&$(".edit_area").css({marginTop:r}),i&&$(".edit_area").css({marginLeft:i}),tplCount==n.length&&$("#eqMobileViewport").attr("content","width=320, initial-scale="+o+", maximum-scale="+o+", user-scalable=no")}!function(e){function t(t){return t.classList?t.classList:e(t).attr("class").match(/\S+/gi)}e.fn.ShareLink=function(n){function i(e){var t=a[e];return t=t.replace("{url}",encodeURIComponent(n.url)),t=t.replace("{title}",encodeURIComponent(n.title)),t=t.replace("{text}",encodeURIComponent(n.text)),t=t.replace("{image}",encodeURIComponent(n.image))}var r={title:"",text:"",image:"",url:window.location.href,class_prefix:"s_"},n=e.extend({},r,n),o=n.class_prefix.length,a={};this.each(function(r,s){for(var c=t(s),r=0;r<c.length;r++){var l=c[r];if(l.substr(0,o)==n.class_prefix&&a[l.substr(o)]){var d=i(l.substr(o));e(s).attr("href",d).click(function(){var t=screen.width,i=screen.height,r=n.width?n.width:t-.2*t,o=n.height?n.height:i-.2*i,a=t/2-r/2,s=i/2-o/2,c="toolbar=0,status=0,width="+r+",height="+o+",top="+s+",left="+a;return window.open(e(this).attr("href"),"",c)&&!1})}}})}}(jQuery),function(e,t){e.completeEffect=function(e){return!e.find(".lock").get(0)}}(window,jQuery),function(){var e="ontouchstart"in window,t=e?"touchstart":"mousedown",n=e?"touchmove":"mousemove",i=e?"touchend":"mouseup";window.money={doEffect:function(r,o,a,s){function c(){I=9,R=0,P=0,_.onload=function(){F=_.width,H=_.height,D.drawImage(_,L.width/2-F/2,250)},_.width||(F=200,H=408),k.onload=function(){if(D.drawImage(k,0,0,L.width,L.height),!M){s(eqShow,o,a);for(var e=0;e<a[o-1].elements.length;e++){var t=eqShow.selectElement(a[o-1].elements[e].id);eqxCommon.bindTrigger(t,a[o-1].elements[e])}}f("开始"),m(0),u(),d(),l(a[o-1].properties.effect.tip)}}function l(e){D.font="20px Arial",D.textAlign="center",D.fillStyle="#FDE528",D.fillText(e,L.width/2,50)}function d(){D.fillStyle="rgba(0, 0, 0, 0.8)",D.fillRect(L.width/2-F/2+5,L.height-85,F-10,80),D.stroke(),D.font="16px Arial",D.textAlign="center",D.fillStyle="#FDE528",D.fillText("点击屏幕，开始数钱",L.width/2,L.height-35)}function u(){L.addEventListener(t,function(t){P++,1==P&&p(),E&&(clearInterval(E),w.y-N<-320&&(N=0)),z=!0;var n=e?t.targetTouches[0].pageX:t.pageX,i=e?t.targetTouches[0].pageY:t.pageY;w=h(L,n,i),S=w.x,x=w.y}),L.addEventListener(n,function(t){var n=e?t.targetTouches[0].pageX:t.pageX,i=e?t.targetTouches[0].pageY:t.pageY;w=h(L,n,i),T=w.x-S,C=w.y-x,z&&(D.drawImage(A,L.width/2-F/2,w.y),-20>C?(E=setInterval(g,40),R+=100,z=!1):(D.clearRect(0,0,L.width,L.height),D.drawImage(k,0,0,L.width,L.height),D.drawImage(_,L.width/2-F/2,250),A.onload=function(){D.drawImage(A,L.width/2-F/2,w.y),f(I),m(R)}))}),L.addEventListener(i,function(e){S=0,x=0,z&&(z=!1,E&&(clearInterval(E),N=0,fy=0),-20>C||(D.clearRect(0,0,L.width,L.height),D.drawImage(k,0,0,L.width,L.height),D.drawImage(_,L.width/2-F/2,250),f(I),m(R)))})}function p(){var e=setInterval(function(){I--,f(I),0>=I&&(clearInterval(e),$(L).unbind(t),b())},1e3)}function h(e,t,n){var i=e.getBoundingClientRect();return{x:t-i.left,y:n-i.top}}function g(){D.clearRect(0,0,L.width,L.height),D.drawImage(k,0,0,L.width,L.height),D.drawImage(_,L.width/2-F/2,250),D.drawImage(A,L.width/2-F/2,w.y-N),f(I),m(R),N+=150}function f(e){var t=D.createLinearGradient(L.width/2-90,50,L.width/2-90,120);t.addColorStop(0,"#F3AE28"),t.addColorStop(.5,"#FDE528"),t.addColorStop(1,"#F3AE28"),D.fillStyle=t,D.fillRect(L.width/2-80,90,160,40),D.stroke(),D.font="30px Arial",D.textAlign="center",D.fillStyle="#ff0000",isNaN(e)?D.fillText(e,L.width/2,120):D.fillText(e+"秒",L.width/2,120)}function m(e){D.fillStyle="#FFF",D.roundRect(L.width/2-120,160,240,60,10).stroke(),D.font="30px Arial",D.textAlign="center",D.fillStyle="#FDE528",D.fillText("?? "+e,L.width/2,205)}function v(){$("#mask_"+o).remove(),$("#alert_"+o).remove(),M=!0,c()}function y(){$("#mask_"+o).remove(),$("#alert_"+o).remove(),$("#money_"+o).removeClass("lock").addClass("unlock").css("display","none"),$("#page"+o).empty(),s(eqShow,o,a),$("#audio_btn").css("opacity",1),1==o&&playVideo(r);for(var e=0;e<a[o-1].elements.length;e++){var t=eqShow.selectElement(a[o-1].elements[e].id);eqxCommon.bindTrigger(t,a[o-1].elements[e])}}function b(){$('<div class="money_mask"></div>').appendTo($("#page"+o)).attr("id","mask_"+o),$('<div class="money_modal"></div>').appendTo($("#page"+o)).attr("id","alert_"+o),$('<div class="money_img"></div>').appendTo($("#alert_"+o)).attr("id","img_"+o),$('<div class="money_text">恭喜你！<br>2015年每天赚'+R+"元！</div>").appendTo($("#alert_"+o)).attr("id","text_"+o),$('<a class="button tryOnce">再来一次</a>').appendTo($("#alert_"+o)).attr("id","try_"+o),$('<a class="button enterScene">进入微课</a>').appendTo($("#alert_"+o)).attr("id","enter_"+o);var e="标准屌丝";R>=5500&&12e3>=R?e="初级土豪":R>12e3&&(e="高级土豪"),$('<div class="level_text">'+e+"</div>").appendTo("#alert_"+o),$('<div class="tip-text">仅供娱乐</div>').appendTo("#alert_"+o),$("#try_"+o).on("click",function(){v()}),$("#enter_"+o).on("click",function(){y()})}$('<canvas class="money page_effect lock"></canvas>').prependTo($("#page"+o)).attr("id","money_"+o);var w,E,S,x,T,C,I,R,P,M,_,k,A,L=document.getElementById("money_"+o),D=L.getContext("2d"),z=!1,F=0,N=0,H=0;return L.width=$(".z-current").width(),L.height=$(".z-current").height(),_=new Image,_.src=CLIENT_CDN+"assets/images/money/moremoney.png",k=new Image,k.src=CLIENT_CDN+"assets/images/money/moneybg.png",A=new Image,A.src=CLIENT_CDN+"assets/images/money/flymoney.png",c(),window.money}},CanvasRenderingContext2D.prototype.roundRect=function(e,t,n,i,r){return 2*r>n&&(r=n/2),2*r>i&&(r=i/2),this.beginPath(),this.moveTo(e+r,t),this.strokeStyle="#FDE528",this.arcTo(e+n,t,e+n,t+i,r),this.arcTo(e+n,t+i,e,t+i,r),this.arcTo(e,t+i,e,t,r),this.arcTo(e,t,e+n,t,r),this.closePath(),this.fillStyle="#FDE528",this}}(),function(){window.eqx={},window.eqx.money={config:{mode:3,effectCallback:"editMoney",imageCallback:"countMoney",resources:[{url:CLIENT_CDN+"view/js/countMoney.js",type:"js"},{url:CLIENT_CDN+"assets/images/money/moneybg.png",type:"image"},{url:CLIENT_CDN+"assets/images/money/moremoney.png",type:"image"},{url:CLIENT_CDN+"assets/images/money/flymoney.png",type:"image"},{url:CLIENT_CDN+"assets/images/money/float.png",type:"image"},{url:CLIENT_CDN+"assets/images/money/float2.png",type:"image"},{url:CLIENT_CDN+"assets/images/money/float3.png",type:"image"}]}},window.eqx.snowFly={config:{mode:4,effectCallback:"flyAction",resources:[{url:CLIENT_CDN+"view/js/effect/snoweffect.js",type:"js"},{url:CLIENT_CDN+"view/js/effect/threecanvas.js",type:"js"}]}},window.eqx.rainyDay={config:{mode:4,effectCallback:"rainyEffect",resources:[{url:CLIENT_CDN+"view/js/effect/rainyday.js",type:"js"},{url:CLIENT_CDN+"view/js/effect/rainyeffect.js",type:"js"}]}},window.eqx.fireWorks={config:{mode:4,effectCallback:"fireWorks",resources:[{url:CLIENT_CDN+"view/js/effect/fireworks.js",type:"js"}]}}}(),function(){function e(e){resources.loaded=!0,e instanceof Array?e.forEach(function(e){t(e)}):t(e)}function t(e){if("loading"!=o[e.url]){if(o[e.url])return o[e.url];if(o[e.url]=!1,"image"==e.type){var t=new Image;o[e.url]="loading",t.onload=function(){o[e.url]=t,i()&&a.forEach(function(e){e()})},t.src=e.url}else"js"==e.type&&(o[e.url]="loading",$.getScript(e.url,function(t,n,r){o[e.url]=!0,i()&&a.forEach(function(e){e()})}))}}function n(e){return o[e]}function i(){var e=!0;for(var t in o)if(o.hasOwnProperty(t)&&(!o[t]||"loading"==o[t]))return!1;return e}function r(e){a.push(e)}var o={},a=[];window.resources={load:e,get:n,onReady:r,isReady:i}}(),function(e,t){function n(e){function t(e,t,n){return e[t]||(e[t]=n())}var n=t(e,"eqShow",Object);return t(n,"templateParser",function(){var e={};return function(n,i){if("hasOwnProperty"===n)throw new Error("hasOwnProperty is not a valid name");return i&&e.hasOwnProperty(n)&&(e[n]=null),t(e,n,i)}})}function i(t){templateParser=n(e)}var r=e.eqShow||(e.eqShow={});i(r)}(window,document),function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,5e3)}}();var e;eqShow.stopFireworkEffect=function(){e=!0},window.fireWorks={doEffect:function(t,n,i,r){function o(){if(!e){requestAnimFrame(o),b=a(0,1e3),p.globalCompositeOperation="destination-out",p.fillStyle="rgba(0, 0, 0, 0.5)",p.fillRect(0,0,f,m),p.globalCompositeOperation="lighter";for(var t=v.length;t--;)v[t].draw(),v[t].update(t);for(var t=y.length;t--;)y[t].draw(),y[t].update(t);x>=S?T||(v.push(new c(f/2,m,a(0,f),a(0,m/2))),x=0):x++,E>=w?T&&(v.push(new c(f/2,m,h,g)),E=0):E++}}function a(e,t){return Math.random()*(t-e)+e}function s(e,t,n,i){var r=e-n,o=t-i;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}function c(e,t,n,i){for(this.x=e,this.y=t,this.sx=e,this.sy=t,this.tx=n,this.ty=i,this.distanceToTarget=s(e,t,n,i),this.distanceTraveled=0,this.coordinates=[],this.coordinateCount=3;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=Math.atan2(i-t,n-e),this.speed=10,this.acceleration=1.05,this.brightness=a(50,120)}function l(e,t){for(this.x=e,this.y=t,this.coordinates=[],this.coordinateCount=5;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=a(0,2*Math.PI),this.speed=a(1,10),this.friction=.95,this.gravity=1,this.hue=a(b-100,b+100),this.brightness=a(20,80),this.alpha=1,this.decay=a(.01,.015)}function d(e,t){for(var n=100;n--;)y.push(new l(e,t))}var u,p,h,g,f=window.innerWidth,m=window.innerHeight,v=[],y=[],b=200,w=7,E=0,S=20,x=0,T=!1;e=!1,r(eqShow,n,i);for(var C=0;C<i[n-1].elements.length;C++){var I=eqShow.selectElement(i[n-1].elements[C].id);eqxCommon.bindTrigger(I,i[n-1].elements[C])}1==n&&playVideo(t),$('<canvas id="fireworks'+n+'"></canvas>').prependTo("#page"+n).css({position:"absolute",zIndex:1}),u=document.getElementById("fireworks"+n),p=u.getContext("2d"),u.width=f,u.height=m,o(),c.prototype.update=function(e){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.acceleration;var t=Math.cos(this.angle)*this.speed,n=Math.sin(this.angle)*this.speed;this.distanceTraveled=s(this.sx,this.sy,this.x+t,this.y+n),this.distanceTraveled>=this.distanceToTarget?(d(this.tx,this.ty),v.splice(e,1)):(this.x+=t,this.y+=n)},c.prototype.draw=function(){p.beginPath(),p.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),p.lineTo(this.x,this.y),p.strokeStyle="hsl("+b+", 100%, "+this.brightness+"%)",p.stroke(),p.beginPath(),p.arc(this.tx,this.ty,0,0,2*Math.PI),p.stroke()},l.prototype.update=function(e){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&y.splice(e,1)},l.prototype.draw=function(){p.beginPath(),p.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),p.lineTo(this.x,this.y),p.strokeStyle="hsla("+this.hue+", 100%, "+this.brightness+"%, "+this.alpha+")",p.stroke()}}}}(),window.flux={version:"1.4.4"},function(e){flux.slider=function(t,n){flux.browser.init(),flux.browser.supportsTransitions||window.console&&window.console.error&&console.error("Flux Slider requires a browser that supports CSS3 transitions");var i=this;this.element=e(t),this.transitions=[];for(var r in flux.transitions)this.transitions.push(r);this.options=e.extend({autoplay:!0,transitions:this.transitions,delay:4e3,pagination:!0,controls:!1,captions:!1,width:null,height:null,onTransitionEnd:null,onStartEnd:null,bgColor:""},n),this.height=this.options.height?this.options.height:null,this.width=this.options.width?this.options.width:null;var o=[];e(this.options.transitions).each(function(e,t){var n=new flux.transitions[t](this),i=!0;n.options.requires3d&&!flux.browser.supports3d&&(i=!1),n.options.compatibilityCheck&&(i=n.options.compatibilityCheck()),i&&o.push(t)}),this.options.transitions=o,this.images=new Array,this.imageLoadedCount=0,this.currentImageIndex=0,this.nextImageIndex=1,this.playing=!1,this.container=e('<div class="fluxslider"></div>').appendTo(this.element),this.surface=e('<div class="surface" style="position: relative"></div>').appendTo(this.container),this.container.bind("click",function(t){e(t.target).hasClass("hasLink")&&(window.location=e(t.target).data("href"))}),this.imageContainer=e('<div class="images loading1"></div>').css({position:"relative",overflow:"hidden"}).appendTo(this.surface),this.width&&this.height&&this.imageContainer.css({width:this.width+"px",height:this.height+"px"}),this.image1=e('<div class="image1" style="height: 100%; width: 100%"></div>').appendTo(this.imageContainer),this.image2=e('<div class="image2" style="height: 100%; width: 100%"></div>').appendTo(this.imageContainer),e(this.image1).add(this.image2).css({position:"absolute",top:"0px",left:"0px"}),this.element.find("img, a img").each(function(t,n){var r=n.cloneNode(!1),o=e(n).parent();o.is("a")&&e(r).data("href",o.attr("href")),i.images.push(r),e(n).remove()});for(var a=0;a<this.images.length;a++){var s=new Image;s.onload=function(){i.imageLoadedCount++,i.width=i.width?i.width:this.width,i.height=i.height?i.height:this.height,i.imageLoadedCount>=i.images.length&&(i.finishedLoading(),i.setupImages())},s.src=this.images[a].src}this.element.bind("fluxTransitionEnd",function(e,t){i.options.onTransitionEnd&&(e.preventDefault(),i.options.onTransitionEnd(t))}),this.options.autoplay&&this.start();var c={},l={},d=20;this.element.bind("mousedown touchstart",function(e){"touchstart"==e.type?c.left=e.originalEvent.touches[0].pageX:"mousedown"==e.type&&(c.left=e.pageX)}).bind("mouseup touchend",function(e){"touchend"==e.type?l.left=e.originalEvent.changedTouches[0].pageX:"mouseup"==e.type&&(l.left=e.pageX),l.left-c.left>d?i.prev(null,{direction:"right"}):c.left-l.left>d&&i.next(null,{direction:"left"}),i.options.autoplay&&(i.stop(),i.start())}),setTimeout(function(){e(window).focus(function(){i.isPlaying()&&i.next()})},100)},flux.slider.prototype={constructor:flux.slider,playing:!1,start:function(){var e=this;this.playing=!0,this.interval=setInterval(function(){e.transition()},this.options.delay),"function"==typeof this.options.onStartEnd&&this.options.onStartEnd(this.interval)},stop:function(){this.playing=!1,clearInterval(this.interval),this.interval=null},isPlaying:function(){return this.playing},next:function(e,t){t=t||{},t.direction="left",this.showImage(this.currentImageIndex+1,e,t)},prev:function(e,t){t=t||{},t.direction="right",this.showImage(this.currentImageIndex-1,e,t)},showImage:function(e,t,n){this.setNextIndex(e),this.setupImages(),this.transition(t,n)},finishedLoading:function(){var t=this;if(this.container.css({width:this.width+"px",height:this.height+"px"}),this.imageContainer.removeClass("loading1"),this.options.pagination&&(this.pagination=e('<ul class="pagination"></ul>').css({margin:"0px",padding:"0px","text-align":"center"}),this.pagination.bind("click",function(n){n.preventDefault(),t.showImage(e(n.target).data("index"))}),e(this.images).each(function(n,i){var r=e('<li data-index="'+n+'">'+(n+1)+"</li>").css({display:"inline-block","margin-left":"0.5em",cursor:"pointer"}).appendTo(t.pagination);0==n&&r.css("margin-left",0).addClass("current")}),this.container.append(this.pagination)),e(this.imageContainer).css({width:this.width+"px",height:this.height+"px"}),e(this.image1).css({width:this.width+"px",height:this.height+"px"}),e(this.image2).css({width:this.width+"px",height:this.height+"px"}),this.container.css({width:this.width+"px",height:this.height+(this.options.pagination?this.pagination.height():0)+"px"}),this.options.controls){var n={padding:"4px 10px 10px","font-size":"60px","font-family":"arial, sans-serif","line-height":"1em","font-weight":"bold",color:"#FFF","text-decoration":"none",background:"rgba(0,0,0,0.5)",position:"absolute","z-index":2e3};this.nextButton=e('<a href="#">??</a>').css(n).css3({"border-radius":"4px"}).appendTo(this.surface).bind("click",function(e){e.preventDefault(),t.next()}),this.prevButton=e('<a href="#">??</a>').css(n).css3({"border-radius":"4px"}).appendTo(this.surface).bind("click",function(e){e.preventDefault(),t.prev()});var i=(this.height-this.nextButton.height())/2;this.nextButton.css({top:i+"px",right:"10px"}),this.prevButton.css({top:i+"px",left:"10px"})}this.options.captions&&(this.captionBar=e('<div class="caption"></div>').css({background:"rgba(0,0,0,0.6)",color:"#FFF","font-size":"16px","font-family":"helvetica, arial, sans-serif","text-decoration":"none","font-weight":"bold",padding:"1.5em 1em",opacity:0,position:"absolute","z-index":110,width:"100%",bottom:0}).css3({"transition-property":"opacity","transition-duration":"800ms","box-sizing":"border-box"}).prependTo(this.surface)),this.updateCaption()},setupImages:function(){var t=this.getImage(this.currentImageIndex),n={background:'url("'+t.src+'") 50% 50% / contain no-repeat '+this.options.bgColor,zIndex:101,cursor:"auto"};e(t).data("href")?(n.cursor="pointer",this.image1.addClass("hasLink"),this.image1.data("href",e(t).data("href"))):(this.image1.removeClass("hasLink"),this.image1.data("href",null)),this.image1.css(n).children().remove(),this.image2.css({background:'url("'+this.getImage(this.nextImageIndex).src+'") 50% 50% / contain no-repeat '+this.options.bgColor,zIndex:100}),this.options.pagination&&this.pagination&&(this.pagination.find("li.current").removeClass("current"),e(this.pagination.find("li")[this.currentImageIndex]).addClass("current"))},transition:function(t,n){if(t==undefined||!flux.transitions[t]){var i=Math.floor(Math.random()*this.options.transitions.length);t=this.options.transitions[i]}var r=null;try{r=new flux.transitions[t](this,e.extend(this.options[t]?this.options[t]:{},n))}catch(e){r=new flux.transition(this,{fallback:!0})}r.run(),this.currentImageIndex=this.nextImageIndex,this.setNextIndex(this.currentImageIndex+1),this.updateCaption()},updateCaption:function(){var t=e(this.getImage(this.currentImageIndex)).attr("title");this.options.captions&&this.captionBar&&(""!==t&&this.captionBar.html(t),this.captionBar.css("opacity",""===t?0:1))},getImage:function(e){return e%=this.images.length,this.images[e]},setNextIndex:function(e){e==undefined&&(e=this.currentImageIndex+1),this.nextImageIndex=e,this.nextImageIndex>this.images.length-1&&(this.nextImageIndex=0),this.nextImageIndex<0&&(this.nextImageIndex=this.images.length-1)},increment:function(){this.currentImageIndex++,this.currentImageIndex>this.images.length-1&&(this.currentImageIndex=0)}}}(window.jQuery||window.Zepto),function(e){flux.browser={init:function(){if(flux.browser.supportsTransitions===undefined){var t=(document.createElement("div"),["-webkit","-moz","-o","-ms"]);if(window.Modernizr&&Modernizr.csstransitions!==undefined?flux.browser.supportsTransitions=Modernizr.csstransitions:flux.browser.supportsTransitions=this.supportsCSSProperty("Transition"),window.Modernizr&&Modernizr.csstransforms3d!==undefined)flux.browser.supports3d=Modernizr.csstransforms3d;else if(flux.browser.supports3d=this.supportsCSSProperty("Perspective"),flux.browser.supports3d&&"webkitPerspective"in e("body").get(0).style){var n=e('<div id="csstransform3d"></div>'),i=e('<style media="(transform-3d), ('+t.join("-transform-3d),(")+'-transform-3d)">div#csstransform3d { position: absolute; left: 9px }</style>');e("body").append(n),e("head").append(i),flux.browser.supports3d=9==n.get(0).offsetLeft,n.remove(),i.remove()}}},supportsCSSProperty:function(e){for(var t=document.createElement("div"),n=["Webkit","Moz","O","Ms"],i=!1,r=0;r<n.length;r++)n[r]+e in t.style&&(i=i||!0);return i},translate:function(e,t,n){return e=e!=undefined?e:0,t=t!=undefined?t:0,n=n!=undefined?n:0,"translate"+(flux.browser.supports3d?"3d(":"(")+e+"px,"+t+(flux.browser.supports3d?"px,"+n+"px)":"px)")},rotateX:function(e){return flux.browser.rotate("x",e)},rotateY:function(e){return flux.browser.rotate("y",e)},rotateZ:function(e){return flux.browser.rotate("z",e)},rotate:function(e,t){return!e in{x:"",y:"",z:""}&&(e="z"),t=t!=undefined?t:0,flux.browser.supports3d?"rotate3d("+("x"==e?"1":"0")+", "+("y"==e?"1":"0")+", "+("z"==e?"1":"0")+", "+t+"deg)":"z"==e?"rotate("+t+"deg)":""}},e(function(){flux.browser.init()})}(window.jQuery||window.Zepto),function(e){e.fn.css3=function(e){var t={},n=["webkit","moz","ms","o"];for(var i in e){for(var r=0;r<n.length;r++)t["-"+n[r]+"-"+i]=e[i];t[i]=e[i]}return this.css(t),this},e.fn.transitionEnd=function(t){for(var n=["webkitTransitionEnd","transitionend","oTransitionEnd"],i=0;i<n.length;i++)this.bind(n[i],function(i){for(var r=0;r<n.length;r++)e(this).unbind(n[r]);t&&t.call(this,i)});return this},flux.transition=function(t,n){if(this.options=e.extend({requires3d:!1,after:function(){}},n),this.slider=t,this.options.requires3d&&!flux.browser.supports3d||!flux.browser.supportsTransitions||this.options.fallback===!0){var i=this;this.options.after=undefined,this.options.setup=function(){i.fallbackSetup()},this.options.execute=function(){i.fallbackExecute()}}},flux.transition.prototype={constructor:flux.transition,hasFinished:!1,run:function(){var e=this;this.options.setup!==undefined&&this.options.setup.call(this),this.slider.image1.css({"background-image":"none"}),this.slider.imageContainer.css("overflow",this.options.requires3d?"visible":"hidden"),setTimeout(function(){e.options.execute!==undefined&&e.slider.image1.css("background-color",""),e.options.execute.call(e)},5)},finished:function(){this.hasFinished||(this.hasFinished=!0,this.options.after&&this.options.after.call(this),this.slider.imageContainer.css("overflow","hidden"),this.slider.setupImages(),this.slider.element.trigger("fluxTransitionEnd",{currentImage:this.slider.getImage(this.slider.currentImageIndex)}))},fallbackSetup:function(){},fallbackExecute:function(){this.finished()}},flux.transitions={},flux.transition_grid=function(t,n){return new flux.transition(t,e.extend({columns:6,rows:6,forceSquare:!1,setup:function(){var t=this.slider.image1.width(),n=this.slider.image1.height(),i=Math.floor(t/this.options.columns),r=Math.floor(n/this.options.rows);this.options.forceSquare&&(r=i,this.options.rows=Math.floor(n/r));for(var o=t-this.options.columns*i,a=Math.ceil(o/this.options.columns),s=n-this.options.rows*r,c=Math.ceil(s/this.options.rows),l=(this.slider.image1.height(),0),d=0,u=document.createDocumentFragment(),p=0;p<this.options.columns;p++){var h=i,d=0;if(o>0){var g=o>=a?a:o;h+=g,o-=g}for(var f=0;f<this.options.rows;f++){var m=r,v=s;if(v>0){var g=v>=c?c:v;m+=g,v-=g}var y=e('<div class="tile tile-'+p+"-"+f+'"></div>').css({width:h+"px",height:m+"px",position:"absolute",top:d+"px",left:l+"px"});this.options.renderTile.call(this,y,p,f,h,m,l,d),u.appendChild(y.get(0)),d+=m}l+=h}this.slider.image1.get(0).appendChild(u)},execute:function(){var e=this,t=this.slider.image1.height(),n=this.slider.image1.find("div.barcontainer");this.slider.image2.hide(),n.last().transitionEnd(function(t){e.slider.image2.show(),e.finished()}),n.css3({transform:flux.browser.rotateX(-90)+" "+flux.browser.translate(0,t/2,t/2)})},renderTile:function(e,t,n,i,r,o,a){}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.bars=function(t,n){return new flux.transition_grid(t,e.extend({columns:10,rows:1,delayBetweenBars:40,renderTile:function(t,n,i,r,o,a,s){e(t).css({background:this.slider.image1.css("background"),"background-size":this.slider.width+"px "+this.slider.height+"px","background-position":"-"+a+"px 0px"}).css3({"transition-duration":"400ms","transition-timing-function":"ease-in","transition-property":"all","transition-delay":n*this.options.delayBetweenBars+"ms"})},execute:function(){var t=this,n=this.slider.image1.height(),i=this.slider.image1.find("div.tile");e(i[i.length-1]).transitionEnd(function(){t.finished()}),setTimeout(function(){i.css({opacity:"0.5"}).css3({transform:flux.browser.translate(0,n)})},50)}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.bars3d=function(t,n){return new flux.transition_grid(t,e.extend({requires3d:!0,columns:7,rows:1,delayBetweenBars:150,perspective:1e3,renderTile:function(t,n,i,r,o,a,s){var c=e('<div class="bar-'+n+'"></div>').css({width:r+"px",height:"100%",position:"absolute",top:"0px",left:"0px","z-index":200,background:this.slider.image1.css("background"),"background-size":this.slider.width+"px "+this.slider.height+"px","background-position":"-"+a+"px 0px","background-repeat":"no-repeat"}).css3({"backface-visibility":"hidden"}),l=e(c.get(0).cloneNode(!1)).css({"background-image":this.slider.image2.css("background-image")}).css3({transform:flux.browser.rotateX(90)+" "+flux.browser.translate(0,-o/2,o/2)}),d=e('<div class="side bar-'+n+'"></div>').css({
width:o+"px",height:o+"px",position:"absolute",top:"0px",left:"0px",background:"#222","z-index":190}).css3({transform:flux.browser.rotateY(90)+" "+flux.browser.translate(o/2,0,-o/2)+" "+flux.browser.rotateY(180),"backface-visibility":"hidden"}),u=e(d.get(0).cloneNode(!1)).css3({transform:flux.browser.rotateY(90)+" "+flux.browser.translate(o/2,0,r-o/2)});e(t).css({width:r+"px",height:"100%",position:"absolute",top:"0px",left:a+"px","z-index":n>this.options.columns/2?1e3-n:1e3}).css3({"transition-duration":"800ms","transition-timing-function":"linear","transition-property":"all","transition-delay":n*this.options.delayBetweenBars+"ms","transform-style":"preserve-3d"}).append(c).append(l).append(d).append(u)},execute:function(){this.slider.image1.css3({perspective:this.options.perspective,"perspective-origin":"50% 50%"}).css({"-moz-transform":"perspective("+this.options.perspective+"px)","-moz-perspective":"none","-moz-transform-style":"preserve-3d"});var e=this,t=this.slider.image1.height(),n=this.slider.image1.find("div.tile");this.slider.image2.hide(),n.last().transitionEnd(function(t){e.slider.image1.css3({"transform-style":"flat"}),e.slider.image2.show(),e.finished()}),setTimeout(function(){n.css3({transform:flux.browser.rotateX(-90)+" "+flux.browser.translate(0,t/2,t/2)})},50)}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.blinds=function(t,n){return new flux.transitions.bars(t,e.extend({execute:function(){var t=this,n=(this.slider.image1.height(),this.slider.image1.find("div.tile"));e(n[n.length-1]).transitionEnd(function(){t.finished()}),setTimeout(function(){n.css({opacity:"0.5"}).css3({transform:"scalex(0.0001)"})},50)}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.zip=function(t,n){return new flux.transitions.bars(t,e.extend({execute:function(){var t=this,n=this.slider.image1.height(),i=this.slider.image1.find("div.tile");e(i[i.length-1]).transitionEnd(function(){t.finished()}),setTimeout(function(){i.each(function(t,i){e(i).css({opacity:"0.3"}).css3({transform:flux.browser.translate(0,t%2?"-"+2*n:n)})})},20)}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.blocks=function(t,n){return new flux.transition_grid(t,e.extend({forceSquare:!0,delayBetweenBars:100,renderTile:function(t,n,i,r,o,a,s){var c=Math.floor(10*Math.random()*this.options.delayBetweenBars);e(t).css({background:this.slider.image1.css("background"),"background-size":this.slider.width+"px "+this.slider.height+"px","background-position":"-"+a+"px -"+s+"px"}).css3({"transition-duration":"350ms","transition-timing-function":"ease-in","transition-property":"all","transition-delay":c+"ms"}),this.maxDelay===undefined&&(this.maxDelay=0),c>this.maxDelay&&(this.maxDelay=c,this.maxDelayTile=t)},execute:function(){var t=this,n=this.slider.image1.find("div.tile");this.maxDelayTile.transitionEnd(function(){t.finished()}),setTimeout(function(){n.each(function(t,n){e(n).css({opacity:"0"}).css3({transform:"scale(0.8)"})})},50)}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.blocks2=function(t,n){return new flux.transition_grid(t,e.extend({cols:12,forceSquare:!0,delayBetweenDiagnols:150,renderTile:function(t,n,i,r,o,a,s){Math.floor(10*Math.random()*this.options.delayBetweenBars),e(t).css({background:this.slider.image1.css("background"),"background-size":this.slider.width+"px "+this.slider.height+"px","background-position":"-"+a+"px -"+s+"px"}).css3({"transition-duration":"350ms","transition-timing-function":"ease-in","transition-property":"all","transition-delay":(n+i)*this.options.delayBetweenDiagnols+"ms","backface-visibility":"hidden"})},execute:function(){var t=this,n=this.slider.image1.find("div.tile");n.last().transitionEnd(function(){t.finished()}),setTimeout(function(){n.each(function(t,n){e(n).css({opacity:"0"}).css3({transform:"scale(0.8)"})})},50)}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.cube=function(t,n){return new flux.transition(t,e.extend({requires3d:!0,barWidth:100,direction:"left",perspective:1e3,setup:function(){var t=this.slider.image1.width(),n=this.slider.image1.height();this.slider.image1.css3({perspective:this.options.perspective,"perspective-origin":"50% 50%"}),this.cubeContainer=e('<div class="cube"></div>').css({width:t+"px",height:n+"px",position:"relative"}).css3({"transition-duration":"800ms","transition-timing-function":"linear","transition-property":"all","transform-style":"preserve-3d"});var i={height:"100%",width:"100%",position:"absolute",top:"0px",left:"0px"},r=e('<div class="face current"></div>').css(e.extend(i,{background:this.slider.image1.css("background"),"background-size":this.slider.width+"px "+this.slider.height+"px"})).css3({"backface-visibility":"hidden"});this.cubeContainer.append(r);var o=e('<div class="face next"></div>').css(e.extend(i,{background:this.slider.image2.css("background-image")})).css3({transform:this.options.transitionStrings.call(this,this.options.direction,"nextFace"),"backface-visibility":"hidden"});this.cubeContainer.append(o),this.slider.image1.append(this.cubeContainer)},execute:function(){var e=this;this.slider.image1.width(),this.slider.image1.height(),this.slider.image2.hide(),this.cubeContainer.transitionEnd(function(){e.slider.image2.show(),e.finished()}),setTimeout(function(){e.cubeContainer.css3({transform:e.options.transitionStrings.call(e,e.options.direction,"container")})},50)},transitionStrings:function(e,t){var n=this.slider.image1.width(),i=this.slider.image1.height(),r={up:{nextFace:flux.browser.rotateX(-90)+" "+flux.browser.translate(0,i/2,i/2),container:flux.browser.rotateX(90)+" "+flux.browser.translate(0,-i/2,i/2)},down:{nextFace:flux.browser.rotateX(90)+" "+flux.browser.translate(0,-i/2,i/2),container:flux.browser.rotateX(-90)+" "+flux.browser.translate(0,i/2,i/2)},left:{nextFace:flux.browser.rotateY(90)+" "+flux.browser.translate(n/2,0,n/2),container:flux.browser.rotateY(-90)+" "+flux.browser.translate(-n/2,0,n/2)},right:{nextFace:flux.browser.rotateY(-90)+" "+flux.browser.translate(-n/2,0,n/2),container:flux.browser.rotateY(90)+" "+flux.browser.translate(n/2,0,n/2)}};return!(!r[e]||!r[e][t])&&r[e][t]}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.tiles3d=function(t,n){return new flux.transition_grid(t,e.extend({requires3d:!0,forceSquare:!0,columns:5,perspective:600,delayBetweenBarsX:200,delayBetweenBarsY:150,renderTile:function(t,n,i,r,o,a,s){var c=e("<div></div>").css({width:r+"px",height:o+"px",position:"absolute",top:"0px",left:"0px",background:this.slider.image1.css("background"),"background-size":this.slider.width+"px "+this.slider.height+"px","background-position":"-"+a+"px -"+s+"px","background-repeat":"no-repeat","-moz-transform":"translateZ(1px)"}).css3({"backface-visibility":"hidden"}),l=e(c.get(0).cloneNode(!1)).css({"background-image":this.slider.image2.css("background-image")}).css3({transform:flux.browser.rotateY(180),"backface-visibility":"hidden"});e(t).css({"z-index":(n>this.options.columns/2?500-n:500)+(i>this.options.rows/2?500-i:500)}).css3({"transition-duration":"800ms","transition-timing-function":"ease-out","transition-property":"all","transition-delay":n*this.options.delayBetweenBarsX+i*this.options.delayBetweenBarsY+"ms","transform-style":"preserve-3d"}).append(c).append(l)},execute:function(){this.slider.image1.css3({perspective:this.options.perspective,"perspective-origin":"50% 50%"});var e=this,t=this.slider.image1.find("div.tile");this.slider.image2.hide(),t.last().transitionEnd(function(t){e.slider.image2.show(),e.finished()}),setTimeout(function(){t.css3({transform:flux.browser.rotateY(180)})},50)}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.turn=function(t,n){return new flux.transition(t,e.extend({requires3d:!0,perspective:1300,direction:"left",setup:function(){var t=e('<div class="tab"></div>').css({width:"50%",height:"100%",position:"absolute",top:"0px",left:"left"==this.options.direction?"50%":"0%","z-index":101}).css3({"transform-style":"preserve-3d","transition-duration":"1000ms","transition-timing-function":"ease-out","transition-property":"all","transform-origin":"left"==this.options.direction?"left center":"right center"}),n=(e("<div></div>").appendTo(t).css({background:this.slider.image1.css("background"),"background-size":this.slider.width+"px "+this.slider.height+"px","background-position":("left"==this.options.direction?"-"+this.slider.image1.width()/2:0)+"px 0",width:"100%",height:"100%",position:"absolute",top:"0",left:"0","-moz-transform":"translateZ(1px)"}).css3({"backface-visibility":"hidden"}),e("<div></div>").appendTo(t).css({background:this.slider.image2.css("background"),"background-size":this.slider.width+"px "+this.slider.height+"px","background-position":("left"==this.options.direction?0:"-"+this.slider.image1.width()/2)+"px 0",width:"100%",height:"100%",position:"absolute",top:"0",left:"0"}).css3({transform:flux.browser.rotateY(180),"backface-visibility":"hidden"}),e("<div></div>").css({position:"absolute",top:"0",left:"left"==this.options.direction?"0":"50%",width:"50%",height:"100%",background:this.slider.image1.css("background"),"background-size":this.slider.width+"px "+this.slider.height+"px","background-position":("left"==this.options.direction?0:"-"+this.slider.image1.width()/2)+"px 0","z-index":100})),i=e('<div class="overlay"></div>').css({position:"absolute",top:"0",left:"left"==this.options.direction?"50%":"0",width:"50%",height:"100%",background:"#000",opacity:1}).css3({"transition-duration":"800ms","transition-timing-function":"linear","transition-property":"opacity"}),r=e("<div></div>").css3({width:"100%",height:"100%"}).css3({perspective:this.options.perspective,"perspective-origin":"50% 50%"}).append(t).append(n).append(i);this.slider.image1.append(r)},execute:function(){var e=this;this.slider.image1.find("div.tab").first().transitionEnd(function(){e.finished()}),setTimeout(function(){e.slider.image1.find("div.tab").css3({transform:flux.browser.rotateY("left"==e.options.direction?-179:179)}),e.slider.image1.find("div.overlay").css({opacity:0})},50)}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.slide=function(t,n){return new flux.transition(t,e.extend({direction:"left",setup:function(){var t=this.slider.image1.width(),n=this.slider.image1.height(),i=e('<div class="current"></div>').css({height:n+"px",width:t+"px",position:"absolute",top:"0px",left:"0px",background:this.slider["left"==this.options.direction?"image1":"image2"].css("background")}).css3({"backface-visibility":"hidden"}),r=e('<div class="next"></div>').css({height:n+"px",width:t+"px",position:"absolute",top:"0px",left:t+"px",background:this.slider["left"==this.options.direction?"image2":"image1"].css("background")}).css3({"backface-visibility":"hidden"});this.slideContainer=e('<div class="slide"></div>').css({width:2*t+"px",height:n+"px",position:"relative",left:"left"==this.options.direction?"0px":-t+"px","z-index":101}).css3({"transition-duration":"600ms","transition-timing-function":"ease-in","transition-property":"all"}),this.slideContainer.append(i).append(r),this.slider.image1.append(this.slideContainer)},execute:function(){var e=this,t=this.slider.image1.width();"left"==this.options.direction&&(t=-t),this.slideContainer.transitionEnd(function(){e.finished()}),setTimeout(function(){e.slideContainer.css3({transform:flux.browser.translate(t)})},50)}},n))}}(window.jQuery||window.Zepto),function(e){flux.transitions.explode=function(t,n){return new flux.transition_grid(t,e.extend({columns:6,forceSquare:!0,delayBetweenBars:30,perspective:800,requires3d:!0,renderTile:function(t,n,i,r,o,a,s){var c=Math.floor(10*Math.random()*this.options.delayBetweenBars);e(t).css({background:this.slider.image1.css("background"),"background-size":this.slider.width+"px "+this.slider.height+"px","background-position":"-"+a+"px -"+s+"px"}).css3({"transition-duration":"500ms","transition-timing-function":"ease-in","transition-property":"all","transition-delay":c+"ms"}),this.maxDelay===undefined&&(this.maxDelay=0),c>this.maxDelay&&(this.maxDelay=c,this.maxDelayTile=t)},execute:function(){this.slider.image1.css3({perspective:this.options.perspective,"perspective-origin":"50% 50%"}).css({"-moz-transform":"perspective("+this.options.perspective+"px)","-moz-perspective":"none","-moz-transform-style":"preserve-3d"});var t=this,n=this.slider.image1.find("div.tile");this.maxDelayTile.transitionEnd(function(){t.slider.image1.css3({"transform-style":"flat"}),t.finished()}),setTimeout(function(){n.each(function(t,n){e(n).css({opacity:"0"}).css3({transform:flux.browser.translate(0,0,700)+" rotate3d("+(Math.round(2*Math.random())-1)+", "+(Math.round(2*Math.random())-1)+", "+(Math.round(2*Math.random())-1)+", 90deg) "})})},50)}},n))}}(window.jQuery||window.Zepto),function(e){e.fn.qrcode=function(t){"string"==typeof t&&(t={text:t}),t=e.extend({},{render:"canvas",width:256,height:256,typeNumber:-1,correctLevel:QRErrorCorrectLevel.H,background:"#ffffff",foreground:"#000000"},t);var n=function(){var e=new QRCode(t.typeNumber,t.correctLevel);e.addData(t.text),e.make();var n=document.createElement("canvas");n.width=t.width,n.height=t.height;for(var i=n.getContext("2d"),r=t.width/e.getModuleCount(),o=t.height/e.getModuleCount(),a=0;a<e.getModuleCount();a++)for(var s=0;s<e.getModuleCount();s++){i.fillStyle=e.isDark(a,s)?t.foreground:t.background;var c=Math.ceil((s+1)*r)-Math.floor(s*r),l=Math.ceil((a+1)*r)-Math.floor(a*r);i.fillRect(Math.round(s*r),Math.round(a*o),c,l)}return n},i=function(){var n=new QRCode(t.typeNumber,t.correctLevel);n.addData(t.text),n.make();for(var i=e("<table></table>").css("width",t.width+"px").css("height",t.height+"px").css("border","0px").css("border-collapse","collapse").css("background-color",t.background),r=t.width/n.getModuleCount(),o=t.height/n.getModuleCount(),a=0;a<n.getModuleCount();a++)for(var s=e("<tr></tr>").css("height",o+"px").appendTo(i),c=0;c<n.getModuleCount();c++)e("<td></td>").css("width",r+"px").css("background-color",n.isDark(a,c)?t.foreground:t.background).appendTo(s);return i};return this.each(function(){var r="canvas"==t.render?n():i();e(r).appendTo(this)})}}(jQuery),function(){function e(e){$("#finger_div"+e).on(i,function(){$("#page"+e).find(".u-arrow-bottom").attr("style","display: none;"),$("#page"+e).find(".edit_wrapper").attr("style","display: none;"),$("#finger_line"+e).show(),$("#finger_info"+e).html("扫描中..."),$("#finger_line"+e).stop(!0,!1).animate({top:"50%",marginTop:"-87px"},1e3,function(){$("#finger_div"+e).unbind(),$("#finger_info"+e).hide().html("扫描成功").fadeIn(300,function(){$("#finger_line"+e).fadeOut(),$("#finger_zw"+e).fadeOut(),$("#finger_div"+e).fadeOut(),$("#finger_info"+e).fadeOut(200,function(){setTimeout(function(){$("#finger_background"+e).removeClass("lock").addClass("unlock")},500),$("#finger_background"+e).addClass("noFinger").fadeOut(500,function(){$("#page"+e).empty(),renderPage(eqShow,e,t);for(var n=0;n<t[e-1].elements.length;n++){var i=eqShow.selectElement(t[e-1].elements[n].id);eqxCommon.bindTrigger(i,t[e-1].elements[n])}}),$("#audio_btn").css("opacity",1),1==e&&playVideo(audioObj)})})})})}var t;window.lockEffect=function(n,i,r,o,a){audioObj=n,t=i;for(var s=0;s<r.length;s++){var c=r[s].num;$(".finger_background","#page"+c).length&&$(".finger_background","#page"+c).remove(),$('<div class = "finger_background page_effect lock"></div>').prependTo($("#page"+c)).attr("id","finger_background"+c).attr("style","background-image: url("+r[s].finger.bgImage.path+");width:100%; height: 100%;"),$('<div class = "finger_div"></div>').prependTo($("#finger_background"+c)).attr("id","finger_div"+c),$('<img class = "finger_zw"/>').appendTo($("#finger_background"+c)).attr("id","finger_zw"+c).attr("src",r[s].finger.zwImage.path),$('<img class = "finger_line" src = "'+CLIENT_CDN+'view/images/finger_line.png">').appendTo($("#finger_background"+r[s].num)).attr("id","finger_line"+r[s].num),$('<p class = "finger_info"></p>').appendTo($("#finger_background"+c)).attr("id","finger_info"+c),renderPage(eqShow,c,i),e(c)}};var n="ontouchstart"in window,i=n?"touchstart":"mousedown"}();var eqxiu=function(){function e(e){if("10"!=p._scrollMode){R=!0;for(var i,r=0,o=p._pageData.length;o>r;r++)e==p._pageData[r].id&&(i=p._pageData[r].num);i||(i=e);var a=$(p.$currentPage).find(".m-img").attr("id").substring(4),s=$(p.$currentPage).siblings(".main-page").find("#page"+i);if(!s)return;p.$activePage=$(s).parent(".main-page").get(0),a>i?t():i>a&&n()}else flipBookScroll(e)}function t(e){if(!(E&&2==e||S&&1==e))if("10"!=p._scrollMode){var t=0;h();var n=setInterval(function(){t+=2,"0"==p._scrollMode||"1"==p._scrollMode||"2"==p._scrollMode||"6"==p._scrollMode||"7"==p._scrollMode||"8"==p._scrollMode||"11"==p._scrollMode||"12"==p._scrollMode?L=t:("3"==p._scrollMode||"4"==p._scrollMode||"5"==p._scrollMode||"9"==p._scrollMode)&&(A=t),g(),t>=21&&(clearInterval(n),f())},1)}else $(document).trigger("bookFlipPre")}function n(e){if(!(E&&2==e||S&&1==e))if("10"!=p._scrollMode){b=!1;var t=0;h();var n=setInterval(function(){t-=2,"0"==p._scrollMode||"1"==p._scrollMode||"2"==p._scrollMode||"6"==p._scrollMode||"7"==p._scrollMode||"8"==p._scrollMode||"11"==p._scrollMode||"12"==p._scrollMode?L=t:("3"==p._scrollMode||"4"==p._scrollMode||"5"==p._scrollMode||"9"==p._scrollMode)&&(A=t),g(),-21>=t&&(clearInterval(n),f(),I||p.$activePage||clearInterval(T))},1)}else $(document).trigger("bookFlipNext")}function i(){T=setInterval(function(){"10"!=p._scrollMode&&n()},w)}function r(){clearInterval(T)}function o(){p.$activePage=p._$pages.last().get(0),p._$pages.parent().find(".z-current").removeClass("z-current"),p._$pages.last().addClass("z-current")}function a(e){e?p._$pages.last().prev().remove():p._$pages.last().remove()}function s(e){p._scrollMode=e,m=e,_scrollMode=e}function c(e){w=1e3*e,r(),i()}function l(){p._$pages=p._$app.find(".main-page")}function o(e){p._$pages.parent().find(".z-current").removeClass("z-current"),e?(p.$activePage=p._$pages.last().prev().get(0),p._$pages.last().prev().addClass("z-current")):(p.$activePage=p._$pages.last().get(0),p._$pages.last().addClass("z-current"))}function d(e){p._pageData=e}function u(e){I=e}var p,h,g,f,m,v,y,b,w,E,S,x,T,C=$(window),I=!1,R=!1,P=mobilecheck(),M=tabletCheck(),_=0,k=0,A=0,L=0,D=!1,z=!1,F=!0,N=500,H=.4,U=function(e,t,n,r){function o(e,t,n){for(var i=["","webkit","moz"],r=0,o=i.length;o>r;r++){0!=r||mobilecheck()||(t=t.substring(0,1).toLowerCase()+t.substring(1,t.length));var a=n instanceof Array?n[r]:n,s=i[r]+t;e[s]=a}}function a(e,t,n){for(var i=["","-webkit-","-moz-"],r=0;r<i.length;r++)e.css(i[r]+t,n)}function s(e){var t;return t=$("#inside_"+e,".phone-view").length?$("#inside_"+e,".phone-view"):$("#inside_"+e)}function c(){p._isDisableFlipPage=!0;var e;"0"==t||"1"==t||"2"==t||"6"==t||"9"==t||"11"==t||"12"==t?(e=L>0?-y:y,a($(p.$activePage),"transform","translateY("+e+"px)"),a($(p.$currentPage),"transform","translateY(0) scale(1)")):("3"==t||"5"==t)&&(e=A>0?-v:v,a($(p.$activePage),"transform","translateX("+e+"px)"),a($(p.$currentPage),"transform","translateX(0) scale(1)")),setTimeout(function(){$(p.$currentPage).attr("style",""),$(p.$activePage).attr("style",""),$(p.$activePage).removeClass("z-active z-move"),p._isDisableFlipPage=!1},500)}function l(){if(Math.abs(L)>Math.abs(A)&&completeEffect($(p.$currentPage)))if(L>0){if(p._isDisableFlipPrevPage)return;z||F?(z=!1,F=!1,J(!0),K(!0,"bottom center","translateY",y)):ee(!0,"translateY",y,L,p._scrollMode)}else if(0>L){if(p._isDisableFlipNextPage)return;!z||F?(z=!0,F=!1,J(!1),K(!1,"top center","translateY",y)):ee(!1,"translateY",y,L,p._scrollMode)}}function d(){Math.abs(L)>Math.abs(A)&&Math.abs(L)>20?(te("translateY",L,y,p._scrollMode),$(document).trigger("flipend")):(p._isDisableFlipPage=!1,c())}function u(){if(Math.abs(A)>Math.abs(L)&&completeEffect($(p.$currentPage)))if(A>0){if(p._isDisableFlipPrevPage)return;z||F?(z=!1,F=!1,J(!0),K(!0,"center right","translateX",v)):ee(!0,"translateX",v,A,p._scrollMode)}else if(0>A){if(p._isDisableFlipNextPage)return;!z||F?(z=!0,F=!1,J(!1),K(!1,"center left","translateX",v)):ee(!1,"translateX",v,A,p._scrollMode)}}function m(){Math.abs(A)>Math.abs(L)&&Math.abs(A)>20?(te("translateX",A,v,p._scrollMode),$(document).trigger("flipend")):(p._isDisableFlipPage=!1,c())}function b(){if(Math.abs(A)>Math.abs(L)&&completeEffect($(p.$currentPage)))if(A>0){if(p._isDisableFlipPrevPage)return;z||F?(z=!1,F=!1,J(!0),v=P?window.innerWidth:$(".nr").width(),K(!0,"","translateX",v)):ee(!0,"translateX",v,A,p._scrollMode)}else if(0>A){if(p._isDisableFlipNextPage)return;!z||F?(z=!0,F=!1,J(!1),v=P?window.innerWidth:$(".nr").width(),K(!1,"","translateX",v)):ee(!1,"translateX",v,A,p._scrollMode)}}function T(){Math.abs(A)>Math.abs(L)&&Math.abs(A)>20?(te("translateX",A,v,p._scrollMode),$(document).trigger("flipend")):(p._isDisableFlipPage=!1,c())}function U(){if(Math.abs(L)>Math.abs(A)&&completeEffect($(p.$currentPage)))if(L>0){if(p._isDisableFlipPrevPage)return;z||F?(z=!1,F=!1,J(!0),y=P?window.innerHeight:$(".nr").height(),K(!0,"","translateY",y)):ee(!0,"translateY",y,L,p._scrollMode)}else if(0>L){if(p._isDisableFlipNextPage)return;!z||F?(z=!0,F=!1,J(!1),y=P?window.innerHeight:$(".nr").height(),K(!1,"","translateY",y)):ee(!1,"translateY",y,L,p._scrollMode)}}function O(){Math.abs(L)>Math.abs(A)&&Math.abs(L)>20?(te("translateY",L,y,p._scrollMode),$(document).trigger("flipend")):(p._isDisableFlipPage=!1,c())}function B(){if(Math.abs(L)>Math.abs(A)&&completeEffect($(p.$currentPage)))if(L>0){if(p._isDisableFlipNextPage)return;(!z||F)&&(z=!0,F=!1,p.$activePage&&$(p.$activePage).removeClass("z-move z-active"),J(!0),o(p.$activePage.style,"Transform","rotateX(90deg) translateY(-"+y/2+"px) translateZ("+y/2+"px)"),o(ne.get(0).style,"Perspective","700px"),o(ne.get(0).style,"TransformStyle","preserve-3d")),p.$activePage&&p.$activePage.classList.contains("main-page")&&($(p.$activePage).addClass("z-active z-move").trigger("active").css("zIndex",1),o(p.$currentPage.style,"Transform","rotateX(-"+L/y*90+"deg) translateY("+L/2+"px) translateZ("+L/2+"px)"),o(p.$activePage.style,"Transform","rotateX("+(90-L/y*90)+"deg) translateY("+(-(y/2)+L/2)+"px) translateZ("+(y/2-L/2)+"px)"))}else if(0>L){if(p._isDisableFlipNextPage)return;(!z||F)&&(z=!0,F=!1,p.$activePage&&$(p.$activePage).removeClass("z-move z-active"),J(!1),o(p.$activePage.style,"Transform","rotateX(-90deg) translateY(-"+y/2+"px) translateZ(-"+y/2+"px)"),o(ne.get(0).style,"Perspective","700px"),o(ne.get(0).style,"TransformStyle","preserve-3d")),p.$activePage&&p.$activePage.classList.contains("main-page")?($(p.$activePage).addClass("z-active z-move").trigger("active").css("zIndex",0),o(p.$currentPage.style,"Transform","rotateX("+-L/y*90+"deg) translateY("+L/2+"px) translateZ("+-L/2+"px)"),o(p.$activePage.style,"Transform","rotateX("+(-90-L/y*90)+"deg) translateY("+(y/2+L/2)+"px) translateZ("+(y/2+L/2)+"px)")):(o(p.$currentPage.style,"Transform","translateX(0px) scale(1)"),p.$activePage=null)}}function j(){Math.abs(L)>Math.abs(A)&&Math.abs(L)>20?(L>0?o(p.$currentPage.style,"Transform","rotateX(-90deg) translateY("+y/2+"px) translateZ("+y/2+"px)"):o(p.$currentPage.style,"Transform","rotateX(90deg) translateY(-"+y/2+"px) translateZ("+y/2+"px)"),o(p.$currentPage.style,"zIndex","0"),o(p.$activePage.style,"Transform","rotateX(0deg) translateY(0px) translateZ(0px)"),o(p.$activePage.style,"zIndex","2"),$(document).trigger("flipend")):(o(p.$currentPage.style,"Transition","none"),o(p.$activePage.style,"Transition","none"),p._isDisableFlipPage=!1,c())}function q(){if(Math.abs(L)>Math.abs(A)&&completeEffect($(p.$currentPage)))if(L>0){if(p._isDisableFlipNextPage)return;(!z||F)&&(z=!0,F=!1,p.$activePage&&$(p.$activePage).removeClass("z-move z-active"),J(!0),a(ne,"perspective","700px"),a(ne,"transform-style","preserve-3d"),o(p.$activePage.style,"TransformOrigin","top"),o(p.$activePage.style,"Transform","rotateX(90deg)")),p.$activePage&&p.$activePage.classList.contains("main-page")&&($(p.$activePage).addClass("z-active z-move").trigger("active"),o(p.$activePage.style,"Transform","rotateX("+(90-L/y*90)+"deg) "))}else if(0>L){if(p._isDisableFlipNextPage)return;(!z||F)&&(z=!0,F=!1,p.$activePage&&$(p.$activePage).removeClass("z-move z-active"),J(!1),o(p.$activePage.style,"TransformOrigin","bottom"),o(p.$activePage.style,"Transform","rotateX(-90deg)"),a(ne,"perspective","700px"),a(ne,"transform-style","preserve-3d")),p.$activePage&&p.$activePage.classList.contains("main-page")?($(p.$activePage).addClass("z-active z-move").trigger("active"),o(p.$activePage.style,"Transform","rotateX("+(-90-L/y*90)+"deg) ")):(o(p.$currentPage.style,"Transform","translateX(0px) scale(1)"),p.$activePage=null)}}function X(){Math.abs(L)>Math.abs(A)&&Math.abs(L)>20?(L>0?o(p.$activePage.style,"Transform","rotateX(0deg)"):o(p.$activePage.style,"Transform","rotateX(0deg)"),$(document).trigger("flipend")):(o(p.$currentPage.style,"Transition","none"),o(p.$activePage.style,"Transition","none"),p._isDisableFlipPage=!1,c())}function V(){if(Math.abs(L)>Math.abs(A)&&completeEffect($(p.$currentPage))){if(L>0){if(p._isDisableFlipPrevPage)return;(z||F)&&(z=!1,F=!1,p.$activePage&&(p.$activePage.classList.remove("z-active"),p.$activePage.classList.remove("z-move")),J(!0),p.$activePage.style.zIndex=2,p.$activePage&&p.$activePage.classList.contains("main-page")&&(p.$activePage.classList.add("z-active"),p.$activePage.classList.add("z-move")),p.$activePage.style.opacity=0)}else if(0>L){if(p._isDisableFlipNextPage)return;(!z||F)&&(z=!0,F=!1,p.$activePage&&(p.$activePage.classList.remove("z-active"),p.$activePage.classList.remove("z-move")),J(!1),p.$activePage.style.zIndex=2,p.$activePage&&p.$activePage.classList.contains("main-page")&&(p.$activePage.classList.add("z-active"),p.$activePage.classList.add("z-move")),p.$activePage.style.opacity=0)}var e=Math.abs(L)/y*1.3;p.$activePage.style.opacity=e.toFixed(1),e.toFixed(3)<=1&&a($(p.$activePage),"transform","scale("+e.toFixed(3)+")")}}function G(){Math.abs(L)>Math.abs(A)&&Math.abs(L)>20?(a($(p.$activePage),"transform","scale(1)"),p.$activePage.style.opacity=1,$(document).trigger("flipend")):(o(p.$currentPage.style,"Transition","none"),o(p.$activePage.style,"Transition","none"),p._isDisableFlipPage=!1,c())}function W(){if(Math.abs(A)>Math.abs(L)&&completeEffect($(p.$currentPage)))if(A>0){if(p._isDisableFlipPrevPage)return;z||F?(z=!1,F=!1,p.$activePage&&(p.$activePage.classList.remove("z-active"),p.$activePage.classList.remove("z-move")),J(!0),p.$activePage&&p.$activePage.classList.contains("main-page")&&(p.$activePage.classList.add("z-active"),p.$activePage.classList.add("z-move"),a($(p.$activePage),"Transform","scale(0.3) translateX(0) translateZ(-"+y+"px) rotateY(45deg)"),p.$activePage.style.zIndex="0"),a(ne,"perspective","1000px"),p.$currentPage.style.zIndex="100"):p.$activePage&&(v/4>=A?a($(p.$currentPage),"Transform","translateX("+A+"px)"):a($(p.$currentPage),"Transform","translateX("+1.5*A+"px) scale("+((5*v/4-A)/v).toFixed(3)+") rotateY("+A/v*45+"deg) translateZ(-"+(A-v/4)+"px)"))}else if(0>A){if(p._isDisableFlipNextPage)return;!z||F?(z=!0,F=!1,p.$activePage&&(p.$activePage.classList.remove("z-active"),p.$activePage.classList.remove("z-move")),J(!1),p.$activePage&&p.$activePage.classList.contains("main-page")&&(p.$activePage.classList.add("z-active"),p.$activePage.classList.add("z-move"),a($(p.$activePage),"Transform","scale(0.3) translateX("+(v+300)+"px) translateZ(-"+y+"px) rotateY(-45deg)"),p.$activePage.style.zIndex="0"),a(ne,"perspective","1000px"),p.$currentPage.style.zIndex="100"):p.$activePage&&(A>=-v/4?a($(p.$currentPage),"Transform","translateX("+A+"px)"):a($(p.$currentPage),"Transform","translateX("+1.5*A+"px) scale("+((5*v/4+A)/v).toFixed(3)+") rotateY("+A/v*45+"deg) translateZ("+(A+v/4)+"px)"),a($(p.$activePage),"Transform","scale("+(.3-(A+v/4)/v).toFixed(3)+") translateX("+(-A-v/4+200)+"px) translateZ("+(-A-3*v/4)+"px) rotateY(-"+(45+(A+v/4)/v*45)+"deg)"))}}function Y(){Math.abs(A)>Math.abs(L)&&Math.abs(A)>20?(A>0?(p.$currentPage.style.webkitTransformOrigin="left",p.$currentPage.style.webkitTransform="translateX(0) translateZ(-"+y+"px) rotateY(0) scale(0.2)",p.$activePage.style.webkitTransform="translateX(0) translateZ(0) rotateY(0) scale(1)",p.$currentPage.style.zIndex="0",p.$activePage.style.zIndex="1"):(p.$currentPage.style.webkitTransformOrigin="right",p.$currentPage.style.webkitTransform="translateX("+v+"px) translateZ(-"+y+"px) rotateY(0) scale(0.2)",p.$activePage.style.webkitTransform="translateX(0) translateZ(0) rotateY(0) scale(1)",p.$activePage.style.zIndex="1",p.$currentPage.style.zIndex="0"),$(document).trigger("flipend")):(o(p.$currentPage.style,"Transition","none"),o(p.$activePage.style,"Transition","none"),p._isDisableFlipPage=!1,c())}function Q(){if(Math.abs(L)>Math.abs(A)&&completeEffect($(p.$currentPage))){if(L>0){if(p._isDisableFlipPrevPage)return;(z||F)&&(z=!1,F=!1,p.$activePage&&(p.$activePage.classList.remove("z-active"),p.$activePage.classList.remove("z-move")),J(!0),p.$activePage&&p.$activePage.classList.contains("main-page")&&($(p.$activePage).addClass("z-active z-move"),$(p.$activePage).css({zIndex:0,opacity:1})),$(p.$currentPage).css({opacity:1}),$(p.$activePage).css({zIndex:0,opacity:1}),a($(p.$activePage),"transform","translateY(0)"),a($(p.$currentPage),"transform-origin","0% 0% 0px"))}else if(0>L){if(p._isDisableFlipNextPage)return;(!z||F)&&(z=!0,F=!1,p.$activePage&&(p.$activePage.classList.remove("z-active"),p.$activePage.classList.remove("z-move")),J(!1),p.$activePage&&p.$activePage.classList.contains("main-page")&&(p.$activePage.classList.add("z-active"),p.$activePage.classList.add("z-move"),$(p.$activePage).css({zIndex:0,opacity:1})),$(p.$currentPage).css({opacity:1}),$(p.$activePage).css({zIndex:0,opacity:1}),a($(p.$activePage),"transform","translateY(0)"),a($(p.$currentPage),"transform-origin","0% 0% 0px"))}p.$activePage&&(a($(p.$currentPage),"transform-origin","0% 0% 0px"),a($(p.$currentPage),"transform","rotate("+Math.abs(L)/y*90+"deg)"),p.$currentPage.style.opacity=((y-Math.abs(L))/y).toFixed(1))}}function Z(){Math.abs(L)>Math.abs(A)&&Math.abs(L)>20?(a($(p.$currentPage),"transform","translateY("+y+"px) rotate("+Math.abs(L)/y*90+"deg)"),$(p.$currentPage).css({opacity:.5}),$(document).trigger("flipend")):(o(p.$currentPage.style,"Transition","none"),o(p.$activePage.style,"Transition","none"),p._isDisableFlipPage=!1,c())}function J(e){R||(e?p.$currentPage.previousElementSibling&&p.$currentPage.previousElementSibling.classList.contains("main-page")?p.$activePage=p.$currentPage.previousElementSibling:I?p.$activePage=p._$pages.last().get(0):p.$activePage=!1:p.$currentPage.nextElementSibling&&p.$currentPage.nextElementSibling.classList.contains("main-page")?p.$activePage=p.$currentPage.nextElementSibling:I?p.$activePage=p._$pages.first().get(0):p.$activePage=!1)}function K(e,t,n,i){if(p.$activePage&&(p.$activePage.classList.remove("z-active"),p.$activePage.classList.remove("z-move")),p.$activePage&&p.$activePage.classList.contains("main-page")){p.$activePage.classList.add("z-active"),p.$activePage.classList.add("z-move");var r=e?"-":"";p.$activePage.style.webkitTransition="none",p.$activePage.style.webkitTransform=n+"("+r+i+"px)",p.$activePage.style.mozTransition="none",p.$activePage.style.mozTransform=n+"("+r+i+"px)",p.$activePage.style.transition="none",p.$activePage.style.transform=n+"("+r+i+"px)",$(p.$activePage).trigger("active"),t&&a($(p.$currentPage),"transform-origin",t)}else o(p.$currentPage.style,"Transform",n+"(0px) scale(1)")}function ee(e,t,n,i,r){if(p.$activePage){var o=e?"-":"";a($(p.$activePage),"transform",t+"("+o+(n-Math.abs(i))+"px)"),"1"==r||"3"==r?a($(p.$currentPage),"transform","scale("+((n-Math.abs(i))/y).toFixed(3)+")"):("5"==r||"11"==r)&&a($(p.$currentPage),"transform",t+"("+i+"px)")}}function te(e,t,n,i){if("1"==i||"3"==i)a($(p.$currentPage),"transform","scale(0.2)");else if("5"==i||"11"==i){var r=t>0?"":"-";a($(p.$currentPage),"transform",e+"("+r+n+"px)")}else a($(p.$currentPage),"transform","scale(1)");
a($(p.$activePage),"transform",e+"(0px)")}this._$app=e,this._$pages=this._$app.find(".main-page"),this.$currentPage=this._$pages.eq(0),this.$activePage=null,this._isInitComplete=!1,this._isDisableFlipPage=!1,this._isDisableFlipPrevPage=!1,this._isDisableFlipNextPage=!1,this._scrollMode=t,this._pageData=n,this.pageData=r,t=t,p=this,v=P||M?window.innerWidth:e.width(),y=P||M?window.innerHeight:e.height();var ne=$("#con"),ie=!1;if(("8"==t||"9"==t)&&(H=.7,N=800),0==t||1==t||2==t||6==t||7==t||8==t||11==t||12==t?S=!0:(3==t||4==t||5==t||10==t)&&(E=!0),S?(x=$(".ctrl_panel_dir .ctrl-down"),$nextCtrl=$(".ctrl_panel_dir .ctrl-up")):E&&(x=$(".ctrl_panel_dir .ctrl-right"),$nextCtrl=$(".ctrl_panel_dir .ctrl-left")),r.obj.property.hasOwnProperty("triggerLoop")||(r.obj.property.triggerLoop=!0),I=r.obj.property.triggerLoop,r.obj.property.autoFlip&&(w=1e3*r.obj.property.autoFlipTime,i()),n[0].elements&&n[0].elements.length)for(var re=0;re<n[0].elements.length;re++){eqShow.shakeTrigger(n,p.$currentPage);var oe=s(n[0].elements[re].id);eqxCommon.bindTrigger(oe,n[0].elements[re])}!function(){C.on("scroll.elasticity",function(e){e.preventDefault()}).on("touchmove.elasticity",function(e){e.preventDefault()}),C.delegate("img","mousemove",function(e){e.preventDefault()})}(),"10"!=t?p._$app.on("mousedown touchstart",function(e){h(e)}).on("mousemove touchmove",function(e){g(e)}).on("mouseup touchend mouseleave",function(e){f(e)}):turnBook(r),h=function(e){ie=!1,P&&e&&(e=event),p._isDisableFlipPage||(p.$currentPage=p._$pages.filter(".z-current").get(0),R||(p.$activePage=null),p.$currentPage&&completeEffect($(p.$currentPage))&&(D=!0,z=!1,F=!0,A=0,L=0,e&&"mousedown"==e.type?(_=e.pageX,k=e.pageY):e&&"touchstart"==e.type&&(_=e.touches?e.touches[0].pageX:e.originalEvent.touches[0].pageX,k=e.touches?e.touches[0].pageY:e.originalEvent.touches[0].pageY),p.$currentPage.classList.add("z-move"),o(p.$currentPage.style,"Transition","none"),"12"==p._scrollMode&&(p.$currentPage.style.zIndex=3)))},g=function(e){if(P&&e&&(e=event),D&&p._$pages.length>1){if(e&&"mousemove"==e.type?(A=e.pageX-_,L=e.pageY-k):e&&"touchmove"==e.type&&(A=(e.touches?e.touches[0].pageX:e.originalEvent.touches[0].pageX)-_,L=(e.touches?e.touches[0].pageY:e.originalEvent.touches[0].pageY)-k),!ie&&(Math.abs(A)>20||Math.abs(L)>20)){if(p.$activePage){var t=$(p.$activePage).find(".m-img").attr("id").substring(4);$(p.$activePage).find("li").each(function(e){for(var n=0;n<p._pageData[t-1].elements.length;n++)if(p._pageData[t-1].elements[n].id==parseInt($(this).attr("id").substring(7),10)){eqxCommon.animation($(this),p._pageData[t-1].elements[n],"view");var i=s(p._pageData[t-1].elements[n].id);eqxCommon.bindTrigger(i,p._pageData[t-1].elements[n])}})}ie=!0}"0"==p._scrollMode||"2"==p._scrollMode||"1"==p._scrollMode?l():"4"==p._scrollMode||"3"==p._scrollMode?u():"5"==p._scrollMode?b():"6"==p._scrollMode?B():"7"==p._scrollMode?q():"8"==p._scrollMode?V():"9"==p._scrollMode?W():"11"==p._scrollMode?U():"12"==p._scrollMode&&Q()}},f=function(e){if(D&&completeEffect($(p.$currentPage)))if(D=!1,p.$activePage){p._isDisableFlipPage=!0;var t;t="6"==p._scrollMode||"7"==p._scrollMode?"cubic-bezier(0,0,0.99,1)":"12"==p._scrollMode?"cubic-bezier(.17,.67,.87,.13)":"linear",p.$currentPage.style.webkitTransition="-webkit-transform "+H+"s "+t,p.$activePage.style.webkitTransition="-webkit-transform "+H+"s "+t,p.$currentPage.style.mozTransition="-moz-transform "+H+"s "+t,p.$activePage.style.mozTransition="-moz-transform "+H+"s "+t,p.$currentPage.style.transition="transform "+H+"s "+t,p.$activePage.style.transition="transform "+H+"s "+t,"0"==p._scrollMode||"2"==p._scrollMode||"1"==p._scrollMode?d():"4"==p._scrollMode||"3"==p._scrollMode?m():"5"==p._scrollMode?T():"6"==p._scrollMode?j():"7"==p._scrollMode?X():"8"==p._scrollMode?G():"9"==p._scrollMode?Y():"11"==p._scrollMode?O():"12"==p._scrollMode&&Z()}else p.$currentPage.classList.remove("z-move");R=!1},$(document).on("flipend",function(e){completeEffect($(p.$activePage))||$("#audio_btn").css("opacity",0);var i=$("#report0"),a=$(p.$activePage).find(".m-img").attr("id").substring(4);n=p._pageData,n[a-1].elements&&n[a-1].elements.length&&$.each(n[a-1].elements,function(e,t){"d"==t.type&&eqShow.getShowCount(r.obj.id).then(function(e){var n=eqShow.fixedNum(e);$("#"+t.id).find(".counter-number").text(n)})}),setTimeout(function(){o(p.$currentPage.style,"Transition","none"),$(p.$activePage).removeClass("z-active z-move").addClass("z-current"),$(p.$currentPage).removeClass("z-current z-move"),p._isDisableFlipPage=!1,p.$currentPage=$(p.$activePage).trigger("current"),$(p.$currentPage).trigger("hide"),utilSound.pause(),i.length&&i.remove(),("8"==t||"9"==t||"12"==t)&&($(p.$currentPage).css("z-index","1"),$(".main-page").attr("style","")),eqShow.shakeTrigger(n,p.$currentPage),I||(1==a?x.removeClass("enabled"):a==p._pageData.length?$nextCtrl.removeClass("enabled"):(x.addClass("enabled"),$nextCtrl.addClass("enabled")))},N)}),$(document).on("startAutoFlip",function(e){r.obj.property.autoFlip&&i()}),eqShow.showProgressBar(r,p._$pages,e)};return{pageScroll:e,nextPage:n,prePage:t,lastPage:o,app:U,pauseAutoFlip:r,removeLastPage:a,changeScrollMode:s,startAutoFlip:c,changeAppPage:l,setTriggerLoop:u,setPageData:d}}();!function(e,t){function n(e,n){completeEffect(t(".z-current"))&&(M="started",P.length||(P=h.find(".main-page")),n||(I?(e=event,m={x:e.touches[0].pageX-h.offset().left,y:e.touches[0].pageY-h.offset().top}):m={x:e.pageX-h.offset().left,y:e.pageY-h.offset().top}))}function i(e,n){if(M="turning",W&&W.obj.property.autoFlip&&W.obj.property.autoFlipTime&&p(),n||(I?(e=event,v={x:e.touches[0].pageX-h.offset().left,y:e.touches[0].pageY-h.offset().top}):v={x:e.pageX-h.offset().left,y:e.pageY-h.offset().top}),y=v.x-m.x,0>y){if(x){x=!1,I&&f?E=!0:m.y>=h.height()/2?b=!0:m.y<h.height()/2&&(w=!0),T=t(".z-current").get(0);var i=t(T).find(".m-img").attr("id").substring(4);g=t("#flip"+i),Z||(C=t(T).parent(".flip-mask").get(0).nextElementSibling&&t(t(T).parent(".flip-mask").get(0).nextElementSibling).find(".main-page").get(0)?t(t(T).parent(".flip-mask").get(0).nextElementSibling).find(".main-page").get(0):!!$&&P.first().get(0)),C&&(t(C).find(".m-img").attr("id").substring(4),t(T).parent(".flip-mask").css({zIndex:100,display:"block"}),t(C).addClass("z-active").parent(".flip-mask").css({zIndex:99,display:"block"}),c(C),completeEffect(t(C))||t("#audio_btn").css("opacity",0),b?(t(".z-current").css({top:g.height()-h.height()+"px",left:"0"}),g.css({top:"-"+(g.height()-h.height())+"px"}),t(".turning").css({transformOrigin:"0% 100% 0px",left:h.width()+"px",top:h.height()+"px"})):w?t(".turning").css({top:"0",left:h.width()+"px",transformOrigin:"0% 0% 0px"}):E&&(t(".z-current").css({top:0,left:t(this).width()-h.width()+"px"}),g.css({top:0,left:-(g.width()-h.width())+"px"}),t(".turning").css({transformOrigin:"0% 100% 0px",left:h.width()+"px",top:0})))}}else if(y>0&&x){x=!1,S=!0,T=t(".z-current").get(0);var i=t(T).find(".m-img").attr("id").substr(4);g=t("#flip"+i),Z||(C=t(T).parent(".flip-mask").get(0).previousElementSibling&&t(t(T).parent(".flip-mask").get(0).previousElementSibling).find(".main-page").get(0)?t(t(T).parent(".flip-mask").get(0).previousElementSibling).find(".main-page").get(0):!!$&&P.last().get(0)),C&&(c(C),completeEffect(t(C))||t("#audio_btn").css("opacity",0),t(T).parent(".flip-mask").css({display:"block"}),t(C).addClass("z-active").parent(".flip-mask").css({zIndex:99,display:"block"}),t(".turning").css({top:"0",left:"0",transformOrigin:"0% 0% 0px"}))}C&&o(v)}function r(e,t){if(!C)return M="feeling",b=!1,w=!1,E=!1,S=!1,void(x=!0);M="leaving";var n,i,r,a;t?(n=e.x,i=e.y):I?(n=v.x-h.offset().left,i=v.y-h.offset().top):(n=e.pageX-h.offset().left,i=e.pageY-h.offset().top),b?(_=16,r=-h.width(),a=h.height(),R=setInterval(function(){n=_>=n-r?n:n-_,i=_>=a-i?i:i+_,o({x:n,y:i}),_>=n-r&&_>=a-i&&(clearInterval(R),s())},10)):w?(_=16,r=-h.width(),a=0,R=setInterval(function(){n=_>=n-r?n:n-_,i=_>=i-a?i:i-_,o({x:n,y:i}),_>=n-r&&_>=i-a&&(clearInterval(R),s())},1)):E?(_=5,r=-h.width(),R=setInterval(function(){n=_>=n-r?n:n-_,o({x:n,y:i}),_>=n-r&&(clearInterval(R),s())},1)):S&&(_=3,r=h.width(),a=0,R=setInterval(function(){n=_>=r-n?n:n+_,o({x:n,y:i}),_>=r-n&&(clearInterval(R),s())},1))}function o(e){b||w?(A=h.width()-e.x,b?L=Math.abs(h.height()-e.y):w&&(L=e.y),D=L/A,z=L/Math.sqrt(A*A+L*L),F=Math.sqrt(1-z*z),N=Math.sqrt(A*A+L*L)/2,H=N*D,U=Math.sqrt(H*H+N*N),O=U/D,k=180*Math.atan(D)/Math.PI>0?180*Math.atan(D)/Math.PI:0,B=(h.width()-U)*F,j=(h.width()-U)*z*F,q=(h.width()-U)*(1-z*z),B>=1&&(b?(k>1?t(".turning").css({width:U+"px",height:O+"px",backgroundColor:"#ff0000",background:"-webkit-linear-gradient("+(180-k)+"deg, #fff 10%, #d1cfc7 40%, #f2eee2 50%, transparent 50%, transparent 100%)",transform:"translateX(-"+(U-3)+"px) translateY(-"+(O-3)+"px) rotate("+2*k+"deg) scaleX(-1)"}):a(e),X="0% 100% 0px",V="rotate(-"+(90-k)+"deg) translateY("+B+"px)",G="rotate("+(90-k)+"deg) translateY(-"+j+"px) translateX(-"+q+"px)"):w&&(k>1?t(".turning").css({width:U+"px",height:O+"px",backgroundColor:"#000",background:"-webkit-linear-gradient(-"+(180-k)+"deg, #fff 10%, #d1cfc7 40%, #f2eee2 50%, transparent 50%, transparent 100%)",transform:"translateX(-"+(U-2)+"px) rotate(-"+2*k+"deg) scaleX(-1)"}):a(e),X="0% 0% 0px",V="rotate("+(90-k)+"deg) translateY(-"+B+"px)",G="rotate(-"+(90-k)+"deg) translateY("+j+"px) translateX(-"+q+"px)"),g.css({zIndex:100,transformOrigin:X,transform:V}),t(C).parent(".flip-mask").css({zIndex:99,display:"block"}),t(C).css({zIndex:1e3}),t(T).css({transformOrigin:X,transform:G}))):E?(t(".turning").css({width:(h.width()-e.x)/2+"px",height:h.height()+"px",left:e.x+"px",background:"-webkit-linear-gradient(left, #fff 0% , #d1cfc7 15%, #f2eee2 85%, #fff 100%)"}),g.css({transformOrigin:"0% 50% 0px",left:0,transform:"translateX(-"+(g.width()-e.x)+"px)"}),t(T).css({transformOrigin:"0% 50% 0px",transform:"translateX("+(g.width()-e.x)+"px)"})):S&&(g.css({zIndex:100,transformOrigin:"0% 50% 0px",transform:"translateX("+e.x+"px)"}),t(T).css({transformOrigin:"0% 50% 0px",transform:"translateX(-"+e.x+"px)"}),t(".turning").css({width:h.width()-e.x+"px",height:h.height()+"px",left:-(h.width()-2*e.x)+"px",background:"-webkit-linear-gradient(left, #fff 0% , #d1cfc7 15%, #f2eee2 85%, #fff 100%)"}))}function a(e){t(".turning").css({width:(h.width()-e.x+6)/2+"px",height:h.height()+"px",top:0,left:e.x+2+"px",background:"-webkit-linear-gradient(left, #fff 0% , #d1cfc7 10%, #f2eee2 90%, #fff 100%)",transform:"",border:0})}function s(){var e=W.list;W.obj.property.autoFlip&&W.obj.property.autoFlipTime&&u(),utilSound.pause();var n=t("#report0");n.length&&n.remove(),M="feeling",b=!1,w=!1,E=!1,S=!1,x=!0,y=0,t(".flip-mask").css({transform:"",top:0,left:0,zIndex:0}),t(T).removeClass("z-current").css({transform:"",top:0,left:0}),t(C).removeClass("z-active").addClass("z-current").css({transform:""}),t(".turning").css({width:0,height:0,top:0,left:0,transform:"",background:"none"}),T=C;var i=t(C).find(".m-img").attr("id").substring(4);t("#flip"+i).css({zIndex:100}),t("#audio_btn").css("opacity",1),C=null;var r=t(T).find(".m-img").attr("id").substring(4);e[r-1].elements&&e[r-1].elements.length&&t.each(e[r-1].elements,function(e,n){"d"==n.type&&eqShow.getShowCount(W.obj.id).then(function(e){var i=eqShow.fixedNum(e);t("#"+n.id).find(".counter-number").text(i)})}),J||eqShow.showProgressBar(W,t("#nr").find(".main-page")),J=!0}function c(e){if(e){var n=t(e).find(".m-img").attr("id").substring(4);t(e).find("li").each(function(e){for(var i=0;i<W.list[n-1].elements.length;i++)W.list[n-1].elements[i].id==parseInt(t(this).attr("id").substring(7),10)&&eqxCommon.animation(t(this),W.list[n-1].elements[i],"view")})}}function l(){"turning"!=M&&"leaving"!=M&&(m={x:0,y:h.height()},n(m,"mock"),M="turning",t(".main-page").css({width:h.width()+"px",height:h.height()+"px"}),v={x:0,y:h.height()},S=!0,R=setInterval(function(){v.x++,i(v,"mock"),v.x<=250&&(clearInterval(R),r(v,"mock"))},1))}function d(){"turning"!=M&&"leaving"!=M&&(m={x:h.width(),y:h.height()},n(m,"mock"),M="turning",t(".main-page").css({width:h.width()+"px",height:h.height()+"px"}),v={x:h.width(),y:h.height()},I&&f?E=!0:b=!0,Q=setInterval(function(){v.x-=5,v.y-=5,i(v,"mock"),v.x<=200&&(clearInterval(Q),r(v,"mock"),$||C||p())},1))}function u(){K=setInterval(function(){return completeEffect(t(".z-current"))?void d():void p()},1e3*Y)}function p(){clearInterval(K)}var h=t(".nr"),g=null,f=isAndroid(),m={},v={},y=0,b=!1,w=!1,E=!1,S=!1,x=!0,T=null,C=null,$=!1,I=mobilecheck(),R=null,P=[],M="feeling",_=0,k=0,A=0,L=0,D=0,z=0,F=0,N=0,H=0,U=0,O=0,B=0,j=0,q=0,X=0,V=0,G=0,W=null,Y=0,Q="",Z=!1;e.turnBook=function(e){W=e,W.obj.property.autoFlip&&W.obj.property.autoFlipTime&&(Y=W.obj.property.autoFlipTime,u()),$=W.obj.property.triggerLoop,t('<div class="turning"></div>').appendTo(".nr"),t(".main-page").css({width:t(".nr").width()+"px",height:t(".nr").height()+"px"}),h.on(I?"touchstart":"mousedown",function(e){"feeling"==M&&(n(e),t(".main-page").css({width:h.width()+"px",height:h.height()+"px"}))}).on(I?"touchmove":"mousemove",function(e){("started"==M||"turning"==M)&&i(e)}).on(I?"touchend":"mouseup mouseleave",function(e){return Z=!1,t(".z-current").get(0)?0==y?(x=!0,void(M="feeling")):void("turning"==M&&r(e)):void 0})};var J=!1;e.flipBookScroll=function(e){Z=!0;for(var n,i=0,r=W.list.length;r>i;i++)e==W.list[i].id&&(n=W.list[i].num);n||(n=e),T=t(".z-current").get(0);var o=t(T).find(".m-img").attr("id").substring(4),a=t(T).parent(".flip-mask").siblings(".flip-mask").find(".main-page").find("#page"+n);a&&(C=t(a).parent(".main-page").get(0),o>n?l():n>o&&d())},t(document).on("bookFlipPre",function(e){l()}),t(document).on("bookFlipNext",function(e){d()});var K}(window,jQuery),QR8bitByte.prototype={getLength:function(e){return this.data.length},write:function(e){for(var t=0;t<this.data.length;t++)e.put(this.data.charCodeAt(t),8)}},QRCode.prototype={addData:function(e){var t=new QR8bitByte(e);this.dataList.push(t),this.dataCache=null},isDark:function(e,t){if(0>e||this.moduleCount<=e||0>t||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){if(this.typeNumber<1){var e=1;for(e=1;40>e;e++){for(var t=QRRSBlock.getRSBlocks(e,this.errorCorrectLevel),n=new QRBitBuffer,i=0,r=0;r<t.length;r++)i+=t[r].dataCount;for(var r=0;r<this.dataList.length;r++){var o=this.dataList[r];n.put(o.mode,4),n.put(o.getLength(),QRUtil.getLengthInBits(o.mode,e)),o.write(n)}if(n.getLengthInBits()<=8*i)break}this.typeNumber=e}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=QRCode.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(e,t){for(var n=-1;7>=n;n++)if(!(-1>=e+n||this.moduleCount<=e+n))for(var i=-1;7>=i;i++)-1>=t+i||this.moduleCount<=t+i||(n>=0&&6>=n&&(0==i||6==i)||i>=0&&6>=i&&(0==n||6==n)||n>=2&&4>=n&&i>=2&&4>=i?this.modules[e+n][t+i]=!0:this.modules[e+n][t+i]=!1)},getBestMaskPattern:function(){for(var e=0,t=0,n=0;8>n;n++){this.makeImpl(!0,n);var i=QRUtil.getLostPoint(this);(0==n||e>i)&&(e=i,t=n)}return t},createMovieClip:function(e,t,n){var i=e.createEmptyMovieClip(t,n),r=1;this.make();for(var o=0;o<this.modules.length;o++)for(var a=o*r,s=0;s<this.modules[o].length;s++){var c=s*r,l=this.modules[o][s];l&&(i.beginFill(0,100),i.moveTo(c,a),i.lineTo(c+r,a),i.lineTo(c+r,a+r),i.lineTo(c,a+r),i.endFill())}return i},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=QRUtil.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var i=e[t],r=e[n];if(null==this.modules[i][r])for(var o=-2;2>=o;o++)for(var a=-2;2>=a;a++)-2==o||2==o||-2==a||2==a||0==o&&0==a?this.modules[i+o][r+a]=!0:this.modules[i+o][r+a]=!1}},setupTypeNumber:function(e){for(var t=QRUtil.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var i=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=i}for(var n=0;18>n;n++){var i=!e&&1==(t>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=i}},setupTypeInfo:function(e,t){for(var n=this.errorCorrectLevel<<3|t,i=QRUtil.getBCHTypeInfo(n),r=0;15>r;r++){var o=!e&&1==(i>>r&1);6>r?this.modules[r][8]=o:8>r?this.modules[r+1][8]=o:this.modules[this.moduleCount-15+r][8]=o}for(var r=0;15>r;r++){var o=!e&&1==(i>>r&1);8>r?this.modules[8][this.moduleCount-r-1]=o:9>r?this.modules[8][15-r-1+1]=o:this.modules[8][15-r-1]=o}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var n=-1,i=this.moduleCount-1,r=7,o=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;2>s;s++)if(null==this.modules[i][a-s]){var c=!1;o<e.length&&(c=1==(e[o]>>>r&1));var l=QRUtil.getMask(t,i,a-s);l&&(c=!c),this.modules[i][a-s]=c,r--,-1==r&&(o++,r=7)}if(i+=n,0>i||this.moduleCount<=i){i-=n,n=-n;break}}}},QRCode.PAD0=236,QRCode.PAD1=17,QRCode.createData=function(e,t,n){for(var i=QRRSBlock.getRSBlocks(e,t),r=new QRBitBuffer,o=0;o<n.length;o++){var a=n[o];r.put(a.mode,4),r.put(a.getLength(),QRUtil.getLengthInBits(a.mode,e)),a.write(r)}for(var s=0,o=0;o<i.length;o++)s+=i[o].dataCount;if(r.getLengthInBits()>8*s)throw new Error("code length overflow. ("+r.getLengthInBits()+">"+8*s+")");for(r.getLengthInBits()+4<=8*s&&r.put(0,4);r.getLengthInBits()%8!=0;)r.putBit(!1);for(;!(r.getLengthInBits()>=8*s)&&(r.put(QRCode.PAD0,8),!(r.getLengthInBits()>=8*s));)r.put(QRCode.PAD1,8);return QRCode.createBytes(r,i)},QRCode.createBytes=function(e,t){for(var n=0,i=0,r=0,o=new Array(t.length),a=new Array(t.length),s=0;s<t.length;s++){var c=t[s].dataCount,l=t[s].totalCount-c;i=Math.max(i,c),r=Math.max(r,l),o[s]=new Array(c);for(var d=0;d<o[s].length;d++)o[s][d]=255&e.buffer[d+n];n+=c;var u=QRUtil.getErrorCorrectPolynomial(l),p=new QRPolynomial(o[s],u.getLength()-1),h=p.mod(u);a[s]=new Array(u.getLength()-1);for(var d=0;d<a[s].length;d++){var g=d+h.getLength()-a[s].length;a[s][d]=g>=0?h.get(g):0}}for(var f=0,d=0;d<t.length;d++)f+=t[d].totalCount;for(var m=new Array(f),v=0,d=0;i>d;d++)for(var s=0;s<t.length;s++)d<o[s].length&&(m[v++]=o[s][d]);for(var d=0;r>d;d++)for(var s=0;s<t.length;s++)d<a[s].length&&(m[v++]=a[s][d]);return m};for(var QRMode={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},QRErrorCorrectLevel={L:1,M:0,Q:3,H:2},QRMaskPattern={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},QRUtil={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(QRUtil.G15)>=0;)t^=QRUtil.G15<<QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(QRUtil.G15);return(e<<10|t)^QRUtil.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(QRUtil.G18)>=0;)t^=QRUtil.G18<<QRUtil.getBCHDigit(t)-QRUtil.getBCHDigit(QRUtil.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return QRUtil.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case QRMaskPattern.PATTERN000:return(t+n)%2==0;case QRMaskPattern.PATTERN001:return t%2==0;case QRMaskPattern.PATTERN010:return n%3==0;case QRMaskPattern.PATTERN011:return(t+n)%3==0;case QRMaskPattern.PATTERN100:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case QRMaskPattern.PATTERN101:return t*n%2+t*n%3==0;case QRMaskPattern.PATTERN110:return(t*n%2+t*n%3)%2==0;case QRMaskPattern.PATTERN111:return(t*n%3+(t+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new QRPolynomial([1],0),n=0;e>n;n++)t=t.multiply(new QRPolynomial([1,QRMath.gexp(n)],0));return t},getLengthInBits:function(e,t){if(t>=1&&10>t)switch(e){case QRMode.MODE_NUMBER:return 10;case QRMode.MODE_ALPHA_NUM:return 9;case QRMode.MODE_8BIT_BYTE:return 8;case QRMode.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>t)switch(e){case QRMode.MODE_NUMBER:return 12;case QRMode.MODE_ALPHA_NUM:return 11;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>t))throw new Error("type:"+t);switch(e){case QRMode.MODE_NUMBER:return 14;case QRMode.MODE_ALPHA_NUM:return 13;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,i=0;t>i;i++)for(var r=0;t>r;r++){for(var o=0,a=e.isDark(i,r),s=-1;1>=s;s++)if(!(0>i+s||i+s>=t))for(var c=-1;1>=c;c++)0>r+c||r+c>=t||(0!=s||0!=c)&&a==e.isDark(i+s,r+c)&&o++;o>5&&(n+=3+o-5)}for(var i=0;t-1>i;i++)for(var r=0;t-1>r;r++){var l=0;e.isDark(i,r)&&l++,e.isDark(i+1,r)&&l++,e.isDark(i,r+1)&&l++,e.isDark(i+1,r+1)&&l++,(0==l||4==l)&&(n+=3)}for(var i=0;t>i;i++)for(var r=0;t-6>r;r++)e.isDark(i,r)&&!e.isDark(i,r+1)&&e.isDark(i,r+2)&&e.isDark(i,r+3)&&e.isDark(i,r+4)&&!e.isDark(i,r+5)&&e.isDark(i,r+6)&&(n+=40);for(var r=0;t>r;r++)for(var i=0;t-6>i;i++)e.isDark(i,r)&&!e.isDark(i+1,r)&&e.isDark(i+2,r)&&e.isDark(i+3,r)&&e.isDark(i+4,r)&&!e.isDark(i+5,r)&&e.isDark(i+6,r)&&(n+=40);for(var d=0,r=0;t>r;r++)for(var i=0;t>i;i++)e.isDark(i,r)&&d++;var u=Math.abs(100*d/t/t-50)/5;return n+=10*u}},QRMath={glog:function(e){if(1>e)throw new Error("glog("+e+")");return QRMath.LOG_TABLE[e]},gexp:function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return QRMath.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},i=0;8>i;i++)QRMath.EXP_TABLE[i]=1<<i;for(var i=8;256>i;i++)QRMath.EXP_TABLE[i]=QRMath.EXP_TABLE[i-4]^QRMath.EXP_TABLE[i-5]^QRMath.EXP_TABLE[i-6]^QRMath.EXP_TABLE[i-8];for(var i=0;255>i;i++)QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i;QRPolynomial.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),n=0;n<this.getLength();n++)for(var i=0;i<e.getLength();i++)t[n+i]^=QRMath.gexp(QRMath.glog(this.get(n))+QRMath.glog(e.get(i)));return new QRPolynomial(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=QRMath.glog(this.get(0))-QRMath.glog(e.get(0)),n=new Array(this.getLength()),i=0;i<this.getLength();i++)n[i]=this.get(i);for(var i=0;i<e.getLength();i++)n[i]^=QRMath.gexp(QRMath.glog(e.get(i))+t);return new QRPolynomial(n,0).mod(e)}},QRRSBlock.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],QRRSBlock.getRSBlocks=function(e,t){var n=QRRSBlock.getRsBlockTable(e,t);if(n==undefined)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var i=n.length/3,r=new Array,o=0;i>o;o++)for(var a=n[3*o+0],s=n[3*o+1],c=n[3*o+2],l=0;a>l;l++)r.push(new QRRSBlock(s,c));return r},QRRSBlock.getRsBlockTable=function(e,t){switch(t){case QRErrorCorrectLevel.L:return QRRSBlock.RS_BLOCK_TABLE[4*(e-1)+0];case QRErrorCorrectLevel.M:return QRRSBlock.RS_BLOCK_TABLE[4*(e-1)+1];case QRErrorCorrectLevel.Q:return QRRSBlock.RS_BLOCK_TABLE[4*(e-1)+2];case QRErrorCorrectLevel.H:return QRRSBlock.RS_BLOCK_TABLE[4*(e-1)+3];default:return undefined}},QRBitBuffer.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var n=0;t>n;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},RainyDay.prototype.prepareCanvas=function(){var e=document.createElement("canvas");return e.style.position=this.options.position,e.style.top=this.options.top,e.style.left=this.options.left,e.width=this.options.width,e.height=this.options.height,this.options.parentElement.appendChild(e),this.options.enableSizeChange&&this.setResizeHandler(),e},RainyDay.prototype.setResizeHandler=function(){null!==window.onresize?window.setInterval(this.checkSize.bind(this),100):(window.onresize=this.checkSize.bind(this),window.onorientationchange=this.checkSize.bind(this))},RainyDay.prototype.checkSize=function(){var e=this.img.clientWidth,t=this.img.clientHeight,n=this.img.offsetLeft,i=this.img.offsetTop,r=this.canvas.width,o=this.canvas.height,a=this.canvas.offsetLeft,s=this.canvas.offsetTop;(r!==e||o!==t)&&(this.canvas.width=e,this.canvas.height=t,this.prepareBackground(),this.glass.width=this.canvas.width,this.glass.height=this.canvas.height,this.prepareReflections()),(a!==n||s!==i)&&(this.canvas.offsetLeft=n,this.canvas.offsetTop=i)},RainyDay.prototype.animateDrops=function(){this.addDropCallback&&this.addDropCallback();for(var e=this.drops.slice(),t=[],n=0;n<e.length;++n)e[n].animate()&&t.push(e[n]);this.drops=t,window.requestAnimFrame(this.animateDrops.bind(this))},RainyDay.prototype.setRequestAnimFrame=function(){var e=this.options.fps;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/e)}}()},RainyDay.prototype.prepareReflections=function(){this.reflected=document.createElement("canvas"),this.reflected.width=this.canvas.width/this.options.reflectionScaledownFactor,this.reflected.height=this.canvas.height/this.options.reflectionScaledownFactor;var e=this.reflected.getContext("2d");e.drawImage(this.img,this.options.crop[0],this.options.crop[1],this.options.crop[2],this.options.crop[3],0,0,this.reflected.width,this.reflected.height)},RainyDay.prototype.prepareGlass=function(){this.glass=document.createElement("canvas"),this.glass.width=this.canvas.width,this.glass.height=this.canvas.height,this.context=this.glass.getContext("2d")},RainyDay.prototype.rain=function(e,t){if(this.reflection!==this.REFLECTION_NONE&&this.prepareReflections(),this.animateDrops(),this.presets=e,this.PRIVATE_GRAVITY_FORCE_FACTOR_Y=.001*this.options.fps/25,this.PRIVATE_GRAVITY_FORCE_FACTOR_X=(Math.PI/2-this.options.gravityAngle)*(.001*this.options.fps)/50,this.options.enableCollisions){for(var n=0,i=0;i<e.length;i++)e[i][0]+e[i][1]>n&&(n=Math.floor(e[i][0]+e[i][1]));if(n>0){var r=Math.ceil(this.canvas.width/n),o=Math.ceil(this.canvas.height/n);this.matrix=new CollisionMatrix(r,o,n)}else this.options.enableCollisions=!1}for(var i=0;i<e.length;i++)e[i][3]||(e[i][3]=-1);var a=0;this.addDropCallback=function(){var n=(new Date).getTime();if(!(t>n-a)){a=n;var i=this.canvas.getContext("2d");i.clearRect(0,0,this.canvas.width,this.canvas.height),i.drawImage(this.background,0,0,this.canvas.width,this.canvas.height);for(var r,o=0;o<e.length;o++)if(e[o][2]>1||-1===e[o][3]){if(0!==e[o][3]){e[o][3]--;for(var s=0;s<e[o][2];++s)this.putDrop(new Drop(this,Math.random()*this.canvas.width,Math.random()*this.canvas.height,e[o][0],e[o][1]))}}else if(Math.random()<e[o][2]){r=e[o];break}r&&this.putDrop(new Drop(this,Math.random()*this.canvas.width,Math.random()*this.canvas.height,r[0],r[1])),i.save(),i.globalAlpha=this.options.opacity,i.drawImage(this.glass,0,0,this.canvas.width,this.canvas.height),i.restore()}}.bind(this)},RainyDay.prototype.putDrop=function(e){e.draw(),this.gravity&&e.r>this.options.gravityThreshold&&(this.options.enableCollisions&&this.matrix.update(e),this.drops.push(e))},RainyDay.prototype.clearDrop=function(e,t){var n=e.clear(t);if(n){var i=this.drops.indexOf(e);i>=0&&this.drops.splice(i,1)}return n},Drop.prototype.draw=function(){this.context.save(),this.context.beginPath();var e=this.r;if(this.r=.95*this.r,this.r<3)this.context.arc(this.x,this.y,this.r,0,2*Math.PI,!0),this.context.closePath();else if(this.colliding||this.yspeed>2){if(this.colliding){var t=this.colliding;this.r=1.001*(this.r>t.r?this.r:t.r),this.x+=t.x-this.x,this.colliding=null}var n=1+.1*this.yspeed;this.context.moveTo(this.x-this.r/n,this.y),this.context.bezierCurveTo(this.x-this.r,this.y-2*this.r,this.x+this.r,this.y-2*this.r,this.x+this.r/n,this.y),this.context.bezierCurveTo(this.x+this.r,this.y+n*this.r,this.x-this.r,this.y+n*this.r,this.x-this.r/n,this.y)}else this.context.arc(this.x,this.y,.9*this.r,0,2*Math.PI,!0),
this.context.closePath();this.context.clip(),this.r=e,this.rainyday.reflection&&this.rainyday.reflection(this),this.context.restore()},Drop.prototype.clear=function(e){return this.context.clearRect(this.x-this.r-1,this.y-this.r-2,2*this.r+2,2*this.r+2),e?(this.terminate=!0,!0):this.y-this.r>this.rainyday.canvas.height||this.x-this.r>this.rainyday.canvas.width||this.x+this.r<0},Drop.prototype.animate=function(){if(this.terminate)return!1;var e=this.rainyday.gravity(this);if(!e&&this.rainyday.trail&&this.rainyday.trail(this),this.rainyday.options.enableCollisions){var t=this.rainyday.matrix.update(this,e);t&&this.rainyday.collision(this,t)}return!e||this.terminate},RainyDay.prototype.TRAIL_NONE=function(){},RainyDay.prototype.TRAIL_DROPS=function(e){(!e.trailY||e.y-e.trailY>=100*Math.random()*e.r)&&(e.trailY=e.y,this.putDrop(new Drop(this,e.x+(2*Math.random()-1)*Math.random(),e.y-e.r-5,Math.ceil(e.r/5),0)))},RainyDay.prototype.TRAIL_SMUDGE=function(e){var t=e.y-e.r-3,n=e.x-e.r/2+2*Math.random();0>t||0>n||this.context.drawImage(this.clearbackground,n,t,e.r,2,n,t,e.r,2)},RainyDay.prototype.GRAVITY_NONE=function(){return!0},RainyDay.prototype.GRAVITY_LINEAR=function(e){return!!this.clearDrop(e)||(e.yspeed?(e.yspeed+=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y*Math.floor(e.r),e.xspeed+=this.PRIVATE_GRAVITY_FORCE_FACTOR_X*Math.floor(e.r)):(e.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,e.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X),e.y+=e.yspeed,e.draw(),!1)},RainyDay.prototype.GRAVITY_NON_LINEAR=function(e){return!!this.clearDrop(e)||(e.collided?(e.collided=!1,e.seed=Math.floor(e.r*Math.random()*this.options.fps),e.skipping=!1,e.slowing=!1):(!e.seed||e.seed<0)&&(e.seed=Math.floor(e.r*Math.random()*this.options.fps),e.skipping=e.skipping===!1,e.slowing=!0),e.seed--,e.yspeed?e.slowing?(e.yspeed/=1.1,e.xspeed/=1.1,e.yspeed<this.PRIVATE_GRAVITY_FORCE_FACTOR_Y&&(e.slowing=!1)):e.skipping?(e.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,e.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X):(e.yspeed+=1*this.PRIVATE_GRAVITY_FORCE_FACTOR_Y*Math.floor(e.r),e.xspeed+=1*this.PRIVATE_GRAVITY_FORCE_FACTOR_X*Math.floor(e.r)):(e.yspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_Y,e.xspeed=this.PRIVATE_GRAVITY_FORCE_FACTOR_X),0!==this.options.gravityAngleVariance&&(e.xspeed+=(2*Math.random()-1)*e.yspeed*this.options.gravityAngleVariance),e.y+=e.yspeed,e.x+=e.xspeed,e.draw(),!1)},RainyDay.prototype.positiveMin=function(e,t){var n=0;return n=t>e?0>=e?t:e:0>=t?e:t,0>=n?1:n},RainyDay.prototype.REFLECTION_NONE=function(){this.context.fillStyle=this.options.fillStyle,this.context.fill()},RainyDay.prototype.REFLECTION_MINIATURE=function(e){var t=Math.max((e.x-this.options.reflectionDropMappingWidth)/this.options.reflectionScaledownFactor,0),n=Math.max((e.y-this.options.reflectionDropMappingHeight)/this.options.reflectionScaledownFactor,0),i=this.positiveMin(2*this.options.reflectionDropMappingWidth/this.options.reflectionScaledownFactor,this.reflected.width-t),r=this.positiveMin(2*this.options.reflectionDropMappingHeight/this.options.reflectionScaledownFactor,this.reflected.height-n),o=Math.max(e.x-1.1*e.r,0),a=Math.max(e.y-1.1*e.r,0);this.context.drawImage(this.reflected,t,n,i,r,o,a,2*e.r,2*e.r)},RainyDay.prototype.COLLISION_SIMPLE=function(e,t){for(var n,i=t;null!=i;){var r=i.drop;if(Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))<e.r+r.r){n=r;break}i=i.next}if(n){var o,a;e.y>n.y?(o=e,a=n):(o=n,a=e),this.clearDrop(a),this.clearDrop(o,!0),this.matrix.remove(o),a.draw(),a.colliding=o,a.collided=!0}},RainyDay.prototype.prepareBackground=function(){this.background=document.createElement("canvas"),this.background.width=this.canvas.width,this.background.height=this.canvas.height,this.clearbackground=document.createElement("canvas"),this.clearbackground.width=this.canvas.width,this.clearbackground.height=this.canvas.height;var e=this.background.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),e.drawImage(this.img,this.options.crop[0],this.options.crop[1],this.options.crop[2],this.options.crop[3],0,0,this.canvas.width,this.canvas.height),e=this.clearbackground.getContext("2d"),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.drawImage(this.img,this.options.crop[0],this.options.crop[1],this.options.crop[2],this.options.crop[3],0,0,this.canvas.width,this.canvas.height),!isNaN(this.options.blur)&&this.options.blur>=1&&this.stackBlurCanvasRGB(this.canvas.width,this.canvas.height,this.options.blur)},RainyDay.prototype.stackBlurCanvasRGB=function(e,t,n){var i=[[0,9],[1,11],[2,12],[3,13],[5,14],[7,15],[11,16],[15,17],[22,18],[31,19],[45,20],[63,21],[90,22],[127,23],[181,24]],r=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];n|=0;var o=this.background.getContext("2d");console.log(e);var a,s,c,l,d,u,p,h,g,f,m,v,y,b,w,E,S,x,T,C,$=o.getImageData(0,0,e,t),I=$.data,R=n+1,P=R*(R+1)/2,M=new BlurStack,_=new BlurStack,k=M;for(c=1;2*n+1>c;c++)k=k.next=new BlurStack,c===R&&(_=k);k.next=M;var A=null,L=null;p=u=0;for(var D,z=r[n],F=0;F<i.length;++F)if(n<=i[F][0]){D=i[F-1][1];break}for(s=0;t>s;s++){for(b=w=E=h=g=f=0,m=R*(S=I[u]),v=R*(x=I[u+1]),y=R*(T=I[u+2]),h+=P*S,g+=P*x,f+=P*T,k=M,c=0;R>c;c++)k.r=S,k.g=x,k.b=T,k=k.next;for(c=1;R>c;c++)l=u+((c>e-1?e-1:c)<<2),h+=(k.r=S=I[l])*(C=R-c),g+=(k.g=x=I[l+1])*C,f+=(k.b=T=I[l+2])*C,b+=S,w+=x,E+=T,k=k.next;for(A=M,L=_,a=0;e>a;a++)I[u]=h*z>>D,I[u+1]=g*z>>D,I[u+2]=f*z>>D,h-=m,g-=v,f-=y,m-=A.r,v-=A.g,y-=A.b,l=p+((l=a+n+1)<e-1?l:e-1)<<2,b+=A.r=I[l],w+=A.g=I[l+1],E+=A.b=I[l+2],h+=b,g+=w,f+=E,A=A.next,m+=S=L.r,v+=x=L.g,y+=T=L.b,b-=S,w-=x,E-=T,L=L.next,u+=4;p+=e}for(a=0;e>a;a++){for(w=E=b=g=f=h=0,u=a<<2,m=R*(S=I[u]),v=R*(x=I[u+1]),y=R*(T=I[u+2]),h+=P*S,g+=P*x,f+=P*T,k=M,c=0;R>c;c++)k.r=S,k.g=x,k.b=T,k=k.next;for(d=e,c=1;R>c;c++)u=d+a<<2,h+=(k.r=S=I[u])*(C=R-c),g+=(k.g=x=I[u+1])*C,f+=(k.b=T=I[u+2])*C,b+=S,w+=x,E+=T,k=k.next,t-1>c&&(d+=e);for(u=a,A=M,L=_,s=0;t>s;s++)l=u<<2,I[l]=h*z>>D,I[l+1]=g*z>>D,I[l+2]=f*z>>D,h-=m,g-=v,f-=y,m-=A.r,v-=A.g,y-=A.b,l=a+((l=s+R)<t-1?l:t-1)*e<<2,h+=b+=A.r=I[l],g+=w+=A.g=I[l+1],f+=E+=A.b=I[l+2],A=A.next,m+=S=L.r,v+=x=L.g,y+=T=L.b,b-=S,w-=x,E-=T,L=L.next,u+=e}o.putImageData($,0,0)},CollisionMatrix.prototype.update=function(e,t){if(e.gid){if(!this.matrix[e.gmx]||!this.matrix[e.gmx][e.gmy])return null;if(this.matrix[e.gmx][e.gmy].remove(e),t)return null;if(e.gmx=Math.floor(e.x/this.resolution),e.gmy=Math.floor(e.y/this.resolution),!this.matrix[e.gmx]||!this.matrix[e.gmx][e.gmy])return null;this.matrix[e.gmx][e.gmy].add(e);var n=this.collisions(e);if(n&&null!=n.next)return n.next}else{if(e.gid=Math.random().toString(36).substr(2,9),e.gmx=Math.floor(e.x/this.resolution),e.gmy=Math.floor(e.y/this.resolution),!this.matrix[e.gmx]||!this.matrix[e.gmx][e.gmy])return null;this.matrix[e.gmx][e.gmy].add(e)}return null},CollisionMatrix.prototype.collisions=function(e){var t=new DropItem(null),n=t;return t=this.addAll(t,e.gmx-1,e.gmy+1),t=this.addAll(t,e.gmx,e.gmy+1),t=this.addAll(t,e.gmx+1,e.gmy+1),n},CollisionMatrix.prototype.addAll=function(e,t,n){if(t>0&&n>0&&t<this.xc&&n<this.yc)for(var i=this.matrix[t][n];null!=i.next;)i=i.next,e.next=new DropItem(i.drop),e=e.next;return e},CollisionMatrix.prototype.remove=function(e){this.matrix[e.gmx][e.gmy].remove(e)},DropItem.prototype.add=function(e){for(var t=this;null!=t.next;)t=t.next;t.next=new DropItem(e)},DropItem.prototype.remove=function(e){for(var t=this,n=null;null!=t.next;)n=t,t=t.next,t.drop.gid===e.gid&&(n.next=t.next)},function(e){window.rainyDay={doEffect:function(e,t,n,i){console.log(123),i(eqShow,t,n);var r=document.getElementById("2755513881");r.onload=function(){var e=new RainyDay({image:this,parentElement:document.getElementById("page1")});e.rain([[1,2,8e3]]),e.rain([[3,3,.88],[5,5,.9],[6,2,1]],100)},r.src=src}}}(jQuery),function(){function e(e,i,r,o,s){function c(){timeout=setTimeout(function(){nums>=300*r&&(console.log(r),$(i).fadeOut(500,function(){setTimeout(function(){$(i).removeClass("lock").addClass("unlock")},500),$("#audio_btn").css("opacity",1),1==o&&playVideo(t)}),nums=0)},n)}var l="ontouchstart"in window,d=l?"touchstart":"mousedown",u=l?"touchmove":"mousemove",p=l?"touchend":"mouseup";e.lineCap="round",e.lineJoin="round",e.lineWidth=2*a,e.globalCompositeOperation="destination-out",new RegExp("assets"),i.addEventListener(d,function(t){function n(t){c(),nums++,t.preventDefault(),x2=l?t.targetTouches[0].pageX:t.pageX-$("#can"+o).offset().left,y2=l?t.targetTouches[0].pageY:t.pageY-$("#can"+o).offset().top,e.moveTo(x1,y1),e.lineTo(x2,y2),e.stroke(),x1=x2,y1=y2}$("#tip"+o).remove(),t.preventDefault(),x1=l?t.targetTouches[0].pageX:t.pageX-$("#can"+o).offset().left,y1=l?t.targetTouches[0].pageY:t.pageY-$("#can"+o).offset().top,startX=x1,startY=y1,i.addEventListener(u,n),i.addEventListener(p,function(){i.removeEventListener(u,n)})})}var t,n=200;window.addScratchEffect=function(n,i,r){pageInfo=i,t=n,a=20,nums=0;var o,s=$(".m-img").width(),c=$(".m-img").height(),l=document.createElement("canvas");$(l).prependTo("#page"+r).attr("class","cas scratch-cas page_effect lock").attr("id","can"+r).attr("style","z-index: 1000");var d=l.getContext("2d");l.width=s,l.height=c;var u=new Image;if(i[r-1].properties.image){if(num=r,i[r-1].properties.tip){var p=document.createElement("div");$(p).attr("id","tip"+r).attr("class","tip").prependTo("#page"+r),$(p).html(i[r-1].properties.tip)}u.src=i[r-1].properties.image.path,o=i[r-1].properties.percentage.value}else if(i[r-1].properties.scratch){if(num=r,i[r-1].properties.scratch.tip){var p=document.createElement("div");$(p).attr("id","tip"+r).attr("class","tip").prependTo("#page"+r),$(p).html(i[r-1].properties.scratch.tip)}u.src=i[r-1].properties.scratch.image.path,o=i[r-1].properties.scratch.percentage.value||i[r-1].properties.scratch.percentage}!function(t,n,r,o,a){t.onload=function(){i[o-1].properties.image||!i[o-1].properties.scratch.hasOwnProperty("opacity")?n.globalAlpha=.8:n.globalAlpha=1-parseFloat(i[o-1].properties.scratch.opacity).toFixed(2),n.drawImage(this,0,0,r.width,r.height),renderPage(eqShow,o,pageInfo);for(var s=0;s<pageInfo[o-1].elements.length;s++){var c=eqShow.selectElement(pageInfo[o-1].elements[s].id);eqxCommon.bindTrigger(c,pageInfo[o-1].elements[s])}e(n,r,a,o,t)}}(u,d,l,r,o)}}(),function(e){e.fn.slides=function(t){return t=e.extend({},e.fn.slides.option,t),this.each(function(){function n(){clearInterval(l.data("interval"))}function i(){t.pause?(clearTimeout(l.data("pause")),clearInterval(l.data("interval")),pauseTimeout=setTimeout(function(){clearTimeout(l.data("pause")),playInterval=setInterval(function(){r("next",f)},t.play),l.data("interval",playInterval)},t.pause),l.data("pause",pauseTimeout)):n()}function r(n,i,r){if(!a&&o){switch(a=!0,n){case"next":y=w,v=w+1,v=u===v?0:v,c=2*p,n=2*-p,w=v;break;case"prev":y=w,v=w-1,v=-1===v?u-1:v,c=0,n=0,w=v;break;case"pagination":v=parseInt(r,10),y=e("."+t.paginationClass+" li.current a",l).attr("rel"),v>y?(c=2*p,n=2*-p):(c=0,n=0),w=v}"fade"===i?(t.animationStart(),t.crossfade?d.children(":eq("+v+")",l).css({zIndex:10}).fadeIn(t.fadeSpeed,function(){d.children(":eq("+y+")",l).css({display:"none",zIndex:0}),e(this).css({zIndex:0}),t.animationComplete(v+1),a=!1}):(t.animationStart(),d.children(":eq("+y+")",l).fadeOut(t.fadeSpeed,function(){t.autoHeight?d.animate({height:d.children(":eq("+v+")",l).outerHeight()},t.autoHeightSpeed,function(){d.children(":eq("+v+")",l).fadeIn(t.fadeSpeed)}):d.children(":eq("+v+")",l).fadeIn(t.fadeSpeed,function(){e.browser.msie&&e(this).get(0).style.removeAttribute("filter")}),t.animationComplete(v+1),a=!1}))):(d.children(":eq("+v+")").css({left:c,display:"block"}),t.autoHeight?(t.animationStart(),d.animate({left:n,height:d.children(":eq("+v+")").outerHeight()},t.slideSpeed,function(){d.css({left:-p}),d.children(":eq("+v+")").css({left:p,zIndex:5}),d.children(":eq("+y+")").css({left:p,display:"none",zIndex:0}),t.animationComplete(v+1),a=!1})):(t.animationStart(),d.animate({left:n},t.slideSpeed,function(){d.css({left:-p}),d.children(":eq("+v+")").css({left:p,zIndex:5}),d.children(":eq("+y+")").css({left:p,display:"none",zIndex:0}),t.animationComplete(v+1),a=!1}))),t.pagination&&(e("."+t.paginationClass+" li.current",l).removeClass("current"),e("."+t.paginationClass+" li a:eq("+v+")",l).parent().addClass("current"))}}e("."+t.container,e(this)).children().wrapAll('<div class="slides_control"/>');var o,a,s,c,l=e(this),d=e(".slides_control",l),u=d.children().size(),p=d.children().outerWidth(),h=d.children().outerHeight(),g=t.start-1,f=t.effect.indexOf(",")<0?t.effect:t.effect.replace(" ","").split(",")[0],m=t.effect.indexOf(",")<0?f:t.effect.replace(" ","").split(",")[1],v=0,y=0,b=0,w=0;if(!(2>u)){if(0>g&&(g=0),g>u&&(g=u-1),t.start&&(w=g),t.randomize&&d.randomize(),e("."+t.container,l).css({overflow:"hidden",position:"relative"}),d.css({position:"relative",width:3*p,height:h,left:-p}),d.children().css({position:"absolute",top:0,left:p,zIndex:0,display:"none"}),t.autoHeight&&d.animate({height:d.children(":eq("+g+")").outerHeight()},t.autoHeightSpeed),t.preload&&"IMG"==d.children()[0].tagName){l.css({background:"url("+t.preloadImage+") no-repeat 50% 50%"});var E=e("img:eq("+g+")",l).attr("src")+"?"+(new Date).getTime();e("img:eq("+g+")",l).attr("src",E).load(function(){e(this).fadeIn(t.fadeSpeed,function(){e(this).css({zIndex:5}),l.css({background:""}),o=!0})})}else d.children(":eq("+g+")").fadeIn(t.fadeSpeed,function(){o=!0});t.bigTarget&&(d.children().css({cursor:"pointer"}),d.children().click(function(){return r("next",f),!1})),t.hoverPause&&t.play&&(d.children().bind("mouseover",function(){n()}),d.children().bind("mouseleave",function(){i()})),t.generateNextPrev&&(e("."+t.container,l).after('<a href="#" class="'+t.prev+'">Prev</a>'),e("."+t.prev,l).after('<a href="#" class="'+t.next+'">Next</a>')),e("."+t.next,l).click(function(e){e.preventDefault(),t.play&&i(),r("next",f)}),e("."+t.prev,l).click(function(e){e.preventDefault(),t.play&&i(),r("prev",f)}),t.generatePagination?(l.append("<ul class="+t.paginationClass+"></ul>"),d.children().each(function(){e("."+t.paginationClass,l).append("<li><a rel="+b+' href="#">'+(b+1)+"</a></li>"),b++})):e("."+t.paginationClass+" li a",l).each(function(){e(this).attr("rel",b),b++}),e("."+t.paginationClass+" li a:eq("+g+")",l).parent().addClass("current"),e("."+t.paginationClass+" li a",l).click(function(){return t.play&&i(),s=e(this).attr("rel"),w!=s&&r("pagination",m,s),!1}),t.play&&(playInterval=setInterval(function(){r("next",f)},t.play),l.data("interval",playInterval))}})},e.fn.slides.option={preload:!1,preloadImage:"/img/loading.gif",container:"slides_container",generateNextPrev:!1,next:"next",prev:"prev",pagination:!0,generatePagination:!0,paginationClass:"pagination",fadeSpeed:350,slideSpeed:350,start:1,effect:"slide",crossfade:!1,randomize:!1,play:0,pause:0,hoverPause:!1,autoHeight:!1,autoHeightSpeed:350,bigTarget:!1,animationStart:function(){},animationComplete:function(){}},e.fn.randomize=function(t){function n(){return Math.round(Math.random())-.5}return e(this).each(function(){var r=e(this),o=r.children(),a=o.length;if(a>1){o.hide();var s=[];for(i=0;a>i;i++)s[s.length]=i;s=s.sort(n),e.each(s,function(e,n){var i=o.eq(n),a=i.clone(!0);a.show().appendTo(r),t!==undefined&&t(i,a),i.remove()})}})}}(jQuery),function($){window.snowFly={doEffect:function(audioObj,pageNum,pages,callback){callback(eqShow,pageNum,pages);for(var i=0;i<pages[pageNum-1].elements.length;i++){var $elem=eqShow.selectElement(pages[pageNum-1].elements[i].id);eqxCommon.bindTrigger($elem,pages[pageNum-1].elements[i])}1==pageNum&&playVideo(audioObj);var container,particle,camera,scene,renderer,SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight,mouseX=0,mouseY=0,particles=(window.innerWidth/2,window.innerHeight/2,[]),particleImage=new Image;particleImage.src=CLIENT_CDN+"view/images/ParticleSmoke.png";var $parent=$("#page"+pageNum).parent(".main-page");container=$parent.get(0),camera=new THREE.PerspectiveCamera(75,SCREEN_WIDTH/SCREEN_HEIGHT,1,1e4),camera.position.z=1e3,scene=new THREE.Scene,scene.add(camera),renderer=new THREE.CanvasRenderer,renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),renderer.num=pageNum;for(var material=new THREE.ParticleBasicMaterial({map:new THREE.Texture(particleImage)}),i=0;500>i;i++)particle=new Particle3D(material),particle.position.x=2e3*Math.random()-1e3,particle.position.y=2e3*Math.random()-1e3,particle.position.z=2e3*Math.random()-1e3,particle.scale.x=particle.scale.y=1,scene.add(particle),particles.push(particle);var canvas=renderer.domElement;$(canvas).attr("id","snowcas"+pageNum).appendTo($parent),$("#snowcas"+pageNum).css({position:"absolute",top:0,width:"100%",height:"100%"}),eqShow.stopSnowFly=setInterval(function(){for(var i=0;i<particles.length;i++){var particle=particles[i];with(particle.updatePhysics(),particle.position)y<-1e3&&(y+=2e3),x>1e3?x-=2e3:x<-1e3&&(x+=2e3),z>1e3?z-=2e3:z<-1e3&&(z+=2e3)}camera.position.x+=.05*(mouseX-camera.position.x),camera.position.y+=.05*(-mouseY-camera.position.y),camera.lookAt(scene.position),renderer.render(scene,camera)},1e3/60)}}}(jQuery),function(){window.eqxiuSvg={NAMESPACE:"http://www.w3.org/2000/svg",SYMBOLS:{},boundingBox:function(e){var t,n=e.parentNode,i=document.createElementNS(eqxiuSvg.NAMESPACE,"svg");return i.setAttribute("width","0"),i.setAttribute("height","0"),i.setAttribute("style","visibility: hidden; position: absolute; left: 0; top: 0;"),i.appendChild(e),document.body.appendChild(i),t=e.getBBox(),n?n.appendChild(e):i.removeChild(e),document.body.removeChild(i),t},pointsToPolygon:function(e){for(var t=[];e.length>=2;)t.push(e.shift()+","+e.shift());return t.join(" ")},symbol:function(e,t,n){var i=n?n:"#555",r=eqxiuSvg.SYMBOLS[e],o='<g fill="'+i+'" id="path_'+t+'">'+r+"</g>";return o},ShapeFromType:function(e,t,n,i,r){return t||(t=64),n||(n=64),/symbols\-/.test(e)?eqxiuSvg.symbol(e.replace(/^symbols\-/,""),i,r):"rect"==e?eqxiuSvg.rect(t,n):"circle"==e?eqxiuSvg.ellipse(t,n):"diamond"==e?eqxiuSvg.polygon(t,n,4):"octagon"==e?eqxiuSvg.polygon(t,n,8):"triangle-up"==e?eqxiuSvg.triangleUp(t,n):"triangle-down"==e?eqxiuSvg.triangleDown(t,n):"triangle-left"==e?eqxiuSvg.triangleLeft(t,n):"triangle-right"==e?eqxiuSvg.triangleRight(t,n):"arrow-up"==e?eqxiuSvg.arrowUp(t,n):"arrow-down"==e?eqxiuSvg.arrowDown(t,n):"arrow-left"==e?eqxiuSvg.arrowLeft(t,n):"arrow-right"==e?eqxiuSvg.arrowRight(t,n):void 0},rect:function(e,t){var n=document.createElementNS(eqxiuSvg.NAMESPACE,"rect");return n.setAttribute("width",e),n.setAttribute("height",t),n},ellipse:function(e,t){var n=document.createElementNS(eqxiuSvg.NAMESPACE,"ellipse");return n.setAttribute("rx",e/2),n.setAttribute("ry",t/2),n.setAttribute("cx",e/2),n.setAttribute("cy",t/2),n},triangleUp:function(e,t){var n=document.createElementNS(eqxiuSvg.NAMESPACE,"polygon");return n.setAttribute("points",eqxiuSvg.pointsToPolygon([e/2,0,e,t,0,t])),n},triangleDown:function(e,t){var n=document.createElementNS(eqxiuSvg.NAMESPACE,"polygon");return n.setAttribute("points",eqxiuSvg.pointsToPolygon([0,0,e,0,e/2,t])),n},triangleLeft:function(e,t){var n=document.createElementNS(eqxiuSvg.NAMESPACE,"polygon");return n.setAttribute("points",eqxiuSvg.pointsToPolygon([0,t/2,e,0,e,t])),n},triangleRight:function(e,t){var n=document.createElementNS(eqxiuSvg.NAMESPACE,"polygon");return n.setAttribute("points",eqxiuSvg.pointsToPolygon([e,t/2,0,t,0,0])),n},arrowUp:function(e,t){var n=document.createElementNS(eqxiuSvg.NAMESPACE,"polygon");return n.setAttribute("points",eqxiuSvg.pointsToPolygon([.5*e,0,e,.5*t,.7*e,.5*t,.7*e,t,.3*e,t,.3*e,.5*t,0,.5*t,.5*e,0])),n},arrowDown:function(e,t){var n=document.createElementNS(eqxiuSvg.NAMESPACE,"polygon");return n.setAttribute("points",eqxiuSvg.pointsToPolygon([.5*e,t,e,.5*t,.7*e,.5*t,.7*e,0,.3*e,0,.3*e,.5*t,0,.5*t,.5*e,t])),n},arrowLeft:function(e,t){var n=document.createElementNS(eqxiuSvg.NAMESPACE,"polygon");return n.setAttribute("points",eqxiuSvg.pointsToPolygon([e,.3*t,.5*e,.3*t,.5*e,0,0,.5*t,.5*e,t,.5*e,.7*t,e,.7*t,e,.3*t])),n},arrowRight:function(e,t){var n=document.createElementNS(eqxiuSvg.NAMESPACE,"polygon");return n.setAttribute("points",eqxiuSvg.pointsToPolygon([0,.3*t,.5*e,.3*t,.5*e,0,e,.5*t,.5*e,t,.5*e,.7*t,0,.7*t])),n},polygon:function(e,t,n){var i=document.createElementNS(eqxiuSvg.NAMESPACE,"polygon"),r=[];if(3===n)r=[e/2,0,e,t,0,t];else if(n>3)for(var o=e/2,a=t/2,s=0;n>s;s++){var c=o+o*Math.cos(2*Math.PI*s/n),l=a+a*Math.sin(2*Math.PI*s/n);c=Math.round(10*c)/10,l=Math.round(10*l)/10,r.push(c),r.push(l)}return i.setAttribute("points",eqxiuSvg.pointsToPolygon(r)),i}}}(),function(){window.eqxiuSvg.SYMBOLS={bolt:'<path d="M32 0l-24 16 6 4-14 12 24-12-6-4z"></path>',camera:'<path d="M16 20c0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.209-1.791 4-4 4-2.209 0-4-1.791-4-4zM28 8l-3.289-6.643c-0.27-0.789-1.016-1.357-1.899-1.357h-5.492c-0.893 0-1.646 0.582-1.904 1.385l-3.412 6.615h-8.004c-2.209 0-4 1.791-4 4v20h32v-20c0-2.209-1.789-4-4-4zM6 16c-1.105 0-2-0.895-2-2s0.895-2 2-2 2 0.895 2 2-0.895 2-2 2zM20 28c-4.418 0-8-3.582-8-8s3.582-8 8-8 8 3.582 8 8-3.582 8-8 8z"></path>',"checkmark-circle":'<path d="M16 0c-8.836 0-16 7.164-16 16s7.164 16 16 16 16-7.164 16-16-7.164-16-16-16zM13.52 23.383l-7.362-7.363 2.828-2.828 4.533 4.535 9.617-9.617 2.828 2.828-12.444 12.445z"></path>',clock:'<path d="M16 4c6.617 0 12 5.383 12 12s-5.383 12-12 12-12-5.383-12-12 5.383-12 12-12zM16 0c-8.836 0-16 7.164-16 16s7.164 16 16 16 16-7.164 16-16-7.164-16-16-16v0zM21.422 18.578l-3.422-3.426v-7.152h-4.023v7.992c0 0.602 0.277 1.121 0.695 1.492l3.922 3.922 2.828-2.828z"></path>',cloud:'<path d="M24 10c-0.379 0-0.738 0.061-1.102 0.111-1.394-2.465-3.972-4.111-6.898-4.111-2.988 0-5.566 1.666-6.941 4.1-0.352-0.047-0.704-0.1-1.059-0.1-4.41 0-8 3.588-8 8 0 4.414 3.59 8 8 8h16c4.41 0 8-3.586 8-8 0-4.412-3.59-8-8-8zM24 22h-16c-2.207 0-4-1.797-4-4 0-2.193 1.941-3.885 4.004-3.945 0.008 0.943 0.172 1.869 0.5 2.744l3.746-1.402c-0.168-0.444-0.25-0.915-0.25-1.397 0-2.205 1.793-4 4-4 1.293 0 2.465 0.641 3.199 1.639-1.929 1.461-3.199 3.756-3.199 6.361h4c0-2.205 1.793-4 4-4s4 1.795 4 4c0 2.203-1.793 4-4 4z"></path>',cog:'<path d="M32 17.969v-4l-4.781-1.992c-0.133-0.375-0.273-0.738-0.445-1.094l1.93-4.805-2.829-2.828-4.762 1.961c-0.363-0.176-0.734-0.324-1.117-0.461l-2.027-4.75h-4l-1.977 4.734c-0.398 0.141-0.781 0.289-1.16 0.469l-4.754-1.91-2.828 2.828 1.938 4.711c-0.188 0.387-0.34 0.781-0.485 1.188l-4.703 2.011v4l4.707 1.961c0.145 0.406 0.301 0.801 0.488 1.188l-1.902 4.742 2.828 2.828 4.723-1.945c0.379 0.18 0.766 0.324 1.164 0.461l2.023 4.734h4l1.98-4.758c0.379-0.141 0.754-0.289 1.113-0.461l4.797 1.922 2.828-2.828-1.969-4.773c0.168-0.359 0.305-0.723 0.438-1.094l4.782-2.039zM15.969 22c-3.312 0-6-2.688-6-6s2.688-6 6-6 6 2.688 6 6-2.688 6-6 6z"></path>',denied:'<path d="M16 0c-8.836 0-16 7.164-16 16s7.164 16 16 16 16-7.164 16-16-7.164-16-16-16zM16 4c2.59 0 4.973 0.844 6.934 2.242l-16.696 16.688c-1.398-1.961-2.238-4.344-2.238-6.93 0-6.617 5.383-12 12-12zM16 28c-2.59 0-4.973-0.844-6.934-2.242l16.696-16.688c1.398 1.961 2.238 4.344 2.238 6.93 0 6.617-5.383 12-12 12z"></path>',earth:'<path d="M27.314 4.686c3.022 3.022 4.686 7.040 4.686 11.314s-1.664 8.292-4.686 11.314c-3.022 3.022-7.040 4.686-11.314 4.686s-8.292-1.664-11.314-4.686c-3.022-3.022-4.686-7.040-4.686-11.314s1.664-8.292 4.686-11.314c3.022-3.022 7.040-4.686 11.314-4.686s8.292 1.664 11.314 4.686zM25.899 25.9c1.971-1.971 3.281-4.425 3.821-7.096-0.421 0.62-0.824 0.85-1.073-0.538-0.257-2.262-2.335-0.817-3.641-1.621-1.375 0.927-4.466-1.802-3.941 1.276 0.81 1.388 4.375-1.858 2.598 1.079-1.134 2.050-4.145 6.592-3.753 8.946 0.049 3.43-3.504 0.715-4.729-0.422-0.824-2.279-0.281-6.262-2.434-7.378-2.338-0.102-4.344-0.314-5.25-2.927-0.545-1.87 0.58-4.653 2.584-5.083 2.933-1.843 3.98 2.158 6.731 2.232 0.854-0.894 3.182-1.178 3.375-2.18-1.805-0.318 2.29-1.517-0.173-2.199-1.358 0.16-2.234 1.409-1.512 2.467-2.632 0.614-2.717-3.809-5.247-2.414-0.064 2.206-4.132 0.715-1.407 0.268 0.936-0.409-1.527-1.594-0.196-1.379 0.654-0.036 2.854-0.807 2.259-1.325 1.225-0.761 2.255 1.822 3.454-0.059 0.866-1.446-0.363-1.713-1.448-0.98-0.612-0.685 1.080-2.165 2.573-2.804 0.497-0.213 0.973-0.329 1.336-0.296 0.752 0.868 2.142 1.019 2.215-0.104-1.862-0.892-3.915-1.363-6.040-1.363-3.051 0-5.952 0.969-8.353 2.762 0.645 0.296 1.012 0.664 0.39 1.134-0.483 1.439-2.443 3.371-4.163 3.098-0.893 1.54-1.482 3.238-1.733 5.017 1.441 0.477 1.773 1.42 1.464 1.736-0.734 0.64-1.185 1.548-1.418 2.541 0.469 2.87 1.818 5.515 3.915 7.612 2.644 2.644 6.16 4.1 9.899 4.1s7.255-1.456 9.899-4.1z"></path>',eye:'<path d="M16 4c-8.836 0-16 11.844-16 11.844s7.164 12.156 16 12.156 16-12.156 16-12.156-7.164-11.844-16-11.844zM16 24c-4.418 0-8-3.582-8-8s3.582-8 8-8 8 3.582 8 8-3.582 8-8 8zM12 16c0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.209-1.791 4-4 4-2.209 0-4-1.791-4-4z"></path>',facebook:'<path d="M17.996 32h-5.996v-16h-4v-5.514l4-0.002-0.007-3.248c0-4.498 1.22-7.236 6.519-7.236h4.412v5.515h-2.757c-2.064 0-2.163 0.771-2.163 2.209l-0.008 2.76h4.959l-0.584 5.514-4.37 0.002-0.004 16z"></path>',fork:'<path d="M20 0v3.875c0 1.602-0.625 3.109-1.754 4.238l-11.316 11.254c-1.789 1.785-2.774 4.129-2.883 6.633h-4.047l6 6 6-6h-3.957c0.105-1.438 0.684-2.773 1.711-3.805l11.316-11.25c1.891-1.89 2.93-4.398 2.93-7.070v-3.875h-4zM23.953 26c-0.109-2.504-1.098-4.848-2.887-6.641l-2.23-2.215-2.836 2.821 2.242 2.23c1.031 1.027 1.609 2.367 1.715 3.805h-3.957l6 6 6-6h-4.047z"></path>',globe:'<path d="M15 2c-8.284 0-15 6.716-15 15s6.716 15 15 15c8.284 0 15-6.716 15-15s-6.716-15-15-15zM23.487 22c0.268-1.264 0.437-2.606 0.492-4h3.983c-0.104 1.381-0.426 2.722-0.959 4h-3.516zM6.513 12c-0.268 1.264-0.437 2.606-0.492 4h-3.983c0.104-1.381 0.426-2.722 0.959-4h3.516zM21.439 12c0.3 1.28 0.481 2.62 0.54 4h-5.979v-4h5.439zM16 10v-5.854c0.456 0.133 0.908 0.355 1.351 0.668 0.831 0.586 1.625 1.488 2.298 2.609 0.465 0.775 0.867 1.638 1.203 2.578h-4.852zM10.351 7.422c0.673-1.121 1.467-2.023 2.298-2.609 0.443-0.313 0.895-0.535 1.351-0.668v5.854h-4.852c0.336-0.94 0.738-1.803 1.203-2.578zM14 12v4h-5.979c0.059-1.38 0.24-2.72 0.54-4h5.439zM2.997 22c-0.533-1.278-0.854-2.619-0.959-4h3.983c0.055 1.394 0.224 2.736 0.492 4h-3.516zM8.021 18h5.979v4h-5.439c-0.3-1.28-0.481-2.62-0.54-4zM14 24v5.854c-0.456-0.133-0.908-0.355-1.351-0.668-0.831-0.586-1.625-1.488-2.298-2.609-0.465-0.775-0.867-1.638-1.203-2.578h4.852zM19.649 26.578c-0.673 1.121-1.467 2.023-2.298 2.609-0.443 0.312-0.895 0.535-1.351 0.668v-5.854h4.852c-0.336 0.94-0.738 1.802-1.203 2.578zM16 22v-4h5.979c-0.059 1.38-0.24 2.72-0.54 4h-5.439zM23.98 16c-0.055-1.394-0.224-2.736-0.492-4h3.516c0.533 1.278 0.855 2.619 0.959 4h-3.983zM25.958 10h-2.997c-0.582-1.836-1.387-3.447-2.354-4.732 1.329 0.636 2.533 1.488 3.585 2.54 0.671 0.671 1.261 1.404 1.766 2.192zM5.808 7.808c1.052-1.052 2.256-1.904 3.585-2.54-0.967 1.285-1.771 2.896-2.354 4.732h-2.997c0.504-0.788 1.094-1.521 1.766-2.192zM4.042 24h2.997c0.583 1.836 1.387 3.447 2.354 4.732-1.329-0.636-2.533-1.488-3.585-2.54-0.671-0.671-1.261-1.404-1.766-2.192zM24.192 26.192c-1.052 1.052-2.256 1.904-3.585 2.54 0.967-1.285 1.771-2.896 2.354-4.732h2.997c-0.504 0.788-1.094 1.521-1.766 2.192z"></path>',happy:'<path d="M16 32c8.837 0 16-7.163 16-16s-7.163-16-16-16-16 7.163-16 16 7.163 16 16 16zM16 3c7.18 0 13 5.82 13 13s-5.82 13-13 13-13-5.82-13-13 5.82-13 13-13zM16 18.711c3.623 0 7.070-0.963 10-2.654-0.455 5.576-4.785 9.942-10 9.942-5.215 0-9.544-4.371-10-9.947 2.93 1.691 6.377 2.658 10 2.658zM8 11c0-1.657 0.895-3 2-3s2 1.343 2 3c0 1.657-0.895 3-2 3-1.105 0-2-1.343-2-3zM20 11c0-1.657 0.895-3 2-3s2 1.343 2 3c0 1.657-0.895 3-2 3-1.105 0-2-1.343-2-3z"></path>',"heart-fill":'<path d="M16 5.844c-1.613-2.266-4.129-3.844-7.113-3.844-4.903 0-8.887 3.992-8.887 8.891v0.734l16.008 18.375 15.992-18.375v-0.734c0-4.899-3.984-8.891-8.887-8.891-2.984 0-5.5 1.578-7.113 3.844z"></path>',"heart-stroke":'<path d="M23.113 6c2.457 0 4.492 1.82 4.836 4.188l-11.945 13.718-11.953-13.718c0.344-2.368 2.379-4.188 4.836-4.188 2.016 0 3.855 2.164 3.855 2.164l3.258 3.461 3.258-3.461c0 0 1.84-2.164 3.855-2.164zM23.113 2c-2.984 0-5.5 1.578-7.113 3.844-1.613-2.266-4.129-3.844-7.113-3.844-4.903 0-8.887 3.992-8.887 8.891v0.734l16.008 18.375 15.992-18.375v-0.734c0-4.899-3.984-8.891-8.887-8.891v0z"></path>',home:'<path d="M16 0l-16 16h4v16h24v-16h4l-16-16zM24 28h-6v-6h-4v6h-6v-14.344l8-5.656 8 5.656v14.344z"></path>',iphone:'<path d="M16 0h-8c-4.418 0-8 3.582-8 8v16c0 4.418 3.582 8 8 8h8c4.418 0 8-3.582 8-8v-16c0-4.418-3.582-8-8-8zM12 30.062c-1.139 0-2.062-0.922-2.062-2.062s0.924-2.062 2.062-2.062 2.062 0.922 2.062 2.062-0.923 2.062-2.062 2.062zM20 24h-16v-16c0-2.203 1.795-4 4-4h8c2.203 0 4 1.797 4 4v16z"></path>',lock:'<path d="M14 0c-5.508 0-9.996 4.484-9.996 10v2h-4.004v14c0 3.309 2.691 6 6 6h12c3.309 0 6-2.691 6-6v-16c0-5.516-4.488-10-10-10zM11.996 24c-1.101 0-1.996-0.895-1.996-2s0.895-2 1.996-2c1.105 0 2 0.895 2 2s-0.894 2-2 2zM20 12h-11.996v-2c0-3.309 2.691-6 5.996-6 3.309 0 6 2.691 6 6v2z"></path>',mail:'<path d="M15.996 15.457l16.004-7.539v-3.918h-32v3.906zM16.004 19.879l-16.004-7.559v15.68h32v-15.656z"></path>',"minus-circle":'<path d="M16 0c-8.836 0-16 7.164-16 16s7.164 16 16 16 16-7.164 16-16-7.164-16-16-16zM24 18h-16v-4h16v4z"></path>',moon:'<path d="M24.633 22.184c-8.188 0-14.82-6.637-14.82-14.82 0-2.695 0.773-5.188 2.031-7.363-6.824 1.968-11.844 8.187-11.844 15.644 0 9.031 7.32 16.355 16.352 16.355 7.457 0 13.68-5.023 15.648-11.844-2.18 1.254-4.672 2.028-7.367 2.028z"></path>',paperclip:'<path d="M17.293 15.292l-2.829-2.829-4 4c-1.953 1.953-1.953 5.119 0 7.071 1.953 1.953 5.118 1.953 7.071 0l10.122-9.879c3.123-3.124 3.123-8.188 0-11.313-3.125-3.124-8.19-3.124-11.313 0l-11.121 10.88c-4.296 4.295-4.296 11.26 0 15.557 4.296 4.296 11.261 4.296 15.556 0l6-6-2.829-2.829-5.999 6c-2.733 2.732-7.166 2.732-9.9 0-2.733-2.732-2.733-7.166 0-9.899l11.121-10.881c1.562-1.562 4.095-1.562 5.656 0 1.563 1.563 1.563 4.097 0 5.657l-10.121 9.879c-0.391 0.391-1.023 0.391-1.414 0s-0.391-1.023 0-1.414l4-4z"></path>',pin:'<path d="M17.070 2.93c-3.906-3.906-10.234-3.906-14.141 0-3.906 3.904-3.906 10.238 0 14.14 0.001 0 7.071 6.93 7.071 14.93 0-8 7.070-14.93 7.070-14.93 3.907-3.902 3.907-10.236 0-14.14zM10 14c-2.211 0-4-1.789-4-4s1.789-4 4-4 4 1.789 4 4-1.789 4-4 4z"></path>',"plus-circle":'<path d="M16 0c-8.836 0-16 7.164-16 16s7.164 16 16 16 16-7.164 16-16-7.164-16-16-16zM24 18h-6v6h-4v-6h-6v-4h6v-6h4v6h6v4z"></path>',rain:'<path d="M23.998 6c-0.375 0-0.733 0.061-1.103 0.111-1.389-2.465-3.969-4.111-6.895-4.111-2.987 0-5.565 1.666-6.94 4.1-0.353-0.047-0.705-0.1-1.060-0.1-4.41 0-8 3.588-8 8s3.59 8 8 8h15.998c4.414 0 8-3.588 8-8s-3.586-8-8-8zM23.998 18h-15.998c-2.207 0-4-1.795-4-4 0-2.193 1.941-3.885 4.004-3.945 0.009 0.943 0.172 1.869 0.5 2.744l3.746-1.402c-0.168-0.444-0.25-0.915-0.25-1.397 0-2.205 1.793-4 4-4 1.293 0 2.465 0.641 3.199 1.639-1.928 1.461-3.199 3.756-3.199 6.361h4c0-2.205 1.795-4 3.998-4 2.211 0 4 1.795 4 4s-1.789 4-4 4zM3.281 29.438c-0.75 0.75-1.969 0.75-2.719 0s-0.75-1.969 0-2.719 5.438-2.719 5.438-2.719-1.969 4.688-2.719 5.438zM11.285 29.438c-0.75 0.75-1.965 0.75-2.719 0-0.75-0.75-0.75-1.969 0-2.719 0.754-0.75 5.438-2.719 5.438-2.719s-1.965 4.688-2.719 5.438zM19.28 29.438c-0.75 0.75-1.969 0.75-2.719 0s-0.75-1.969 0-2.719 5.437-2.719 5.437-2.719-1.968 4.688-2.718 5.438z"></path>',
ribbon:'<path d="M8 20c-1.41 0-2.742-0.289-4-0.736v12.736l4-4 4 4v-12.736c-1.258 0.447-2.59 0.736-4 0.736zM0 8c0-4.418 3.582-8 8-8s8 3.582 8 8c0 4.418-3.582 8-8 8-4.418 0-8-3.582-8-8z"></path>',sad:'<path d="M16 32c8.837 0 16-7.163 16-16s-7.163-16-16-16-16 7.163-16 16 7.163 16 16 16zM16 3c7.18 0 13 5.82 13 13s-5.82 13-13 13-13-5.82-13-13 5.82-13 13-13zM8 10c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2zM20 10c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2zM9.997 24.398l-2.573-1.544c1.749-2.908 4.935-4.855 8.576-4.855 3.641 0 6.827 1.946 8.576 4.855l-2.573 1.544c-1.224-2.036-3.454-3.398-6.003-3.398-2.549 0-4.779 1.362-6.003 3.398z"></path>',smiley:'<path d="M16 32c8.837 0 16-7.163 16-16s-7.163-16-16-16-16 7.163-16 16 7.163 16 16 16zM16 3c7.18 0 13 5.82 13 13s-5.82 13-13 13-13-5.82-13-13 5.82-13 13-13zM8 10c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2zM20 10c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2zM22.003 19.602l2.573 1.544c-1.749 2.908-4.935 4.855-8.576 4.855s-6.827-1.946-8.576-4.855l2.573-1.544c1.224 2.036 3.454 3.398 6.003 3.398s4.779-1.362 6.003-3.398z"></path>',star:'<path d="M22.137 19.625l9.863-7.625h-12l-4-12-4 12h-12l9.875 7.594-3.875 12.406 10.016-7.68 9.992 7.68z"></path>',sun:'<path d="M16.001 8c-4.418 0-8 3.582-8 8s3.582 8 8 8c4.418 0 7.999-3.582 7.999-8s-3.581-8-7.999-8v0zM14 2c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2zM4 6c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2zM2 14c1.105 0 2 0.895 2 2 0 1.107-0.895 2-2 2s-2-0.893-2-2c0-1.105 0.895-2 2-2zM4 26c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2zM14 30c0-1.109 0.895-2 2-2 1.108 0 2 0.891 2 2 0 1.102-0.892 2-2 2-1.105 0-2-0.898-2-2zM24 26c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2zM30 18c-1.104 0-2-0.896-2-2 0-1.107 0.896-2 2-2s2 0.893 2 2c0 1.104-0.896 2-2 2zM24 6c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2z"></path>',"thin-arrow-down":'<path d="M4.586 19.414l10 10c0.781 0.781 2.047 0.781 2.828 0l10-10c0.781-0.781 0.781-2.047 0-2.828s-2.047-0.781-2.828 0l-6.586 6.586v-19.172c0-1.105-0.895-2-2-2s-2 0.895-2 2v19.172l-6.586-6.586c-0.391-0.39-0.902-0.586-1.414-0.586s-1.024 0.195-1.414 0.586c-0.781 0.781-0.781 2.047 0 2.828z"></path>',"thin-arrow-down-left":'<path d="M18 28c1.105 0 2-0.895 2-2s-0.895-2-2-2h-7.172l16.586-16.586c0.781-0.781 0.781-2.047 0-2.828-0.391-0.391-0.902-0.586-1.414-0.586s-1.024 0.195-1.414 0.586l-16.586 16.586v-7.172c0-1.105-0.895-2-2-2s-2 0.895-2 2v14h14z"></path>',"thin-arrow-down-right":'<path d="M28 14c0-1.105-0.895-2-2-2s-2 0.895-2 2v7.172l-16.586-16.586c-0.781-0.781-2.047-0.781-2.828 0-0.391 0.391-0.586 0.902-0.586 1.414s0.195 1.024 0.586 1.414l16.586 16.586h-7.172c-1.105 0-2 0.895-2 2s0.895 2 2 2h14v-14z"></path>',"thin-arrow-left":'<path d="M12.586 4.586l-10 10c-0.781 0.781-0.781 2.047 0 2.828l10 10c0.781 0.781 2.047 0.781 2.828 0s0.781-2.047 0-2.828l-6.586-6.586h19.172c1.105 0 2-0.895 2-2s-0.895-2-2-2h-19.172l6.586-6.586c0.39-0.391 0.586-0.902 0.586-1.414s-0.195-1.024-0.586-1.414c-0.781-0.781-2.047-0.781-2.828 0z"></path>',"thin-arrow-right":'<path d="M19.414 27.414l10-10c0.781-0.781 0.781-2.047 0-2.828l-10-10c-0.781-0.781-2.047-0.781-2.828 0s-0.781 2.047 0 2.828l6.586 6.586h-19.172c-1.105 0-2 0.895-2 2s0.895 2 2 2h19.172l-6.586 6.586c-0.39 0.39-0.586 0.902-0.586 1.414s0.195 1.024 0.586 1.414c0.781 0.781 2.047 0.781 2.828 0z"></path>',"thin-arrow-up":'<path d="M27.414 12.586l-10-10c-0.781-0.781-2.047-0.781-2.828 0l-10 10c-0.781 0.781-0.781 2.047 0 2.828s2.047 0.781 2.828 0l6.586-6.586v19.172c0 1.105 0.895 2 2 2s2-0.895 2-2v-19.172l6.586 6.586c0.39 0.39 0.902 0.586 1.414 0.586s1.024-0.195 1.414-0.586c0.781-0.781 0.781-2.047 0-2.828z"></path>',"thin-arrow-up-left":'<path d="M4 18c0 1.105 0.895 2 2 2s2-0.895 2-2v-7.172l16.586 16.586c0.781 0.781 2.047 0.781 2.828 0 0.391-0.391 0.586-0.902 0.586-1.414s-0.195-1.024-0.586-1.414l-16.586-16.586h7.172c1.105 0 2-0.895 2-2s-0.895-2-2-2h-14v14z"></path>',"thin-arrow-up-right":'<path d="M26.001 4c-0 0-0.001 0-0.001 0h-11.999c-1.105 0-2 0.895-2 2s0.895 2 2 2h7.172l-16.586 16.586c-0.781 0.781-0.781 2.047 0 2.828 0.391 0.391 0.902 0.586 1.414 0.586s1.024-0.195 1.414-0.586l16.586-16.586v7.172c0 1.105 0.895 2 2 2s2-0.895 2-2v-14h-1.999z"></path>',twitter:'<path d="M32 6.076c-1.177 0.522-2.443 0.875-3.771 1.034 1.355-0.813 2.396-2.099 2.887-3.632-1.269 0.752-2.674 1.299-4.169 1.593-1.198-1.276-2.904-2.073-4.792-2.073-3.626 0-6.565 2.939-6.565 6.565 0 0.515 0.058 1.016 0.17 1.496-5.456-0.274-10.294-2.888-13.532-6.86-0.565 0.97-0.889 2.097-0.889 3.301 0 2.278 1.159 4.287 2.921 5.465-1.076-0.034-2.088-0.329-2.974-0.821-0.001 0.027-0.001 0.055-0.001 0.083 0 3.181 2.263 5.834 5.266 6.437-0.551 0.15-1.131 0.23-1.73 0.23-0.423 0-0.834-0.041-1.235-0.118 0.835 2.608 3.26 4.506 6.133 4.559-2.247 1.761-5.078 2.81-8.154 2.81-0.53 0-1.052-0.031-1.566-0.092 2.905 1.863 6.356 2.95 10.064 2.95 12.076 0 18.679-10.004 18.679-18.68 0-0.285-0.006-0.568-0.019-0.849 1.283-0.926 2.396-2.082 3.276-3.398z"></path>',umbrella:'<path d="M16 0c-8.82 0-16 7.178-16 16h4c0-0.826 0.676-1.5 1.5-1.5 0.828 0 1.5 0.674 1.5 1.5h4c0-0.826 0.676-1.5 1.5-1.5 0.828 0 1.5 0.674 1.5 1.5v10c0 1.102-0.895 2-2 2-1.102 0-2-0.898-2-2h-4c0 3.309 2.695 6 6 6 3.312 0 6-2.691 6-6v-10c0-0.826 0.676-1.5 1.5-1.5 0.828 0 1.498 0.674 1.498 1.5h4c0-0.826 0.68-1.5 1.5-1.5 0.828 0 1.5 0.674 1.5 1.5h4c0-8.822-7.172-16-15.998-16z"></path>',unlock:'<path d="M14.004 0c-5.516 0-9.996 4.484-9.996 10h3.996c0-3.309 2.688-6 6-6 3.305 0 5.996 2.691 5.996 6v2h-20v14c0 3.309 2.695 6 6 6h12c3.305 0 6-2.691 6-6v-16c0-5.516-4.488-10-9.996-10zM12 24c-1.102 0-2-0.895-2-2s0.898-2 2-2c1.109 0 2 0.895 2 2s-0.891 2-2 2z"></path>',user:'<path d="M12 16c-6.625 0-12 5.375-12 12 0 2.211 1.789 4 4 4h16c2.211 0 4-1.789 4-4 0-6.625-5.375-12-12-12zM6 6c0-3.314 2.686-6 6-6s6 2.686 6 6c0 3.314-2.686 6-6 6-3.314 0-6-2.686-6-6z"></path>',wondering:'<path d="M16 32c8.837 0 16-7.163 16-16s-7.163-16-16-16-16 7.163-16 16 7.163 16 16 16zM16 3c7.18 0 13 5.82 13 13s-5.82 13-13 13-13-5.82-13-13 5.82-13 13-13zM23.304 18.801l0.703 2.399-13.656 4-0.703-2.399zM8 10c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2zM20 10c0-1.105 0.895-2 2-2s2 0.895 2 2c0 1.105-0.895 2-2 2-1.105 0-2-0.895-2-2z"></path>',"x-circle":'<path d="M16 0c-8.836 0-16 7.164-16 16s7.164 16 16 16 16-7.164 16-16-7.164-16-16-16zM23.914 21.086l-2.828 2.828-5.086-5.086-5.086 5.086-2.828-2.828 5.086-5.086-5.086-5.086 2.828-2.828 5.086 5.086 5.086-5.086 2.828 2.828-5.086 5.086 5.086 5.086z"></path>',android:'<path d="M50.143,45.057h-0.241c-2.13,0-3.857-1.735-3.857-3.875V24.713 c0-2.14,1.727-3.875,3.857-3.875h0.241c2.13,0,3.857,1.735,3.857,3.875v16.469C54,43.323,52.273,45.057,50.143,45.057z M39.777,51.112h-2.169v8.961c0,2.14-1.727,3.875-3.857,3.875h-0.241c-2.13,0-3.857-1.735-3.857-3.875v-8.961h-5.304v8.961 c0,2.14-1.727,3.875-3.857,3.875H20.25c-2.13,0-3.857-1.735-3.857-3.875v-8.961h-2.17c-2.663,0-4.821-2.169-4.821-4.844V21.565 h35.196v24.704C44.598,48.944,42.44,51.112,39.777,51.112z M18.451,5.498l-2.777-4.832c-0.1-0.174-0.041-0.396,0.132-0.496 l0.209-0.121c0.173-0.1,0.394-0.041,0.494,0.133l2.802,4.877c2.297-1.091,4.863-1.705,7.573-1.705c2.856,0,5.552,0.681,7.941,1.885 l2.906-5.056c0.1-0.174,0.321-0.233,0.494-0.133l0.209,0.121c0.173,0.1,0.232,0.322,0.132,0.496l-2.889,5.028 c4.989,2.866,8.459,8.094,8.901,14.169H9.191C9.643,13.645,13.271,8.316,18.451,5.498z M35.076,13.572 c0.865,0,1.567-0.705,1.567-1.574c0-0.87-0.702-1.574-1.567-1.574c-0.865,0-1.567,0.705-1.567,1.574 C33.509,12.867,34.21,13.572,35.076,13.572z M18.924,13.572c0.865,0,1.567-0.705,1.567-1.574c0-0.87-0.702-1.574-1.567-1.574 c-0.865,0-1.567,0.705-1.567,1.574C17.357,12.867,18.059,13.572,18.924,13.572z M4.098,45.057H3.857C1.727,45.057,0,43.323,0,41.182 V24.713c0-2.14,1.727-3.875,3.857-3.875h0.241c2.13,0,3.857,1.735,3.857,3.875v16.469C7.955,43.323,6.228,45.057,4.098,45.057z"/>',apple:'<path d="M43.061,34.522c0,8.67,8.393,12.374,8.393,12.374 c-2.057,8.63-9.252,15.172-9.252,15.172c-1.613,1.607-4.567,1.852-4.567,1.852c-2.377,0-5.309-1.34-5.309-1.34 c-2.259-1.299-5.426-1.301-5.426-1.301c-2.792,0-5.309,1.261-5.309,1.261C19.334,63.835,16.399,64,16.399,64 c-2.568,0-3.982-1.498-3.982-1.498C-0.546,50.658,0.003,35.271,0.003,35.271c0-19.645,15.576-19.586,15.576-19.586 c3.626,0,4.919,0.827,4.919,0.827c3.866,1.882,5.777,1.892,5.777,1.892c1.5,0,5.816-1.931,5.816-1.931 c2.223-1.052,5.778-1.064,5.778-1.064c8.325,0,11.984,6.424,11.984,6.424C42.702,26.182,43.061,34.522,43.061,34.522z M25.729,14.818C25.729,1.075,38.377,0,38.377,0C38.377,14.797,25.729,14.818,25.729,14.818z"/>',baidu:'<path d="M57.549,28.923c-0.219,7.717-6.714,8.677-6.714,8.677 c-8.176-0.648-7.673-8.677-7.673-8.677c-0.795-8.379,5.755-9.641,5.755-9.641C58,19.412,57.549,28.923,57.549,28.923z M37.407,20.246c-5.931,0-5.755-8.677-5.755-8.677c1.708-7.93,7.673-9.641,7.673-9.641c5.472,0.78,6.714,8.677,6.714,8.677 C44.174,21.255,37.407,20.246,37.407,20.246z M37.407,32.779c2.75,3.707,7.673,8.677,7.673,8.677 c7.267,4.21,7.673,10.605,7.673,10.605c0,13.939-14.387,10.605-14.387,10.605c-1.873-0.813-7.673-1.928-7.673-1.928h-4.796 c-2.325,0.456-10.551,1.928-10.551,1.928c-10.734,0-11.51-10.605-11.51-10.605c0-6.349,4.796-9.641,4.796-9.641 c6.151-4.696,9.592-9.641,9.592-9.641c5.137-7.284,9.591-6.749,9.591-6.749C33.569,25.744,37.407,32.779,37.407,32.779z M25.897,35.672H23.02v5.785h-6.714c-5.859,0.902-5.755,8.677-5.755,8.677c-0.551,5.375,5.755,7.713,5.755,7.713h9.591V35.672z M32.611,53.025V41.456h-4.796v12.533c-0.017,2.653,3.837,3.856,3.837,3.856h10.551v-16.39h-4.796v12.533h-2.877 C33.473,53.886,32.611,53.025,32.611,53.025z M17.265,46.277h5.755v7.713h-4.796c0,0-2.647-0.459-2.877-3.856 C15.346,50.133,15.452,46.899,17.265,46.277z M21.101,20.246c-6.799,0-6.714-10.605-6.714-10.605c0-9.31,6.714-9.641,6.714-9.641 c5.997,0,6.714,9.641,6.714,9.641C27.815,19.489,21.101,20.246,21.101,20.246z M6.714,33.743C0.544,33.743,0,24.102,0,24.102 c0-8.281,6.714-9.641,6.714-9.641c6.751,0,7.673,9.641,7.673,9.641C14.387,32.77,6.714,33.743,6.714,33.743z"/>',douban:'<path d="M0,64v-5.818h20.945c0,0-4.899-9.901-8.145-11.636l8.145-3.491 c0,0,5.56,12.555,5.818,15.127h13.964c0,0,5.825-11.048,5.818-15.127l6.982,3.491c0,0-3.36,10.254-5.295,11.512 c-0.447,0.029-0.656,0.069-0.523,0.124c0.157,0.065,0.336-0.002,0.523-0.124C51.09,57.875,64,58.182,64,58.182V64H0z M5.818,40.727 v-25.6h52.364v25.6H5.818z M48.873,20.945H15.127v13.964h33.745V20.945z M3.491,0H64v5.818H3.491V0z"/>',googleplay:'<path d="M55.532,34.556c-0.828,0.473-5.547,3.122-11.786,6.618 l-8.591-8.715l9.908-9.829c5.385,3.012,9.44,5.281,10.469,5.858C58,29.871,57.958,33.17,55.532,34.556z M3.177,0.02 c0.741-0.078,1.548,0.064,2.355,0.511c1.54,0.853,23.514,13.139,37.89,21.18l-9.536,9.46L3.177,0.02z M1.36,0.75l31.244,31.694 L2.074,62.731C0.89,62.224,0,61.115,0,59.574C0,56.662,0,5.559,0,3.55C0,2.412,0.532,1.401,1.36,0.75z M42.112,42.089 C27.972,50.01,7.556,61.427,5.419,62.575c-0.32,0.172-0.655,0.291-0.993,0.367l29.446-29.212L42.112,42.089z"/>',kaixinwang:'<path d="M60.549,30.164c0,0-3.494,8.614-16.984,12.25c0,0-0.502,11.237,0,15.076c0,0,1.59,4.938-4.718,3.769c0,0-6.539-0.588-13.21-9.423c0,0-2.071-1.431-2.831,0c0,0-5.588,5.249-9.436,7.538c0,0-7.049,0.734-7.549-3.769c0,0-2.985-13.205,0.944-21.672c0,0-0.269-2.116-0.944-2.827c0,0-8.864-10.313-4.718-22.615c0,0,1.108-1.884,5.661-0.942c0,0,7.295,4.273,8.492,4.711c0,0,3.262,0.609,3.774-0.942c0,0,7.578-9.802,14.153-11.307c0,0,7.228-0.583,7.549,6.596c0,0,2.168,10.163,1.887,13.192c0,0,1.659,4.159,4.718,3.769c0,0,9.924-0.088,12.266,1.885C59.605,25.453,61.958,26.999,60.549,30.164z M13.371,27.337c0.013-2.519-1.887-2.827-1.887-2.827c-3.341,0-2.831,1.884-2.831,1.884c-0.146,2.405,2.831,2.827,2.831,2.827C13.764,28.831,13.371,27.337,13.371,27.337zM14.314,32.991c-1.477,8.602,6.605,11.307,6.605,11.307c6.04,0.515,11.323-4.711,11.323-4.711c-7.647,2.452-11.323,0.942-11.323,0.942C14.869,38.902,14.314,32.991,14.314,32.991z M36.016,18.857c0,0-3.136-1.152-5.661,0.942c0,0-0.944,0.585-0.944-0.942c0,0-3.121-5.667-7.549-1.885c0,0-6.72,5.505-2.831,13.192c0,0,1.414,3.005,6.605,0.942c0,0,0.403,2.079,1.887,3.769c0,0,4.505,3.149,7.549-3.769C35.073,31.107,38.588,24.505,36.016,18.857z M41.678,33.933c0,0-3.622-0.382-3.774,2.827c0,0-0.038,2.695,2.831,2.827c0,0,2.968-0.587,2.831-2.827C43.565,36.76,43.968,33.933,41.678,33.933zM33.186,28.28c-2.024-0.756-1.887-3.769-1.887-3.769c0.251-1.965,2.831-2.827,2.831-2.827c2.763,0.114,0.944,3.769,0.944,3.769C34.54,29.362,33.186,28.28,33.186,28.28z M23.75,25.453c-2.17-0.976,0-4.711,0-4.711c1.118-2.725,2.831-1.885,2.831-1.885c2.222,0.41,0.944,3.769,0.944,3.769C27.212,24.78,23.75,25.453,23.75,25.453z"/>',laiwang:'<path d="M58.659,31.066V36.4h-5.618v-3.138h2.809v-4.707c3.787-6.594,2.185-13.179,2.185-13.179c-4.56-14.795-19.35-10.669-19.35-10.669c-0.413-0.661-4.057-2.51-4.057-2.51C38.404,0.023,43.679,0,43.679,0C59.986,1.348,61.78,14.748,61.78,14.748C64,25.266,58.659,31.066,58.659,31.066z M52.56,29.556c0,6.135-2.082,11.777-5.565,16.263v6.759h-7.79C35.388,54.753,30.98,56,26.28,56C11.766,56,0,44.16,0,29.556C0,14.951,11.766,3.111,26.28,3.111C40.794,3.111,52.56,14.951,52.56,29.556z M26.28,8.4c-11.611,0-21.024,9.472-21.024,21.156c0,11.684,9.413,21.156,21.024,21.156c3.336,0,6.489-0.786,9.291-2.178h7.405v-6.135c2.711-3.562,4.328-8.01,4.328-12.843C47.304,17.872,37.891,8.4,26.28,8.4z M37.411,32.667c-1.708,0-3.092-1.393-3.092-3.111c0-1.718,1.384-3.111,3.092-3.111c1.708,0,3.092,1.393,3.092,3.111C40.502,31.274,39.118,32.667,37.411,32.667z M26.28,32.667c-1.708,0-3.092-1.393-3.092-3.111c0-1.718,1.384-3.111,3.092-3.111c1.708,0,3.092,1.393,3.092,3.111C29.372,31.274,27.988,32.667,26.28,32.667z M15.15,32.667c-1.708,0-3.092-1.393-3.092-3.111c0-1.718,1.384-3.111,3.092-3.111c1.707,0,3.092,1.393,3.092,3.111C18.242,31.274,16.857,32.667,15.15,32.667z"/>',computer:'<path d="M61,44H38.676l6.199,8.769c0,0,1.125,1.64,0,3.231h-9.289h-6.697h-9.733c-1.156-1.591,0-3.231,0-3.231L25.527,44H3c-1.657,0-3-1.343-3-3V3c0-1.657,1.343-3,3-3h58c1.657,0,3,1.343,3,3v38C64,42.657,62.657,44,61,44z M32,42c1.105,0,2-0.895,2-2s-0.895-2-2-2c-1.105,0-2,0.895-2,2S30.895,42,32,42z M60,5H4v31h56V5z"/>',dengpao:'<path d="M40,44.969V52c0,3.314-2.686,6-6,6h-1v3.5c0,1.381-1.119,2.5-2.5,2.5h-11c-1.381,0-2.5-1.119-2.5-2.5V58h-1c-3.314,0-6-2.686-6-6v-7.041C3.936,40.403,0,33.171,0,25C0,11.193,11.193,0,25,0s25,11.193,25,25C50,33.173,46.068,40.413,40,44.969z M25,7C15.059,7,7,15.059,7,25c0,0.585,0.033,1.162,0.088,1.733c0.02,0.206,0.056,0.407,0.082,0.611c0.047,0.357,0.095,0.714,0.162,1.064c0.048,0.251,0.11,0.496,0.168,0.743c0.069,0.29,0.139,0.58,0.222,0.864c0.079,0.273,0.168,0.542,0.26,0.809c0.083,0.242,0.17,0.482,0.263,0.719c0.113,0.29,0.232,0.575,0.359,0.858c0.089,0.195,0.183,0.386,0.278,0.577c0.152,0.307,0.307,0.611,0.475,0.907c0.078,0.137,0.163,0.268,0.244,0.402c0.202,0.334,0.406,0.667,0.629,0.987c0.006,0.009,0.014,0.018,0.02,0.027c1.674,2.393,3.914,4.354,6.527,5.699C16.3,41.532,16,42.228,16,43v6c0,1.657,1.343,3,3,3h12c1.657,0,3-1.343,3-3v-6c0-0.772-0.3-1.468-0.778-2c2.998-1.544,5.497-3.904,7.222-6.788c0.062-0.103,0.127-0.203,0.186-0.306c0.177-0.31,0.34-0.629,0.499-0.951c0.09-0.181,0.179-0.361,0.262-0.545c0.13-0.286,0.251-0.577,0.366-0.871c0.093-0.236,0.179-0.474,0.261-0.715c0.091-0.267,0.18-0.535,0.259-0.808c0.084-0.287,0.154-0.578,0.224-0.871c0.058-0.245,0.119-0.487,0.167-0.736c0.068-0.353,0.117-0.712,0.164-1.072c0.026-0.202,0.062-0.401,0.081-0.605C42.967,26.163,43,25.586,43,25C43,15.059,34.941,7,25,7z M28.5,48h-7c-1.381,0-2.5-1.119-2.5-2.5v-1c0-1.381,1.119-2.5,2.5-2.5h7c1.381,0,2.5,1.119,2.5,2.5v1C31,46.881,29.881,48,28.5,48z"/>',normaluser:'<path d="M31.5,64C59.433,56.326,63,32.541,63,24.694C63,16.846,60.61,8.58,54.309,0C49.566,1.885,39.207,2.721,31.5,0C23.794,2.721,13.434,1.885,8.692,0C2.39,8.58,0,16.846,0,24.694C0,32.541,3.568,56.326,31.5,64z"/>',pad:'<path d="M49,64H3c-1.657,0-3-1.343-3-3V3c0-1.657,1.343-3,3-3h46c1.657,0,3,1.343,3,3v58C52,62.657,50.657,64,49,64z M26,62c1.657,0,3-1.343,3-3s-1.343-3-3-3s-3,1.343-3,3S24.343,62,26,62z M45,6H7v48h38V6z"/>',pengyou:'<path d="M52.671,41.29c0,0,3.271,9.101-5.532,11.011c0,0-7.661,1.98-11.065-11.011c0,0-3.688-10.606-3.688-12.846c0,0,11.041-2.228,18.442-1.835c0,0,11.116,0.842,11.065,9.175C61.892,35.785,62.397,43.503,52.671,41.29z M52.671,22.939c-5.253,0.729-21.208,3.67-21.208,3.67V7.34C31.264,1.286,39.762,0,39.762,0c7.386,0.19,6.455,7.34,6.455,7.34c10.325-4.012,11.065,7.34,11.065,7.34C57.501,18.724,52.671,22.939,52.671,22.939z M7.488,28.444c0,0-8.17-0.479-7.377-8.258c0,0-1.714-6.644,8.299-6.423c0,0-3.114-11.531,11.065-11.011c0,0,6.523-0.627,8.299,7.34c0,0,3.449,12.205,2.766,16.516C30.541,26.609,18.663,27.596,7.488,28.444z M31.463,28.444c-0.872,4.484,1.844,12.846,1.844,12.846c3.235,6.336,0.922,11.011,0.922,11.011c-2.931,8.699-11.987,7.34-11.987,7.34c-6.323-1.717-6.455-8.258-6.455-8.258c-5.134-0.13-7.377-1.835-7.377-1.835c-5.279-1.891-2.766-11.011-2.766-11.011C14.528,26.962,31.463,28.444,31.463,28.444z"/>',qq:'<path d="M173.94,152.517c0,0-7.239,0.531-15.89-15.949c0,0-7.897,20.246-13.904,24.921c0,0,15.89,5.883,15.89,17.943c0,0-2.979,19.937-36.746,19.937c0,0-22.406,0.632-30.787-13.956h-2.979v-0.309l-2.979,0.309C78.162,200,55.756,199.368,55.756,199.368c-33.767,0-36.746-19.937-36.746-19.937c0-12.06,15.89-17.943,15.89-17.943c-6.007-4.675-13.904-24.921-13.904-24.921c-8.651,16.48-15.89,15.949-15.89,15.949c-17.583-29.635,15.89-60.807,15.89-60.807c-5.712-18.322,5.959-26.915,5.959-26.915C29.54,0.66,89.523,0,89.523,0s59.983,0.66,62.568,64.795c0,0,11.671,8.593,5.959,26.915C158.05,91.709,191.523,122.882,173.94,152.517z"/>',qqliulanqi:'<path d="M64,55.332c0,4.57-3.122,8.311-7.081,8.642V64H31.793c-0.02,0-0.039-0.007-0.059-0.007C14.184,63.849,0,49.584,0,32C0,14.327,14.327,0,32,0s32,14.327,32,32c0,5.69-1.492,11.029-4.096,15.66C62.338,49.11,64,51.999,64,55.332z M32,14.222c-9.818,0-17.778,7.959-17.778,17.778c0,7.131,4.208,13.262,10.268,16.092c1.219-2.013,3.562-3.394,6.287-3.394c0.893,0,1.743,0.156,2.533,0.424c1.731-5.002,6.017-8.551,11.047-8.551c1.599,0,3.12,0.368,4.512,1.017c0.583-1.759,0.91-3.634,0.91-5.588C49.778,22.182,41.818,14.222,32,14.222z"/>',qqweibo:'<path d="M60.847,26.088c-8.08-2.418-13.422-13.494-13.422-13.494c-2.424,0-2.684-2.699-2.684-2.699c0-3.708,2.684-3.598,2.684-3.598c3.337,0,3.579,3.598,3.579,3.598c0.013,1.683-1.79,2.699-1.79,2.699c2.627,8.909,12.527,11.695,12.527,11.695C64,25.295,60.847,26.088,60.847,26.088z M54.583,16.192c0,0-1.339,0.621-0.895-0.9c0,0,1.906-1.828,1.79-5.398c0,0-0.266-8.096-8.053-8.096c0,0-7.158,0.059-7.158,8.096c0,0,0.001,8.096,7.158,8.096c0,0,1.785,1.974,0,1.799c0,0-8.948-0.952-8.948-9.895c0,0,0.135-9.895,9.843-9.895c0,0,8.948,1.557,8.948,9.895C57.267,9.895,56.836,14.713,54.583,16.192z M17.001,38.682h-3.579c0,0-2.586-0.992-0.895-2.699c0,0,17.896,2.971,17.896-14.393c0,0-0.252-13.494-13.422-13.494c0,0-14.317,1.116-14.317,14.393c0,0,0.037,4.655,1.79,6.297c0,0,0.568,3.071-1.79,0.9c0,0-2.521-3.105-2.684-7.197c0,0,1.061-17.092,17.001-17.092c0,0,16.107,0.699,16.107,16.193C33.108,21.59,32.527,38.682,17.001,38.682z M12.527,24.289c0,0-1.74-4.156,1.79-7.197c0,0,5.442-2.025,8.053,2.699c0,0,1.083,4.133-1.79,6.297c0,0-3.242,1.586-6.264,0c0,0-9.393,9.066-8.948,17.992c0.029,0.574,0,10.795,0,10.795S4.337,58,1.79,55.774V44.08C1.79,44.08,4.022,30.876,12.527,24.289z"/>',qqzone:'<path d="M49.096,31.429L51.726,55L32.438,43.651L13.151,55l1.753-22.698L0,19.206h21.918L32.438,0l11.397,19.206H64L49.096,31.429z M47.342,21.825H21.041l15.781,2.619L17.534,41.032h29.808L29.808,37.54L47.342,21.825z"/>',renren:'<path d="M26.667,0h12c0,0-5.9,40.406,25.333,51.726L58,63c0,0-20.229-14.581-24-29.179c0,0-12.018,22.795-27.333,28.516L0,54.379C0,54.379,31.489,46.61,26.667,0z"/>',sendcompany:'<path d="M56,37L32,13L8,37H0v-6L31,0h2l31,31v6H56z M53,38v26H39V43H25v21H11V38l21-21L53,38z"/>',scenegift:'<path d="M34.133,63.954V25.581H64v38.372H34.133z M0,12.791h14.821C8.033,11.603,8,4.996,8,4.996C8.056,0.071,13,0,13,0c9.28-0.03,15.986,11.202,16.888,12.791h4.237C35.125,11.201,42.504-0.046,51,0c0,0,5.046,0.083,5,4.996c0,0,0.061,6.606-6.823,7.794H64v8.527H0V12.791z M53,5.996c0.062-1.888-2-1.999-2-1.999c-8.038-0.049-13,8.993-13,8.993C50.389,13.03,53,5.996,53,5.996z M13,3.997c0,0-1.983,0.024-2,1.999s2.81,6.995,15,6.995C26,12.991,20.979,3.981,13,3.997z M29.867,63.954H0V25.581h29.867V63.954z"/>',scenesend:'<path d="M0,24.889L64,0L46.222,64L24.889,46.222l24.889-32l-32,24.889L0,24.889z M10.667,39.111l14.222,10.667L14.222,60.444L10.667,39.111z"/>',taobao:'<path d="M48.988,48.946c-4.903,0-7.901-1.579-7.901-1.579l0.79-3.947l7.111,0.789c6.122,0,6.321-5.526,6.321-5.526V14.21c0-7.378-7.901-7.895-7.901-7.895c-6.463,0-15.012,3.158-15.012,3.158l3.16,1.579c0.142,1.015-3.16,4.737-3.16,4.737h20.543v3.947H41.086v3.947h11.852v3.947H41.086v9.473l4.741-2.368l-0.79-3.947l4.741-1.579l3.951,10.263l-5.531,2.368l-1.58-3.947c-5.47,3.996-14.222,4.737-14.222,4.737h-7.111c-4.661,0-5.531-5.526-5.531-5.526v-7.105h7.111v3.158c-0.14,5.157,7.111,4.737,7.111,4.737V27.631H21.333v-3.947h12.642v-3.947h-5.531c-0.316,2.196-3.951,3.158-3.951,3.158s-2.819-0.519-3.16-1.579c2.749-1.888,6.321-9.473,6.321-9.473c-4.473,0.22-8.691,6.316-8.691,6.316l-4.741-3.947C19.296,12.449,22.914,0,22.914,0l7.111,1.579c0.106,1.229-1.58,4.737-1.58,4.737c11.708-3.875,23.704-3.158,23.704-3.158C63.475,4.407,64,15,64,15v21.315C64,49,48.988,48.946,48.988,48.946z M11.062,10.263c-5.479,0-5.531-4.737-5.531-4.737c0-5.404,5.531-4.737,5.531-4.737c5.138,0,5.531,4.737,5.531,4.737C16.593,10.074,11.062,10.263,11.062,10.263z M2.37,18.157l3.951-5.526c11.83,10.053,11.062,12.631,11.062,12.631c-0.264,5.059-9.482,22.105-9.482,22.105L0,41.841L11.852,29.21c1.392-1.303,0-3.947,0-3.947C11.562,22.982,2.37,18.157,2.37,18.157z"/>',tieba:'<path d="M64,28.804v33.072H36.267c0,0-0.933,0.052-1.067-2.134V32.005c0,0-1.165-3.201,5.333-3.201V1.067h6.4v4.267H64v6.401H46.933v17.069H64z M42.667,36.272v19.203h13.867V36.272H42.667z M14.933,55.475c0,0-4.911,5.24-12.8,6.401l-1.067-4.267c0,0,8.079-3.243,9.6-7.468V13.869c0,0,0.682-2.067,4.267-2.134c0,0,3.289,0.126,3.2,2.134V46.94c0,0,0.469,6.066,11.733,10.668L28.8,62.943C28.8,62.943,22.857,64,14.933,55.475z M23.467,9.601c0,0,0.113-3.437-8.533-3.201c0,0-8.533,0.099-8.533,3.201V46.94H0V0h29.867v46.94h-6.4V9.601z"/>',time:'<path d="M57.094,17.342L39.191,4.248c3.421-4.74,10.201-5.651,15.145-2.035C59.28,5.829,60.514,12.602,57.094,17.342z M56.896,34.986c0.016,15.224-12.23,27.578-27.352,27.594C14.421,62.597,2.149,50.268,2.133,35.044C2.117,19.821,14.363,7.466,29.485,7.45C44.608,7.434,56.88,19.762,56.896,34.986z M29.492,14.27c-10.206,0.011-18.663,7.491-20.294,17.297H8.966v6.895h0.231c1.633,9.824,10.118,17.308,20.339,17.297C39.742,55.75,48.2,48.269,49.83,38.463h0.232v-6.895h-0.23C48.199,21.743,39.713,14.26,29.492,14.27z M14.103,38.463v-6.895H26.09V16.915h6.849v14.653v6.895H26.09H14.103z M4.692,2.213c4.944-3.616,11.724-2.705,15.145,2.035L1.935,17.342C-1.486,12.602-0.251,5.829,4.692,2.213z"/>',uc:'<path d="M53.093,32.265c-7.527-5.77-19.034-7.054-19.034-7.054c5.833-1.908,12.021-7.054,12.021-7.054c-0.333-6.053,2.003-8.061,2.003-8.061c1.492,1.376,3.005,6.046,3.005,6.046C64,21.39,61.107,32.265,61.107,32.265H53.093z M26.046,26.219c0,0-16.028,6.346-16.028,20.153c0,0,0.893,11.278,8.172,13.661C12.446,58.893,0,55.07,0,43.35c0-15.233,13.134-18.434,14.025-27.207c0,0-1.021-8.061-7.012-8.061c0,0-4.643,0.683-6.01,2.015c0,0,5.962-10.617,18.032-10.077c0,0,12.937,0.063,14.025,11.084C33.058,11.104,34.791,19.555,26.046,26.219z M18.189,60.034c1.721,0.342,2.848,0.446,2.848,0.446C19.991,60.48,19.048,60.315,18.189,60.034z M16.028,48.388c0,0,0.948-8.061,8.014-8.061c0,0,9.016,0.132,9.016,8.061c0,0-0.119,9.069-8.014,9.069C25.044,57.457,16.028,58.129,16.028,48.388z M20.035,48.388c0,4.649,4.007,5.038,4.007,5.038c4.47,0,5.009-4.031,5.009-4.031c0-4.625-5.009-5.038-5.009-5.038C19.821,44.233,20.035,48.388,20.035,48.388z M37.065,48.388c0,0-0.189-12.092-11.019-12.092c0,0-4.6-1.381-11.019,3.023c0,0,3.518-7.19,12.021-7.054c0,0,15.761,0.647,16.028,17.13c0,0-0.817,6.053-3.005,7.054c0,0,7.737-1.618,10.018,4.031H28.049C28.049,60.48,36.582,59.201,37.065,48.388z M46.081,41.334c0,0-4.805-11.215-21.037-12.092c0,0,8.813-2.856,17.03,1.008l8.014,5.038c0,0,1.677,0.997,5.009,1.008c0,0,6.234,0.472,7.012,4.031c0,0-5.923-1.36-8.014,0C54.095,40.327,50.536,44.644,46.081,41.334z"/>',voice:'<path d="M38.246,32.653c0,9.68-7.396,17.645-16.902,18.686v8.482h8.451V64H8.667v-4.18h8.451v-8.482C7.612,50.298,0.216,42.333,0.216,32.653c0-1.815-0.485-2.548,0-4.209h4.111c-0.629,1.624,0.114,2.365,0.114,4.209c0,8.079,6.621,14.629,14.79,14.629S34.02,40.732,34.02,32.653c0-1.843,0.743-2.584,0.114-4.209h4.111C38.731,30.105,38.246,30.838,38.246,32.653z M19.231,42.667h-1.028c-5.393,0-9.764-4.321-9.764-9.651V9.651C8.438,4.321,12.81,0,18.203,0h1.028c5.393,0,9.764,4.321,9.764,9.651v23.365C28.995,38.346,24.623,42.667,19.231,42.667z"/>',wechat:'<path d="M171.484,138.214l6.938,21.872l-26.761-14.913c-72.415-0.249-66.407-49.709-66.407-49.709c0-28.146,34.69-40.761,34.69-40.761c75.009-16.33,78.301,42.749,78.301,42.749C198.245,125.746,171.484,138.214,171.484,138.214z M122.245,78.086c-4.418,0-8,3.582-8,8c0,4.418,3.582,8,8,8c4.418,0,8-3.582,8-8C130.245,81.667,126.663,78.086,122.245,78.086z M165.245,78.086c-4.418,0-8,3.582-8,8c0,4.418,3.582,8,8,8c4.418,0,8-3.582,8-8C173.245,81.667,169.663,78.086,165.245,78.086z M90.209,69.616c-17.464,24.322-4.956,47.72-4.956,47.72c-2.767,2.24-7.929,1.988-7.929,1.988H61.466l-36.673,16.901l8.92-25.849C-1.755,92.678,0.015,60.668,0.015,60.668v-2.982C6.983-1.914,70.386,0.024,70.386,0.024c30.227-0.665,46.584,12.924,46.584,12.924c19.951,11.217,24.779,32.808,24.779,32.808C107.066,46.955,90.209,69.616,90.209,69.616z M41.245,30.086c-6.075,0-11,4.925-11,11s4.925,11,11,11s11-4.925,11-11S47.32,30.086,41.245,30.086z M108.245,41.086c0-6.075-4.925-11-11-11c-6.075,0-11,4.925-11,11s4.925,11,11,11C103.32,52.086,108.245,47.161,108.245,41.086z"/>',weibo:'<path d="M199.389,65.394c0,0-0.493,9.988-10.011,9.988c0,0-10.252-1.807-7.007-11.985c0,0,11.965-41.924-36.038-47.942c0,0-17.018,5.194-17.018-6.991c0,0,1.506-7.99,8.008-7.99C137.322,0.473,204.096-9.8,199.389,65.394z M143.329,40.425c0,0-8.008,1.063-8.008-6.992c0,0,2.411-5.993,7.007-5.993c0,0,34.003-5.033,30.032,32.96c0,0-1.923,5.993-6.006,5.993c0,0-8.008,0.682-8.008-7.99C158.345,58.403,162.869,40.425,143.329,40.425z M133.318,45.419c0,0,17.018,0.911,17.018,16.979c0,0,0.245,9.102-4.004,12.984c0,0,29.031,6.811,29.031,28.965c0,0-0.251,56.931-91.097,56.931c0,0-84.09,0.922-84.09-52.936c0,0-4.081-25.111,27.029-54.933c31.109-29.822,48.801-30.962,57.061-30.962c0,0,16.017-0.976,16.017,15.98c0,0-0.412,11.219-3.003,14.982C97.28,53.409,116.344,45.419,133.318,45.419z M78.259,71.387c0,0-49.884,3.469-58.062,42.948c0,0-0.603,30.22,52.055,34.958c0,0,54.006,2.183,66.07-36.955C138.324,112.337,151.405,74.021,78.259,71.387z M73.12,142.2c-26.866-0.565-28.931-22.871-28.931-22.871c-1.094-30.22,32.921-32.815,32.921-32.815c31.985-0.314,30.926,25.854,30.926,25.854C106.16,142.199,73.12,142.2,73.12,142.2z M67.135,110.379c0,0-11.971,1.423-11.971,9.944c0,0-1.051,8.95,9.976,8.95c0,0,10.974-1.898,10.974-9.944C76.113,119.328,77.207,110.379,67.135,110.379z M83.097,106.401c0,0-3.99-0.664-3.99,2.983c0,0-0.929,2.983,2.993,2.983c0,0,3.99-0.785,3.99-3.978C86.089,108.39,85.751,106.401,83.097,106.401z"/>',windows:'<path d="M28.984,59.594V33.416H63V64L28.984,59.594z M28.984,4.406L63,0v30.584H28.984V4.406z M0,33.416h26.149v25.487L0,55.231V33.416z M0,8.769l26.149-3.672v25.487H0V8.769z"/>',yixin:'<path d="M45.364,58.38c4.124,2.52,10.259,2.797,10.259,2.797C44.551,65,36.341,63.943,30.867,61.901C13.807,61.829,0,48.002,0,30.952C0,13.858,13.879,0,31,0s31,13.858,31,30.952C62,42.869,55.251,53.207,45.364,58.38z M31,14.977c-8.837,0-16,7.153-16,15.975c0,5.364,2.656,10.098,6.718,12.996c-3.185,4.404-11.86,5.579-11.86,5.579c19.676,4.767,29.433-4.088,31.788-6.672C44.924,39.93,47,35.688,47,30.952C47,22.129,39.837,14.977,31,14.977z"/>',zhifubao:'<path d="M63.021,50L36.949,36.957c-10.737,11.987-22.813,10.87-22.813,10.87c-15.115,0-14.122-11.957-14.122-11.957C-0.088,22.841,15.222,25,15.222,25c8.559,0.109,18.468,3.261,18.468,3.261c3.55-4.164,4.345-9.783,4.345-9.783H10.877v-2.174h13.036V10.87H7.618V8.696h16.295V0h8.691v8.696h16.295v2.174H32.604v5.435h14.122c0.153,3.882-5.432,15.217-5.432,15.217l21.727,6.522V50z M14.136,28.261c0,0-11.95-2.295-11.95,7.609c0,0-1.54,7.609,10.863,7.609c0,0,11.464,0.271,17.381-9.783C30.431,33.696,23.002,28.261,14.136,28.261z"/>'}}(),function(e){"use strict";e.fn.swipeSlide=function(t,n){function i(e,t){e.css({"-webkit-transition":"all "+t+"s "+R.transitionType,transition:"all "+t+"s "+R.transitionType})}function r(e,t){R.axisX?e.css({"-webkit-transform":"translate3d("+t+"px,0,0)",transform:"translate3d("+t+"px,0,0)"}):e.css({"-webkit-transform":"translate3d(0,"+t+"px,0)",transform:"translate3d(0,"+t+"px,0)"})}function o(e){if(R.lazyLoad){var t=R.ul.find("[data-src]");if(t.length>0){var n=t.eq(e);n.data("src")&&(n.is("img")?n.attr("src",n.data("src")).data("src",""):n.css({"background-image":"url("+n.data("src")+")"}).data("src",""))}}}function a(e){e.touches||(e.touches=e.originalEvent.touches)}function s(e){v=e.touches[0].pageX,y=e.touches[0].pageY}function c(e){if(e.preventDefault(),R.autoSwipe&&f&&clearInterval(f),S=e.touches[0].pageX,x=e.touches[0].pageY,b=S-v,w=x-y,i(R.ul,0),R.axisX){if(!R.continuousScroll){if(0==m&&b>0)return b=0,g();if(m+1>=_&&0>b)return b=0,g()}r(R.ul,-(P*parseInt(m)-b))}else{if(!R.continuousScroll){if(0==m&&w>0)return w=0,g();if(m+1>=_&&0>w)return w=0,g()}r(R.ul,-(M*parseInt(m)-w))}}function l(){E=R.axisX?b:w,Math.abs(E)<=T?d(.3):E>T?h():-T>E&&p(),g(),b=0,w=0}function d(e){i(R.ul,e),R.axisX?r(R.ul,-m*P):r(R.ul,-m*M)}function u(){R.continuousScroll?m>=_?(d(.3),m=0,setTimeout(function(){d(0)},300)):0>m?(d(.3),m=_-1,setTimeout(function(){d(0)},300)):d(.3):(m>=_?m=0:0>m&&(m=_-1),d(.3)),n(m)}function p(){m++,u(),R.lazyLoad&&o(R.continuousScroll?m+2:m+1)}function h(){if(m--,u(),$&&R.lazyLoad){var e=_-1;for(e;_+1>=e;e++)o(e);return void($=!1)}!$&&R.lazyLoad&&o(m)}function g(){R.autoSwipe&&(f=setInterval(function(){p()},R.speed))}var f,m=0,v=0,y=0,b=0,w=0,E=0,S=0,x=0,T=50,C=0,$=!0,I=e(this),R=e.extend({},{ul:I.children("ul"),li:I.children().children("li"),continuousScroll:!1,autoSwipe:!0,speed:4e3,axisX:!0,transitionType:"ease",lazyLoad:!1,clone:!0,width:0,length:0},t||{}),P=R.width||R.li.width(),M=R.li.height(),_=R.length||R.li.length;n=n||function(){},function(){if(R.continuousScroll&&(R.clone&&R.ul.prepend(R.li.last().clone()).append(R.li.first().clone()),R.axisX?(r(R.ul.children().first(),-1*P),r(R.ul.children().last(),P*_)):(r(R.ul.children().first(),-1*M),r(R.ul.children().last(),M*_))),R.lazyLoad){var t=0;for(C=R.continuousScroll?3:2,t;C>t;t++)o(t)}R.axisX?R.li.each(function(t){r(e(this),P*t)}):R.li.each(function(t){r(e(this),M*t)}),g(),n(m,f),I.on("touchstart",function(e){e.stopPropagation(),a(e),s(e)}),I.on("touchmove",function(e){e.stopPropagation(),a(e),c(e)}),I.on("touchend",function(e){e.stopPropagation(),l()})}()}}(window.Zepto||window.jQuery);var THREE=THREE||{};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array),THREE.Color=function(e){return void 0!==e&&this.setHex(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSV:function(e,t,n){var i,r,o;if(0===n)this.r=this.g=this.b=0;else switch(i=Math.floor(6*e),r=6*e-i,e=n*(1-t),o=n*(1-t*r),t=n*(1-t*(1-r)),i){case 1:this.r=o,this.g=n,this.b=e;break;case 2:this.r=e,this.g=n,this.b=t;break;case 3:this.r=e,this.g=o,this.b=n;break;case 4:this.r=t,this.g=e,this.b=n;break;case 5:this.r=n,this.g=e,this.b=o;break;case 6:case 0:this.r=n,this.g=t,this.b=e}return this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,
this},getHex:function(){return~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},getContextStyle:function(){return"rgb("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return e.x===this.x&&e.y===this.y}},THREE.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},multiply:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},multiplySelf:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},divideSelf:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e,this.z/=e):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},crossSelf:function(e){var t=this.x,n=this.y,i=this.z;return this.x=n*e.z-i*e.y,this.y=i*e.x-t*e.z,this.z=t*e.y-n*e.x,this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new THREE.Vector3).sub(this,e).lengthSq()},setPositionFromMatrix:function(e){this.x=e.n14,this.y=e.n24,this.z=e.n34},setRotationFromMatrix:function(e){var t=Math.cos(this.y);this.y=Math.asin(e.n13),Math.abs(t)>1e-5?(this.x=Math.atan2(-e.n23/t,e.n33/t),this.z=Math.atan2(-e.n12/t,e.n11/t)):(this.x=0,this.z=Math.atan2(e.n21,e.n22))},isZero:function(){return this.lengthSq()<1e-4}},THREE.Vector4=function(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==i?i:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},copy:function(e){this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},THREE.Ray=function(e,t){function n(e,t,n){return S.sub(n,e),u=S.dot(t),0>=u?null:(p=x.add(e,T.copy(t).multiplyScalar(u)),h=n.distanceTo(p))}function i(e,t,n,i){return S.sub(i,t),x.sub(n,t),T.sub(e,t),g=S.dot(S),f=S.dot(x),m=S.dot(T),v=x.dot(x),y=x.dot(T),b=1/(g*v-f*f),w=(v*m-f*y)*b,E=(g*y-f*m)*b,w>=0&&E>=0&&1>w+E}this.origin=e||new THREE.Vector3,this.direction=t||new THREE.Vector3,this.intersectScene=function(e){return this.intersectObjects(e.children)},this.intersectObjects=function(e){var t,n,i=[];for(t=0,n=e.length;n>t;t++)Array.prototype.push.apply(i,this.intersectObject(e[t]));return i.sort(function(e,t){return e.distance-t.distance}),i};var r=new THREE.Vector3,o=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3,e=new THREE.Vector3,t=new THREE.Vector3,c=new THREE.Vector3,l=new THREE.Vector3,d=new THREE.Vector3;this.intersectObject=function(u){for(var p,h=[],g=0,f=u.children.length;f>g;g++)Array.prototype.push.apply(h,this.intersectObject(u.children[g]));if(u instanceof THREE.Particle){if(g=n(this.origin,this.direction,u.matrixWorld.getPosition()),null===g||g>u.scale.x)return[];p={distance:g,point:u.position,face:null,object:u},h.push(p)}else if(u instanceof THREE.Mesh){if(g=n(this.origin,this.direction,u.matrixWorld.getPosition()),null===g||g>u.geometry.boundingSphere.radius*Math.max(u.scale.x,Math.max(u.scale.y,u.scale.z)))return h;var m,v,y=u.geometry,b=y.vertices;for(u.matrixRotationWorld.extractRotation(u.matrixWorld),g=0,f=y.faces.length;f>g;g++)p=y.faces[g],e.copy(this.origin),t.copy(this.direction),v=u.matrixWorld,c=v.multiplyVector3(c.copy(p.centroid)).subSelf(e),m=c.dot(t),0>=m||(r=v.multiplyVector3(r.copy(b[p.a].position)),o=v.multiplyVector3(o.copy(b[p.b].position)),a=v.multiplyVector3(a.copy(b[p.c].position)),p instanceof THREE.Face4&&(s=v.multiplyVector3(s.copy(b[p.d].position))),l=u.matrixRotationWorld.multiplyVector3(l.copy(p.normal)),m=t.dot(l),!u.doubleSided&&!(u.flipSided?m>0:0>m))||(m=l.dot(c.sub(r,e))/m,d.add(e,t.multiplyScalar(m)),p instanceof THREE.Face3?i(d,r,o,a)&&(p={distance:e.distanceTo(d),point:d.clone(),face:p,object:u},h.push(p)):p instanceof THREE.Face4&&(i(d,r,o,s)||i(d,o,a,s))&&(p={distance:e.distanceTo(d),point:d.clone(),face:p,object:u},h.push(p)))}return h};var u,p,h,g,f,m,v,y,b,w,E,S=new THREE.Vector3,x=new THREE.Vector3,T=new THREE.Vector3},THREE.Rectangle=function(){function e(){o=i-t,a=r-n}var t,n,i,r,o,a,s=!0;this.getX=function(){return t},this.getY=function(){return n},this.getWidth=function(){return o},this.getHeight=function(){return a},this.getLeft=function(){return t},this.getTop=function(){return n},this.getRight=function(){return i},this.getBottom=function(){return r},this.set=function(o,a,c,l){s=!1,t=o,n=a,i=c,r=l,e()},this.addPoint=function(o,a){s?(s=!1,t=o,n=a,i=o,r=a):(t=o>t?t:o,n=a>n?n:a,i=i>o?i:o,r=r>a?r:a),e()},this.add3Points=function(o,a,c,l,d,u){s?(s=!1,t=c>o?d>o?o:d:d>c?c:d,n=l>a?u>a?a:u:u>l?l:u,i=o>c?o>d?o:d:c>d?c:d,r=a>l?a>u?a:u:l>u?l:u):(t=c>o?d>o?t>o?o:t:t>d?d:t:d>c?t>c?c:t:t>d?d:t,n=l>a?u>a?n>a?a:n:n>u?u:n:u>l?n>l?l:n:n>u?u:n,i=o>c?o>d?o>i?o:i:d>i?d:i:c>d?c>i?c:i:d>i?d:i,r=a>l?a>u?a>r?a:r:u>r?u:r:l>u?l>r?l:r:u>r?u:r),e()},this.addRectangle=function(o){s?(s=!1,t=o.getLeft(),n=o.getTop(),i=o.getRight(),r=o.getBottom()):(t=t<o.getLeft()?t:o.getLeft(),n=n<o.getTop()?n:o.getTop(),i=i>o.getRight()?i:o.getRight(),r=r>o.getBottom()?r:o.getBottom()),e()},this.inflate=function(o){t-=o,n-=o,i+=o,r+=o,e()},this.minSelf=function(o){t=t>o.getLeft()?t:o.getLeft(),n=n>o.getTop()?n:o.getTop(),i=i<o.getRight()?i:o.getRight(),r=r<o.getBottom()?r:o.getBottom(),e()},this.intersects=function(e){return Math.min(i,e.getRight())-Math.max(t,e.getLeft())>=0&&Math.min(r,e.getBottom())-Math.max(n,e.getTop())>=0},this.empty=function(){s=!0,r=i=n=t=0,e()},this.isEmpty=function(){return s}},THREE.Math={clamp:function(e,t,n){return t>e?t:e>n?n:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={constructor:THREE.Matrix3,transpose:function(){var e,t=this.m;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},THREE.Matrix4=function(e,t,n,i,r,o,a,s,c,l,d,u,p,h,g,f){this.set(void 0!==e?e:1,t||0,n||0,i||0,r||0,void 0!==o?o:1,a||0,s||0,c||0,l||0,void 0!==d?d:1,u||0,p||0,h||0,g||0,void 0!==f?f:1),this.flat=Array(16),this.m33=new THREE.Matrix3},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,i,r,o,a,s,c,l,d,u,p,h,g,f){return this.n11=e,this.n12=t,this.n13=n,this.n14=i,this.n21=r,this.n22=o,this.n23=a,this.n24=s,this.n31=c,this.n32=l,this.n33=d,this.n34=u,this.n41=p,this.n42=h,this.n43=g,this.n44=f,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.set(e.n11,e.n12,e.n13,e.n14,e.n21,e.n22,e.n23,e.n24,e.n31,e.n32,e.n33,e.n34,e.n41,e.n42,e.n43,e.n44),this},lookAt:function(e,t,n){var i=THREE.Matrix4.__v1,r=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return o.sub(e,t).normalize(),0===o.length()&&(o.z=1),i.cross(n,o).normalize(),0===i.length()&&(o.x+=1e-4,i.cross(n,o).normalize()),r.cross(o,i).normalize(),this.n11=i.x,this.n12=r.x,this.n13=o.x,this.n21=i.y,this.n22=r.y,this.n23=o.y,this.n31=i.z,this.n32=r.z,this.n33=o.z,this},multiply:function(e,t){var n=e.n11,i=e.n12,r=e.n13,o=e.n14,a=e.n21,s=e.n22,c=e.n23,l=e.n24,d=e.n31,u=e.n32,p=e.n33,h=e.n34,g=e.n41,f=e.n42,m=e.n43,v=e.n44,y=t.n11,b=t.n12,w=t.n13,E=t.n14,S=t.n21,x=t.n22,T=t.n23,C=t.n24,$=t.n31,I=t.n32,R=t.n33,P=t.n34,M=t.n41,_=t.n42,k=t.n43,A=t.n44;return this.n11=n*y+i*S+r*$+o*M,this.n12=n*b+i*x+r*I+o*_,this.n13=n*w+i*T+r*R+o*k,this.n14=n*E+i*C+r*P+o*A,this.n21=a*y+s*S+c*$+l*M,this.n22=a*b+s*x+c*I+l*_,this.n23=a*w+s*T+c*R+l*k,this.n24=a*E+s*C+c*P+l*A,this.n31=d*y+u*S+p*$+h*M,this.n32=d*b+u*x+p*I+h*_,this.n33=d*w+u*T+p*R+h*k,this.n34=d*E+u*C+p*P+h*A,this.n41=g*y+f*S+m*$+v*M,this.n42=g*b+f*x+m*I+v*_,this.n43=g*w+f*T+m*R+v*k,this.n44=g*E+f*C+m*P+v*A,this},multiplySelf:function(e){return this.multiply(this,e)},multiplyToArray:function(e,t,n){return this.multiply(e,t),n[0]=this.n11,n[1]=this.n21,n[2]=this.n31,n[3]=this.n41,n[4]=this.n12,n[5]=this.n22,n[6]=this.n32,n[7]=this.n42,n[8]=this.n13,n[9]=this.n23,n[10]=this.n33,n[11]=this.n43,n[12]=this.n14,n[13]=this.n24,n[14]=this.n34,n[15]=this.n44,this},multiplyScalar:function(e){return this.n11*=e,this.n12*=e,this.n13*=e,this.n14*=e,this.n21*=e,this.n22*=e,this.n23*=e,this.n24*=e,this.n31*=e,this.n32*=e,this.n33*=e,this.n34*=e,this.n41*=e,this.n42*=e,this.n43*=e,this.n44*=e,this},multiplyVector3:function(e){var t=e.x,n=e.y,i=e.z,r=1/(this.n41*t+this.n42*n+this.n43*i+this.n44);return e.x=(this.n11*t+this.n12*n+this.n13*i+this.n14)*r,e.y=(this.n21*t+this.n22*n+this.n23*i+this.n24)*r,e.z=(this.n31*t+this.n32*n+this.n33*i+this.n34)*r,e},multiplyVector4:function(e){var t=e.x,n=e.y,i=e.z,r=e.w;return e.x=this.n11*t+this.n12*n+this.n13*i+this.n14*r,e.y=this.n21*t+this.n22*n+this.n23*i+this.n24*r,e.z=this.n31*t+this.n32*n+this.n33*i+this.n34*r,e.w=this.n41*t+this.n42*n+this.n43*i+this.n44*r,e},rotateAxis:function(e){var t=e.x,n=e.y,i=e.z;return e.x=t*this.n11+n*this.n12+i*this.n13,e.y=t*this.n21+n*this.n22+i*this.n23,e.z=t*this.n31+n*this.n32+i*this.n33,e.normalize(),e},crossVector:function(e){var t=new THREE.Vector4;return t.x=this.n11*e.x+this.n12*e.y+this.n13*e.z+this.n14*e.w,t.y=this.n21*e.x+this.n22*e.y+this.n23*e.z+this.n24*e.w,t.z=this.n31*e.x+this.n32*e.y+this.n33*e.z+this.n34*e.w,t.w=e.w?this.n41*e.x+this.n42*e.y+this.n43*e.z+this.n44*e.w:1,t},determinant:function(){var e=this.n11,t=this.n12,n=this.n13,i=this.n14,r=this.n21,o=this.n22,a=this.n23,s=this.n24,c=this.n31,l=this.n32,d=this.n33,u=this.n34,p=this.n41,h=this.n42,g=this.n43,f=this.n44;return i*a*l*p-n*s*l*p-i*o*d*p+t*s*d*p+n*o*u*p-t*a*u*p-i*a*c*h+n*s*c*h+i*r*d*h-e*s*d*h-n*r*u*h+e*a*u*h+i*o*c*g-t*s*c*g-i*r*l*g+e*s*l*g+t*r*u*g-e*o*u*g-n*o*c*f+t*a*c*f+n*r*l*f-e*a*l*f-t*r*d*f+e*o*d*f},transpose:function(){var e;return e=this.n21,this.n21=this.n12,this.n12=e,e=this.n31,this.n31=this.n13,this.n13=e,e=this.n32,this.n32=this.n23,this.n23=e,e=this.n41,this.n41=this.n14,this.n14=e,e=this.n42,this.n42=this.n24,this.n24=e,e=this.n43,this.n43=this.n34,this.n43=e,this},clone:function(){var e=new THREE.Matrix4;return e.n11=this.n11,e.n12=this.n12,e.n13=this.n13,e.n14=this.n14,e.n21=this.n21,e.n22=this.n22,e.n23=this.n23,e.n24=this.n24,e.n31=this.n31,e.n32=this.n32,e.n33=this.n33,e.n34=this.n34,e.n41=this.n41,e.n42=this.n42,e.n43=this.n43,e.n44=this.n44,e},flatten:function(){return this.flat[0]=this.n11,this.flat[1]=this.n21,this.flat[2]=this.n31,this.flat[3]=this.n41,this.flat[4]=this.n12,this.flat[5]=this.n22,this.flat[6]=this.n32,this.flat[7]=this.n42,this.flat[8]=this.n13,this.flat[9]=this.n23,this.flat[10]=this.n33,this.flat[11]=this.n43,this.flat[12]=this.n14,this.flat[13]=this.n24,this.flat[14]=this.n34,this.flat[15]=this.n44,this.flat},flattenToArray:function(e){return e[0]=this.n11,e[1]=this.n21,e[2]=this.n31,e[3]=this.n41,e[4]=this.n12,e[5]=this.n22,e[6]=this.n32,e[7]=this.n42,e[8]=this.n13,e[9]=this.n23,e[10]=this.n33,e[11]=this.n43,e[12]=this.n14,e[13]=this.n24,e[14]=this.n34,e[15]=this.n44,e},flattenToArrayOffset:function(e,t){return e[t]=this.n11,e[t+1]=this.n21,e[t+2]=this.n31,e[t+3]=this.n41,e[t+4]=this.n12,e[t+5]=this.n22,e[t+6]=this.n32,e[t+7]=this.n42,e[t+8]=this.n13,e[t+9]=this.n23,e[t+10]=this.n33,e[t+11]=this.n43,e[t+12]=this.n14,e[t+13]=this.n24,e[t+14]=this.n34,e[t+15]=this.n44,e},setTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},setScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},setRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},setRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},setRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},setRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,o=e.x,a=e.y,s=e.z,c=r*o,l=r*a;return this.set(c*o+n,c*a-i*s,c*s+i*a,0,c*a+i*s,l*a+n,l*s-i*o,0,c*s-i*a,l*s+i*o,r*s*s+n,0,0,0,0,1),this},setPosition:function(e){return this.n14=e.x,this.n24=e.y,this.n34=e.z,this},getPosition:function(){return THREE.Matrix4.__v1.set(this.n14,this.n24,this.n34)},getColumnX:function(){return THREE.Matrix4.__v1.set(this.n11,this.n21,this.n31)},getColumnY:function(){return THREE.Matrix4.__v1.set(this.n12,this.n22,this.n32)},getColumnZ:function(){return THREE.Matrix4.__v1.set(this.n13,this.n23,this.n33)},getInverse:function(e){var t=e.n11,n=e.n12,i=e.n13,r=e.n14,o=e.n21,a=e.n22,s=e.n23,c=e.n24,l=e.n31,d=e.n32,u=e.n33,p=e.n34,h=e.n41,g=e.n42,f=e.n43,m=e.n44;return this.n11=s*p*g-c*u*g+c*d*f-a*p*f-s*d*m+a*u*m,this.n12=r*u*g-i*p*g-r*d*f+n*p*f+i*d*m-n*u*m,this.n13=i*c*g-r*s*g+r*a*f-n*c*f-i*a*m+n*s*m,this.n14=r*s*d-i*c*d-r*a*u+n*c*u+i*a*p-n*s*p,this.n21=c*u*h-s*p*h-c*l*f+o*p*f+s*l*m-o*u*m,this.n22=i*p*h-r*u*h+r*l*f-t*p*f-i*l*m+t*u*m,this.n23=r*s*h-i*c*h-r*o*f+t*c*f+i*o*m-t*s*m,this.n24=i*c*l-r*s*l+r*o*u-t*c*u-i*o*p+t*s*p,this.n31=a*p*h-c*d*h+c*l*g-o*p*g-a*l*m+o*d*m,this.n32=r*d*h-n*p*h-r*l*g+t*p*g+n*l*m-t*d*m,this.n33=i*c*h-r*a*h+r*o*g-t*c*g-n*o*m+t*a*m,this.n34=r*a*l-n*c*l-r*o*d+t*c*d+n*o*p-t*a*p,this.n41=s*d*h-a*u*h-s*l*g+o*u*g+a*l*f-o*d*f,this.n42=n*u*h-i*d*h+i*l*g-t*u*g-n*l*f+t*d*f,this.n43=i*a*h-n*s*h-i*o*g+t*s*g+n*o*f-t*a*f,this.n44=n*s*l-i*a*l+i*o*d-t*s*d-n*o*u+t*a*u,this.multiplyScalar(1/e.determinant()),this},setRotationFromEuler:function(e,t){var n=e.x,i=e.y,r=e.z,o=Math.cos(n),n=Math.sin(n),a=Math.cos(i),i=Math.sin(i),s=Math.cos(r),r=Math.sin(r);switch(t){case"YXZ":var c=a*s,l=a*r,d=i*s,u=i*r;this.n11=c+u*n,this.n12=d*n-l,this.n13=o*i,this.n21=o*r,this.n22=o*s,this.n23=-n,this.n31=l*n-d,this.n32=u+c*n,this.n33=o*a;break;case"ZXY":c=a*s,l=a*r,d=i*s,u=i*r,this.n11=c-u*n,this.n12=-o*r,this.n13=d+l*n,this.n21=l+d*n,this.n22=o*s,this.n23=u-c*n,this.n31=-o*i,this.n32=n,this.n33=o*a;break;case"ZYX":c=o*s,l=o*r,d=n*s,u=n*r,this.n11=a*s,this.n12=d*i-l,this.n13=c*i+u,this.n21=a*r,this.n22=u*i+c,this.n23=l*i-d,this.n31=-i,this.n32=n*a,this.n33=o*a;break;case"YZX":c=o*a,l=o*i,d=n*a,u=n*i,this.n11=a*s,this.n12=u-c*r,this.n13=d*r+l,this.n21=r,this.n22=o*s,this.n23=-n*s,this.n31=-i*s,this.n32=l*r+d,this.n33=c-u*r;break;case"XZY":c=o*a,l=o*i,d=n*a,u=n*i,this.n11=a*s,this.n12=-r,this.n13=i*s,this.n21=c*r+u,this.n22=o*s,this.n23=l*r-d,this.n31=d*r-l,this.n32=n*s,this.n33=u*r+c;break;default:c=o*s,l=o*r,d=n*s,u=n*r,this.n11=a*s,this.n12=-a*r,this.n13=i,this.n21=l+d*i,this.n22=c-u*i,this.n23=-n*a,this.n31=u-c*i,this.n32=d+l*i,this.n33=o*a}return this},setRotationFromQuaternion:function(e){var t=e.x,n=e.y,i=e.z,r=e.w,o=t+t,a=n+n,s=i+i,e=t*o,c=t*a;t*=s;var l=n*a;return n*=s,i*=s,o*=r,a*=r,r*=s,this.n11=1-(l+i),this.n12=c-r,this.n13=t+a,this.n21=c+r,this.n22=1-(e+i),this.n23=n-o,this.n31=t-a,this.n32=n+o,this.n33=1-(e+l),this},scale:function(e){var t=e.x,n=e.y,e=e.z;return this.n11*=t,this.n12*=n,this.n13*=e,this.n21*=t,this.n22*=n,this.n23*=e,this.n31*=t,this.n32*=n,this.n33*=e,this.n41*=t,this.n42*=n,this.n43*=e,this},compose:function(e,t,n){var i=THREE.Matrix4.__m1,r=THREE.Matrix4.__m2;return i.identity(),i.setRotationFromQuaternion(t),r.setScale(n.x,n.y,n.z),this.multiply(i,r),this.n14=e.x,this.n24=e.y,this.n34=e.z,this},decompose:function(e,t,n){var i=THREE.Matrix4.__v1,r=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return i.set(this.n11,this.n21,this.n31),r.set(this.n12,this.n22,this.n32),o.set(this.n13,this.n23,this.n33),e=e instanceof THREE.Vector3?e:new THREE.Vector3,t=t instanceof THREE.Quaternion?t:new THREE.Quaternion,n=n instanceof THREE.Vector3?n:new THREE.Vector3,n.x=i.length(),n.y=r.length(),n.z=o.length(),e.x=this.n14,e.y=this.n24,e.z=this.n34,i=THREE.Matrix4.__m1,i.copy(this),i.n11/=n.x,i.n21/=n.x,i.n31/=n.x,i.n12/=n.y,i.n22/=n.y,i.n32/=n.y,i.n13/=n.z,i.n23/=n.z,i.n33/=n.z,t.setFromRotationMatrix(i),[e,t,n]},extractPosition:function(e){return this.n14=e.n14,this.n24=e.n24,this.n34=e.n34,this},extractRotation:function(e){var t=THREE.Matrix4.__v1,n=1/t.set(e.n11,e.n21,e.n31).length(),i=1/t.set(e.n12,e.n22,e.n32).length(),t=1/t.set(e.n13,e.n23,e.n33).length();return this.n11=e.n11*n,this.n21=e.n21*n,this.n31=e.n31*n,this.n12=e.n12*i,this.n22=e.n22*i,this.n32=e.n32*i,this.n13=e.n13*t,this.n23=e.n23*t,this.n33=e.n33*t,this}},THREE.Matrix4.makeInvert3x3=function(e){var t=e.m33,n=t.m,i=e.n33*e.n22-e.n32*e.n23,r=-e.n33*e.n21+e.n31*e.n23,o=e.n32*e.n21-e.n31*e.n22,a=-e.n33*e.n12+e.n32*e.n13,s=e.n33*e.n11-e.n31*e.n13,c=-e.n32*e.n11+e.n31*e.n12,l=e.n23*e.n12-e.n22*e.n13,d=-e.n23*e.n11+e.n21*e.n13,u=e.n22*e.n11-e.n21*e.n12,e=e.n11*i+e.n21*a+e.n31*l;return 0===e&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible."),e=1/e,n[0]=e*i,n[1]=e*r,n[2]=e*o,n[3]=e*a,n[4]=e*s,n[5]=e*c,n[6]=e*l,n[7]=e*d,n[8]=e*u,t},THREE.Matrix4.makeFrustum=function(e,t,n,i,r,o){var a;return a=new THREE.Matrix4,a.n11=2*r/(t-e),a.n12=0,a.n13=(t+e)/(t-e),a.n14=0,a.n21=0,a.n22=2*r/(i-n),a.n23=(i+n)/(i-n),a.n24=0,a.n31=0,a.n32=0,a.n33=-(o+r)/(o-r),a.n34=-2*o*r/(o-r),a.n41=0,a.n42=0,a.n43=-1,a.n44=0,a},THREE.Matrix4.makePerspective=function(e,t,n,i){var r,e=n*Math.tan(e*Math.PI/360);return r=-e,THREE.Matrix4.makeFrustum(r*t,e*t,r,e,n,i)},THREE.Matrix4.makeOrtho=function(e,t,n,i,r,o){var a,s,c,l;return a=new THREE.Matrix4,s=t-e,c=n-i,l=o-r,a.n11=2/s,a.n12=0,a.n13=0,a.n14=-((t+e)/s),a.n21=0,a.n22=2/c,a.n23=0,a.n24=-((n+i)/c),a.n31=0,a.n32=0,a.n33=-2/l,a.n34=-((o+r)/l),a.n41=0,a.n42=0,a.n43=0,a.n44=1,a},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Matrix4.__m1=new THREE.Matrix4,THREE.Matrix4.__m2=new THREE.Matrix4,THREE.Object3D=function(){this.name="",this.id=THREE.Object3DCount++,this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.eulerOrder="XYZ",this.scale=new THREE.Vector3(1,1,1),this.flipSided=this.doubleSided=this.dynamic=!1,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new THREE.Vector3},THREE.Object3D.prototype={constructor:THREE.Object3D,translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},add:function(e){if(-1===this.children.indexOf(e)){void 0!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){for(e.parent=void 0,this.children.splice(t,1),t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.removeObject(e)}},getChildByName:function(e,t){var n,i,r;for(n=0,i=this.children.length;i>n;n++){if(r=this.children[n],r.name===e)return r;if(t&&(r=r.getChildByName(e,t),void 0!==r))return r}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder),(1!==this.scale.x||1!==this.scale.y||1!==this.scale.z)&&(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,n=this.children.length;n>t;t++)this.children[t].updateMatrixWorld(e)}},THREE.Object3DCount=0,THREE.Projector=function(){function e(){var e=f[o]=f[o]||new THREE.RenderableObject;return o++,e}function t(){var e=m[s]=m[s]||new THREE.RenderableVertex;return s++,e}function n(e,t){return t.z-e.z}function i(e,t){var n=0,i=1,r=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return r>=0&&o>=0&&a>=0&&s>=0||!(0>r&&0>o||0>a&&0>s)&&(0>r?n=Math.max(n,r/(r-o)):0>o&&(i=Math.min(i,r/(r-o))),0>a?n=Math.max(n,a/(a-s)):0>s&&(i=Math.min(i,a/(a-s))),!(n>i)&&(e.lerpSelf(t,n),t.lerpSelf(e,1-i),!0))}var r,o,a,s,c,l,d,u,p,h,g,f=[],m=[],v=[],y=[],b=[],w=[],E={objects:[],sprites:[],lights:[],elements:[]},S=new THREE.Vector3,x=new THREE.Vector4,T=new THREE.Matrix4,C=new THREE.Matrix4,$=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],I=new THREE.Vector4,R=new THREE.Vector4;this.computeFrustum=function(e){for($[0].set(e.n41-e.n11,e.n42-e.n12,e.n43-e.n13,e.n44-e.n14),$[1].set(e.n41+e.n11,e.n42+e.n12,e.n43+e.n13,e.n44+e.n14),$[2].set(e.n41+e.n21,e.n42+e.n22,e.n43+e.n23,e.n44+e.n24),$[3].set(e.n41-e.n21,e.n42-e.n22,e.n43-e.n23,e.n44-e.n24),$[4].set(e.n41-e.n31,e.n42-e.n32,e.n43-e.n33,e.n44-e.n34),$[5].set(e.n41+e.n31,e.n42+e.n32,e.n43+e.n33,e.n44+e.n34),e=0;6>e;e++){var t=$[e];t.divideScalar(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))}},this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),T.multiply(t.projectionMatrix,t.matrixWorldInverse),T.multiplyVector3(e),e},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),T.multiply(t.matrixWorld,t.projectionMatrixInverse),T.multiplyVector3(e),e},this.pickingRay=function(e,t){var n;return e.z=-1,n=new THREE.Vector3(e.x,e.y,1),this.unprojectVector(e,t),this.unprojectVector(n,t),n.subSelf(e).normalize(),new THREE.Ray(e,n)},this.projectGraph=function(t,i){o=0,E.objects.length=0,E.sprites.length=0,E.lights.length=0;var a=function(t){if(t.visible!==!1){var n;if((n=t instanceof THREE.Mesh||t instanceof THREE.Line)&&!(n=t.frustumCulled===!1))e:{for(var i=t.matrixWorld,o=-t.geometry.boundingSphere.radius*Math.max(t.scale.x,Math.max(t.scale.y,t.scale.z)),s=0;6>s;s++)if(n=$[s].x*i.n14+$[s].y*i.n24+$[s].z*i.n34+$[s].w,o>=n){n=!1;break e}n=!0}for(n?(T.multiplyVector3(S.copy(t.position)),r=e(),r.object=t,r.z=S.z,E.objects.push(r)):t instanceof THREE.Sprite||t instanceof THREE.Particle?(T.multiplyVector3(S.copy(t.position)),r=e(),r.object=t,r.z=S.z,E.sprites.push(r)):t instanceof THREE.Light&&E.lights.push(t),n=0,i=t.children.length;i>n;n++)a(t.children[n])}};return a(t),i&&E.objects.sort(n),E},this.projectScene=function(e,r,o){var f,S,$,P,M,_,k,A,L,D,z,F,N,H,U,O,B=r.near,j=r.far;for(g=p=d=l=0,E.elements.length=0,void 0===r.parent&&(console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it..."),e.add(r)),e.updateMatrixWorld(),r.matrixWorldInverse.getInverse(r.matrixWorld),T.multiply(r.projectionMatrix,r.matrixWorldInverse),this.computeFrustum(T),E=this.projectGraph(e,!1),e=0,f=E.objects.length;f>e;e++)if(L=E.objects[e].object,D=L.matrixWorld,F=L.material,s=0,L instanceof THREE.Mesh){for(z=L.geometry,N=L.geometry.materials,P=z.vertices,H=z.faces,U=z.faceVertexUvs,z=L.matrixRotationWorld.extractRotation(D),S=0,$=P.length;$>S;S++)a=t(),a.positionWorld.copy(P[S].position),D.multiplyVector3(a.positionWorld),a.positionScreen.copy(a.positionWorld),T.multiplyVector4(a.positionScreen),a.positionScreen.x/=a.positionScreen.w,a.positionScreen.y/=a.positionScreen.w,a.visible=a.positionScreen.z>B&&a.positionScreen.z<j;for(P=0,S=H.length;S>P;P++){if($=H[P],$ instanceof THREE.Face3){if(M=m[$.a],_=m[$.b],k=m[$.c],!(M.visible&&_.visible&&k.visible)||!L.doubleSided&&L.flipSided==(k.positionScreen.x-M.positionScreen.x)*(_.positionScreen.y-M.positionScreen.y)-(k.positionScreen.y-M.positionScreen.y)*(_.positionScreen.x-M.positionScreen.x)<0)continue;A=v[l]=v[l]||new THREE.RenderableFace3,l++,c=A,c.v1.copy(M),c.v2.copy(_),c.v3.copy(k)}else if($ instanceof THREE.Face4){if(M=m[$.a],_=m[$.b],k=m[$.c],A=m[$.d],!(M.visible&&_.visible&&k.visible&&A.visible)||!L.doubleSided&&L.flipSided==((A.positionScreen.x-M.positionScreen.x)*(_.positionScreen.y-M.positionScreen.y)-(A.positionScreen.y-M.positionScreen.y)*(_.positionScreen.x-M.positionScreen.x)<0||(_.positionScreen.x-k.positionScreen.x)*(A.positionScreen.y-k.positionScreen.y)-(_.positionScreen.y-k.positionScreen.y)*(A.positionScreen.x-k.positionScreen.x)<0))continue;O=y[d]=y[d]||new THREE.RenderableFace4,d++,c=O,c.v1.copy(M),c.v2.copy(_),c.v3.copy(k),c.v4.copy(A)}for(c.normalWorld.copy($.normal),z.multiplyVector3(c.normalWorld),c.centroidWorld.copy($.centroid),D.multiplyVector3(c.centroidWorld),c.centroidScreen.copy(c.centroidWorld),T.multiplyVector3(c.centroidScreen),k=$.vertexNormals,M=0,_=k.length;_>M;M++)A=c.vertexNormalsWorld[M],A.copy(k[M]),z.multiplyVector3(A);for(M=0,_=U.length;_>M;M++)if(O=U[M][P])for(k=0,A=O.length;A>k;k++)c.uvs[M][k]=O[k];c.material=F,c.faceMaterial=null!==$.materialIndex?N[$.materialIndex]:null,c.z=c.centroidScreen.z,E.elements.push(c)}}else if(L instanceof THREE.Line)for(C.multiply(T,D),P=L.geometry.vertices,M=t(),M.positionScreen.copy(P[0].position),C.multiplyVector4(M.positionScreen),S=1,$=P.length;$>S;S++)M=t(),M.positionScreen.copy(P[S].position),C.multiplyVector4(M.positionScreen),_=m[s-2],I.copy(M.positionScreen),R.copy(_.positionScreen),i(I,R)&&(I.multiplyScalar(1/I.w),R.multiplyScalar(1/R.w),L=b[p]=b[p]||new THREE.RenderableLine,p++,u=L,u.v1.positionScreen.copy(I),u.v2.positionScreen.copy(R),u.z=Math.max(I.z,R.z),u.material=F,E.elements.push(u));for(e=0,f=E.sprites.length;f>e;e++)L=E.sprites[e].object,D=L.matrixWorld,L instanceof THREE.Particle&&(x.set(D.n14,D.n24,D.n34,1),T.multiplyVector4(x),x.z/=x.w,x.z>0&&x.z<1)&&(B=w[g]=w[g]||new THREE.RenderableParticle,g++,h=B,h.x=x.x/x.w,h.y=x.y/x.w,h.z=x.z,h.rotation=L.rotation.z,h.scale.x=L.scale.x*Math.abs(h.x-(x.x+r.projectionMatrix.n11)/(x.w+r.projectionMatrix.n14)),h.scale.y=L.scale.y*Math.abs(h.y-(x.y+r.projectionMatrix.n22)/(x.w+r.projectionMatrix.n24)),h.material=L.material,E.elements.push(h));return o&&E.elements.sort(n),E}},THREE.Quaternion=function(e,t,n,i){this.set(e||0,t||0,n||0,void 0!==i?i:1)},THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e){var t=Math.PI/360,n=e.x*t,i=e.y*t,r=e.z*t,e=Math.cos(i),i=Math.sin(i),t=Math.cos(-r),r=Math.sin(-r),o=Math.cos(n),n=Math.sin(n),a=e*t,s=i*r;return this.w=a*o-s*n,this.x=a*n+s*o,this.y=i*t*o+e*r*n,this.z=e*r*o-i*t*n,this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(n),this},setFromRotationMatrix:function(e){var t=Math.pow(e.determinant(),1/3);return this.w=Math.sqrt(Math.max(0,t+e.n11+e.n22+e.n33))/2,this.x=Math.sqrt(Math.max(0,t+e.n11-e.n22-e.n33))/2,this.y=Math.sqrt(Math.max(0,t-e.n11+e.n22-e.n33))/2,this.z=Math.sqrt(Math.max(0,t-e.n11-e.n22+e.n33))/2,this.x=e.n32-e.n23<0?-Math.abs(this.x):Math.abs(this.x),this.y=e.n13-e.n31<0?-Math.abs(this.y):Math.abs(this.y),this.z=e.n21-e.n12<0?-Math.abs(this.z):Math.abs(this.z),this.normalize(),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?this.w=this.z=this.y=this.x=0:(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiplySelf:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,o=e.x,a=e.y,s=e.z,e=e.w;return this.x=t*e+r*o+n*s-i*a,this.y=n*e+r*a+i*o-t*s,this.z=i*e+r*s+t*a-n*o,this.w=r*e-t*o-n*a-i*s,this},multiply:function(e,t){return this.x=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x,this.y=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y,this.z=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z,this.w=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w,this},multiplyVector3:function(e,t){t||(t=e);var n=e.x,i=e.y,r=e.z,o=this.x,a=this.y,s=this.z,c=this.w,l=c*n+a*r-s*i,d=c*i+s*n-o*r,u=c*r+o*i-a*n,n=-o*n-a*i-s*r;return t.x=l*c+n*-o+d*-s-u*-a,t.y=d*c+n*-a+u*-o-l*-s,t.z=u*c+n*-s+l*-a-d*-o,t}},THREE.Quaternion.slerp=function(e,t,n,i){var r=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;
if(0>r?(n.w=-t.w,n.x=-t.x,n.y=-t.y,n.z=-t.z,r=-r):n.copy(t),Math.abs(r)>=1)return n.w=e.w,n.x=e.x,n.y=e.y,n.z=e.z,n;var o=Math.acos(r),r=Math.sqrt(1-r*r);return Math.abs(r)<.001?(n.w=.5*(e.w+t.w),n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y),n.z=.5*(e.z+t.z),n):(t=Math.sin((1-i)*o)/r,i=Math.sin(i*o)/r,n.w=e.w*t+n.w*i,n.x=e.x*t+n.x*i,n.y=e.y*t+n.y*i,n.z=e.z*t+n.z*i,n)},THREE.Vertex=function(e){this.position=e||new THREE.Vector3},THREE.Face3=function(e,t,n,i,r,o){this.a=e,this.b=t,this.c=n,this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=r instanceof THREE.Color?r:new THREE.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=o,this.centroid=new THREE.Vector3},THREE.Face4=function(e,t,n,i,r,o,a){this.a=e,this.b=t,this.c=n,this.d=i,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=o instanceof THREE.Color?o:new THREE.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=a,this.centroid=new THREE.Vector3},THREE.UV=function(e,t){this.u=e||0,this.v=t||0},THREE.UV.prototype={constructor:THREE.UV,set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.u=e.u,this.v=e.v,this},clone:function(){return new THREE.UV(this.u,this.v)}},THREE.Geometry=function(){this.id=THREE.GeometryCount++,this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.dynamic=this.hasTangents=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=new THREE.Matrix4;t.extractRotation(e,new THREE.Vector3(1,1,1));for(var n=0,i=this.vertices.length;i>n;n++)e.multiplyVector3(this.vertices[n].position);for(n=0,i=this.faces.length;i>n;n++){var r=this.faces[n];t.multiplyVector3(r.normal);for(var o=0,a=r.vertexNormals.length;a>o;o++)t.multiplyVector3(r.vertexNormals[o]);e.multiplyVector3(r.centroid)}},computeCentroids:function(){var e,t,n;for(e=0,t=this.faces.length;t>e;e++)n=this.faces[e],n.centroid.set(0,0,0),n instanceof THREE.Face3?(n.centroid.addSelf(this.vertices[n.a].position),n.centroid.addSelf(this.vertices[n.b].position),n.centroid.addSelf(this.vertices[n.c].position),n.centroid.divideScalar(3)):n instanceof THREE.Face4&&(n.centroid.addSelf(this.vertices[n.a].position),n.centroid.addSelf(this.vertices[n.b].position),n.centroid.addSelf(this.vertices[n.c].position),n.centroid.addSelf(this.vertices[n.d].position),n.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,n,i,r,o,a=new THREE.Vector3,s=new THREE.Vector3;for(e=0,t=this.faces.length;t>e;e++)n=this.faces[e],i=this.vertices[n.a],r=this.vertices[n.b],o=this.vertices[n.c],a.sub(o.position,r.position),s.sub(i.position,r.position),a.crossSelf(s),a.isZero()||a.normalize(),n.normal.copy(a)},computeVertexNormals:function(){var e,t,n,i;if(void 0===this.__tmpVertices){for(i=this.__tmpVertices=Array(this.vertices.length),e=0,t=this.vertices.length;t>e;e++)i[e]=new THREE.Vector3;for(e=0,t=this.faces.length;t>e;e++)n=this.faces[e],n instanceof THREE.Face3?n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:n instanceof THREE.Face4&&(n.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(i=this.__tmpVertices,e=0,t=this.vertices.length;t>e;e++)i[e].set(0,0,0);for(e=0,t=this.faces.length;t>e;e++)n=this.faces[e],n instanceof THREE.Face3?(i[n.a].addSelf(n.normal),i[n.b].addSelf(n.normal),i[n.c].addSelf(n.normal)):n instanceof THREE.Face4&&(i[n.a].addSelf(n.normal),i[n.b].addSelf(n.normal),i[n.c].addSelf(n.normal),i[n.d].addSelf(n.normal));for(e=0,t=this.vertices.length;t>e;e++)i[e].normalize();for(e=0,t=this.faces.length;t>e;e++)n=this.faces[e],n instanceof THREE.Face3?(n.vertexNormals[0].copy(i[n.a]),n.vertexNormals[1].copy(i[n.b]),n.vertexNormals[2].copy(i[n.c])):n instanceof THREE.Face4&&(n.vertexNormals[0].copy(i[n.a]),n.vertexNormals[1].copy(i[n.b]),n.vertexNormals[2].copy(i[n.c]),n.vertexNormals[3].copy(i[n.d]))},computeTangents:function(){function e(e,t,n,i,r,o,T){s=e.vertices[t].position,c=e.vertices[n].position,l=e.vertices[i].position,d=a[r],u=a[o],p=a[T],h=c.x-s.x,g=l.x-s.x,f=c.y-s.y,m=l.y-s.y,v=c.z-s.z,y=l.z-s.z,b=u.u-d.u,w=p.u-d.u,E=u.v-d.v,S=p.v-d.v,x=1/(b*S-w*E),I.set((S*h-E*g)*x,(S*f-E*m)*x,(S*v-E*y)*x),R.set((b*g-w*h)*x,(b*m-w*f)*x,(b*y-w*v)*x),C[t].addSelf(I),C[n].addSelf(I),C[i].addSelf(I),$[t].addSelf(R),$[n].addSelf(R),$[i].addSelf(R)}var t,n,i,r,o,a,s,c,l,d,u,p,h,g,f,m,v,y,b,w,E,S,x,T,C=[],$=[],I=new THREE.Vector3,R=new THREE.Vector3,P=new THREE.Vector3,M=new THREE.Vector3,_=new THREE.Vector3;for(t=0,n=this.vertices.length;n>t;t++)C[t]=new THREE.Vector3,$[t]=new THREE.Vector3;for(t=0,n=this.faces.length;n>t;t++)o=this.faces[t],a=this.faceVertexUvs[0][t],o instanceof THREE.Face3?e(this,o.a,o.b,o.c,0,1,2):o instanceof THREE.Face4&&(e(this,o.a,o.b,o.c,0,1,2),e(this,o.a,o.b,o.d,0,1,3));var k=["a","b","c","d"];for(t=0,n=this.faces.length;n>t;t++)for(o=this.faces[t],i=0;i<o.vertexNormals.length;i++)_.copy(o.vertexNormals[i]),r=o[k[i]],T=C[r],P.copy(T),P.subSelf(_.multiplyScalar(_.dot(T))).normalize(),M.cross(o.vertexNormals[i],T),r=M.dot($[r]),r=0>r?-1:1,o.vertexTangents[i]=new THREE.Vector4(P.x,P.y,P.z,r);this.hasTangents=!0},computeBoundingBox:function(){var e;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var t=1,n=this.vertices.length;n>t;t++)e=this.vertices[t],e.position.x<this.boundingBox.x[0]?this.boundingBox.x[0]=e.position.x:e.position.x>this.boundingBox.x[1]&&(this.boundingBox.x[1]=e.position.x),e.position.y<this.boundingBox.y[0]?this.boundingBox.y[0]=e.position.y:e.position.y>this.boundingBox.y[1]&&(this.boundingBox.y[1]=e.position.y),e.position.z<this.boundingBox.z[0]?this.boundingBox.z[0]=e.position.z:e.position.z>this.boundingBox.z[1]&&(this.boundingBox.z[1]=e.position.z)}},computeBoundingSphere:function(){for(var e=0,t=0,n=this.vertices.length;n>t;t++)e=Math.max(e,this.vertices[t].position.length());this.boundingSphere={radius:e}},mergeVertices:function(){var e,t,n,i={},r=[],o=[],a=Math.pow(10,4);for(t=0,n=this.vertices.length;n>t;t++)e=this.vertices[t].position,e=[Math.round(e.x*a),Math.round(e.y*a),Math.round(e.z*a)].join("_"),void 0===i[e]?(i[e]=t,r.push(this.vertices[t]),o[t]=r.length-1):o[t]=o[i[e]];for(t=0,n=this.faces.length;n>t;t++)i=this.faces[t],i instanceof THREE.Face3?(i.a=o[i.a],i.b=o[i.b],i.c=o[i.c]):i instanceof THREE.Face4&&(i.a=o[i.a],i.b=o[i.b],i.c=o[i.c],i.d=o[i.d]);this.vertices=r}},THREE.GeometryCount=0,THREE.Camera=function(){return arguments.length?(console.warn("DEPRECATED: Camera() is now PerspectiveCamera() or OrthographicCamera()."),new THREE.PerspectiveCamera(arguments[0],arguments[1],arguments[2],arguments[3])):(THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,void(this.projectionMatrixInverse=new THREE.Matrix4))},THREE.Camera.prototype=new THREE.Object3D,THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},THREE.OrthographicCamera=function(e,t,n,i,r,o){THREE.Camera.call(this),this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=new THREE.Camera,THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makeOrtho(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.PerspectiveCamera=function(e,t,n,i){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=new THREE.Camera,THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(e,t){this.fov=2*Math.atan((void 0!==t?t:43.25)/(2*e)),this.fov*=180/Math.PI,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,i,r,o){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=i,this.width=r,this.height=o,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,n=-t,i=e*n,e=Math.abs(e*t-i),n=Math.abs(t-n);this.projectionMatrix=THREE.Matrix4.makeFrustum(i+this.x*e/this.fullWidth,i+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*n/this.fullHeight,t-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=new THREE.Object3D,THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.supr=THREE.Object3D.prototype,THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(e,t,n){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,0,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0},THREE.PointLight.prototype=new THREE.Light,THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.Material=function(e){this.name="",this.id=THREE.MaterialCount++,e=e||{},this.opacity=void 0!==e.opacity?e.opacity:1,this.transparent=void 0!==e.transparent&&e.transparent,this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending,this.depthTest=void 0===e.depthTest||e.depthTest,this.depthWrite=void 0===e.depthWrite||e.depthWrite,this.polygonOffset=void 0!==e.polygonOffset&&e.polygonOffset,this.polygonOffsetFactor=void 0!==e.polygonOffsetFactor?e.polygonOffsetFactor:0,this.polygonOffsetUnits=void 0!==e.polygonOffsetUnits?e.polygonOffsetUnits:0,this.alphaTest=void 0!==e.alphaTest?e.alphaTest:0,this.overdraw=void 0!==e.overdraw&&e.overdraw},THREE.MaterialCount=0,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.MultiplyBlending=3,THREE.AdditiveAlphaBlending=4,THREE.LineBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.linewidth=void 0!==e.linewidth?e.linewidth:1,this.linecap=void 0!==e.linecap?e.linecap:"round",this.linejoin=void 0!==e.linejoin?e.linejoin:"round",this.vertexColors=!!e.vertexColors&&e.vertexColors,this.fog=void 0===e.fog||e.fog},THREE.LineBasicMaterial.prototype=new THREE.Material,THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.MeshBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0===e.fog||e.fog,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshBasicMaterial.prototype=new THREE.Material,THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshLambertMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=void 0!==e.ambient?new THREE.Color(e.ambient):new THREE.Color(328965),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0===e.fog||e.fog,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshLambertMaterial.prototype=new THREE.Material,THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshPhongMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=void 0!==e.ambient?new THREE.Color(e.ambient):new THREE.Color(328965),this.specular=void 0!==e.specular?new THREE.Color(e.specular):new THREE.Color(1118481),this.shininess=void 0!==e.shininess?e.shininess:30,this.metal=void 0!==e.metal&&e.metal,this.perPixel=void 0!==e.perPixel&&e.perPixel,this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.fog=void 0===e.fog||e.fog,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshPhongMaterial.prototype=new THREE.Material,THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshDepthMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshDepthMaterial.prototype=new THREE.Material,THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=e.shading?e.shading:THREE.FlatShading,this.wireframe=!!e.wireframe&&e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshNormalMaterial.prototype=new THREE.Material,THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshFaceMaterial=function(){},THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.size=void 0!==e.size?e.size:1,this.sizeAttenuation=void 0===e.sizeAttenuation||e.sizeAttenuation,this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.fog=void 0===e.fog||e.fog},THREE.ParticleBasicMaterial.prototype=new THREE.Material,THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial,THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.program=void 0!==e.program?e.program:function(){}},THREE.ParticleCanvasMaterial.prototype=new THREE.Material,THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial,THREE.Texture=function(e,t,n,i,r,o){this.id=THREE.TextureCount++,this.image=e,this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==n?n:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==r?r:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var e=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e}},THREE.TextureCount=0,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.ByteType=9,THREE.UnsignedByteType=10,THREE.ShortType=11,THREE.UnsignedShortType=12,THREE.IntType=13,THREE.UnsignedIntType=14,THREE.FloatType=15,THREE.AlphaFormat=16,THREE.RGBFormat=17,THREE.RGBAFormat=18,THREE.LuminanceFormat=19,THREE.LuminanceAlphaFormat=20,THREE.Particle=function(e){THREE.Object3D.call(this),this.material=e},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.Line=function(e,t,n){THREE.Object3D.call(this),this.geometry=e,this.material=t,this.type=void 0!==n?n:THREE.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(e,t){if(THREE.Object3D.call(this),this.geometry=e,this.material=t,t instanceof Array&&(console.warn("DEPRECATED: Mesh material can no longer be an Array. Using material at index 0..."),this.material=t[0]),this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var n=0;n<this.geometry.morphTargets.length;n++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[n].name]=n}},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.supr=THREE.Object3D.prototype,THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=new THREE.Object3D,THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.supr=THREE.Object3D.prototype,THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var n,i=this.children.length;for(n=0;i>n;n++)this.children[n].update(this.skinMatrix,t)},THREE.Sprite=function(e){THREE.Object3D.call(this),this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=e.map instanceof THREE.Texture?e.map:THREE.ImageUtils.loadTexture(e.map),this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending,this.useScreenCoordinates=void 0===e.useScreenCoordinates||e.useScreenCoordinates,this.mergeWith3D=void 0!==e.mergeWith3D?e.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=void 0!==e.affectedByDistance?e.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=void 0!==e.scaleByViewport?e.scaleByViewport:!this.affectedByDistance,this.alignment=e.alignment instanceof THREE.Vector2?e.alignment:THREE.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1)},THREE.Sprite.prototype=new THREE.Object3D,THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this.scale.x||1!==this.scale.y)&&(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)),this.matrixWorldNeedsUpdate=!0},THREE.SpriteAlignment={},THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,(-1)),THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,(-1)),THREE.SpriteAlignment.topRight=new THREE.Vector2((-1),(-1)),THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0),THREE.SpriteAlignment.center=new THREE.Vector2(0,0),THREE.SpriteAlignment.centerRight=new THREE.Vector2((-1),0),THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1),THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1),THREE.SpriteAlignment.bottomRight=new THREE.Vector2((-1),1),THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.objects=[],this.lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=new THREE.Object3D,THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.addObject=function(e){if(e instanceof THREE.Light)-1===this.lights.indexOf(e)&&this.lights.push(e);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&-1===this.objects.indexOf(e)){this.objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(t=0;t<e.children.length;t++)this.addObject(e.children[t])},THREE.Scene.prototype.removeObject=function(e){if(e instanceof THREE.Light){var t=this.lights.indexOf(e);-1!==t&&this.lights.splice(t,1)}else e instanceof THREE.Camera||(t=this.objects.indexOf(e),-1!==t&&(this.objects.splice(t,1),this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),-1!==t&&this.__objectsAdded.splice(t,1)));for(t=0;t<e.children.length;t++)this.removeObject(e.children[t])},THREE.CanvasRenderer=function(e){function t(e){Q!=e&&(G.globalAlpha=Q=e)}function n(e){if(Z!=e){switch(e){case THREE.NormalBlending:G.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:G.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:G.globalCompositeOperation="darker"}Z=e}}function i(e){J!=e&&(G.strokeStyle=J=e)}function r(e){K!=e&&(G.fillStyle=K=e)}var o,a,s,c,l,d,u,p,h,g,f,m,v,y,b,w,E,S,x,T,C,$,I,R,P,M,_,k,A,L,D,z,F,N,H,U,O,B,j,q=this,X=new THREE.Projector,e=e||{},V=void 0!==e.canvas?e.canvas:document.createElement("canvas"),G=V.getContext("2d"),W=new THREE.Color(0),Y=0,Q=1,Z=0,J=null,K=null,ee=null,te=null,ne=null,ie=new THREE.RenderableVertex,re=new THREE.RenderableVertex,oe=new THREE.Color,ae=new THREE.Color,se=new THREE.Color,ce=new THREE.Color,le=new THREE.Color,de=[],ue=[],pe=new THREE.Rectangle,he=new THREE.Rectangle,ge=new THREE.Rectangle,fe=!1,me=new THREE.Color,ve=new THREE.Color,ye=new THREE.Color,be=new THREE.Vector3,e=16;N=document.createElement("canvas"),N.width=N.height=2,H=N.getContext("2d"),H.fillStyle="rgba(0,0,0,1)",H.fillRect(0,0,2,2),U=H.getImageData(0,0,2,2),O=U.data,B=document.createElement("canvas"),B.width=B.height=e,j=B.getContext("2d"),j.translate(-e/2,-e/2),j.scale(e,e),e--,this.domElement=V,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(e,t){c=e,l=t,d=Math.floor(c/2),u=Math.floor(l/2),V.width=c,V.height=l,pe.set(-d,-u,d,u),he.set(-d,-u,d,u),Q=1,Z=0,ne=te=ee=K=J=null},this.setClearColor=function(e,t){W.copy(e),Y=t,he.set(-d,-u,d,u)},this.setClearColorHex=function(e,t){W.setHex(e),Y=t,he.set(-d,-u,d,u)},this.clear=function(){G.setTransform(1,0,0,-1,d,u),he.isEmpty()||(he.minSelf(pe),he.inflate(2),1>Y&&G.clearRect(Math.floor(he.getX()),Math.floor(he.getY()),Math.floor(he.getWidth()),Math.floor(he.getHeight())),Y>0&&(n(THREE.NormalBlending),t(1),r("rgba("+Math.floor(255*W.r)+","+Math.floor(255*W.g)+","+Math.floor(255*W.b)+","+Y+")"),G.fillRect(Math.floor(he.getX()),Math.floor(he.getY()),Math.floor(he.getWidth()),Math.floor(he.getHeight()))),he.empty())},this.render=function(e,c){function l(e){var t,n,i,r;for(me.setRGB(0,0,0),ve.setRGB(0,0,0),ye.setRGB(0,0,0),t=0,n=e.length;n>t;t++)i=e[t],r=i.color,i instanceof THREE.AmbientLight?(me.r+=r.r,me.g+=r.g,me.b+=r.b):i instanceof THREE.DirectionalLight?(ve.r+=r.r,ve.g+=r.g,ve.b+=r.b):i instanceof THREE.PointLight&&(ye.r+=r.r,ye.g+=r.g,ye.b+=r.b)}function V(e,t,n,i){var r,o,a,s,c,l;for(r=0,o=e.length;o>r;r++)a=e[r],s=a.color,a instanceof THREE.DirectionalLight?(c=a.matrixWorld.getPosition(),l=n.dot(c),0>=l||(l*=a.intensity,i.r+=s.r*l,i.g+=s.g*l,i.b+=s.b*l)):a instanceof THREE.PointLight&&(c=a.matrixWorld.getPosition(),l=n.dot(be.sub(c,t).normalize()),0>=l||(l*=0==a.distance?1:1-Math.min(t.distanceTo(c)/a.distance,1),0!=l&&(l*=a.intensity,i.r+=s.r*l,i.g+=s.g*l,i.b+=s.b*l)))}function W(e,o,a){t(a.opacity),n(a.blending);var s,c,l,p,h,g;a instanceof THREE.ParticleBasicMaterial?a.map&&(p=a.map.image,h=p.width>>1,g=p.height>>1,a=o.scale.x*d,l=o.scale.y*u,s=a*h,c=l*g,ge.set(e.x-s,e.y-c,e.x+s,e.y+c),pe.intersects(ge)&&(G.save(),G.translate(e.x,e.y),G.rotate(-o.rotation),G.scale(a,-l),G.translate(-h,-g),G.drawImage(p,0,0),G.restore())):a instanceof THREE.ParticleCanvasMaterial&&(s=o.scale.x*d,c=o.scale.y*u,ge.set(e.x-s,e.y-c,e.x+s,e.y+c),pe.intersects(ge)&&(i(a.color.getContextStyle()),r(a.color.getContextStyle()),G.save(),G.translate(e.x,e.y),G.rotate(-o.rotation),G.scale(s,c),a.program(G),G.restore()))}function Y(e,r,o,a){t(a.opacity),n(a.blending),G.beginPath(),G.moveTo(e.positionScreen.x,e.positionScreen.y),G.lineTo(r.positionScreen.x,r.positionScreen.y),G.closePath(),a instanceof THREE.LineBasicMaterial&&(e=a.linewidth,ee!=e&&(G.lineWidth=ee=e),e=a.linecap,te!=e&&(G.lineCap=te=e),e=a.linejoin,ne!=e&&(G.lineJoin=ne=e),i(a.color.getContextStyle()),G.stroke(),ge.inflate(2*a.linewidth))}function Q(e,i,r,o,a,l,d,u){q.info.render.vertices+=3,q.info.render.faces++,t(u.opacity),n(u.blending),m=e.positionScreen.x,v=e.positionScreen.y,y=i.positionScreen.x,b=i.positionScreen.y,w=r.positionScreen.x,E=r.positionScreen.y,J(m,v,y,b,w,E),u instanceof THREE.MeshBasicMaterial?u.map?u.map.mapping instanceof THREE.UVMapping&&(_=d.uvs[0],Se(m,v,y,b,w,E,_[o].u,_[o].v,_[a].u,_[a].v,_[l].u,_[l].v,u.map)):u.envMap?u.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(e=c.matrixWorldInverse,be.copy(d.vertexNormalsWorld[o]),k=.5*(be.x*e.n11+be.y*e.n12+be.z*e.n13)+.5,A=.5*-(be.x*e.n21+be.y*e.n22+be.z*e.n23)+.5,be.copy(d.vertexNormalsWorld[a]),L=.5*(be.x*e.n11+be.y*e.n12+be.z*e.n13)+.5,D=.5*-(be.x*e.n21+be.y*e.n22+be.z*e.n23)+.5,be.copy(d.vertexNormalsWorld[l]),z=.5*(be.x*e.n11+be.y*e.n12+be.z*e.n13)+.5,F=.5*-(be.x*e.n21+be.y*e.n22+be.z*e.n23)+.5,Se(m,v,y,b,w,E,k,A,L,D,z,F,u.envMap)):u.wireframe?we(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Ee(u.color):u instanceof THREE.MeshLambertMaterial?(u.map&&!u.wireframe&&(u.map.mapping instanceof THREE.UVMapping&&(_=d.uvs[0],Se(m,v,y,b,w,E,_[o].u,_[o].v,_[a].u,_[a].v,_[l].u,_[l].v,u.map)),n(THREE.SubtractiveBlending)),fe?u.wireframe||u.shading!=THREE.SmoothShading||3!=d.vertexNormalsWorld.length?(oe.r=me.r,oe.g=me.g,oe.b=me.b,V(s,d.centroidWorld,d.normalWorld,oe),oe.r=Math.max(0,Math.min(u.color.r*oe.r,1)),oe.g=Math.max(0,Math.min(u.color.g*oe.g,1)),oe.b=Math.max(0,Math.min(u.color.b*oe.b,1)),u.wireframe?we(oe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Ee(oe)):(ae.r=se.r=ce.r=me.r,ae.g=se.g=ce.g=me.g,ae.b=se.b=ce.b=me.b,V(s,d.v1.positionWorld,d.vertexNormalsWorld[0],ae),V(s,d.v2.positionWorld,d.vertexNormalsWorld[1],se),V(s,d.v3.positionWorld,d.vertexNormalsWorld[2],ce),ae.r=Math.max(0,Math.min(u.color.r*ae.r,1)),ae.g=Math.max(0,Math.min(u.color.g*ae.g,1)),ae.b=Math.max(0,Math.min(u.color.b*ae.b,1)),se.r=Math.max(0,Math.min(u.color.r*se.r,1)),se.g=Math.max(0,Math.min(u.color.g*se.g,1)),se.b=Math.max(0,Math.min(u.color.b*se.b,1)),ce.r=Math.max(0,Math.min(u.color.r*ce.r,1)),ce.g=Math.max(0,Math.min(u.color.g*ce.g,1)),ce.b=Math.max(0,Math.min(u.color.b*ce.b,1)),le.r=.5*(se.r+ce.r),le.g=.5*(se.g+ce.g),le.b=.5*(se.b+ce.b),M=Te(ae,se,ce,le),xe(m,v,y,b,w,E,0,0,1,0,0,1,M)):u.wireframe?we(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Ee(u.color)):u instanceof THREE.MeshDepthMaterial?(R=c.near,P=c.far,ae.r=ae.g=ae.b=1-Ce(e.positionScreen.z,R,P),se.r=se.g=se.b=1-Ce(i.positionScreen.z,R,P),ce.r=ce.g=ce.b=1-Ce(r.positionScreen.z,R,P),le.r=.5*(se.r+ce.r),le.g=.5*(se.g+ce.g),le.b=.5*(se.b+ce.b),M=Te(ae,se,ce,le),xe(m,v,y,b,w,E,0,0,1,0,0,1,M)):u instanceof THREE.MeshNormalMaterial&&(oe.r=$e(d.normalWorld.x),oe.g=$e(d.normalWorld.y),oe.b=$e(d.normalWorld.z),u.wireframe?we(oe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Ee(oe))}function Z(e,i,r,o,a,l,d,u,p){q.info.render.vertices+=4,q.info.render.faces++,t(u.opacity),n(u.blending),u.map||u.envMap?(Q(e,i,o,0,1,3,d,u,p),Q(a,r,l,1,2,3,d,u,p)):(m=e.positionScreen.x,v=e.positionScreen.y,y=i.positionScreen.x,b=i.positionScreen.y,w=r.positionScreen.x,E=r.positionScreen.y,S=o.positionScreen.x,x=o.positionScreen.y,T=a.positionScreen.x,C=a.positionScreen.y,$=l.positionScreen.x,I=l.positionScreen.y,u instanceof THREE.MeshBasicMaterial?(K(m,v,y,b,w,E,S,x),u.wireframe?we(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Ee(u.color)):u instanceof THREE.MeshLambertMaterial?fe?u.wireframe||u.shading!=THREE.SmoothShading||4!=d.vertexNormalsWorld.length?(oe.r=me.r,oe.g=me.g,oe.b=me.b,V(s,d.centroidWorld,d.normalWorld,oe),oe.r=Math.max(0,Math.min(u.color.r*oe.r,1)),oe.g=Math.max(0,Math.min(u.color.g*oe.g,1)),oe.b=Math.max(0,Math.min(u.color.b*oe.b,1)),K(m,v,y,b,w,E,S,x),u.wireframe?we(oe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Ee(oe)):(ae.r=se.r=ce.r=le.r=me.r,ae.g=se.g=ce.g=le.g=me.g,ae.b=se.b=ce.b=le.b=me.b,V(s,d.v1.positionWorld,d.vertexNormalsWorld[0],ae),V(s,d.v2.positionWorld,d.vertexNormalsWorld[1],se),V(s,d.v4.positionWorld,d.vertexNormalsWorld[3],ce),V(s,d.v3.positionWorld,d.vertexNormalsWorld[2],le),ae.r=Math.max(0,Math.min(u.color.r*ae.r,1)),ae.g=Math.max(0,Math.min(u.color.g*ae.g,1)),ae.b=Math.max(0,Math.min(u.color.b*ae.b,1)),se.r=Math.max(0,Math.min(u.color.r*se.r,1)),se.g=Math.max(0,Math.min(u.color.g*se.g,1)),se.b=Math.max(0,Math.min(u.color.b*se.b,1)),ce.r=Math.max(0,Math.min(u.color.r*ce.r,1)),ce.g=Math.max(0,Math.min(u.color.g*ce.g,1)),ce.b=Math.max(0,Math.min(u.color.b*ce.b,1)),
le.r=Math.max(0,Math.min(u.color.r*le.r,1)),le.g=Math.max(0,Math.min(u.color.g*le.g,1)),le.b=Math.max(0,Math.min(u.color.b*le.b,1)),M=Te(ae,se,ce,le),J(m,v,y,b,S,x),xe(m,v,y,b,S,x,0,0,1,0,0,1,M),J(T,C,w,E,$,I),xe(T,C,w,E,$,I,1,0,1,1,0,1,M)):(K(m,v,y,b,w,E,S,x),u.wireframe?we(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Ee(u.color)):u instanceof THREE.MeshNormalMaterial?(oe.r=$e(d.normalWorld.x),oe.g=$e(d.normalWorld.y),oe.b=$e(d.normalWorld.z),K(m,v,y,b,w,E,S,x),u.wireframe?we(oe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):Ee(oe)):u instanceof THREE.MeshDepthMaterial&&(R=c.near,P=c.far,ae.r=ae.g=ae.b=1-Ce(e.positionScreen.z,R,P),se.r=se.g=se.b=1-Ce(i.positionScreen.z,R,P),ce.r=ce.g=ce.b=1-Ce(o.positionScreen.z,R,P),le.r=le.g=le.b=1-Ce(r.positionScreen.z,R,P),M=Te(ae,se,ce,le),J(m,v,y,b,S,x),xe(m,v,y,b,S,x,0,0,1,0,0,1,M),J(T,C,w,E,$,I),xe(T,C,w,E,$,I,1,0,1,1,0,1,M)))}function J(e,t,n,i,r,o){G.beginPath(),G.moveTo(e,t),G.lineTo(n,i),G.lineTo(r,o),G.lineTo(e,t),G.closePath()}function K(e,t,n,i,r,o,a,s){G.beginPath(),G.moveTo(e,t),G.lineTo(n,i),G.lineTo(r,o),G.lineTo(a,s),G.lineTo(e,t),G.closePath()}function we(e,t,n,r){ee!=t&&(G.lineWidth=ee=t),te!=n&&(G.lineCap=te=n),ne!=r&&(G.lineJoin=ne=r),i(e.getContextStyle()),G.stroke(),ge.inflate(2*t)}function Ee(e){r(e.getContextStyle()),G.fill()}function Se(e,t,n,i,o,a,s,c,l,d,u,p,h){if(0!=h.image.width){if(1==h.needsUpdate||void 0==de[h.id]){var g=h.wrapS==THREE.RepeatWrapping,f=h.wrapT==THREE.RepeatWrapping;de[h.id]=G.createPattern(h.image,g&&f?"repeat":g&&!f?"repeat-x":!g&&f?"repeat-y":"no-repeat"),h.needsUpdate=!1}r(de[h.id]);var g=h.offset.x/h.repeat.x,f=h.offset.y/h.repeat.y,m=h.image.width*h.repeat.x,v=h.image.height*h.repeat.y,s=(s+g)*m,c=(c+f)*v,l=(l+g)*m,d=(d+f)*v,u=(u+g)*m,p=(p+f)*v;n-=e,i-=t,o-=e,a-=t,l-=s,d-=c,u-=s,p-=c,g=l*p-u*d,0==g?(void 0==ue[h.id]&&(t=document.createElement("canvas"),t.width=h.image.width,t.height=h.image.height,e=t.getContext("2d"),e.drawImage(h.image,0,0),ue[h.id]=e.getImageData(0,0,h.image.width,h.image.height).data,delete t),t=ue[h.id],s=4*(Math.floor(s)+Math.floor(c)*h.image.width),oe.setRGB(t[s]/255,t[s+1]/255,t[s+2]/255),Ee(oe)):(g=1/g,h=(p*n-d*o)*g,d=(p*i-d*a)*g,n=(l*o-u*n)*g,i=(l*a-u*i)*g,e=e-h*s-n*c,s=t-d*s-i*c,G.save(),G.transform(h,d,n,i,e,s),G.fill(),G.restore())}}function xe(e,t,n,i,r,o,a,s,c,l,d,u,p){var h,g;h=p.width-1,g=p.height-1,a*=h,s*=g,c*=h,l*=g,d*=h,u*=g,n-=e,i-=t,r-=e,o-=t,c-=a,l-=s,d-=a,u-=s,g=1/(c*u-d*l),h=(u*n-l*r)*g,l=(u*i-l*o)*g,n=(c*r-d*n)*g,i=(c*o-d*i)*g,e=e-h*a-n*s,t=t-l*a-i*s,G.save(),G.transform(h,l,n,i,e,t),G.clip(),G.drawImage(p,0,0),G.restore()}function Te(e,t,n,i){var r=~~(255*e.r),o=~~(255*e.g),e=~~(255*e.b),a=~~(255*t.r),s=~~(255*t.g),t=~~(255*t.b),c=~~(255*n.r),l=~~(255*n.g),n=~~(255*n.b),d=~~(255*i.r),u=~~(255*i.g),i=~~(255*i.b);return O[0]=0>r?0:r>255?255:r,O[1]=0>o?0:o>255?255:o,O[2]=0>e?0:e>255?255:e,O[4]=0>a?0:a>255?255:a,O[5]=0>s?0:s>255?255:s,O[6]=0>t?0:t>255?255:t,O[8]=0>c?0:c>255?255:c,O[9]=0>l?0:l>255?255:l,O[10]=0>n?0:n>255?255:n,O[12]=0>d?0:d>255?255:d,O[13]=0>u?0:u>255?255:u,O[14]=0>i?0:i>255?255:i,H.putImageData(U,0,0),j.drawImage(N,0,0),B}function Ce(e,t,n){return e=(e-t)/(n-t),e*e*(3-2*e)}function $e(e){return e=.5*(e+1),0>e?0:e>1?1:e}function Ie(e,t){var n=t.x-e.x,i=t.y-e.y,r=n*n+i*i;0!=r&&(r=1/Math.sqrt(r),n*=r,i*=r,t.x+=n,t.y+=i,e.x-=n,e.y-=i)}var Re,Pe,Me,_e;for(this.autoClear?this.clear():G.setTransform(1,0,0,-1,d,u),q.info.render.vertices=0,q.info.render.faces=0,o=X.projectScene(e,c,this.sortElements),a=o.elements,s=o.lights,(fe=s.length>0)&&l(s),Re=0,Pe=a.length;Pe>Re;Re++)Me=a[Re],_e=Me.material,_e=_e instanceof THREE.MeshFaceMaterial?Me.faceMaterial:_e,null==_e||0==_e.opacity||(ge.empty(),Me instanceof THREE.RenderableParticle?(p=Me,p.x*=d,p.y*=u,W(p,Me,_e,e)):Me instanceof THREE.RenderableLine?(p=Me.v1,h=Me.v2,p.positionScreen.x*=d,p.positionScreen.y*=u,h.positionScreen.x*=d,h.positionScreen.y*=u,ge.addPoint(p.positionScreen.x,p.positionScreen.y),ge.addPoint(h.positionScreen.x,h.positionScreen.y),pe.intersects(ge)&&Y(p,h,Me,_e,e)):Me instanceof THREE.RenderableFace3?(p=Me.v1,h=Me.v2,g=Me.v3,p.positionScreen.x*=d,p.positionScreen.y*=u,h.positionScreen.x*=d,h.positionScreen.y*=u,g.positionScreen.x*=d,g.positionScreen.y*=u,_e.overdraw&&(Ie(p.positionScreen,h.positionScreen),Ie(h.positionScreen,g.positionScreen),Ie(g.positionScreen,p.positionScreen)),ge.add3Points(p.positionScreen.x,p.positionScreen.y,h.positionScreen.x,h.positionScreen.y,g.positionScreen.x,g.positionScreen.y),pe.intersects(ge)&&Q(p,h,g,0,1,2,Me,_e,e)):Me instanceof THREE.RenderableFace4&&(p=Me.v1,h=Me.v2,g=Me.v3,f=Me.v4,p.positionScreen.x*=d,p.positionScreen.y*=u,h.positionScreen.x*=d,h.positionScreen.y*=u,g.positionScreen.x*=d,g.positionScreen.y*=u,f.positionScreen.x*=d,f.positionScreen.y*=u,ie.positionScreen.copy(h.positionScreen),re.positionScreen.copy(f.positionScreen),_e.overdraw&&(Ie(p.positionScreen,h.positionScreen),Ie(h.positionScreen,f.positionScreen),Ie(f.positionScreen,p.positionScreen),Ie(g.positionScreen,ie.positionScreen),Ie(g.positionScreen,re.positionScreen)),ge.addPoint(p.positionScreen.x,p.positionScreen.y),ge.addPoint(h.positionScreen.x,h.positionScreen.y),ge.addPoint(g.positionScreen.x,g.positionScreen.y),ge.addPoint(f.positionScreen.x,f.positionScreen.y),pe.intersects(ge)&&Z(p,h,g,f,ie,re,Me,_e,e)),he.addRectangle(ge));G.setTransform(1,0,0,1,0,0)}},THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.v4=new THREE.RenderableVertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.faceMaterial=this.material=null,this.uvs=[[]],this.z=null},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.material=null},Particle3D=function(e){THREE.Particle.call(this,e),this.velocity=new THREE.Vector3(0,(-8),0),this.velocity.rotateX(randomRange(-45,45)),this.velocity.rotateY(randomRange(0,360)),this.gravity=new THREE.Vector3(0,0,0),this.drag=1},Particle3D.prototype=new THREE.Particle,Particle3D.prototype.constructor=Particle3D,Particle3D.prototype.updatePhysics=function(){this.velocity.multiplyScalar(this.drag),this.velocity.addSelf(this.gravity),this.position.addSelf(this.velocity)};var TO_RADIANS=Math.PI/180;THREE.Vector3.prototype.rotateY=function(e){cosRY=Math.cos(e*TO_RADIANS),sinRY=Math.sin(e*TO_RADIANS);var t=this.z,n=this.x;this.x=n*cosRY+t*sinRY,this.z=n*-sinRY+t*cosRY},THREE.Vector3.prototype.rotateX=function(e){cosRY=Math.cos(e*TO_RADIANS),sinRY=Math.sin(e*TO_RADIANS);var t=this.z,n=this.y;this.y=n*cosRY+t*sinRY,this.z=n*-sinRY+t*cosRY},THREE.Vector3.prototype.rotateZ=function(e){cosRY=Math.cos(e*TO_RADIANS),sinRY=Math.sin(e*TO_RADIANS);var t=this.x,n=this.y;this.y=n*cosRY+t*sinRY,this.x=n*-sinRY+t*cosRY},function(e){function t(e,t,n,i){var r={},o=e/t,a=n/i;return o>a?(r.width=n,r.height=n/o):(r.height=i,r.width=i*o),r}function n(e,t){"view"==l.mode&&t.properties.url&&$(e).click(function(e){var n=t.properties.url;isNaN(n)?window.open(n):eqxiu.pageScroll(n)})}function i(e){$(e).bind("touchstart mousedown",function(e){e.stopPropagation()})}function r(e){e.focus(function(e){eqxiu.pauseAutoFlip()}).blur(function(e){$(document).trigger("startAutoFlip")})}function o(e){for(var t=$(e).find("a[data]"),n=0;n<t.length;n++)if(t[n]&&"view"==l.mode){$(t[n]).css("cursor","pointer");var i=$(t[n]).attr("data");!function(e){t[n].removeAttribute("href"),$(t[n]).click(function(t){eqxiu.pageScroll(e)})}(i)}}function a(e,t){if(t.trigger){var n=$(e);d&&clearTimeout(d),t.trigger.sends&&t.trigger.sends.length&&$.each(t.trigger.sends,function(e,t){n.bind(utilTrigger.getSendType(t.type).name,function(){d=setTimeout(function(){$.each(t.handles,function(e,t){var n=utilTrigger.getHandleType(t.type).name;$.each(t.ids,function(e,t){var i;i=$("#inside_"+t,".phone-view").length?$("#inside_"+t,".phone-view"):$("#inside_"+t),i.trigger(n)})})},1e3*t.delay)})})}}function c(e,t){if(t.sound){var n=$(e),i=$("#media").get(0);0==t.sound.src.indexOf("http://")?t.sound.src=t.sound.src:t.sound.src=PREFIX_FILE_HOST+t.sound.src,utilSound.addAudio(e,t.sound.src),n.click(function(){utilSound.play(e,function(){i&&i.play()},function(){i&&i.pause()})})}}var l=e.templateParser("jsonParser",function(){function e(e){return function(t,n){e[t]=n}}function t(e,t){try{var n=u[(""+e.type).charAt(0)](e)}catch(e){return}if(n){var i=$('<li comp-drag comp-rotate class="comp-resize comp-rotate inside" id="inside_'+e.id+'" num="'+e.num+'" ctype="'+e.type+'"></li>');if(3!=(""+e.type).charAt(0)&&1!=(""+e.type).charAt(0)&&i.attr("comp-resize",""),"p"==(""+e.type).charAt(0)&&i.removeAttr("comp-rotate"),1==(""+e.type).charAt(0)&&i.removeAttr("comp-drag"),2==(""+e.type).charAt(0)&&i.addClass("wsite-text"),"x"==(""+e.type).charAt(0)&&i.addClass("show-text"),4==(""+e.type).charAt(0)&&(e.properties.imgStyle&&$(n).css(e.properties.imgStyle),i.addClass("wsite-image")),"n"==(""+e.type).charAt(0)&&i.addClass("wsite-image"),"h"==(""+e.type).charAt(0)&&i.addClass("wsite-shape"),5==(""+e.type).charAt(0)&&i.addClass("wsite-input"),6==(""+e.type).charAt(0)&&i.addClass("wsite-button"),8==(""+e.type).charAt(0)&&i.addClass("wsite-button"),"v"==(""+e.type).charAt(0)&&i.addClass("wsite-video"),i.mouseenter(function(){$(this).addClass("inside-hover")}),i.mouseleave(function(){$(this).removeClass("inside-hover")}),"edit"==l.mode||"x"!=(""+e.type).charAt(0)){var r=$('<div class="element-box">').append($('<div class="element-box-contents">').append(n));i.append(r),5!=(""+e.type).charAt(0)&&6!=(""+e.type).charAt(0)&&"r"!=e.type&&"c"!=e.type&&"a"!=e.type&&"8"!=e.type&&"l"!=e.type&&"s"!=e.type&&"i"!=e.type&&"h"!=e.type||"edit"!=t||$(n).before($('<div class="element" style="position: absolute; height: 100%; width: 100%;z-index: 1;">'))}if(e.css){var o=320-parseInt(e.css.left);if(i.css({width:o}),i.css({width:e.css.width,height:e.css.height,left:e.css.left,top:e.css.top,zIndex:e.css.zIndex,bottom:e.css.bottom,transform:e.css.transform}),(0===e.css.boxShadowSize||"0"==e.css.boxShadowSize)&&(e.css.boxShadow="rgba(0,0,0,0) 0 0 0"),"edit"!=l.mode&&"x"==(""+e.type).charAt(0))return i.append(n),i.find(".element-box").css({borderStyle:e.css.borderStyle,borderWidth:e.css.borderWidth,borderColor:e.css.borderColor,borderTopLeftRadius:e.css.borderTopLeftRadius,borderTopRightRadius:e.css.borderTopRightRadius,borderBottomRightRadius:e.css.borderBottomRightRadius,borderBottomLeftRadius:e.css.borderBottomLeftRadius,boxShadow:e.css.boxShadow,backgroundColor:e.css.backgroundColor,opacity:e.css.opacity,width:"100%",height:"100%",overflow:"hidden"}),i.find("img").css({width:"100%"}),i;isAndroid()&&isWeixin()&&4==e.type&&"0px"!=e.css.borderRadius&&0==e.css.borderWidth&&e.properties.anim&&(e.css.borderWidth=1,e.css.borderColor="rgba(0,0,0,0)"),r.css(e.css).css({width:"100%",height:"100%",transform:"none"}),r.children(".element-box-contents").css({width:"100%",height:"100%"}),4!=(""+e.type).charAt(0)&&"n"!=(""+e.type).charAt(0)&&"p"!=(""+e.type).charAt(0)&&"h"!=(""+e.type).charAt(0)&&$(n).css({width:e.css.width,height:e.css.height}),"h"==(""+e.type).charAt(0)&&($(n).find("g").length?$(n).find("g").attr("fill",e.css.color):$(n).children().attr("fill",e.css.color),r.children(".element-box-contents").css("position","relative"))}return i}}function n(e){for(var t=0;t<e.length-1;t++)for(var n=t+1;n<e.length;n++)if(parseInt(e[t].css.zIndex,10)>parseInt(e[n].css.zIndex,10)){var i=e[t];e[t]=e[n],e[n]=i}for(var r=0;r<e.length;r++)e[r].css.zIndex=r+1+"";return e}function i(e,i,r){i=i.find(".edit_area");var o,s=e.elements;if(s)for(s=n(s),o=0;o<s.length;o++)if(s[o].sceneId=e.sceneId,3==s[o].type){var l=u[(""+s[o].type).charAt(0)](s[o],i);"edit"==r&&p[(""+s[o].type).charAt(0)]&&p[(""+s[o].type).charAt(0)](l,s[o])}else{var d=t(s[o],r);if(!d)continue;i.append(d);for(var f=0;f<g.length;f++)g[f](d,s[o],r);h[(""+s[o].type).charAt(0)]&&(h[(""+s[o].type).charAt(0)](d,s[o]),"edit"!=r&&(a(d,s[o]),c(d,s[o]))),"edit"==r&&p[(""+s[o].type).charAt(0)]&&p[(""+s[o].type).charAt(0)](d,s[o])}}function r(){return p}function o(){return u}function s(e){g.push(e)}function d(){return g}var u={},p={},h={},g=[],f=containerWidth=320,m=containerHeight=486,v=1,y=1,b={getComponents:o,getEventHandlers:r,addComponent:e(u),bindEditEvent:e(p),bindAfterRenderEvent:e(h),addInterceptor:s,getInterceptors:d,wrapComp:t,mode:"view",parse:function(e){var t=$('<div class="edit_wrapper" data-scene-id="'+e.def.sceneId+'"><ul eqx-edit-destroy id="edit_area'+e.def.id+'" comp-droppable paste-element class="edit_area weebly-content-area weebly-area-active"></div>'),n=this.mode=e.mode;this.def=e.def,"view"==n&&tplCount++;var r=$(e.appendTo);return containerWidth=r.width(),containerHeight=r.height(),v=f/containerWidth,y=m/containerHeight,i(e.def,t.appendTo($(e.appendTo)),n)}};return b});l.addInterceptor(function(e,t,n){eqxCommon.animation(e,t,n)}),l.addComponent("1",function(e){var t=document.createElement("div");if(t.id=e.id,t.setAttribute("class","element comp_title"),e.content&&(t.textContent=e.content),e.css){var n,i=e.css;for(n in i)t.style[n]=i[n]}if(e.properties.labels)for(var r=e.properties.labels,o=0;o<r.length;o++)$('<a class = "label_content" style = "display: inline-block;">').appendTo($(t)).html(r[o].title).css(r[o].color).css("width",100/r.length+"%");return t}),l.addComponent("2",function(e){var t=document.createElement("div");return t.id=e.id,t.setAttribute("ctype",e.type),t.setAttribute("class","element comp_paragraph editable-text"),e.content&&(t.innerHTML=e.content),t.style.cursor="default",t}),l.addComponent("x",function(e){var t;if(!mobilecheck()&&window.top==window&&$(".create_left").get(0)&&(l.mode="edit"),"edit"==l.mode)t=document.createElement("div"),t.id=e.id,t.setAttribute("ctype",e.type),t.setAttribute("class","element comp_paragraph editable-text"),e.content&&(t.innerHTML=e.content),t.style.cursor="default";else var t='<div class="element-box"><img src="'+e.properties.dataUrl+'"></div>';return t}),l.addComponent("j",function(e){var t;if(!mobilecheck()&&window.top==window&&$(".create_left").get(0)&&(l.mode="edit"),"edit"==l.mode)t=document.createElement("div"),t.id=e.id,t.setAttribute("ctype",e.type),t.setAttribute("class","element comp_paragraph editable-text"),e.content&&(t.innerHTML=e.content),t.style.cursor="default";else var t='<div class="element-box"><img src="'+e.properties.dataUrl+'"></div>';return t}),l.addComponent("3",function(e,t){var n,i=document.createElement("div");"edit"==l.mode?(n=t?t.parent(".edit_wrapper"):$("#nr .edit_wrapper"),i.setAttribute("class","wrapper-background"),i.setAttribute("id",e.id)):"view"==l.mode&&(n=t?t.parent(".edit_wrapper"):$("#edit_area"+l.def.id).parent(".edit_wrapper"),i.setAttribute("id","wrapper-background"+l.def.id)),$(i).prependTo(n).css({width:"100%",height:"100%"});var r,o=new Image;return e.properties.imgSrc?(r=e.properties.imgSrc,/^http.*!/.test(r)?(o.src=r,i.style.backgroundImage="url("+r+")"):(o.src=PREFIX_FILE_HOST+"/"+r,i.style.backgroundImage="url("+PREFIX_FILE_HOST+"/"+r+")"),i.style.backgroundOrigin="element content-box",i.style.backgroundSize="cover",i.style.backgroundPosition="50% 50%",e.effect&&("scaleUp"==e.effect.type?$(i).css({animation:"scaleUp 7s ease 1s","animation-fill-mode":"both"}):"scaleDown"==e.effect.type&&$(i).css({animation:"scaleDown 7s ease 1s","animation-fill-mode":"both"}))):e.properties.bgColor&&(i.style.backgroundColor=e.properties.bgColor),i}),l.addComponent("4",function(e){var t=document.createElement("img");return t.id=e.id,t.setAttribute("ctype",e.type),t.setAttribute("class","element comp_image editable-image"),/^http.*/.test(e.properties.src)?t.src=e.properties.src:t.src=PREFIX_FILE_HOST+e.properties.src,t}),l.addComponent("m",function(e){e.properties.src=e.properties.type;var t=document.createElement("img");return t.id=e.id,t.setAttribute("ctype",e.type),t.setAttribute("class","element comp_image editable-image"),t.src=e.properties.src,t}),l.addComponent("h",function(e){var t,n;if(e.properties.type.indexOf("symbol")<0){var t=document.createElementNS(eqxiuSvg.NAMESPACE,"svg");return t.id=e.id,t.setAttribute("class","element svg-element"),t.setAttribute("xmlns",eqxiuSvg.NAMESPACE),t.setAttribute("version","1.1"),t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("preserveAspectRatio","none"),n=eqxiuSvg.ShapeFromType(e.properties.type),n.setAttribute("fill","#555"),t.appendChild(n),s=eqxiuSvg.boundingBox(n),viewBox=[Math.round(s.x)||0,Math.round(s.y)||0,Math.round(s.width)||32,Math.round(s.height)||32].join(" "),t.setAttribute("viewBox",viewBox),t}return t=document.createElement("div"),n=eqxiuSvg.ShapeFromType(e.properties.type,100,100,e.id,e.css.color),t='<svg id="'+e.id+'" class="element svg-element" ctype="'+e.type+'" xmlns="'+eqxiuSvg.NAMESPACE+'" version="1.1" width="100%" height="100%" preserveAspectRatio="xMidYMid" viewBox="'+e.properties.viewBox+'">'+n+"</svg>"}),l.addComponent("v",function(e){var t=document.createElement("a");return console.log(66),t.setAttribute("class","element video_area"),t.id=e.id,t.setAttribute("ctype",e.type),e.properties.src&&t.setAttribute("videourl",e.properties.src),t}),l.addComponent("5",function(e){var t=document.createElement("textarea");return t.id=e.id,t.setAttribute("ctype",e.type),t.setAttribute("class","element comp_input editable-text"),t.setAttribute("maxlength","300"),e.properties.required&&t.setAttribute("required",e.properties.required),e.properties.placeholder&&t.setAttribute("placeholder",e.properties.placeholder),t.setAttribute("name","eq[f_"+e.id+"]"),t.style.width="100%",t}),l.addComponent("r",function(e){var t=$('<div class="element comp_radio editable-text" id="'+e.id+'"></div>');t.attr("ctype",e.type),t.attr("required",e.properties.required),t.attr("title",e.title),t.attr("name","eq[f_"+e.id+"]");var n=$('<div class="radio-title">'+e.title+"</div>");e.properties.titleStyle&&n.css(e.properties.titleStyle),t.append(n);var i=$('<div class="options"></div>'),r=JSON.parse(e.choices);return $.each(r.options,function(t,n){var o=$('<div class="option-group"><label class="option-label" for="'+(e.id+""+(t+1))+'"><input class="option" id="'+(e.id+""+(t+1))+'" type="radio" name="eq[f_'+e.id+']" value="'+n.id+'">'+n.label+"</label></div>");e.properties.optionStyle&&t<r.options.length-1&&o.css(e.properties.optionStyle),i.append(o)}),t.append(i),t.width("100%"),t.get(0)}),l.addComponent("c",function(e){var t=$('<div class="element comp_radio editable-text" id="'+e.id+'"></div>');t.attr("ctype",e.type),t.attr("required",e.properties.required),t.attr("title",e.title),t.attr("name","eq[f_"+e.id+"]");var n=$('<div class="radio-title">'+e.title+"(可多选)</div>");e.properties.titleStyle&&n.css(e.properties.titleStyle),t.append(n);var i=$('<div class="options"></div>'),r=JSON.parse(e.choices);return $.each(r.options,function(t,n){var o=$('<div class="option-group"><label class="option-label" for="'+(e.id+""+(t+1))+'"><input class="option" id="'+(e.id+""+(t+1))+'" type="checkbox" name="eq[f_'+e.id+']" value="'+n.id+'">'+n.label+"</label></div>");e.properties.optionStyle&&t<r.options.length-1&&o.css(e.properties.optionStyle),i.append(o)}),t.append(i),t.width("100%"),t.get(0)}),l.addComponent("a",function(e){var t=$('<div class="element comp_rating editable-text" id="'+e.id+'"></div>');t.attr("ctype",e.type),t.attr("required",e.properties.required),t.attr("title",e.title),t.attr("name","eq[f_"+e.id+"]"),t.append($('<div class="rating-title">'+e.title+"</div>"));for(var n=$('<div class="rating-icons"></div>'),i=0;5>i;i++)n.append($('<i class="'+e.properties.icon+"-line "+e.properties.size+'">').css("color",e.properties.color));return t.append(n),t.append($('<input type="hidden" name="eq[f_'+e.id+']" value="">')),t.width("100%"),t.get(0)}),l.addComponent("p",function(e){if(e.properties&&e.properties.children){var n=e.css.width,i=e.css.height,r=$('<div id="'+e.id+'" class="slider element" ctype="'+e.type+'"></div>');return e.properties.bgColor&&r.css("backgroundColor",e.properties.bgColor),$.each(e.properties.children,function(e,o){var a=t(o.width,o.height,n,i),s=$('<img src="'+PREFIX_FILE_HOST+o.src+'">');s.css({margin:(i-a.height)/2+"px "+(n-a.width)/2+"px",width:a.width,height:a.height}),r.append(s)}),utilPictures.deleteInterval(e.id),r.get(0)}}),l.addComponent("n",function(e){if(e.properties&&e.properties.pics.length){var t=(e.css.width,e.css.height,$('<div id="'+e.id+'" class="random-event element comp_image editable-image" ctype="'+e.type+'"></div>'));return $.each(e.properties.pics,function(e,n){var i=$('<img src="'+PREFIX_FILE_HOST+n.src+'">');i.css({width:"100%",height:"100%",display:"none"}),0===e&&(i.css({display:"block"}),t.css({width:"100%",height:"100%"})),t.append(i)}),t.get(0)}}),l.addComponent("6",function(e){var t=document.createElement("button");if(t.id=e.id,t.setAttribute("ctype",e.type),t.setAttribute("class","element comp_button editable-text"),e.properties.title){var n=e.properties.title.replace(/ /g,"&nbsp;");t.innerHTML=n}return t.style.width="100%",t}),l.addComponent("8",function(e){var t=document.createElement("a");t.id=e.id,t.setAttribute("ctype",e.type),t.setAttribute("class","element comp_anchor editable-text");var n=null;return e.properties.imgSrc?(n=$('<img style="width: 100%; height: 100%;" src="'+(PREFIX_FILE_HOST+e.properties.imgSrc)+'"></img>'),$(t).html(n),"view"==l.mode&&$(t).attr("href","tel:"+e.properties.number)):e.properties.title&&(n=e.properties.title.replace(/ /g,"&nbsp;"),$(t).html(n),"view"==l.mode&&$(t).attr("href","tel:"+e.properties.number)),t.style.cursor="default",t.style.width="100%",t}),l.addComponent("l",function(e){var t=document.createElement("a");t.id=e.id,t.setAttribute("ctype",e.type),t.setAttribute("class","element comp_anchor editable-text");var n=null;return e.properties.imgSrc?(n=$('<img style="width: 100%; height: 100%;" src="'+(PREFIX_FILE_HOST+e.properties.imgSrc)+'"></img>'),$(t).html(n)):e.properties.title&&(n=e.properties.title.replace(/ /g,"&nbsp;"),$(t).html(n)),t.style.cursor="default",t.style.width="100%",t}),l.addComponent("s",function(e){var t=document.createElement("a");t.id=e.id,t.setAttribute("ctype",e.type),t.setAttribute("class","element comp_anchor editable-text");var n=null;return e.properties.imgSrc?(n=$('<img style="width: 100%; height: 100%;" src="'+(PREFIX_FILE_HOST+e.properties.imgSrc)+'"></img>'),$(t).html(n)):e.properties.title&&(n=e.properties.title.replace(/ /g,"&nbsp;"),$(t).html(n)),t.style.cursor="default",t.style.width="100%",t}),l.addComponent("i",function(t){var n=$('<div class="element comp_counter not-voted editable-text" id="'+t.id+'"></div>');n.attr("ctype",t.type),n.attr("name","eq[f_"+t.id+"]"),n.addClass(t.properties.layout).addClass(t.properties.size);var i=$('<div class="counter-container"></div>');t.properties.imgSrc?i.append($('<img class="counter-elem counter-icon" style="width: 115px; height: 115px; margin: 0 auto;" src="'+(PREFIX_FILE_HOST+t.properties.imgSrc)+'"></img>')):i.append($('<i class="counter-elem counter-icon '+t.properties.icon+'">').css("color",t.properties.color));var r=$('<span class="counter-elem counter-number">0</span>').css("color",t.properties.color);if(i.append(r),"view"==l.mode?e.counterValues&&e.counterValues.then(function(n){var i=n.map[t.id]||0;r.attr("data-counter-number",i);var o=e.fixedNum(i);r.text(o)}):n.removeClass("not-voted"),n.width("100%"),"counter-tb"===t.properties.layout){var o=0;o=t.properties.imgSrc?"counter-l"==t.properties.size?77:"counter-m"==t.properties.size?71:66:"counter-l"==t.properties.size?40:"counter-m"==t.properties.size?30:20,i.css("margin-top",-o)}return"edit"!=l.mode&&setTimeout(function(){var e={width:"auto","min-width":t.css.width};n.css(e),n.parents("li.comp-resize").css(e)},100),n.append(i),t.css.lineHeight&&n.css("line-height",t.css.lineHeight),n.get(0)}),l.addComponent("d",function(t){var n=$('<div class="element comp_counter editable-text" id="'+t.id+'"></div>');n.attr("ctype",t.type),n.addClass(t.properties.layout).addClass(t.properties.size);var i=$('<div class="counter-container"></div>');i.append($('<i class="counter-elem counter-icon '+t.properties.icon+'">').css("color",t.properties.color));var r=$('<span class="counter-elem counter-number">0</span>').css("color",t.properties.color);if(i.append(r),"view"==l.mode&&e.showCount&&e.showCount.then(function(t){var n=e.fixedNum(t),i=n||0;r.text(i)}),n.width("100%"),"counter-tb"===t.properties.layout){var o=0;o="counter-l"==t.properties.size?40:"counter-m"==t.properties.size?30:20,i.css("margin-top",-o)}return n.append(i),t.css.lineHeight&&n.css("line-height",t.css.lineHeight),n.get(0)}),l.addComponent("7",function(e){var t=document.createElement("div");if(t.id="map_"+e.id,t.setAttribute("class","element comp_map_wrapper"),e.content&&(t.textContent=e.content),e.css){var n,i=e.css;for(n in i)t.style[n]=i[n]}return t.style.height="250px",t}),l.bindAfterRenderEvent("1",function(e,t){if(e=$("div",e)[0],"view"==l.mode&&1==t.type){var n=t.properties.labels;for(key in n)!function(t){$($(e).find(".label_content")[t]).on("click",function(){pageScroll(n[t])})}(key)}}),l.bindAfterRenderEvent("8",function(e,t){e=$("a",e)[0];var n={id:t.sceneId,num:t.properties.number};if("view"==l.mode){var i=function(){$.ajax({cache:!0,type:"POST",url:PREFIX_S1_URL+"eqs/dial",data:$.param(n),async:!1,error:function(e){layer.alert("Connection error")},success:function(e){}})};e.addEventListener("click",i)}}),l.bindAfterRenderEvent("l",function(e,t){if(e=$("a",e)[0],"view"==l.mode){var n=t.properties.url;$(e).click(function(e){isNaN(n)?window.open(n):eqxiu.pageScroll(n)})}}),l.bindAfterRenderEvent("s",function(e,t){e=$("a",e)[0],"view"==l.mode&&$(e).click(function(e){})}),l.bindAfterRenderEvent("i",function(t,n){if("view"==l.mode){var i=$(t).find(".counter-icon");i.click(function(r){var o={sceneId:n.sceneId,fieldId:n.id},a=$(t);$.ajax({cache:!0,type:"POST",url:PREFIX_S1_URL+"index.php?c=scene&a=counter",data:$.param(o),async:!1,error:function(e){layer.alert("Connection error")},success:function(t){i.unbind("click"),a.find(".comp_counter").removeClass("not-voted");var n=$(".counter-number",a),r=(parseInt(n.attr("data-counter-number"),10)||0)+1;n.attr("data-counter-number",r);var o=e.fixedNum(r);$(".counter-number",a).text(o)}})})}}),l.bindAfterRenderEvent("4",function(e,t){n(e,t)}),l.bindAfterRenderEvent("m",function(e,t){n(e,t)}),l.bindAfterRenderEvent("x",function(e,t){n(e,t)}),l.bindAfterRenderEvent("n",function(e,t){}),l.bindAfterRenderEvent("h",function(e,t){"view"==l.mode&&t.properties.url&&$(e).click(function(e){var n=t.properties.url;isNaN(n)?window.open(n):eqxiu.pageScroll(n)})}),l.bindAfterRenderEvent("5",function(e,t){var n=mobilecheck();i($(e).find("textarea")),r($(e).find("textarea")),"view"==l.mode&&n&&parseFloat(t.css.top)>=200&&($(e).find("textarea").focus(function(t){$(e).closest(".edit_area").css({top:"-150px"})}),$(e).find("textarea").blur(function(t){$(e).closest(".edit_area").css({top:0})}))}),l.bindAfterRenderEvent("r",function(e,t){"view"==l.mode&&i($(e).find("label"))}),l.bindAfterRenderEvent("c",function(e,t){"view"==l.mode&&i($(e).find("label"))}),l.bindAfterRenderEvent("v",function(e,t){"view"==l.mode&&$(e).click(function(){$(e).hide(),$("#audio_btn").hasClass("video_exist")&&($("#audio_btn").hide(),$("#media")[0].pause()),utilSound.pause(),$('<div class="video_mask page_effect lock" id="mask_'+t.id+'"></div>').appendTo($(e).closest(".m-img")),$('<a class = "close_mask" id="close_'+t.id+'"></a>').appendTo($(e).closest(".m-img")),$(t.properties.src).appendTo($("#mask_"+t.id)).attr("style","position: absolute;top:0; min-height: 45%; max-height: 100%; top: 20%;").attr("width","100%").removeAttr("height"),$("#close_"+t.id).bind("click",function(){$(e).show(),$("#mask_"+t.id).remove(),$("#close_"+t.id).remove(),$("#audio_btn").hasClass("video_exist")&&$("#audio_btn").show(function(){$("#media")[0].play()})})})}),l.bindAfterRenderEvent("2",function(e,t){o(e)}),l.bindAfterRenderEvent("6",function(e,t){if(e=$("button",e)[0],"view"==l.mode){var n={REQUIRED:"为必填项！",WRONG_PHONE_NUMBER_FORMAT:"手机号码格式错误！",WRONG_EMAIL_FORMAT:"邮箱格式错误！",FILL_OUT_THE_FORM:"请填写表单！",DUPLICATED_SUBMISSION:"请不要重复提交！",THANKS_FOR_PARTICIPATION:"您提交的信息已经咻咻地跑到我们的数据库啦！灰常感谢您的参与呐~！"},i=function(e,t,i){var r=!0,o={};if($("textarea",i).each(function(){if(r){if("required"==$(this).attr("required")&&""==$(this).val().trim())return layer.alert($(this).attr("placeholder")+n.REQUIRED),void(r=!1);if("502"==$(this).attr("ctype")&&""!==$(this).val().trim()){var e=new RegExp(/(\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$/g);if(!e.test($(this).val()))return layer.alert("手机号码格式错误！"),void(r=!1)}if("503"==$(this).attr("ctype")&&""!==$(this).val().trim()){var t=new RegExp(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/g);if(!t.test($(this).val()))return layer.alert("邮箱格式错误！"),void(r=!1)}o[$(this).attr("name")]=$(this).val()}}),$("input:checked",i).each(function(){var e=$(this);o[e.attr("name")]?o[e.attr("name")]+=","+e.val():o[e.attr("name")]=e.val()}),$('.comp_radio[required="required"]',i).each(function(){var e=$(this);o[e.attr("name")]||(alert(e.attr("title")+n.REQUIRED),r=!1)}),$('input[type="hidden"]',i).each(function(){o[$(this).attr("name")]=$(this).val()}),$('.comp_rating[required="required"]',i).each(function(){var e=$(this);o[e.attr("name")]&&"0"!=o[e.attr("name")]||(alert(e.attr("title")+"为必填项！"),r=!1)}),r){var a=!1;if($.isEmptyObject(o))return void(a=!0);for(var s in o)if(""!==o[s]){a=!0;break}return a?void $.ajax({cache:!0,type:"POST",url:PREFIX_S1_URL+"eqs/r/"+t,data:$.param(o),async:!1,error:function(e){layer.alert("Connection error")},success:function(t){$(e).unbind("click").click(function(){layer.alert("请不要重复提交！")}),layer.alert("您提交的信息已经咻咻地跑到我们的数据库啦！灰常感谢您的参与呐~！")}}):void layer.alert("请填写表单！")}};l.def.sceneId,$(e).bind("click",function(){var t,n=$(e).parents(".edit_wrapper").attr("data-scene-id");t=n?$(e).parents(".nr").find('.edit_wrapper[data-scene-id="'+n+'"]'):$(e).parents(".nr"),i(this,n,t)})}}),l.bindAfterRenderEvent("7",function(e,t){var n=new BMap.Map("map_"+t.id,{enableMapClick:!1}),i=new BMap.Point(t.properties.x,t.properties.y),r=new BMap.Marker(i);n.addOverlay(r);var o=new BMap.Label(t.properties.markTitle,{offset:new BMap.Size(20,(-10))});r.setLabel(o),n.disableDoubleClickZoom(),n.centerAndZoom(i,15)}),l.bindAfterRenderEvent("p",function(e,t){if(!$(e).closest(".page_tpl_container ").length){$(e).children(".element-box").css("overflow","visible"),utilPictures.deleteInterval(t.id);var n=$(e).find("#"+t.id);new flux.slider(n,{autoplay:t.properties.autoPlay,delay:t.properties.interval,pagination:!1,transitions:[utilPictures.getPicStyle(t.properties.picStyle).name],width:t.css.width,height:t.css.height,bgColor:t.properties.bgColor,onStartEnd:function(e){utilPictures.addInterval(t.id,e)}})}}),l.bindAfterRenderEvent("a",function(e,t){
function n(e){o.each(function(t,n){$(n).removeClass(s).addClass(s+"-line"),e>=t&&$(n).removeClass(s+"-line").addClass(s)})}var r=$(e);if("view"==l.mode){var o=r.find("i"),a=r.find("input"),s=t.properties.icon;o.each(function(e,t){$(t).bind("click",function(){n(e),a.val(e+1)}),$(t).bind("mouseenter",function(){n(e)})}),r.find(".rating-icons").bind("mouseleave",function(){n(parseInt(a.val(),10)-1)}),i(r.find(".rating-icons"))}});var d}(window.eqShow),function(){eqShow.shakeTrigger=function(e,t){function n(e){var t=e.accelerationIncludingGravity,r=(new Date).getTime();if(r-l>100){var h=parseInt(r-l);l=r,o=t.x,a=t.y,s=t.z;var g=Math.abs(o+a+s-d-u-p)/h*1e4;g>c&&(window.removeEventListener("devicemotion",n,!0),i.sends&&i.sends.length&&$.each(i.sends,function(e,t){time=setTimeout(function(){$.each(t.handles,function(e,t){var n=utilTrigger.getHandleType(t.type).name;$.each(t.ids,function(e,t){var i=$("#inside_"+t);i.trigger(n)})})},1e3*t.delay)})),d=o,u=a,p=s}}var i,r=$(t).find(".m-img").attr("id").substring(4);if(e[r-1].properties&&(i=e[r-1].properties.trigger),i&&i.sends){var o,a,s,c=3e3,l=0,d=0,u=0,p=0;window.DeviceMotionEvent&&t&&window.addEventListener("devicemotion",n,!1)}}}(),function(e){function t(){var e={"Allura-Regular":{value:1,familyName:"Allura-Regular",src:"assets/images/fonts/Allura-Regular.png",blueSrc:"assets/images/fonts/Allura-Regular_blue.png"},"Amaranth-Regular":{value:2,familyName:"Amaranth-Regular",src:"assets/images/fonts/Amaranth-Regular.png",blueSrc:"assets/images/fonts/Amaranth-Regular_blue.png"},"Anton-Regular":{value:3,familyName:"Anton-Regular",src:"assets/images/fonts/Anton-Regular.png",blueSrc:"assets/images/fonts/Anton-Regular_blue.png"},"Arial-Regular":{value:4,familyName:"Arial-Regular",src:"assets/images/fonts/Arial-Regular.png",blueSrc:"assets/images/fonts/Arial-Regular_blue.png"},"Arialnarrow-Regular":{value:5,familyName:"Arialnarrow-Regular",src:"assets/images/fonts/Arialnarrow-Regular.png",blueSrc:"assets/images/fonts/Arialnarrow-Regular_blue.png"},"Arialroundedmtbold-Regular":{value:6,familyName:"Arialroundedmtbold-Regular",src:"assets/images/fonts/Arialroundedmtbold-Regular.png",blueSrc:"assets/images/fonts/Arialroundedmtbold-Regular_blue.png"},"Banglasangammn-Regular":{value:7,familyName:"Banglasangammn-Regular",src:"assets/images/fonts/Banglasangammn-Regular.png",blueSrc:"assets/images/fonts/Banglasangammn-Regular_blue.png"},"Blackopsone-Regular":{value:8,familyName:"Blackopsone-Regular",src:"assets/images/fonts/Blackopsone-Regular.png",blueSrc:"assets/images/fonts/Blackopsone-Regular_blue.png"},"Bradleyhand-Bold":{value:9,familyName:"Bradleyhand-Bold",src:"assets/images/fonts/Bradleyhand-Bold.png",blueSrc:"assets/images/fonts/Bradleyhand-Bold_blue.png"},"Cabinsketch-Bold":{value:10,familyName:"Cabinsketch-Bold",src:"assets/images/fonts/Cabinsketch-Bold.png",blueSrc:"assets/images/fonts/Cabinsketch-Bold_blue.png"},songti:{value:11,familyName:"宋体",src:"assets/images/fonts/songti.png",blueSrc:"assets/images/fonts/songti_blue.png"},songti:{value:12,familyName:"宋体",src:"assets/images/fonts/songti.png",blueSrc:"assets/images/fonts/songti_blue.png"},weiruanyahei:{value:12,familyName:"微软雅黑",src:"assets/images/fonts/weiruanyahei.png",blueSrc:"assets/images/fonts/weiruanyahei_blue.png"},mnjbwks:{value:13,familyName:"迷你简笔魏楷书",src:"assets/images/fonts/mnjbwks.png",blueSrc:"assets/images/fonts/mnjbwks_blue.png"},hzgb:{value:17,familyName:"汉真广标",src:"assets/images/fonts/hzgb.png",blueSrc:"assets/images/fonts/hzgb_blue.png"},changyi:{value:18,familyName:"迷你简长艺",src:"assets/images/fonts/changyi.png",blueSrc:"assets/images/fonts/changyi_blue.png"}};this.getFontName=function(t){if(t===undefined)return e;for(var n in e)if(t===n)return e[n];return null}}e.utilFont=new t}(window),function(e){function t(){var e={};this.addInterval=function(t,n){e[t]=n},this.deleteInterval=function(t){e[t]&&(clearInterval(e[t]),delete e[t])},this.clearInterval=function(){for(var t in e)this.deleteInterval(t)};var t=[{value:1,desc:"轮播",name:"slide"},{value:2,desc:"下落",name:"bars"},{value:3,desc:"百页窗",name:"blinds"},{value:4,desc:"消隐",name:"blocks"},{value:5,desc:"渐变",name:"blocks2"},{value:9,desc:"梳理",name:"zip"},{value:11,desc:"翻转",name:"bars3d"},{value:13,desc:"立方体",name:"cube"},{value:14,desc:"棋盘",name:"tiles3d"},{value:16,desc:"飞出",name:"explode"}];this.getPicStyle=function(e){if(e===undefined)return t;for(var n=0;n<t.length;n++)if(e===t[n].value)return t[n]}}e.utilPictures=new t}(window),function(e,t){function n(){var e,n,i,r=[];t("#media"),this.addAudio=function(e,o){var a=new Audio;a.src=o,r.push({elem:e,audio:a}),t(a).bind("ended",function(){n=!1,i()})},this.play=function(t,o,a){var s;i=o;for(var c=0;c<r.length;c++)r[c].elem==t&&(s=r[c].audio);e==s&&n?(s.pause(),n=!1,o()):e!=s||n?(e&&e.pause(),s.currentTime=0,s.play(),a(),n=!0,e=s):(s.play(),n=!0,a())},this.pause=function(){e&&(e.pause(),n=!1)}}e.utilSound=new n}(window,$),function(e){function t(){var e={CLICK:{name:"click",value:1,title:"点击"},SHAKE:{name:"shake",value:2,title:"摇一摇"}},t={SHOW:{name:"show",value:1},HIDE:{name:"hide",value:2},RANDOMEVENT:{name:"randomEvent",value:3}};this.getSendType=function(t){if(t===undefined)return e;for(var n in e)if(t===e[n].value)return e[n];return null},this.getHandleType=function(e){if(e===undefined)return t;for(var n in t)if(e===t[n].value)return t[n];return null}}e.utilTrigger=new t}(window);var tplCount=0,eqxCommon=function(){var e=function(e){var t,n,i=e.type;return 0===i&&(t="fadeIn"),1===i&&(n=e.direction,0===n&&(t="fadeInLeft"),1===n&&(t="fadeInDown"),2===n&&(t="fadeInRight"),3===n&&(t="fadeInUp")),6===i&&(t="wobble"),5===i&&(t="rubberBand"),7===i&&(t="rotateIn"),8===i&&(t="flip"),9===i&&(t="swing"),2===i&&(n=e.direction,0===n&&(t="bounceInLeft"),1===n&&(t="bounceInDown"),2===n&&(t="bounceInRight"),3===n&&(t="bounceInUp")),3===i&&(t="bounce"),4===i&&(t="zoomIn"),10===i&&(t="fadeOut"),11===i&&(t="flipOutY"),12===i&&(t="rollIn"),13===i&&(t="lightSpeedIn"),14===i&&(t="bounceOut"),15===i&&(t="rollOut"),16===i&&(t="lightSpeedOut"),17===i&&(n=e.direction,0===n&&(t="fadeOutRight"),1===n&&(t="fadeOutDown"),2===n&&(t="fadeOutLeft"),3===n&&(t="fadeOutUp")),18===i&&(t="zoomOut"),19===i&&(n=e.direction,0===n&&(t="bounceOutRight"),1===n&&(t="bounceOutDown"),2===n&&(t="bounceOutLeft"),3===n&&(t="bounceOutUp")),20===i&&(t="flipInY"),21===i&&(t="tada"),22===i&&(t="jello"),23===i&&(t="flash"),24===i&&(t="flipInX"),25===i&&(t="flipOutX"),t},t=function(e,t,n){function i(e,t,o){o.length&&r<o.length&&(e.css("animation",""),e.get(0),e.css("animation",t[r]+" "+o[r].duration+"s ease "+o[r].delay+"s "+(o[r].countNum?o[r].countNum:"")),"view"==n?(o[r].count&&r==o.length-1&&e.css("animation-iteration-count","infinite"),e.css("animation-fill-mode","both")):(e.css("animation-iteration-count","1"),e.css("animation-fill-mode","backwards")),o[r].linear&&e.css("animation-timing-function","linear"),e.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){r++,i(e,t,o)}))}var r=0;if(t.properties&&t.properties.anim){var o=[];t.properties.anim.length?o=t.properties.anim:o.push(t.properties.anim);var a=$(".element-box",e);a.attr("element-anim","");for(var s,c=[],l=[],d=0,u=o.length;u>d;d++)null!=o[d].type&&-1!=o[d].type&&(s=eqxCommon.convertType(o[d]),c.push(s),l.push(o[d]));t.properties.anim.trigger?e.click(function(){i(a,s,t.properties.anim)}):i(a,c,l)}},n=function(e,t){var n=$(e);t.trigger&&t.trigger.receives&&t.trigger.receives.length&&$.each(t.trigger.receives,function(e,i){if(i.ids.length){var r=utilTrigger.getHandleType(i.type).name;("show"==r||"randomEvent"==r)&&n.hide(),"hide"==r&&n.show(),n.bind(r,function(){if("show"==r)$(this).show();else if("hide"==r)$(this).hide();else if("randomEvent"==r){$(this).show();var e=Math.floor(Math.random()*t.properties.pics.length);$(this).find("img").css({display:"none"}),$(this).find("img").eq(e).css({display:"block"})}})}})},i=function(){var e,t,n=window.navigator,i=["language","browserLanguage","systemLanguage","userLanguage"];if($.isArray(n.languages))for(e=0;e<n.languages.length;e++)if(t=n.languages[e],t&&t.length)return t;for(e=0;e<i.length;e++)if(t=n[i[e]],t&&t.length)return t;return null};return{convertType:e,animation:t,bindTrigger:n,getFirstBrowserLanguage:i}}();eqShow.getShowCount=function(e){return this.showCount=$.ajax({type:"GET",url:PREFIX_S1_URL+"index.php?c=scene&a=view&id="+e,xhrFields:{withCredentials:!0},error:function(e){layer.alert("Connection error")},crossDomain:!0}),this.showCount},eqShow.fixedNum=function(e){var t;return 1e4>e?t=e:e>=1e4&&1e8>e?t=(e/1e4).toFixed(2)+"万":e>=1e8&&(t=(e/1e8).toFixed(2)+"亿"),t},eqShow.showProgressBar=function(e,t,n){if(e.obj.property.slideNumber){var i=$('<div class="progress"></div>'),r=$("<span></span>"),o=$('<em class="page-tip"></em>');i.append(r).append(o),n&&e.obj.property.slideDisplay?n.append(i.css("display",e.obj.property.slideDisplay)):$("#nr").append(i.css("display","block"))}var a=function(){e.obj.property.slideNumber&&r&&setTimeout(function(){var e=$(".z-active").get(0)?$(".z-active").get(0):$(".z-current").get(0);if(e){var n=$(e).find(".m-img").attr("id").substring(4),a=t.length,s=n/a,c=100;o.text(n+"/"+a),r.css("width",parseFloat(i.width())*s),$(e).find(".lock").length&&(c=0),i.css("z-index",c)}},100)};a(),t.eq(0).find(".u-arrow-bottom").css("bottom","30px"),eqShow.progressInterval=setInterval(function(){a()},300)},eqShow.selectElement=function(e){var t;return t=$("#inside_"+e,".phone-view").length?$("#inside_"+e,".phone-view"):$("#inside_"+e)},angular.module("active",["services.active"]),angular.module("active").controller("ActiveCtrl",["$rootScope","$http","$scope","$timeout","security","$window","activeService","MineService","$routeParams",function(e,t,n,i,r,o,a,s,c){n.PREFIX_FILE_HOST=PREFIX_FILE_HOST,n.PREFIX_SERVER_HOST=PREFIX_URL,n.PREFIX_CLIENT_HOST=PREFIX_HOST}]),angular.module("app",["ngRoute","home","sample","active","show","main","spread","reg","scenePreview","scene","data.edit","error","usercenter","message","invitation","ui.bootstrap","ui.grid","ui.grid.selection","ngSanitize","ui.select","services.i18nNotifications","services.httpRequestTracker","services.sample","services.active","services.config","services.configSer","services.dataCache","security","app.upload","templates-app","templates-common","ui.sortable","I18N.MESSAGES","app.directives.keymap","app.directives.notification","active1","activeXq","search","category","nav","recommend","visitor","visitorXq","pascalprecht.translate","common.directives.dropDown"]),angular.module("app").config(["$routeProvider","$locationProvider","securityAuthorizationProvider","uiSelectConfig","$translateProvider","$provide","$httpProvider",function(e,t,n,i,r,o,a){i.theme="bootstrap",e.when("/home",{feedBackUrl:"http://e.wesambo.com/v-vk2Ucz15",templateUrl:"home/home.tpl.html",controller:"HomeCtrl"}).when("/home/:id",{feedBackUrl:"http://e.wesambo.com/v-vk2Ucz15",templateUrl:"home/home.tpl.html",controller:"HomeCtrl"}).when("/reg",{templateUrl:"reg/reg.tpl.html",controller:"RegCtrl"}).when("/otherRegister",{templateUrl:"common/security/register/otherRegister.tpl.html"}).when("/agreement",{templateUrl:"reg/agreement.tpl.html"}).when("/about",{templateUrl:"about.tpl.html"}).when("/error/:codeid",{templateUrl:"error/error.tpl.html",controller:"ErrorCtrl"}).when("/sample",{templateUrl:"sample/sample.tpl.html",controller:"SampleCtrl"}).when("/active",{templateUrl:"active/active.tpl.html",controller:"ActiveCtrl"}).when("/main",{feedBackUrl:"http://e.wesambo.com/v-2qFiYzrc",templateUrl:"main/main.tpl.html",controller:"MainCtrl",resolve:{authenticatedUser:n.requireAuthenticatedUser}}).when("/spread/:tab/:sceneId",{feedBackUrl:"http://e.wesambo.com/v-euMcJX7J",templateUrl:"spread/spread.tpl.html",controller:"SpreadCtrl",reloadOnSearch:!0,resolve:{authenticatedUser:n.requireAuthenticatedUser}}).when("/spread/:tab/:sceneId/:subtab",{templateUrl:"spread/spread.tpl.html",controller:"SpreadCtrl",reloadOnSearch:!0,resolve:{authenticatedUser:n.requireAuthenticatedUser}}).when("/main/customer",{feedBackUrl:"http://e.wesambo.com/v-zJuTC6jT",templateUrl:"main/customer.tpl.html",controller:"CustomerCtrl",resolve:{authenticatedUser:n.requireAuthenticatedUser}}).when("/main/customer/:sceneId",{templateUrl:"data/editData.tpl.html",controller:"EditDataCtrl",resolve:{authenticatedUser:n.requireAuthenticatedUser}}).when("/scene",{templateUrl:"scene/scene.tpl.html",controller:"SceneCtrl",resolve:{authenticatedUser:n.requireAuthenticatedUser}}).when("/scene/create/:sceneId",{templateUrl:"scene/create.tpl.html",controller:"CreateSceneCtrl",reloadOnSearch:!1,resolve:{authenticatedUser:n.requireAuthenticatedUser}}).when("/scene/support/",{templateUrl:"scene/support/support.tpl.html",controller:"SupportCtrl",reloadOnSearch:!1}).when("/scene/preview/:sceneId",{feedBackUrl:"http://e.wesambo.com/v-QblumX2x",templateUrl:"my/myscene.tpl.html",controller:"MySceneCtrl",reloadOnSearch:!1}).when("/usercenter/:id",{feedBackUrl:"http://e.wesambo.com/v-eWdpV5XU",templateUrl:"usercenter/usercenter.tpl.html",controller:"UserCenterCtrl",resolve:{authenticatedUser:n.requireAuthenticatedUser}}).when("/message",{templateUrl:"usercenter/message.tpl.html",controller:"MessageCtrl",resolve:{authenticatedUser:n.requireAuthenticatedUser}}).when("/invitation",{templateUrl:"usercenter/console/invitation.tpl.html",controller:"InvitationCtrl",resolve:{authenticatedUser:n.requireAuthenticatedUser}}).when("/show",{templateUrl:"show/index.tpl.html",controller:"ShowCtrl"}).when("/show/active",{templateUrl:"show/active/active.tpl.html",controller:"Active1Ctrl"}).when("/show/active/:id",{templateUrl:"show/active/active-xq.tpl.html",controller:"ActiveXqCtrl"}).when("/show/search/:name",{templateUrl:"show/search/search.tpl.html",controller:"SearchCtrl"}).when("/show/category/:id",{templateUrl:"show/category/category.tpl.html",controller:"CategoryCtrl"}).when("/show/recommend",{templateUrl:"show/recommend/recommend.tpl.html",controller:"RecommendCtrl"}).when("/show/visitor",{templateUrl:"show/visitor/visitor.tpl.html",controller:"VisitorCtrl"}).when("/show/visitor/:id",{templateUrl:"show/visitor/visitor-xq.tpl.html",controller:"VisitorXqCtrl"}).when("/privilege",{templateUrl:"usercenter/tab/privilege.tpl.html",controller:"PrivilegeCtrl"}).otherwise({redirectTo:"/home"}),r.useStaticFilesLoader({prefix:CLIENT_CDN+"assets/languages/",suffix:".json"});var s="zh-CN";"en-US"==s&&$(document.body).addClass("en"),r.preferredLanguage(s),a.interceptors.push(["$translate","$rootScope",function(e,t){var n=s.replace("-","_");return t.$on("$translateChangeSuccess",function(){n=e.use(),n&&(n=n.replace("-","_"))}),{request:function(e){return n&&(e.headers["Accept-Language"]=n),e||$q.when(e)},response:function(e){return e||$q.when(e)}}}])}]),angular.module("app").run(["security","$rootScope","configService","$anchorScroll","$location","usercenterService",function(e,t,n,i,r,o){t.CLIENT_CDN=CLIENT_CDN,t.PREFIX_FILE_HOST=PREFIX_FILE_HOST,t.PREFIX_SERVER_HOST=PREFIX_URL,t.PREFIX_CLIENT_HOST=PREFIX_HOST,t.PREFIX_S3_URL=PREFIX_S3_URL,e.requestCurrentUser(),n.getLogo().then(function(e){try{t.logoSrc=e.data}catch(e){t.logoSrc=CLIENT_CDN+"assets/images/logo.png"}},function(){t.logoSrc=CLIENT_CDN+"assets/images/logo.png"}),t.load2=function(){$("#eq_main").scroll(function(){s=$("#eq_main").scrollTop(),s>100?$(".scroll").css("display","block"):$(".scroll").css("display","none")})},t.appIconDown=!0,t.downApp=function(){t.appIconDown=!1},t.closeDown=function(){t.appIconDown=!0},t.appIconDown=!0,t.downApp=function(){t.appIconDown=!1},t.closeDown=function(){t.appIconDown=!0},t.appIconDown=!0,t.downApp=function(){t.appIconDown=!1},t.closeDown=function(){t.appIconDown=!0},t.goTop=function(){$("#eq_main").scrollTop(0)},t.$on("$routeChangeSuccess",function(e,n){n.$$route&&(t.feedBackUrl=n.$$route.feedBackUrl)})}]),angular.module("app").run(["$route","$rootScope","$location",function(e,t,n){t.$on("$locationChangeStart",function(){t.branchid&&n.search("branchid",t.branchid),$(".modal").remove(),$(".modal-backdrop").remove()});var i=n.path;n.path=function(r,o){if(o===!1)var a=e.current,s=t.$on("$locationChangeSuccess",function(){e.current=a,s()});return i.apply(n,[r])}}]),angular.module("app").controller("AppCtrl",["$translate","SpreadService","$window","$scope","$rootScope","$location","$route","$modal","security","sceneService","$routeParams","$timeout","i18nNotifications","usercenterService","thirdpartyService","$modalStack",function(e,t,n,i,r,o,a,s,c,l,d,u,p,h,g,f){function m(){return sessionStorage.getItem("sysMsgHasRead")}function v(e,t,n,i){h.getNewMessage(e,t,n,i).then(function(e){i?(r.sysMsgs=e.data.list,r.sysNewCount=e.data.map.count):(r.newMsgs=e.data.list,r.newMsgCount=e.data.map.count>9?"9+":e.data.map.count)})}i.openSysMsg=!1,i.openSysMsgDialog=!m(),i.closeSysMsgDialog=function(){i.openSysMsgDialog=!i.openSysMsgDialog,sessionStorage.setItem("sysMsgHasRead","true")},i.notifications=p,i.removeNotification=function(e){p.remove(e)},n.setValue=function(e){i.thirdpartyLoginParam=e,i.$apply()},i.$watch("thirdpartyLoginParam",function(e,t){e&&(e.state&&/WECHAT_STATE/.test(e.state)?g.weiChatLogin(e.code).then(function(e){200==e.data.code&&(o.path("main"),c.setLoginSuccess(!0))}):g.qqLogin(e.access_token,e.expires_in))}),i.$on("$locationChangeStart",function(e){if("/home/login"!=o.path()||c.currentUser?0!==o.path().indexOf("/home/register")||c.currentUser||c.showRegister(y):c.showLogin(),c.isAuthenticated()&&("/home"==o.path()||"/home/login"==o.path())&&o.path("main"),o.search().resetToken){var t=o.search().resetToken;c.requestResetPassword(t)}var n=f.getTop();n&&f.dismiss(n.key)}),i.openLogin=function(){o.path("/home/login",!1)};var y;i.openRegister=function(e){y=e,o.path("/home/register",!1)},i.isAuthenticated=c.isAuthenticated,o.search().branchid&&(r.branchid=o.search().branchid),r.sysMsgs=[],i.$watch(function(){return c.currentUser},function(e){e&&(i.user=e,r.user=e,i.userProperty=e,i.isEditor=c.isEditor(),r.isEditor=c.isEditor(),i.isAdvancedUser=c.isAdvancedUser(),r.isAdvancedUser=c.isAdvancedUser(),i.isVendorUser=c.isVendorUser(),r.isVendorUser=c.isVendorUser(),i.$broadcast("currentUser",e),c.isAuthenticated()&&(("/home"==o.path()||"/home/login"==o.path())&&o.path("main"),v(1,4,!0,!0),v(1,4,!0)))},!0),i.$on("addBranch",function(e,t){for(var n=0;n<i.userbranches.length;n++)if(t.id==i.userbranches[n].id)return;i.userbranches.unshift(t)}),i.showBoardsDropdown=function(){i.isProjectsDropdownVisible=!0},i.hideBoardsDropdown=function(){i.isProjectsDropdownVisible=!1};var b=$(document);b.scroll(function(){var e=b.scrollTop();e>180?$(".header-contain",b).addClass("head-shadow"):$(".header-contain",b).removeClass("head-shadow")}),i.$watch("branchid",function(){i.hideOpea=!!r.branchid}),i.openReg=function(){s.open({windowClass:"request_contain",templateUrl:"usercenter/request_reg.tpl.html",controller:"UsercenterrequestCtrl",resolve:{}}).result.then(function(){},function(){})},i.login=function(){c.showLogin()},i.register=function(){c.showRegister()},i.showToolBar=function(){return o.$$path.indexOf("/scene/create")<0},i.showPanel=function(){$("#helpPanel").stop().animate({right:"0"},500)},i.hidePanel=function(){$("#helpPanel").stop().animate({right:"-120"},500)},i.suggestionUrl="http://bbs.e.wesambo.com/forum.php?mod=forumdisplay&fid=45",i.feedbackUrl="http://bbs.e.wesambo.com/forum.php?mod=forumdisplay&fid=46",i.qqChatUrl="http://shang.qq.com/wpa/qunwpa?idkey=4a2d63670009360b878aa9a1e1437ef4caec132f74a0e2c4df4a686168cc73dc",i.helpUrl="http://bbs.e.wesambo.com/forum.php",i.createSkillUrl="http://bbs.e.wesambo.com/forum.php?gid=37",i.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)},i.changeLanguage=function(t){e.use(t),window.localStorage.setItem("preferredLanguage",t),a.reload(),"en-US"===t?$(document.body).addClass("en"):$(document.body).removeClass("en")}}]).filter("fixnum",["$translate",function(e){return function(t){var n=t;return t>=1e4&&1e8>t?n=(t/1e4).toFixed(1)+e.instant("UNIT1"):t>=1e8&&(n=(t/1e8).toFixed(1)+e.instant("UNIT2")),n}}]),angular.module("app").run(["$templateCache",function(e){e.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel" ng-swipe-right="prev()" ng-swipe-left="next()">\n    <ol class="carousel-indicators" ng-show="slides.length > 1">\n        <li ng-repeat="slide in slides track by $index" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>\n    </ol>\n    <div class="carousel-inner" ng-transclude></div>\n    <a class="prev eqf-chevron-small-left" ng-click="prev()" ng-show="slides.length > 1"></a>\n    <a class="next eqf-chevron-small-right" ng-click="next()" ng-show="slides.length > 1"></a>\n</div>\n')}]),angular.module("data.edit",["services.usercenter","services.i18nNotifications"]),angular.module("data.edit").controller("EditDataCtrl",["$rootScope","$scope","$window","$routeParams","usercenterService","security","$modal","ModalService","$location","dataService","i18nNotifications","$translate",function(e,t,n,i,r,o,a,s,c,l,d,u){t.sceneId=i.sceneId,t.sexOptions=[{id:1,name:"男"},{id:2,name:"女"}],t.sex=t.sexOptions[0],t.isAllowedToAccessGrouping=o.isAllowToAccess(o.accessDef.GROUP_CUSTOMER);var p=e.branchid,h={};t.getDataDetail=function(e){l.getDataDetail(t.sceneId,p).then(function(e){t.dataDetail=e.data.obj,h=e.data.obj,t.groupNames=t.dataDetail.group;var n=t.dataDetail.email,i=t.dataDetail.sex,r=t.dataDetail.mobile,o=t.dataDetail.tel;n?t.formEmails=n.split(","):t.formEmails=[""],r?t.formMobiles=r.split(","):t.formMobiles=[""],o?t.formTels=o.split(","):t.formTels=[""],i&&("男"==i?t.sex=t.sexOptions[0]:t.sex=t.sexOptions[1])})},"create"!=t.sceneId&&t.getDataDetail(t.sceneId),t.dataDetail||(t.dataDetail={},t.sex=null,t.formEmails=[""],t.formMobiles=[""],t.formTels=[""]),t.updateData=function(e,n,i){var r=e.name,o={};if("email"==r||"mobile"==r||"tel"==r){o[r]="";var a,s=[];for(a=0;a<n.length;a++)n[a]&&s.push(n[a]);for(a=0;a<s.length-1;a++)o[r]+=s[a]+",";o[r]+=s[a]}else o[r]=t.dataDetail[r];h[r]=o[r]},t.updateSex=function(e){var n={};n.id=t.sceneId,0!==e.id?n.sex=e.name:n.sex="",h.sex=n.sex},t.formEmails=[""],t.formMobiles=[""],t.formTels=[""],t.removeInputs=function(e,n,i){if(i.length>1){if(!i[e])return void i.splice(e,1);i.splice(e,1),t.updateData({name:n},i)}else 1===i.length&&""!==i[0]&&(i[e]="",t.updateData({name:n},i))},t.addInputs=function(e){e.push("")},t.saveData=function(){if(countCharacters(h.name)>50)return void d.pushForCurrentRoute("customer.name.overflow","notify.success");delete h.group,h&&$.each(h,function(e,t){"undefined"==t&&(h[e]=null)});var e="create"==t.sceneId;"create"==t.sceneId&&delete h.id,l.saveData($.param(h),e).then(function(e){e.data.success&&(alert(u.instant("main.customer.SAVE_SUCCESS")),c.path("/main/customer"))})},t.cancel=function(){c.path("/main/customer")},t.groups=[],t.getGroups=function(){t.groups.length>0||l.getGroups().then(function(e){t.groups=e.data.list},function(e){alert(u.instant("main.customer.SERVER_ERROR"))})},t.getGroups(),t.deleteAssociation=function(e,n,i){var r={cId:e,gId:n};s.openConfirmDialog({msg:u.instant("main.customer.ENSURE_RELIEVE")},function(){l.deleteAssociation(r).then(function(e){if(e.data.success)for(var i=0;i<t.groupNames.length;i++)t.groupNames[i].id==n&&t.groupNames.splice(i,1)},function(e){alert(u.instant("main.customer.SERVER_ERROR"))})})},t.addGroup=function(){a.open({windowClass:"group-console",templateUrl:"main/console/group.tpl.html",controller:"AddGroupCtrl"}).result.then(function(e){t.groups.push(e)},function(){})};var g=[];t.assignGroup=function(){for(var e=[],n=0,i=t.groups.length;i>n;n++)if(t.groups[n].selected){g.push(t.groups[n].id);var r={id:t.groups[n].id,name:t.groups[n].name};e.push(r)}if(!g.length)return void alert(u.instant("main.customer.SELECT_GROUP"));var o={cIds:t.dataDetail.id,gIds:g};l.assignGroup(o).then(function(n){if(n.data.success){f();for(var i=0;i<e.length;i++)if(t.groupNames.length>0)for(var r=0;r<t.groupNames.length&&t.groupNames[r].id!=e[i].id;r++)r==t.groupNames.length-1&&t.groupNames.push(e[i]);else t.groupNames.push(e[i]);d.pushForCurrentRoute("data.assign.success","notify.success")}},function(){})},t.deleteGroup=function(e,n){s.openConfirmDialog({msg:u.instant("main.customer.ENSURE_DEL")},function(){l.deleteGroup(e.id).then(function(i){if(i.data.success){f(),t.groups.splice(n,1);for(var r=0;r<t.groupNames.length;r++)t.groupNames[r].id==e.id&&t.groupNames.splice(r,1)}},function(e){alert(u.instant("main.customer.SERVER_ERROR"))})})};var f=function(){for(var e=0,n=t.groups.length;n>e;e++)t.groups[e].selected=!1}}]),angular.module("bindemail-dialog",[]).controller("BindEmailDialogCtrl",["$scope",function(e){}]),angular.module("confirm-dialog",[]).controller("ConfirmDialogCtrl",["$scope","confirmObj",function(e,t){e.confirmObj=t,e.ok=function(){e.$close()},e.cancel=function(){e.$dismiss()}}]),angular.module("message-dialog",[]).controller("MessageDialogCtrl",["$scope","msgObj",function(e,t){e.msgObj=t,e.close=function(){e.$close()},e.cancel=function(){e.$dismiss()}}]),angular.module("error",["services.sample"]),angular.module("error").controller("ErrorCtrl",["$rootScope","$http","$scope","$timeout","security","$window","sampleService",function(e,t,n,i,r,o,a){n.PREFIX_CLIENT_HOST=PREFIX_HOST}]),angular.module("home",["services.sample","app.directives.addelement","services.staticRes","services.scene","app.directives.qrcode","app.directives.loading","security.thirdparty"]),angular.module("home").controller("HomeCtrl",["$rootScope","$http","$scope","$timeout","security","$window","sampleService","sceneService","$routeParams","$route","$location","configService","thirdpartyService","staticResService",function(e,t,n,i,r,o,a,s,c,l,d,u,p,h){n.home70fun=function(){$(".header-fixed").addClass("header-opacity"),$(".header-shadow").hide(),$(".slide").slider({autoRollingTime:1e4,bgSpeed:500,motion:{"a1-1":{left:-384,opacity:0,speed:1e3,delay:500},"a1-2":{left:931,opacity:0,speed:1e3,delay:1e3},"a1-3":{left:1116,opacity:0,speed:1e3,delay:1200},"a1-4":{left:731,opacity:0,speed:1e3,delay:1400},"a2-1":{top:679,opacity:0,speed:1e3,delay:500},"a2-2":{top:679,opacity:0,speed:1e3,delay:800},"a2-3":{left:-1169,opacity:0,speed:1e3,delay:800},"a2-4":{opacity:0,speed:1e3,delay:1200},"a2-5":{opacity:0,speed:1e3,delay:1500},"a2-6":{opacity:0,speed:1e3,delay:1700},"a2-7":{top:559,opacity:0,speed:1e3,delay:1800},"a2-8":{top:559,opacity:0,speed:1e3,delay:2e3},"a2-9":{top:559,opacity:0,speed:1e3,delay:2200},"a2-10":{opacity:0,speed:1e3,delay:2400},"a2-11":{opacity:0,speed:1e3,delay:2600},"a2-12":{top:-60,opacity:0,speed:1e3,delay:2800},"a3-1":{top:679,opacity:0,speed:1e3,delay:200},"a3-2":{left:-200,opacity:0,speed:1e3,delay:1e3},"a3-3":{left:824,opacity:0,speed:1e3,delay:1e3},"a3-4":{left:-94,opacity:0,speed:500,delay:1500},"a3-5":{opacity:0,speed:500,delay:1600},"a3-6":{opacity:0,speed:500,delay:1700},"a3-7":{opacity:0,speed:500,delay:1800},"a3-8":{opacity:0,speed:500,delay:1900},"a3-9":{opacity:0,speed:500,delay:2e3},"a3-10":{opacity:0,speed:500,delay:2100},"a3-11":{opacity:0,speed:500,delay:2200},"a3-14":{opacity:0,speed:1e3,delay:2300},"a3-15":{opacity:0,speed:1e3,delay:2400},"a3-23":{opacity:0,speed:500,delay:2500},"a3-22":{opacity:0,speed:500,delay:2600},"a3-21":{opacity:0,speed:500,delay:2700},"a3-20":{opacity:0,speed:500,delay:2800},"a3-19":{opacity:0,speed:500,delay:2900},"a3-18":{opacity:0,speed:500,delay:3e3},"a3-17":{opacity:0,speed:500,delay:3100},"a3-16":{opacity:0,speed:500,delay:3200},"a3-12":{opacity:0,speed:500,delay:3300},"a3-13":{opacity:0,speed:500,delay:3400},"a4-1":{top:679,opacity:0,speed:1e3,delay:200},"a4-2":{left:-200,opacity:0,speed:1e3,delay:1e3},"a4-3":{left:824,opacity:0,speed:1e3,delay:1e3},"a4-4":{left:-94,opacity:0,speed:500,delay:1500},"a4-5":{left:-60,opacity:0,speed:500,delay:1500},"a5-1":{top:679,opacity:0,speed:1e3,delay:500},"a5-2":{top:679,opacity:0,speed:1e3,delay:800},"a5-3":{left:-1169,opacity:0,speed:1e3,delay:800},"a5-4":{opacity:0,speed:1e3,delay:1200},"a6-1":{top:679,opacity:0,speed:1e3,delay:200},"a6-2":{left:-200,opacity:0,speed:1e3,delay:1e3},"a6-3":{left:824,opacity:0,speed:1e3,delay:1e3},"a6-4":{left:-94,opacity:0,speed:500,delay:1500},end:null}})},n.showCode=!1,n.isAuthenticated=r.isAuthenticated,n.registerMsg={},n.PREFIX_FILE_HOST=PREFIX_FILE_HOST,n.PREFIX_CLIENT_HOST=PREFIX_HOST,n.PREFIX_SERVER_HOST=PREFIX_URL,n.scene||(n.scene={}),n.typeindex="all",n.pageSize=12,n.pageNo=1,n.getHomes=function(e,t,i,r){n.typeindex=e,a.getSamples(t,i,r).then(function(e){n.homes=e.data.list},function(e){})},n.sceneTypes=h.getSceneType(),n.getHomes("all",null,1,12),n.getSamplesPV=function(){a.getSamplesPV().then(function(e){n.SamplesPVs=e.data,n.dayTop=n.SamplesPVs.obj.dayTop,n.monthTop=n.SamplesPVs.obj.monthTop,n.weekTop=n.SamplesPVs.obj.weekTop,n.page="month"},function(e){})},u.getBanner70().then(function(e){console.log("re",e),$("#slides_bgcc").html(e.data.banner_bg),$("#slide_switchcc").html(e.data.slide_switchcc),$("#banner_body").html(e.data.banner_body);var t=setInterval(function(){$("#scenecount").html(parseInt($("#scenecount").html())+150)},10);setTimeout(function(){window.clearInterval(t),$("#scenecount").html(e.data.scenecount)},5e3),n.home70fun()}),u.getMenu70().then(function(e){n.menus=e.data.list}),u.getFriendLinks().then(function(e){n.friendLinks=e.data.list,n.friendLinks.length>15&&(n.friendLinks.length=15)}),u.getProduct().then(function(e){n.product=e.data.list,n.product.length>15&&(n.product.length=15)})}]).directive("iframeImgSwitch",function(){return{compile:function(e,t){(document.documentMode||navigator.userAgent.indexOf("Edge")>0)&&(e.find(".svg-animation").css("display","none"),e.find(".noSvg").css("display","block"))}}}),angular.module("customer.group",["services.data","services.i18nNotifications"]),angular.module("customer.group").controller("AddGroupCtrl",["$rootScope","$scope","dataService","i18nNotifications","$translate",function(e,t,n,i,r){t.group={},t.authError="",t.confirm=function(){if(!t.group.name)return void(t.authError=r.instant("main.customer.GROUP_NAME_ERROR1"));var e=countCharacters(t.group.name);if(e>12)return void(t.authError=r.instant("main.customer.GROUP_NAME_ERROR2"));var o={name:t.group.name};n.createGroup(o).then(function(e){e.data.success&&(i.pushForCurrentRoute("group.create.success","notify.success"),t.$close({id:e.data.obj,name:t.group.name}))},function(){})},t.cancel=function(){t.$dismiss()}}]),angular.module("main.transferScene",["services.usercenter"]),angular.module("main.transferScene").controller("TransferSceneCtrl",["$scope","$rootScope","sceneService","sceneId","$translate",function(e,t,n,i,r){e.model={toUser:""},e.transferScene=!0,e.confirm=function(){return e.model.toUser?e.model.toUser==t.user.loginName?void(e.actionerror=r.instant("main.TRANSFER_SELF")):void n.transferScene(i.sceneId,e.model.toUser).then(function(t){200==t.data.code?e.transferScene=!1:e.actionerror=t.data.msg}):void(e.actionerror=r.instant("main.EMPTY_ACCOUTN"))},e.cancel=function(){e.$close()}}]),angular.module("main.data",["app.directives.dataDraggable","customer.group","services.i18nNotifications","app.directives.customer"]),angular.module("main.data").controller("CustomerCtrl",["$translate","$rootScope","$scope","$route","$location","$timeout","dataService","$modal","ModalService","i18nNotifications","security",function(e,t,n,i,r,o,a,s,c,l,d){n.PREFIX_URL=PREFIX_URL,n.isActive="customer",n.select=0,n.showBranchSelect=!0;var u=t.branchid;n.toPage=1,n.model={},n.dataShow="message",a.getCustomDatas(u),n.$on("customDatas",function(e,t){n.customCount=t}),n.customer={group:null,origin:null},n.branchEdit=!0,n.branchDelete=!0,n.branchExport=!0,o(function(){21==n.user.type&&(n.user.extPermi?(/^([\d,]+,)?1(,[\d,]*)?$/.test(n.user.extPermi)?n.branchEdit=!0:n.branchEdit=!1,/^([\d,]+,)?2(,[\d,]*)?$/.test(n.user.extPermi)?n.branchDelete=!0:n.branchDelete=!1,
/^([\d,]+,)?3(,[\d,]*)?$/.test(n.user.extPermi)?n.branchExport=!0:n.branchExport=!1):(n.branchEdit=!1,n.branchDelete=!1,n.branchExport=!1))},100),n.downLoad=function(e,t){var n;n=PREFIX_S3_URL+"index.php?c=custom&a=exp"+(u?"?user="+u:""),t&&(n+=(/\?/.test(n)?"&":"?")+"origin="+t),e&&(n+=(/\?/.test(n)?"&":"?")+"groupId="+e),location.href=n},n.staticFileds=[],e(["main.customer.CUSTOMER_NAME","main.customer.CUSTOMER_MOBILE","main.customer.CUSTOMER_EMAIL","main.customer.CUSTOMER_SEX","main.customer.CUSTOMER_COMPANY","main.customer.CUSTOMER_JOB","main.customer.CUSTOMER_ADDRESS","main.customer.CUSTOMER_TELEPHONE","main.customer.CUSTOMER_WEBSITE","main.customer.CUSTOMER_QQ","main.customer.CUSTOMER_WECHAT","main.customer.CUSTOMER_REMARK"]).then(function(e){n.staticFileds=[{id:"name",name:e["main.customer.CUSTOMER_NAME"]},{id:"mobile",name:e["main.customer.CUSTOMER_MOBILE"]},{id:"email",name:e["main.customer.CUSTOMER_EMAIL"]},{id:"sex",name:e["main.customer.CUSTOMER_SEX"]},{id:"company",name:e["main.customer.CUSTOMER_COMPANY"]},{id:"job",name:e["main.customer.CUSTOMER_JOB"]},{id:"address",name:e["main.customer.CUSTOMER_ADDRESS"]},{id:"tel",name:e["main.customer.CUSTOMER_TELEPHONE"]},{id:"website",name:e["main.customer.CUSTOMER_WEBSITE"]},{id:"qq",name:e["main.customer.CUSTOMER_QQ"]},{id:"weixin",name:e["main.customer.CUSTOMER_WECHAT"]},{id:"remark",name:e["main.customer.CUSTOMER_REMARK"]}]}),n.selectScene=function(t,i){n.selectedSceneId=t,a.getSceneField(t).then(function(t){n.fields=t.data.list,n.select=i,$(".list_attribute").html(e.instant("main.customer.DRAG_HERE"))})},n.clickScene=function(){r.path("main")},n.clickSpread=function(){r.path("main/spread")},n.clickCustomer=function(){r.path("main/customer")},n.editCustomer=function(e){n.getDataDetail(e.id),n.editData=!0},n.removeCustomer=function(t){c.openConfirmDialog({msg:e.instant("main.customer.CONFIRM_TO_DELETE_DATA")},function(){a.deleteDataById(t.id).then(function(e){200==e.data.code&&l.pushForCurrentRoute("custom.data.delete","notify.success"),1===n.customerDatas.length&&n.model.currentPage>1?n.getDataBySceneId(n.model.currentPage-1,u,n.groupId,n.origin):n.getDataBySceneId(n.model.currentPage,u,n.groupId,n.origin),a.getCustomDatas(u)})})},n.addColor=function(e){n.trIndex=e},n.removeColor=function(){n.trIndex=-1},n.totalItems=0,n.model.currentPage=0,n.toPage="",n.pageChanged=function(t,i,r,o){return 1>t||t>n.totalItems/10+1?void alert(e.instant("main.customer.PAGE_OVERFLOW")):(n.model.currentPage=t,void n.getDataBySceneId(t,i,r,o))},n.getDataBySceneId=function(e,t,i,r){e||(e=1),i&&(n.groupId=i),r&&(n.origin=r),a.getAllData(e,t,i,r).then(function(e){n.customerDatas=e.data.list,n.totalItems=e.data.map.count,n.model.currentPage=e.data.map.pageNo,n.toPage="",n.totalNum=Math.ceil(n.totalItems/e.data.map.pageSize)})},n.getDataBySceneId(1,u,null,null),n.editCustom=function(e,t){r.path("/main/customer/"+e.id)};var p=function(){a.getDataMessage(u).then(function(e){n.dataMessage=e.data.list})};p(),n.sceneLoad=function(e){var t=PREFIX_S3_URL+"index.php?c=scenedata&a=excel&flag=noheader&id="+e+(u?"&user="+u:"");location.href=t},n.importDatas=function(){a.getPremergeScenes(u).then(function(e){n.importDatas=e.data.list,e.data.list.length>0&&n.selectScene(e.data.list[0].ID,0)})},n.associateData={};var h=!0;if(n.confirm=function(){h?jQuery.isEmptyObject(n.associateData,{})?(alert(e.instant("main.customer.PLEASE_IMPORT_DATA")),h=!0):(a.mergeSceneData(n.selectedSceneId,n.associateData).then(function(){alert(e.instant("main.customer.IMPORT_CUSTOMER_SUCCESS")),i.reload()},function(){}),h=!1):alert(e.instant("main.customer.DUPLICATE_CONFIRM"))},n.importDatas(),n.isAllowedToAccessGrouping=d.isAllowToAccess(d.accessDef.GROUP_CUSTOMER),n.isAllowedToAccessGrouping){n.allImages={selected:!1},n.selectAll=function(){for(var e=0,t=n.customerDatas.length;t>e;e++)n.customerDatas[e].selected=n.allImages.selected},n.selectCustomer=function(e){e.selected||(n.allImages.selected=!1)},n.groups=[],n.getGroups=function(){n.groups.length>0||a.getGroups(u).then(function(e,t){n.groups=e.data.list},function(e){})},n.getGroups(),n.getOrigins=function(){a.getOrigin(u).then(function(e){n.origins=e.data.list},function(t){alert(e.instant("main.customer.SERVER_ERROR"))})},n.getOrigins(),n.addGroup=function(){s.open({windowClass:"group-console console",templateUrl:"main/console/group.tpl.html",controller:"AddGroupCtrl"}).result.then(function(e){n.groups.push(e),v(),l.pushForCurrentRoute("group.create.success","notify.success")},function(){})};var g=[],f=[];n.assignGroup=function(){g=[],f=[];for(var t=0,i=n.customerDatas.length;i>t;t++)n.customerDatas[t].selected&&g.push(n.customerDatas[t].id);for(t=0,i=n.groups.length;i>t;t++)n.groups[t].selected&&f.push(n.groups[t].id);if(!g.length)return void alert(e.instant("main.customer.NO_CUSTOMER_SELECTED"));if(!f.length)return void alert(e.instant("main.customer.NO_GROUP_SELECTED"));var r={cIds:g,gIds:f};a.assignGroup(r).then(function(e){e.data.success&&(v(),n.allImages.selected=!1,m(),l.pushForCurrentRoute("data.assign.success","notify.success"))},function(){})},n.deleteCustomer=function(t){g=[];var i,r;if(t)i={ids:t.id},r=e.instant("main.customer.CONFIRM_TO_DELETE_DATA");else{for(var o=0,s=n.customerDatas.length;s>o;o++)n.customerDatas[o].selected&&g.push(n.customerDatas[o].id);if(!g.length)return void alert(e.instant("main.customer.NO_CUSTOMER_SELECTED"));i={ids:g},r=e.instant("main.customer.CONFIRM_TO_DELETE_DATA")}c.openConfirmDialog({msg:r},function(){a.deleteCustomer(i).then(function(e){e.data.success&&(n.allImages.selected=!1,m(),v(),l.pushForCurrentRoute("data.delete.success","notify.success"))},function(t){alert(e.instant("main.customer.SERVER_ERROR"))})})},n.deleteGroup=function(t,i){c.openConfirmDialog({msg:e.instant("main.customer.CONFIRM_TO_DELETE_GROUP")},function(){a.deleteGroup(t.id).then(function(e){e.data.success&&(n.groups.splice(i,1),v(),l.pushForCurrentRoute("group.delete.success","notify.success"))},function(t){alert(e.instant("main.customer.SERVER_ERROR"))})})};var m=function(){1===n.customerDatas.length&&n.model.currentPage>1?n.getDataBySceneId(n.model.currentPage-1):n.getDataBySceneId(n.model.currentPage)},v=function(){for(var e=0,t=n.groups.length;t>e;e++)n.groups[e].selected=!1}}n.createData=function(){r.path("main/customer/create")},n.sceneData=function(){n.dataShow="dataIn"},n.$watch("model.currentPage",function(e,t){e&&e!=t&&(n.model.toPage=e)},!0)}]),angular.module("main",["services.mine","services.data","app.directives.pageTplTypes","services.staticRes","app.directives.addelement","main.data","main.transferScene","services.usercenter","main.userGuide","services.i18nNotifications","common.directives.scroll"]),angular.module("main").controller("MainCtrl",["$rootScope","$scope","$location","$translate","security","MineService","dataService","sceneService","ModalService","$modal","usercenterService","i18nNotifications","configSerService","SpreadService","$filter","staticResService","$timeout",function(e,t,n,i,r,o,a,s,c,l,d,u,p,h,g,f,m){t.PREFIX_URL=PREFIX_URL,t.PREFIX_CLIENT_HOST=PREFIX_HOST,t.client_cdn=CLIENT_CDN,t.scene={type:null},t.pageSize=11,t.editInfo={isEditable:!1};var v=1;t.lists=[{title:"我的微课"},{title:"模板中心"}],t.listType=0,t.navChange=function(e){var n=e;console.log(n),0==n?(console.log(0),document.getElementById("weike").style.display="block",document.getElementById("muban").style.display="none",document.getElementById("searchweike").style.display="block",document.getElementById("searchmuban").style.display="none",document.getElementById("mubannav").style.display="none",document.getElementById("weikefl").style.display="block"):1==n?(console.log(1),document.getElementById("weike").style.display="none",document.getElementById("muban").style.display="block",document.getElementById("searchweike").style.display="none",document.getElementById("searchmuban").style.display="block",document.getElementById("mubannav").style.display="block",document.getElementById("weikefl").style.display="none"):alert("出错；请刷新页面"),t.listType=e},t.isAllowedHistory=r.isAllowToAccess(r.accessDef.USERCENTER_HISTORY),t.showCloseStatus=[],t.showOpenStatus=[],t.isActive="main",t.loginSuccess=r.isLoginSuccess,t.myScene=!0,t.showBranchSelect=!0;var y=e.branchid;t.XdpageSize=100,t.getBranches=function(e){d.getBranches(t.XdpageSize,e).then(function(e){e.data.success&&(t.branches=e.data.list)},function(){})},t.getBranches(1),t.selectBranch=function(i){i?(t.branchCurrent=i,e.branchid=i.id,n.search({branchid:i.id})):(e.branchid="",n.search("branchid",null))};var b=n.search().branchid;m(function(){if(b)for(var e=0;e<t.branches.length;e++)t.branches[e].id==b&&(t.branchCurrent=t.branches[e])},300),t.showSceneList=function(){t.initShowGuide=!1,e.$broadcast("eqmain.overflow.visible")},t.getUserInfo=function(){d.getUserInfo().then(function(e){t.userinfo=e.data.obj})},t.getUserInfo(),t.getUserXd=function(){d.getUserXd().then(function(e){e.data.success&&(t.xdCounts=e.data.obj)})},t.getUserXd(),t.showSceneList=function(){t.initShowGuide=!1,e.$broadcast("eqmain.overflow.visible")},t.userXd=0,d.getUserXd().then(function(e){t.userXd=e.data.obj||0}),t.customerUpload=function(){l.open({windowClass:"img_console console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1}}}}).result.then(function(n){if(n.width/n.height===1){t.userinfo.headImg=n.data;var i={headImg:n.data,id:t.userinfo.id};return void d.saveUserInfo(i).then(function(i){i.data.success&&(t.editInfo.isEditable=!1,e.$broadcast("headImg.change",n.data))})}l.open({windowClass:"console seven-contain",templateUrl:"scene/console/imageCrop.tpl.html",controller:"imageCropCtrl",backdrop:"static",resolve:{obj:function(){return{type:"square",properties:{src:n.data}}}}}).result.then(function(n){t.userinfo.headImg=n.src;var i={headImg:n.src,id:t.userinfo.id};d.saveUserInfo(i).then(function(n){n.data.success&&(t.editInfo.isEditable=!1,e.$broadcast("headImg.change",n.data.obj.headImg))})},function(e){})},function(e){})},t.createScene=function(e){if(e&&e.price){var n=parseFloat(e.price)||0;n&&n>t.userXd?c.openMsgDialog({msg:'当前选择需要消耗微币<font color="#ff6e6e">'+n+'</font>个<br/>微币余额不足(<font color="#ff6e6e">'+(t.userXd||0)+'</font>个)<span class="get-xd"><a href="http://bbs.e.wesambo.com/forum.php?mod=viewthread&tid=297&extra=page%3D1" target = "_blank">获取微币</a></span>'}):c.openConfirmDialog({msg:'当前选择需要消耗微币<font color="#ff6e6e">'+n+'</font>个<br/>微币余额为<font color="#ff6e6e">'+(t.userXd||0)+"</font>个"},function(){l.open({windowClass:"login-container six-contain",templateUrl:"scene/createNew.tpl.html",controller:"SceneNewCtrl",resolve:{items:function(){return e}}})})}else l.open({windowClass:"login-container six-contain",templateUrl:"scene/createNew.tpl.html",controller:"SceneNewCtrl",resolve:{items:function(){return e}}})},t.buyXd=function(){l.open({windowClass:"console",templateUrl:"?c=pay",controller:"BuyXdController",resolve:{getUserXd:function(){return function(){t.getUserXd(),t.getXdlog(t.XdtoPage)}}}}).result.then(function(){},function(){})},t.transferXd=function(){l.open({windowClass:"six-contain",templateUrl:"usercenter/transfer.tpl.html",controller:"UsercentertransferCtrl",resolve:{username:function(){return t.userinfo.loginName}}}).result.then(function(){t.getUserXd(),t.getXdlog(),t.getXdStatNum()},function(){})},t.$watch("user.loginName",function(e,n){if(e){var i=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;t.loginSuccess&&"eqs"==e.substr(0,3)&&!i.test(e)&&u.pushForCurrentRoute("rel.tip","notify.tip")}}),t.editScene=function(e,t){e&&e.stopPropagation(),n.path("scene/create/"+t).search("pageId",1)},t.visitSceneAction=function(){c.openMsgDialog({msg:"分别可在设置微课-分享设置中、微课详情页中设置微课状态为不允许访问",btn:"知道了"},function(){})},t.showPreview=function(e,n){if(n.publishTime)if(n.publishTime&&n.updateTime>n.publishTime)c.openConfirmDialog({msg:"微课有更新需要再次发布才能预览最新内容，坚持预览会看到修改之前的微课",confirmName:"发布",cancelName:"坚持预览"},function(){t.publishScene(e,n)},function(){e&&e.stopPropagation();var i=t.canvasUrl+("/v-"+n.code);window.open(i)});else{e&&e.stopPropagation();var i=t.canvasUrl+("/v-"+n.code);window.open(i)}else c.openConfirmDialog({msg:"尚未发布微课无法预览，请先发布",confirmName:"发布",cancelName:"取消"},function(){t.publishScene(e,n)})},window.localStorage&&"false"==localStorage.getItem("myScenesListType")?t.listType=!1:t.listType=!0,t.listToggle=function(){t.listType=!t.listType,window.localStorage&&localStorage.setItem("myScenesListType",t.listType)},t.addColor=function(e){t.trIndex=e},t.removeColor=function(){t.trIndex=-1},t.sceneSettings=function(e,t){e&&e.stopPropagation(),n.path("scene/create/"+t).search({pageId:1,openSetting:"show"})},t.clickScene=function(){n.path("main")},t.clickSpread=function(){n.path("main/spread")},t.creatCompanyTpl=function(e,n,i){e&&e.stopPropagation(),s.createCompanyTpls(n).then(function(e){e.data.success&&(t.myScenes[i].isTpl=3,u.pushForCurrentRoute("scene.save.success.companyTpl","notify.success"))})},t.clearCompanyTpl=function(e,n,i){e&&e.stopPropagation(),s.clearCompanyTpls(n).then(function(e){e.data.success&&(t.myScenes[i].isTpl=0,u.pushForCurrentRoute("scene.clear.success.companyTpl","notify.success"))})},t.clickCustomer=function(){n.path("main/customer")},t.register=r.getRegisterInfo(),t.logout=function(){r.logout()},t.copyScene=function(e,t){e&&e.stopPropagation(),c.openConfirmDialog({msg:"确定复制此微课?"},function(){s.copySceneById(t).then(function(e){n.path("scene/create/"+e.data.obj).search("pageId",1)})})},t.isAllowedToAccessTransfer=r.isAllowToAccess(r.accessDef.TRANSFER_SCENE),t.isAllowedToAccessTransfer&&(t.transferScene=function(n,i){n&&n.stopPropagation(),"eqs"==e.user.loginName.substr(0,3)&&null==e.user.email?c.openBindEmailDialog():l.open({windowClass:"six-contain",templateUrl:"main/console/transferscene.tpl.html",controller:"TransferSceneCtrl",resolve:{sceneId:function(){return{sceneId:i}}}}).result.then(function(){t.getMyScenes()},function(){})}),t.color_arry=["#eac8c1","#c1ead4","#d1bce2","#b8dee8","#e8e1af","#a7addb"],t.getStyle=function(e,n){n=n||0,n%=6;var i=t.color_arry[n];return{"background-image":"url("+PREFIX_FILE_HOST+e+")","background-size":"cover","background-color":i}},t.getImageStyle=function(e,n){n=n||0,n%=6;var i=t.color_arry[n];return{"background-image":"url("+PREFIX_FILE_HOST+e+")","background-size":"cover","background-color":i}},t.totalItems=0,t.page={currentPage:1},t.toPage="",t.name=null,t.EnterPress=function(e,n){var i=e||window.event;13==i.keyCode&&t.submit(n)},t.EnterPressTwo=function(e,n){var i=e||window.event;13==i.keyCode&&t.submitTwo(n)},t.searchButton=!0;var w={};t.submit=function(e){t.name=e,o.getMyScenes(t.scene.type?t.scene.type.value:null,v,t.pageSize,y,null,e),e&&(t.searchButton=!1),w.refresh=!0},t.submitTwo=function(e){t.name=e,s.getPageTpls(1,null,null,0,12,u.orderby,null,e),e&&(t.searchButton=!1),w.refresh=!0},t.changeName=function(e){t.searchButton=!0,""==e&&w.refresh&&o.getMyScenes(t.scene.type?t.scene.type.value:null,v,t.pageSize,y,null,e)},t.clearSearch=function(){t.searchButton=!0,t.name="",o.getMyScenes(t.scene.type?t.scene.type.value:null,v,t.pageSize,y)},t.clearSearchTwo=function(){t.searchButton=!0,t.name="",s.getPageTpls(1,null,null,1,12)},t.getMyScenes=function(e){o.getMyScenes(t.scene.type?t.scene.type.value:null,e,t.pageSize,y)},t.getMyScenes(),t.$on("get.my.scene.list",function(n){var i=o.scenes;i.list&&i.list.length>0?(t.myScenes=i.list,t.totalItems=i.map.count,t.page.currentPage=i.map.pageNo,t.allPageCount=i.map.count,t.toPage=i.map.pageNo,e.user&&e.user.domain?(t.url=e.user.domain,t.canvasUrl="http://"+t.url):(t.url=t.PREFIX_CLIENT_HOST,t.canvasUrl=t.url)):(t.totalItems=0,t.currentPage>1?t.getMyScenes(--t.currentPage):(t.myScenes=[],t.allPageCount=0))}),t.deleteScene=function(e,n){e&&e.stopPropagation();var i=t.isAllowedHistory?"确定删除此微课?删除后，该微课将在回收站保留3天":"确定删除此微课?";c.openConfirmDialog({msg:i},function(){o.deleteSceneById(n).then(function(){1==t.myScenes.length&&t.currentPage>1&&t.currentPage--,t.getMyScenes(t.currentPage)})})},t.pageChanged=function(e){return 1==e?t.pageSize=11:t.pageSize=12,1>e||e>t.totalItems/10+1?void alert("此页超出范围"):(t.page.currentPage=e,void t.getMyScenes(e,t.pageSize))},t.getTdStyle=function(e){var t=$(".header_table td:eq("+e+")").outerWidth();return{width:t+"px",maxWidth:t+"px"}},t.scene.types=f.getSceneType(),t.dataDetail={},a.getDatas(y),a.getCustomDatas(y),t.$on("sceneDatas",function(e,n){t.datasCount=n}),t.$on("customDatas",function(e,n){t.customCount=n}),t.showDetail=function(e){n.path("spread/share/"+e+"/socialShare")},t.$on("$destroy",function(){r.setLoginSuccess(!1)}),t.publishScene=function(e,n){if(e&&e.stopPropagation(),!n.name)return void c.openMsgDialog({msg:"尚未设置标题，请设置后再执行此操作",btn:"去设置"},function(){t.sceneSettings(e,n.id)});var i=window.open();s.publishScene(n.id).then(function(e){if(e.data.success){n.publishTime=(new Date).getTime(),u.pushForCurrentRoute("scene.publish.success","notify.success");var r=t.canvasUrl+("/v-"+n.code);i.location=r}})},t.getRejectDetail=function(e){e.stopPropagation(),n.path("/usercenter/message")},t.viewDetail=function(i){e.showSpreadTable=!1,t.$parent.showBranchSelect=!1,n.path("/main/spread/statistics/"+i),h.getSceneDetail(i,y),h.getSceneData(i,-6,1,y),h.getWebList(i,!0,y);var r=new Date;r=new Date(r.getTime()-864e5)}}]).directive("sysMsgAdjust",function(){return{restrict:"EA",link:function(e,t,n){e.isSysMsgVeryShort=!1;var i=e.$watch(function(){return $(".messages",t).css("height")},function(t){"44px"===t&&(e.isSysMsgVeryShort=!0)});t.bind("$destroy",function(){i()})}}}).directive("selectPicker",function(){return{restrict:"EA",link:function(e,t,n){t.selectpicker()}}}),function(){angular.module("main.userGuide",["usercenter.relAccount"]).controller("userGuideCtrl",["$rootScope","$scope","dateFilter",function(e,t,n){var i;if(window.localStorage){var r=JSON.parse(localStorage.getItem("loginInfo"));r&&r[e.user.id]?!r.isShow||t.user.checkEmail?t.firstLogin=!1:sessionStorage.getItem("emailGuide")?t.firstLogin=!1:(r.isShow=!0,i=!0,t.firstLogin=!0):(t.firstLogin=!0,r=r||{},r[e.user.id]=1,r.isShow=!0,localStorage.setItem("loginInfo",JSON.stringify(r)))}t.currentGuide="bindEmailGuide",t.showNextGuide=function(){sessionStorage.setItem("emailGuide","true"),i?t.firstLogin=!1:(t.currentGuide="createGuide",t.firstLogin=!0)};var o=0;t.closeDiv=function(){document.getElementById("divClose").style.display="none"},t.showGuide=function(){"createGuide"==t.currentGuide&&(t.firstLogin=1===++o)},t.isShow=function(){if(window.localStorage){var e=JSON.parse(localStorage.getItem("loginInfo"));e.isShow=!e.isShow,localStorage.setItem("loginInfo",JSON.stringify(e))}}}])}(),angular.module("scenePreview",["services.scene","services.mine","services.data","scene.create.console","app.directives.addelement","services.usercenter","app.directives.qrcode","services.i18nNotifications"]),angular.module("scenePreview").controller("MySceneCtrl",["$location","$rootScope","$scope","$routeParams","$modal","usercenterService","ModalService","sceneService","security","$sce",function(e,t,n,i,r,o,a,s,c,l){n.loading=!1,n.sceneId=i.sceneId,n.iframeUrl=l.trustAsResourceUrl(PREFIX_URL+"index.php?c=view&id="+n.sceneId+".html?preview=myscene"),n.tpl=t.tplObj,n.userXd=0,o.getUserXd().then(function(e){n.userXd=e.data.obj||0}),t.backurl?n.backurl=t.backurl:n.backurl="#/main",s.getSceneDetail(n.sceneId).then(function(e){e.data.success&&(e.data.obj.createUser==c.currentUser.id?n.isTpl=!1:n.isTpl=!0,n.scene=e.data.obj,t.user&&t.user.domain?(n.url=t.user.domain+"/v-"+n.scene.code,n.canvasUrl="http://"+n.url):(n.url=PREFIX_HOST+"/v-"+n.scene.code,n.canvasUrl=n.url))}),n.editScene=function(){e.path("scene/create/"+n.sceneId).search("pageId",1)},n.setSceneInfo=function(){e.path("scene/create/"+n.sceneId).search("pageId",1).search("openSetting","show")},n.moreShareWay=function(){e.path("spread/share/"+n.sceneId+"/socialShare")},n.userTpl=function(){e.path("/scene"),t.tplId=n.scene};var d,u;document.getElementById("sharescript")?($("#sharescript").remove(),d=document.getElementsByTagName("head")[0],u=document.createElement("script"),u.id="sharescript",u.src="http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5),d.appendChild(u)):(d=document.getElementsByTagName("head")[0],u=document.createElement("script"),u.id="sharescript",u.src="http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion="+~(-new Date/36e5),d.appendChild(u)),window._bd_share_config={common:{bdText:"aa",bdDesc:"aa",bdUrl:"aa",bdSign:"on",bdSnsKey:{}},share:[{bdSize:32}],slide:[{bdImg:0,bdPos:"right",bdTop:100}]},n.scrollPage=function(e){t.$broadcast("scene.page.scroll",e)}}]).directive("ctrlPageScroll",function(){function e(e,t,n){e.$on("scene.page.scroll",function(e,t){var n=$("iframe").get(0).contentWindow;t?n.eqxiu.nextPage():n.eqxiu.prePage()})}return{restrict:"EA",link:e}}),angular.module("scene.my.upload",["angularFileUpload"]),angular.module("scene.my.upload").controller("UploadCtrl",["$scope","FileUploader","fileService","category","$timeout","$interval",function(e,t,n,i,r,o){e.category=i;var a;a=e.category.scratch||e.category.headerImage||e.category.companyImg?e.uploader=new t({url:PREFIX_URL+"index.php?c=upfile&a=upload&bizType="+i.categoryId+"&fileType="+i.fileType,withCredentials:!0,queueLimit:1,onSuccessItem:function(t,n,i,r){function a(){o.cancel(s),alert("上传完毕"),e.$close(n.obj.path)}e.progressNum=0;var s=o(function(){e.progressNum<100?e.progressNum+=15:a()},100)}}):e.uploader=new t({url:PREFIX_URL+"index.php?c=upfile&a=upload&bizType="+i.categoryId+"&fileType="+i.fileType,withCredentials:!0,queueLimit:5,onCompleteAll:function(){function t(){o.cancel(n),alert("上传完毕"),e.$close()}e.progressNum=0;var n=o(function(){e.progressNum<100?e.progressNum+=15:t()},100)}}),i.limitSize=i.limitSize||3145728;var s,c=i.limitSize;"0"==i.fileType||"1"==i.fileType?s="|jpg|png|jpeg|bmp|gif|svg+xml|":("2"==i.fileType||"4"==i.fileType)&&(s="|mp3|mpeg|"),a.filters.push({name:"imageFilter",fn:function(e,t){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!==s.indexOf(n)}}),a.filters.push({name:"imageSizeFilter",fn:function(e,t){var n=e.size;return n>=c&&alert("上传文件大小限制在"+c/1024/1024+"M以内"),c>n}}),a.filters.push({name:"fileNameFilter",fn:function(e,t){return e.name.length>50&&alert("文件名应限制在50字符以内"),e.name.length<=50}}),e.removeQueue=function(){}}]),angular.module("reg",[]),angular.module("reg").controller("TestLoginCtrl",["$rootScope","$scope",function(e,t){t.weiChatUrl="https://open.weixin.qq.com/connect/qrconnect?appid=wxc5f1bbae4bb93ced&redirect_uri=http://www.hjtmt.com/testlogin.html&response_type=code&scope=snsapi_login&state=STATE#wechat_redirect"}]),angular.module("sample",["services.sample","services.mine","services.scene","services.staticRes","app.directives.addelement","app.directives.qrcode"]),angular.module("sample").controller("SampleCtrl",["$rootScope","$http","$scope","$timeout","security","$window","sampleService","MineService","sceneService","$routeParams","staticResService",function(e,n,i,r,o,a,c,l,d,u,p){i.PREFIX_FILE_HOST=PREFIX_FILE_HOST,i.PREFIX_SERVER_HOST=PREFIX_URL,i.PREFIX_CLIENT_HOST=PREFIX_HOST,i.load=function(){t=$(".fixed").offset().top,mh=$(".mains").height(),fh=$(".fixed").height(),$("#eq_main").scroll(function(){s=$("#eq_main").scrollTop(),s>t-10?($(".fixed").css("position","fixed"),s+fh>mh&&$(".fixed").css("top","0px")):$(".fixed").css("position","")})},i.$on("$destroy",function(){$("#eq_main").unbind("scroll")}),i.pageNo=1,i.pageSize=9,i.scene||(i.scene={}),i.typeindex="all",i.getHomes=function(e,t,n,r){i.pageNo=1,i.typeindex=e,i.currentType=t,i.showMoreButton=!0,c.getSamples(t,n,r).then(function(e){i.homes=e.data.list},function(e){})},i.sceneTypes=p.getSceneType(),i.showMore=function(){i.pageNo++,c.getSamples(i.currentType,i.pageNo,i.pageSize).then(function(e){e.data.list.length>0?i.homes=i.homes.concat(e.data.list):i.showMoreButton=!1},function(e){})},i.getHomes("all",null,1,9),i.getSamplesPV=function(){c.getSamplesPV().then(function(e){i.SamplesPVs=e.data,i.dayTop=i.SamplesPVs.obj.dayTop,i.monthTop=i.SamplesPVs.obj.monthTop,i.weekTop=i.SamplesPVs.obj.weekTop,i.page="month"},function(e){})}}]),angular.module("scene.create.console",["scene.create.console.bg","scene.create.console.ppt","scene.create.console.psd","scene.create.console.map","scene.create.console.input","scene.create.console.radio.checkbox","scene.create.console.rating","scene.create.console.counter","scene.create.console.linkComponent","scene.create.console.button","scene.create.console.setting","scene.create.console.audio","scene.create.console.tel","scene.create.console.adr","scene.create.console.fake","scene.create.console.pictures1","scene.create.console.sound","scene.create.console.soundComponent","scene.create.console.micro","scene.create.console.link","scene.create.console.video","scene.create.console.category","scene.create.console.imageCrop","scene.create.console.cropImage","scene.pageeffect.console","scene.create.console.scene-setting-component","scene.create.console.shape","scene.create.console.randomevent","scene.create.console.statistics"]),angular.module("scene.create.console").controller("ConsoleCtrl",["$scope",function(e){}]),angular.module("scene.create.console").directive("autofocus",function(){return function(e,t,n){setTimeout(function(){t.focus().select()},400)}}).directive("checkCount",function(){return{restrict:"EA",require:"ngModel",link:function(e,t,n,i){var r=parseInt(n.checkCount,10);i.$viewChangeListeners.push(function(){if(countCharacters(i.$modelValue)>r){var e=i.$modelValue.replace(/[^\x00-\xff]/g,"xx"),t=e.substring(0,r).replace(/xx/g,"中").length;i.$setViewValue(i.$modelValue.substring(0,t)),i.$render()}})}}}),angular.module("scene.create.console.setting.anim",["app.directives.uislider","app.directives.limitInput"]),angular.module("scene.create.console.setting.anim").controller("AnimConsoleCtrl",["$scope","$rootScope","sceneService","security",function(e,t,n,i){function r(n,i){var r={anim:n,animClasses:l,count:i,elemId:e.elemDef.id};t.$broadcast("previewCurrentChange",r)}function o(n,i){var r={animations:n,animClasses:i,count:c,elemId:e.elemDef.id};t.$broadcast("previewAllChanges",r)}var a=e.elemDef=n.currentElemDef;e.animations=[],e.types=[],e.directions=[];var s,c,l=[];e.animTypeEnum=[{id:-1,name:"无"},{id:0,name:"淡入",cat:"进入"},{id:1,name:"移入",cat:"进入"},{id:2,name:"弹入",cat:"进入"},{id:20,name:"翻转进入",cat:"进入"},{id:3,name:"中心弹入",cat:"进入"},{id:4,name:"中心放大",cat:"进入"},{id:12,name:"翻滚进入",cat:"进入"},{id:24,name:"翻开进入",cat:"进入"},{id:13,name:"光速进入",cat:"进入"},{id:6,name:"摇摆",cat:"强调"},{id:5,name:"抖动",cat:"强调"},{id:7,name:"旋转",cat:"强调"},{id:8,name:"翻转",cat:"强调"},{id:9,name:"悬摆",cat:"强调"},{id:23,name:"闪烁",cat:"强调"},{id:21,name:"放大抖动",cat:"强调"},{id:22,name:"倾斜摆动",cat:"强调"},{id:10,name:"淡出",cat:"退出"},{id:17,name:"移出",cat:"退出"},{id:19,name:"弹出",cat:"退出"},{id:11,name:"翻转消失",cat:"退出"},{id:14,name:"中心消失",cat:"退出"},{id:18,name:"中心缩小",cat:"退出"},{id:15,name:"翻滚退出",cat:"退出"},{id:25,name:"翻开消失",cat:"退出"},{id:16,name:"光速退出",cat:"退出"}];var d,u,p=[26,27,28];if(!i.isAllowToAccess(i.accessDef.COMP_ANIMATION))for(d=0;d<e.animTypeEnum.length;d++)for(u=0;u<p.length;u++)e.animTypeEnum[d].id==p[u]&&(e.animTypeEnum.splice(d,1),d--);if(e.animDirectionEnum=[{id:0,name:"从左向右"},{id:1,name:"从上到下"},{id:2,name:"从右向左"},{id:3,name:"从下到上"}],a.properties.anim)if(a.properties.anim instanceof Array){if(a.properties.anim.length)for(d=0;d<a.properties.anim.length;d++)if(null!=a.properties.anim[d].type&&-1!=a.properties.anim[d].type){for(e.animations.push(a.properties.anim[d]),u=0,tlen=e.animTypeEnum.length;u<tlen;u++)e.animations[d].type==e.animTypeEnum[u].id&&(e.types[d]=e.animTypeEnum[u]);for(u=0,tlen=e.animDirectionEnum.length;u<tlen;u++)e.animations[d].direction==e.animDirectionEnum[u].id&&(e.directions[d]=e.animDirectionEnum[u])}else a.properties.anim.splice(d,1),d--}else{for(d=0;d<e.animTypeEnum.length;d++)e.animTypeEnum[d].id==a.properties.anim.type&&(e.types[0]=e.animTypeEnum[d]);null!=a.properties.anim.direction?e.directions[0]=e.animDirectionEnum[a.properties.anim.direction]:e.directions[0]=e.animDirectionEnum[0],a.properties.anim.duration=parseFloat(a.properties.anim.duration),a.properties.anim.delay=parseFloat(a.properties.anim.delay),a.properties.anim.countNum=parseInt(a.properties.anim.countNum,10)||1,e.animations.push(a.properties.anim)}a.properties||(a.properties={});var h={type:null,direction:null,duration:2,delay:0,countNum:1,count:null};e.addAnim=function(t){if(!t.originalEvent._constructed){var n=angular.copy(h);n.type=e.animTypeEnum[0].id,n.direction=e.animDirectionEnum[0].id,e.animations.push(n);var i=e.animations.length;e.types[i-1]=e.animTypeEnum[0],e.directions[i-1]=e.animDirectionEnum[0]}},e.removeAnim=function(t,n){n.stopPropagation(),e.animations.splice(t,1),e.types.splice(t,1),e.directions.splice(t,1)},e.clear=function(){e.animations=[]},e.$watch("animations",function(t,n){t!=n&&(a.properties.anim=e.animations)},!0),e.$watch("types",function(t,n){if(t&&t!=n)for(var i=0;i<t.length;i++)n[i]&&t[i].id!=n[i].id&&r(e.animations[i],i)},!0),e.$watch("directions",function(t,n){if(t&&t!=n)for(var i=0;i<t.length;i++)n[i]&&t[i].id!=n[i].id&&r(e.animations[i],i)},!0),e.previewAnim=function(t){if(!t.originalEvent._constructed){for(var n=angular.copy(e.animations),i=[],r=[],a=0;a<n.length;a++)null!=n[a].type&&-1!=n[a].type?(i.push(n[a]),r[a]=eqxCommon.convertType(n[a])):(n.splice(a,1),a--);c=0,o(i,r)}},e.changeAnimation=function(e,t){s=eqxCommon.convertType(e),l[t]=s}}]),angular.module("scene.create.console.audio",[]),angular.module("scene.create.console.audio").controller("AudioConsoleCtrl",["$scope","$rootScope","$sce","$timeout","$modal","fileService","obj",function(e,t,n,i,r,o,a){function s(e){o.getFileByCategory(e,10,"2","1").success(function(e){e.success?t.$broadcast("sounds.update",e):alert(e.msg)}).error(function(){alert("网络连接超时，请稍后重试")})}function c(e){o.getFileByCategory(e,10,"2","0").success(function(e){e.success?t.$broadcast("sounds.update",e):alert(e.msg)}).error(function(){alert("网络连接超时，请稍后重试")})}e.PREFIX_FILE_HOST=PREFIX_FILE_HOST;var l=e.sounds=[];e.pagination={},e.getSounds=function(t){e.isMySound?c(t):s(t)},e.selectTab=function(t){e.isMySound=t,e.getSounds()},e.$on("sounds.update",function(t,n){l.length=0,$.each(n.list,function(e,t){l.push({id:t.id,name:t.name,src:t.path,isPlaying:!1})});var i=n.map;e.pagination={totalItems:i.count,pageSize:i.pageSize,currentPage:i.pageNo,numPages:Math.ceil(i.count/i.pageSize)}}),e.model={bgAudio:{url:a.url?a.url:"",type:a.type?a.type:"3"},compType:"bgAudio"},i(function(){"1"==a.type&&a.url&&(e.model.type1=a.url),"2"==a.type&&a.url&&(e.model.type2=n.trustAsResourceUrl(PREFIX_FILE_HOST+a.url)),"3"==a.type&&a.url&&(e.model.type3=n.trustAsResourceUrl(PREFIX_FILE_HOST+a.url))}),e.goUpload=function(){r.open({windowClass:"upload-console",templateUrl:"my/upload.tpl.html",controller:"UploadCtrl",resolve:{category:function(){return{categoryId:0,fileType:2}}}}).result.then(function(e){c()})},e.playAudio=function(e){$("#audition"+e)[0].play()},e.pauseAudio=function(e){$("#audition"+e)[0].pause()},e.authError="",e.confirm=function(){if("1"==e.model.bgAudio.type){if(!e.model.type1)return $('input[type="text"]').focus(),void(e.authError="链接地址不能为空");e.model.bgAudio.url=e.model.type1}if("2"==e.model.bgAudio.type){if(!e.model.selectedMyAudio)return $("select").focus(),void(e.authError="您没有选择音乐");e.model.bgAudio.url=e.model.selectedMyAudio.path}if("3"==e.model.bgAudio.type){if(!e.model.selectedAudio)return $("select").focus(),void(e.authError="您没有选择音乐");e.model.bgAudio.url=e.model.selectedAudio.path}e.$close(e.model)},e.cancel=function(){e.$dismiss()}}]),angular.module("scene.create.console.bg",["services.file","scene.my.upload","app.directives.responsiveImage","app.directives.rightclick","services.file.upload","services.i18nNotifications","app.directives.autoclose"]),angular.module("scene.create.console.bg").controller("BgConsoleCtrl",["$scope","$timeout","$rootScope","$interval","$modal","ModalService","sceneService","fileService","localizedMessages","obj","uploaderService","i18nNotifications","security","dataCacheService",function(e,t,n,i,r,o,a,s,c,l,d,u,p,h){
function g(){e.$watch("imgList",function(t){for(var n=0;n<t.length;n++){if(t[n].selected)return void(e.mangeObj.manageAll=!0);e.mangeObj.manageAll=!1}},!0)}function f(){e.systemImages=!1,e.userTagId="",e.sysCatId="",s.getUserFiles1(1,v,m,null,e.userTagId)}var m=e.fileType=l.fileType;e.type=l.type;var v,y=1;e.currentPage=1,e.systemImages=!0,e.isAllowedHistory=p.isAllowToAccess(p.accessDef.USERCENTER_HISTORY),e.toPage=1,e.mangeObj={manageAll:!1},e.showObj={showGroup:!1},v=e.pageSize=18,("p"==e.type||"n"==e.type)&&(e.mangeObj.manageAll=!0),e.switchToSystemImages=function(t){e.systemImages="true"===t};var b=function(e){s.getSysCategory(e)},w=function(e,t,n,i,r){s.getSystemFiles1(e,t,n,i,r)};if(e.getSystemFiles=function(){"0"!=e.sysCatId&&(e.mangeObj.manageAll=!1,window.localStorage&&("1"==e.fileType?localStorage.setItem("photoTag",""):localStorage.setItem("backgroundTag","")),e.userTagId="",e.sysCatId="0",e.sysTagList=[],e.sysTagId="",T=[],w(y,v,m))},e.getHistory=function(){e.userTagId="history",s.getFilesHistory(1).then(function(t){t.data.success&&(e.imgList=t.data.list)})},e.$on("sysCategory.update",function(t){$.get(categoryUrl,function(t){e.sysCategoryList=t})}),e.getSysCatAndList=function(t){searchVal="",T=[],e.sysCatId=t,"0"!=t&&"pure"!=t?s.getSysTagByCatId(t):(e.sysTagList=[],e.sysTagId="",angular.forEach(e.imgList,function(e,t){e.selected=!1})),w(y,v,m,t)},e.$on("sysTag.update",function(t){e.sysTagList=s.sysTagList}),e.getSysImgByTag=function(t){T=[],e.sysTagId=t,w(y,v,m,e.sysCatId,t)},e.$watch("currentPage",function(t,n){t!=n&&(e.toPage=t,T=[],e.systemImages?w(t,v,m,e.sysCatId,e.sysTagId):s.getUserFiles1(t,v,m,null,e.userTagId))}),e.getImgByPage=function(){e.currentPage=e.toPage},e.getUserFiles=function(t,n){t!==e.userTagId&&(e.mangeObj.manageAll=!1,window.localStorage&&("1"==e.fileType?localStorage.setItem("photoTag",t):localStorage.setItem("backgroundTag",t)),e.thumbnailList=[],T=[],e.userTagId=t,e.sysCatId="",s.getUserFiles1(n,v,m,null,t))},e.$on("imgList.update",function(t){e.imgList=s.imgList,e.totalItems=s.totalItems,e.currentPage=s.pageNo}),window.localStorage){var E="1"==e.fileType?localStorage.getItem("photoTag"):localStorage.getItem("backgroundTag");E?(e.getUserFiles(parseInt(E,10)),e.switchToSystemImages(!1),e.sysCatId=""):(w(y,v,m),e.sysCatId="0")}else w(y,v,m);b(m);var S=null;e.createTag=function(){return e.tagList.length>=8?void(e.authError="最多能创建8个自定义分组！"):void(S=r.open({windowClass:"console",templateUrl:"scene/console/category.tpl.html",controller:"CategoryConsoleCtrl"}))};var x=function(){s.getTagList()};x(),e.deleteTag=function(e,t){o.openConfirmDialog({msg:"确定删除此分组?"},function(){s.deleteTag(e,t)})},e.$on("tagList.update",function(t){e.tagList=s.tagList}),e.$on("tagList.delete",function(e){f()});var T=[];e.switchSelect=function(t,n,i,r){if(e.mangeObj.manageAll||!r)if(i.stopPropagation(),t.selected=!t.selected,e.systemImages&&"p"!=l.type&&"n"!=l.type)if(angular.forEach(e.imgList,function(e,n){!e.selected||e.id==t.id&&e.color==t.color||(e.selected=!1)}),t.selected){var o;T=[],t.path?o={id:t.id,src:t.path,shape:t.shape}:t.color&&(o={color:t.color}),T.push(o)}else T=[];else if(t.selected)e.mangeObj.manageAll=!0,T.push({id:t.id,src:t.path||t.tmbPath,shape:t.shape});else{g();for(var a in T)T[a].id==t.id&&T.splice(a,1)}},e.cancelSelect=function(){for(var t in e.imgList)e.imgList[t].selected&&(e.imgList[t].selected=!1);T=[]},e.assignTag=function(t){var n=[];e.showObj.showGroup=!1;for(var i=0;i<T.length;i++)n.push(T[i].id);if(!n.length)return void(e.authError="请先点击管理选择一张图片再进行分组");angular.forEach(e.imgList,function(e,t){e.selected=!1});var r=n.join(",");h.clear("fileService"),s.assignTag(t,r),T=[]},e.$on("tag.assign",function(){u.pushForCurrentRoute("data.assign.success","notify.success")}),e.unbindTag=function(t){for(var n=[],i=0;i<T.length;i++)n.push(T[i].id);if(!n.length)return void(e.authError="请先选择一张图片再解除分组");var r=n.join(",");h.clear("fileService"),s.unbindTag(t,r)},e.$on("tag.unbind",function(){u.pushForCurrentRoute("group.delete.data","notify.success"),s.getUserFiles1(e.currentPage,v,m,null,e.userTagId)}),e.deleteFile=function(t){var n=[];if(!t&&0===T.length)return void(e.authError="请您选中图片后再进行删除操作！");for(var i=0;i<T.length;i++)n.push(T[i].id);var r="";r=e.isAllowedHistory?t?"确定删除此图片？删除后，该图片将在回收站保留3天":"确定删除所选图片？删除后，该图片将在回收站中保留3天":t?"确定删除此图片？":"确定删除所选图片？";var a=t?t:n.join(",");o.openConfirmDialog({msg:r},function(){s.deleteFile(a),h.clear("fileService")})},e.$on("files.delete",function(t){e.sysCatId="",T=[],s.getUserFiles1(e.currentPage,v,m,null,e.userTagId)}),e.replaceImage=function(){if(!T.length)return void(e.authError="请您先选择图片！");var t;if("p"!=l.type&&"n"!=l.type){if(T.length>1)return void(e.authError="只能选择一张图片进行替换！");t=T[0]}else{var n=l.count+T.length,i="p"==l.type?6:10;if(n>i)return e.authError="最多可选择"+(i-l.count)+"张图片",!1;e.picObj=[];for(var r=0;r<T.length;r++)e.picObj.push({width:T[r].shape.width,height:T[r].shape.height,src:T[r].src})}var o={};t&&t.src&&(o={type:"imgSrc",data:t.src,width:t.shape.width,height:t.shape.height,id:t.id}),"0"==m?t.src?e.$close(o):e.$close({type:"backgroundColor",color:t.color}):(("p"==l.type||"n"==l.type)&&(o.selectedImages=e.picObj),e.$close(o))},e.replaceByClick=function(t,n,i){if(!e.mangeObj.manageAll){if("p"==l.type||"n"==l.type)return void e.switchSelect(t,n,i,!0);T=[],(!T.length&&!e.mangeObj.manageAll||e.systemImages)&&(t.path||t.tmbPath?T.push({id:t.id,src:t.path||t.tmbPath,shape:t.shape}):t.color&&T.push({color:t.color}),e.replaceImage())}},e.uploader=d.uploader(m),e.$on("uploadfiles.add",function(t){e.systemImages&&f(),h.clear("fileService"),e.imgList.length==v&&e.imgList.splice(e.imgList.length-e.uploader.queue.length-1,e.uploader.queue.length)});var C;e.$on("thumbnailList.update",function(t,n){for(var i=0;i<e.uploader.queue.length;i++)100==e.uploader.queue[i].progress&&(e.uploader.queue.splice(i,1),C=n,e.imgList.unshift(C));h.clear("fileService")}),e.$on("upload.bg.complete",function(t,n){s.deleteFile(C.id),a.openCropModal(n,function(t){C.tmbPath=t.src,C.id=t.id,e.imgList.unshift(C)},function(e){})}),e.cancel=function(){e.$dismiss()},e.search=function(){searchVal=document.getElementById("search-value").value,searchUrl="/index.php?c=upfile&a=syslist&pageNo=1&pageSize=18&fileType="+m+"&bizType=0&key="+searchVal,window.m(0,1,18,0,"0",0)},window.enterSearchPic=function(){var e=event||window.event||arguments.callee.caller.arguments[0];e&&13==e.keyCode&&(searchVal=document.getElementById("search-value").value,searchUrl="/index.php?c=upfile&a=syslist&pageNo=1&pageSize=18&fileType="+m+"&bizType=0&key="+searchVal,window.m(0,1,18,0,"0",0))},e.$watch("userTagId",function(t,n){var i=PREFIX_URL+"index.php?c=upfile&a=upload&bizType=0&fileType="+m;t&&(i+="&tagId="+t),e.uploader.url=i})}]),angular.module("scene.create.console.button",[]),angular.module("scene.create.console.button").controller("ButtonConsoleCtrl",["$scope","$timeout","localizedMessages","obj",function(e,t,n,i){e.model={title:i.properties.title},e.authError="",e.buttons=[{id:1,text:"点击提交",btnStyle:{backgroundColor:"#08a1ef",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:2,text:"立即提交",btnStyle:{backgroundColor:"rgb(255, 255, 255)",height:"30px","text-align":"center","line-height":"30px",color:"rgb(0, 0, 0)"}},{id:3,text:"提交信息",btnStyle:{backgroundColor:"#f6b223",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:4,text:"立即参加",btnStyle:{height:"30px",backgroundColor:"#333333","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:5,text:"提交表单",btnStyle:{height:"30px",backgroundColor:"#a0d86b","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:6,text:"马上订购",btnStyle:{height:"30px",backgroundColor:"#ff6666","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}}],angular.forEach(e.buttons,function(t,n){""!==e.model.title&&i.css.backgroundColor&&i.css.backgroundColor==t.btnStyle.backgroundColor&&(e.btnIndex=n)}),e.confirm=function(){return e.model.title&&0!==e.model.title.length?void e.$close(e.model):(e.authError="按钮名称不能为空",void $('.bg_console input[type="text"]').focus())},e.cancel=function(){e.$dismiss()},e.chooseTabButton=function(t,n){e.model.title=t.text,e.model.btnStyle=t.btnStyle,e.btnIndex=n}}]),angular.module("scene.create.console.category",["services.file"]),angular.module("scene.create.console.category").controller("CategoryConsoleCtrl",["$scope","$timeout","localizedMessages","fileService",function(e,t,n,i){e.category={},e.authError="",e.confirm=function(){return e.category.name&&e.category.name.trim()?countCharacters(e.category.name)>16?void(e.authError="分类名称不能超过16个字符"):(i.createTag(e.category.name),void e.$close()):void(e.authError="请输入分类名称！")},e.cancel=function(){e.$dismiss()}}]),angular.module("scene.create.console.counter",[]),angular.module("scene.create.console.counter").controller("CounterConsoleCtrl",["$scope","$timeout","localizedMessages","obj","$modal",function(e,t,n,i,r){e.model={title:i.title,properties:{layout:i.properties.layout,size:i.properties.size,color:i.properties.color,icon:i.properties.icon,imgSrc:i.properties.imgSrc}},e.authError="",e.openImageModal=function(){r.open({windowClass:"img_console console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1}}}}).result.then(function(t){e.model.properties.icon="",e.model.properties.imgSrc=i.properties.imgSrc=t.data},function(e){})},e.confirm=function(){angular.extend(i,e.model);var t=parseInt(i.css.height,10)||0;e.model.properties.imgSrc&&115>t&&(e.model.btnStyle={width:"320px",height:"115px",lineHeight:"115px",backgroundColor:"transparent"}),"counter-tb"===e.model.properties.layout&&(!e.model.properties.imgSrc&&80>t&&(e.model.btnStyle={height:"80px",lineHeight:"80px"}),e.model.properties.imgSrc&&155>t&&(e.model.btnStyle=e.model.btnStyle||{},e.model.btnStyle.height=e.model.btnStyle.lineHeight="155px")),e.$close(e.model)},e.cancel=function(){e.$dismiss()},e.chooseEqfont=function(t){e.model.properties.icon=t,e.model.properties.imgSrc=null}}]),angular.module("scene.create.console.cropImage",["services.file"]).directive("cropImage",["sceneService","fileService","$compile",function(e,t,n){return{restrict:"EAC",scope:{},replace:!0,templateUrl:"scene/console/cropimage.tpl.html",link:function(n,i,r){function o(){g.css.width/g.css.height>p/h?(d=parseInt(g.css.width*p/g.css.width,10),u=parseInt(g.css.height*p/g.css.width,10)):(d=parseInt(g.css.width*h/g.css.height,10),u=parseInt(g.css.height*h/g.css.height,10));var e=(p-d)/2,t=(h-u)/2,n=(p-d)/2+d,i=(h-u)/2+u;l=[0,0,p,h],v=g.css.width/g.css.height,c=[e,t,n,i]}function a(e){$(".cropWidth").html(parseInt(e.w,10)),$(".cropHeight").html(parseInt(e.h,10))}n.PREFIX_FILE_HOST=PREFIX_FILE_HOST;var s,c,l,d,u,p,h,g=e.currentElemDef,f=e.currentElemDef.properties.src,m=$("#target"),v=g.css.width/g.css.height;n.fit=!0,n.lockRatio=!1,n.$on("changeElemDef",function(e,t){g=t,n.fit=!0,n.lockRatio=!1,g.properties.src!=f?(f=g.properties.src,s.setImage(PREFIX_FILE_HOST+f),m.unbind("load").attr("src",PREFIX_FILE_HOST+f).load(function(){p=this.width,h=this.height,n.preSelectImage(f),n.$apply()})):(n.preSelectImage(f),n.$apply())}),n.preSelectImage=function(e){s?(o(),s.setOptions({aspectRatio:v,setSelect:c})):m.attr("src",PREFIX_FILE_HOST+e).load(function(){p=this.width,h=this.height,m.Jcrop({onChange:a,keySupport:!1,setSelect:[0,0,100,100],boxHeight:320,boxWidth:680},function(){s=this}),e&&(o(),s.setOptions({aspectRatio:v,setSelect:c}))})},n.preSelectImage(f),n.$watch("lockRatio",function(e,t){if(s){var n=s.tellSelect();n.w=parseInt(n.w,10),n.h=parseInt(n.h,10),e?s.setOptions({aspectRatio:n.w/n.h}):s.setOptions({aspectRatio:null})}}),n.$watch("fit",function(e,t){if(s)if(e){var n=s.tellSelect();n.x=parseInt(n.x,10),n.y=parseInt(n.y,10),n.x2=parseInt(n.x2,10),n.y2=parseInt(n.y2,10),l=[n.x,n.y,n.x2,n.y2],s.setOptions({aspectRatio:v,setSelect:c})}else s.setOptions({aspectRatio:null,setSelect:l})}),n.crop=function(){var n=e.currentElemDef,r=s.tellSelect();return 0===r.w||0===r.h?void $(i).hide():(r.x=parseInt(r.x,10),r.y=parseInt(r.y,10),r.w=parseInt(r.w,10),r.h=parseInt(r.h,10),r.x2=parseInt(r.x2,10),r.y2=parseInt(r.y2,10),r.src=$("#target").attr("src").split(PREFIX_FILE_HOST)[1],void t.cropImage(r).then(function(e){var t={type:"imgSrc",data:e.data.obj,width:r.w,height:r.h};n.properties.src=t.data;var o=t.width/t.height,a=$("#"+n.id),s=$("#inside_"+n.id).width(),c=$("#inside_"+n.id).height(),l=s/c;o>=l?(c=s/o,$("#inside_"+n.id).height(c),n.css.height=c,n.properties.height=c,a.outerHeight(c),a.outerWidth(s),a.css("marginLeft",0),a.css("marginTop",0)):(s=c*o,$("#inside_"+n.id).width(s),n.css.width=s,n.properties.width=s,a.outerWidth(s),a.outerHeight(c),a.css("marginTop",0),a.css("marginLeft",0)),a.attr("src",PREFIX_FILE_HOST+t.data),n.properties.imgStyle={},n.properties.imgStyle.width=a.outerWidth(),n.properties.imgStyle.height=a.outerHeight(),n.properties.imgStyle.marginTop=a.css("marginTop"),n.properties.imgStyle.marginLeft=a.css("marginLeft"),$(i).hide()},function(t){n.properties.src||e.deleteElement(n.id)}))},n.cancel=function(){$(i).hide()}}}}]),angular.module("scene.create.console.fake",[]),angular.module("scene.create.console.fake").controller("FakeConsoleCtrl",["$scope","type",function(e,t){e.type=t}]),angular.module("scene.create.console.imageCrop",["services.file"]).controller("imageCropCtrl",["$translate","$rootScope","$scope","imageCropService","obj","dataCacheService",function(e,t,n,i,r,o){var a;"square"==r.type?a=n.cropOption={type:r.type,title:"图片裁切",desc:"图片将按照要求的比例进行裁切",showItems:!1,imgSrc:r.properties.src,cropItems:[{ratio:1,desc:"正方形比例"}]}:3==r.type?a=n.cropOption={type:r.type,title:"背景裁切",desc:"背景图将按照要求的比例进行裁切",showItems:!1,imgSrc:r.properties.src,cropItems:[{ratio:640/1008,desc:"背景图比例"}]}:4==r.type&&(a=n.cropOption={type:r.type,title:"图片裁切",desc:"请根据你的需求，点击右侧常用比例进行裁切",showItems:!0,imgSrc:r.properties.src,cropItems:[{value:1,ratio:0,desc:"原图比例"},{value:2,ratio:1,desc:"1:1"},{value:3,ratio:4/3,desc:"4:3"},{value:4,ratio:.75,desc:"3:4"},{value:5,ratio:320/486,desc:"标准屏比例"},{value:6,ratio:320/243,desc:"1/2屏比例"},{value:7,ratio:320/162,desc:"1/3屏比例"},{value:8,ratio:-1,desc:"自定义",lock:!1}]}),a.currentItem=a.cropItems[0],n.cropItemChange=function(e){null==e.lock&&(a.cropItems[7].lock=!1),a.currentItem=e,t.$broadcast("cropItem.change",e)},n.ok=function(){t.$broadcast("cropImage.ok",r)},n.cancel=function(){n.$dismiss(r.properties.src)}}]).factory("imageCropService",["$rootScope","fileService",function(e,t){var n={};return n.cropImage=function(n){t.cropImage(n).success(function(t){if(t.success){var i={width:n.w,height:n.h,src:t.map.path,id:t.map.id};e.$broadcast("crop.success",i)}else alert(t.msg),e.$broadcast("crop.fail")}).error(function(){alert("网络连接超时，请稍后重试"),e.$broadcast("crop.fail")})},n}]).directive("eqxCropPreview",["imageCropService","dataCacheService",function(e,t){function n(e,n){i(e,n),e.$on("$destroy",function(){p=!1}),e.$on("cropItem.change",function(e,t){o(t)}),e.$on("cropImage.ok",function(i,r){p||(u=r,t.clear("fileService"),a(e,n))}),e.$on("crop.success",function(t,n){4==u.type&&s(n),e.$close(n)})}function i(e,t){t.hide().load(function(){t.show();var n=$(".image_crop"),i={width:n.width(),height:n.height()},o=i.width/i.height;l={width:this.width,height:this.height};var a,s=l.width/l.height;l.width>i.width||l.height>i.height?s>o?(t.css({width:i.width,height:i.width/s}),a={position:"absolute",top:"50%",marginTop:-i.width/s/2}):(t.css({width:i.height*s,height:i.height}),a={margin:"auto"}):a={position:"absolute",left:"50%",top:"50%",marginLeft:-l.width/2,marginTop:-l.height/2},d={width:t.width(),height:t.height()},r(e,t,a)})}function r(e,t,n){var i=t.parent().attr("ctype"),r=d.width,o=d.height;if(3==i||"square"==i){var a=e.$parent.cropOption.currentItem;r>o?r=o*a.ratio:o=r/a.ratio,t.Jcrop({keySupport:!1,aspectRatio:a.ratio,allowSelect:!1,setSelect:[0,0,r,o],onRelease:function(){this.setOptions({setSelect:[0,0,r,o]})}},function(){c=this})}else t.Jcrop({keySupport:!1,aspectRatio:r/o,allowSelect:!1,setSelect:[0,0,r,o],onRelease:function(){this.setOptions({setSelect:[0,0,r,o]})}},function(){c=this});$(".jcrop-holder").css(n)}function o(e){var t,n=d.width,i=d.height;if(-1===e.ratio){var r=c.tellSelect();t=e.lock?{aspectRatio:r.w/r.h,setSelect:[0,0,r.w,r.h]}:{aspectRatio:0,setSelect:[0,0,r.w,r.h]}}else 0===e.ratio?t={aspectRatio:n/i,setSelect:[0,0,n,i]}:(n>i?n=i*e.ratio:i=n/e.ratio,t={aspectRatio:n/i,setSelect:[0,0,n,i]});c.setOptions(t)}function a(t,n){var i=c.tellSelect();if(i.w===d.width&&i.h===d.height||0===i.w&&0===i.h){if(!u)return;return void t.$dismiss(u.properties.src)}p=!0;var r=l.width/d.width;i.w=parseInt(i.w*r,10),i.h=parseInt(i.h*r,10),i.x=parseInt(i.x*r,10),i.y=parseInt(i.y*r,10),i.src=n.attr("src").split(PREFIX_FILE_HOST)[1],i.x+i.w>l.width&&(i.w=l.width-i.x),i.y+i.h>l.height&&(i.h=l.height-i.y),3==u.type?i.fileType=0:i.fileType=1,delete i.x2,delete i.y2,u.cw&&(i.cw=u.cw),e.cropImage(i)}function s(e){var t=u;t.properties.src=e.src;var n=e.width/e.height,i=$("#"+t.id),r=$("#inside_"+t.id),o=r.width(),a=r.height(),s=o/a;n>=s?(a=o/n,r.height(a),t.css.height=a,t.properties.height=a,i.outerHeight(a),i.outerWidth(o),i.css("marginLeft",0),i.css("marginTop",0)):(o=a*n,r.width(o),t.css.width=o,t.properties.width=o,i.outerWidth(o),i.outerHeight(a),i.css("marginTop",0),i.css("marginLeft",0)),i.attr("src",PREFIX_FILE_HOST+e.src),t.properties.imgStyle={},t.properties.imgStyle.width=i.outerWidth(),t.properties.imgStyle.height=i.outerHeight(),t.properties.imgStyle.marginTop=i.css("marginTop"),t.properties.imgStyle.marginLeft=i.css("marginLeft")}var c,l,d,u,p=!1;return{link:n}}]),angular.module("scene.create.console.input",[]),angular.module("scene.create.console.input").controller("InputConsoleCtrl",["$scope","$timeout","localizedMessages","obj",function(e,t,n,i){e.model={title:i.title,type:i.type,required:i.properties.required},e.authError="";var r="输入框";e.buttons=[{id:1,text:r,btnStyle:{height:"40px",backgroundColor:"#fff","text-align":"center",borderWidth:"1",borderStyle:"solid",borderColor:"#08a1ef",color:"rgb(0, 0, 0)"}},{id:2,text:r,btnStyle:{height:"40px",backgroundColor:"#fff","text-align":"center",borderWidth:"1",borderStyle:"solid",borderColor:"#fff",color:"rgb(0, 0, 0)"}},{id:3,text:r,btnStyle:{height:"40px",backgroundColor:"#fff","text-align":"center",borderWidth:"1",borderStyle:"solid",borderColor:"#f6b223",color:"rgb(0, 0, 0)"}},{id:4,text:r,btnStyle:{height:"40px",backgroundColor:"#fff","text-align":"center",borderWidth:"1",borderStyle:"solid",borderColor:"#333",color:"rgb(0, 0, 0)"}},{id:5,text:r,btnStyle:{height:"40px",backgroundColor:"#fff","text-align":"center",borderWidth:"1",borderStyle:"solid",borderColor:"#a0d86b",color:"rgb(0, 0, 0)"}},{id:6,text:r,btnStyle:{height:"40px",backgroundColor:"#fff","text-align":"center",borderWidth:"1",borderStyle:"solid",borderColor:"#f66",color:"rgb(0, 0, 0)"}}],angular.forEach(e.buttons,function(t,n){""!==e.model.title&&i.css.borderColor&&i.css.borderColor==t.btnStyle.borderColor&&(e.btnIndex=n)}),e.confirm=function(){return e.model.title&&0!==e.model.title.length?void e.$close(e.model):(e.authError="输入框名称不能为空",void $('input[type="text"]').focus())},e.cancel=function(){e.$dismiss()},e.chooseTabButton=function(t,n){e.model.btnStyle=t.btnStyle,e.btnIndex=n}}]),angular.module("scene.create.console.linkComponent",[]),angular.module("scene.create.console.linkComponent").controller("LinkComponentConsoleCtrl",["$scope","$timeout","localizedMessages","obj","$modal","sceneService",function(e,t,n,i,r,o){e.model={title:i.properties.title,imgSrc:i.properties.imgSrc,url:{link:"external",externalLink:"http://"}},i.properties.url&&(angular.isNumber(i.properties.url)?(e.model.url.link="internal",e.model.url.internalLink=i.properties.url):(e.model.url.link="external",e.model.url.externalLink=decodeURIComponent(i.properties.url.split("=")[2]))),e.authError="",e.buttons=[{id:1,text:"点我购买",btnStyle:{width:"100px",backgroundColor:"rgb(244, 113, 31)",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:2,text:"点开链接",btnStyle:{width:"100px",backgroundColor:"rgb(253, 175, 7)",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:3,text:"马上购买",btnStyle:{width:"100px",backgroundColor:"rgb(121, 196, 80)",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:4,text:"关注我们",btnStyle:{width:"100px",height:"30px",backgroundColor:"#fff","text-align":"center",border:"1px solid #3FB816","line-height":"30px",color:"rgb(0, 0, 0)"}}],e.openImageModal=function(){r.open({windowClass:"img_console console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1}}}}).result.then(function(t){e.model.title="",e.btnIndex=-1,e.model.btnStyle={width:"115px",height:"115px","line-height":"1",backgroundColor:"transparent"},e.model.imgSrc=i.properties.imgSrc=t.data},function(e){})},angular.forEach(e.buttons,function(t,n){""!==e.model.title&&i.css.backgroundColor&&i.css.backgroundColor==t.btnStyle.backgroundColor&&(e.btnIndex=n)}),e.confirm=function(){return null!=e.model.imgSrc||e.model.title&&0!==e.model.title.length?e.model.url.internalLink||e.model.url.externalLink?(i.properties.url="internal"===e.model.url.link?e.model.url.internalLink:e.model.url.externalLink,i.properties.title=e.model.title,void e.$close(e.model)):void(e.authError="链接不能为空"):(e.authError="按钮名称不能为空",void $("#buttonName").focus())},e.cancel=function(){e.$dismiss()},e.chooseTabButton=function(t,n){e.model.title=t.text,e.model.btnStyle=t.btnStyle,e.btnIndex=n,e.model.imgSrc=i.properties.imgSrc=null},e.removeLink=function(t){"external"==t?e.model.url.externalLink=null:"internal"==t&&(e.model.url.internalLink=0),e.model.url.link=""},e.changed=function(){"external"==e.model.url.link?e.model.url.internalLink=0:e.model.url.externalLink="http://"},e.selectRadio=function(t){"external"==t?e.model.url.link="external":"internal"==t&&(e.model.url.link="internal"),e.changed()},e.getPageNames=function(){var t=i.sceneId;o.getPageNames(t).then(function(t){e.pageList=t.data.list,e.pageList.unshift({id:0,name:"无"}),angular.forEach(e.pageList,function(e,t){e.name||(e.name="第"+e.num+"页")}),i.properties.url&&angular.isNumber(i.properties.url)&&(e.model.url.link="internal",e.model.url.internalLink=i.properties.url)})},e.getPageNames()}]),angular.module("scene.create.console.link",["services.scene"]),angular.module("scene.create.console.link").directive("limitLinkLength",["ModalService",function(e){var t=40;return{restrict:"A",require:"?ngModel",link:function(n,i,r,o){i.blur(function(){var n=i.val()||"";n.length>t&&e.openMsgDialog({msg:'<div align="left">提示：链接过长有可能会导致链接组件打不开，建议生成短链接后再使用。生成短链接地址<a href="http://dwz.cn" target="_blank"><font color="#08A1EF">http://dwz.cn</font></a></div>'},function(){})})}}}]),angular.module("scene.create.console.link").controller("LinkConsoleCtrl",["$scope","$timeout","obj","sceneService",function(e,t,n,i){e.url={},e.url.externalLink="http://";var r;e.confirm=function(){"external"==e.url.link?r=e.url.externalLink:"internal"==e.url.link&&(r=e.url.internalLink.id),e.$close(r)},e.cancel=function(){e.$dismiss()},e.removeLink=function(t){"external"==t?e.url.externalLink="http://":"internal"==t&&(e.url.internalLink=e.pageList[0]),e.url.link=""},e.changed=function(){"external"==e.url.link?e.url.internalLink=e.pageList[0]:e.url.externalLink="http://"},e.selectRadio=function(t){e.url.link||("external"==t?e.url.link="external":"internal"==t&&(e.url.link="internal"))},e.getPageNames=function(){var t=n.sceneId;i.getPageNames(t).then(function(t){e.pageList=t.data.list,e.pageList.unshift({id:0,name:"无"}),e.url.internalLink=e.pageList[0],angular.forEach(e.pageList,function(t,i){t.name||(t.name="第"+t.num+"页"),n.properties.url&&n.properties.url==t.id&&(e.url.link="internal",e.url.internalLink=t)}),n.properties.url&&isNaN(n.properties.url)&&(e.url.link="external",e.url.externalLink=decodeURIComponent(n.properties.url.split("=")[2]))})},e.getPageNames()}]),angular.module("scene.create.console.map",["app.directives.comp.editor"]),angular.module("scene.create.console.map").controller("MapConsoleCtrl",["$scope","sceneService","$timeout",function(e,t,n){var i=null,r=null;e.address={address:"",lat:"",lng:""},e.search={address:""},e.searchResult=[],n(function(){i=new BMap.Map("l-map"),i.addControl(new BMap.NavigationControl),i.centerAndZoom(new BMap.Point(116.404,39.915),12);var t={onSearchComplete:function(t){r.getStatus()==BMAP_STATUS_SUCCESS&&(e.searchResult=t.Fn,e.$apply())}};r=new BMap.LocalSearch(i,t)}),e.searchAddress=function(){r.search(e.search.address)},e.setPoint=function(t,n,r){e.address.address=r,e.address.lat=t,e.address.lng=n,i.clearOverlays();var o=new BMap.Point(n,t),a=new BMap.Marker(o);i.addOverlay(a);var s=new BMap.Label(r,{offset:new BMap.Size(20,(-10))});a.setLabel(s),i.centerAndZoom(o,12)},e.resetAddress=function(){e.$close(e.address)},e.cancel=function(){e.$dismiss()}}]),angular.module("scene.create.console.micro",["app.directives.addelement","services.scene"]),angular.module("scene.create.console.micro").controller("MicroConsoleCtrl",["$scope","$timeout","localizedMessages","obj","sceneService",function(e,t,n,i,r){e.model||(e.model={});var o=[];e.isSelected=[],e.backgroundColors=[{backgroundColor:"#D34141"},{backgroundColor:"#000"},{backgroundColor:"#23A3D3"},{backgroundColor:"#79C450"},{backgroundColor:"#fafafa"}],e.labelNames=[{id:1,title:"栏目一",color:{backgroundColor:""}},{id:2,title:"栏目二",color:{backgroundColor:""}},{id:3,title:"栏目三",color:{backgroundColor:""}},{id:4,title:"栏目四",color:{backgroundColor:""}}],e.model.color=i.properties.labels[0].color.backgroundColor,e.selectColor=function(t){e.model.color=t.backgroundColor,angular.forEach(e.labelNames,function(e,n){e.color.backgroundColor&&(e.color.backgroundColor=t.backgroundColor)})},angular.forEach(i.properties.labels,function(t,n){angular.forEach(e.labelNames,function(e,n){t.id==e.id&&(e.title=t.title,e.color.backgroundColor=t.color.backgroundColor,e.link=t.link,e.selected=!0,t.mousedown=!1)})}),e.confirm=function(){o=[];var t=0,n=0;angular.forEach(e.labelNames,function(e,i){e.selected&&(e.link?o.push(e):n++,t++)}),2>t?alert("导航标签不能少于两个！"):n>0?alert("每个导航必须有链接页面！"):e.$close(o)},e.cancel=function(){e.$dismiss()},e.switchLabel=function(t,n){e.label=t,t.selected?e.labelIndex==n?(t.color.backgroundColor="",t.selected=!1,t.mousedown=!1):(e.labelIndex=n,t.mousedown=!0):(t.color.backgroundColor=e.model.color,e.labelIndex=n,t.selected=!0,t.mousedown=!0),t.mousedown?(e.model.title=t.title,t.link?e.model.link=e.pageList[t.link]:e.model.link=e.pageList[0]):(e.model.title="",e.model.link=e.pageList[0])},e.selectLink=function(t){e.label.mousedown&&(e.label.link=t.num,console.log(e.labelNames))},e.changeLabelName=function(){e.label.mousedown&&(e.label.title=e.model.title)},e.getPageNames=function(){var t=i.sceneId;r.getPageNames(t).then(function(t){e.pageList=t.data.list,e.pageList.unshift({id:0,name:"无"}),angular.forEach(e.pageList,function(e,t){e.name||(e.name="第"+e.num+"页")}),e.model.link=e.pageList[0]})},e.getPageNames()}]),angular.module("scene.create.console.pictures",["services.file"]).controller("picturesCtrl",["$scope","$timeout","$rootScope","$modal","picturesService","obj",function(e,t,n,i,r,o){var a=530,s=265,c=e.picStyles=utilPictures.getPicStyle();e.currentImageIndex=-1;var l=angular.copy(o),d=e.position=l.css;if(null!=d.width&&null!=d.height){var u=d.width/d.height,p=a/s;u>p?(d.width=a,d.height=a/u):(d.height=s,d.width=s*u)}var h=e.properties=l.properties;h.autoPlay=null==h.autoPlay||h.autoPlay,h.interval=null==h.interval?2e3:h.interval,h.picStyle=null==h.picStyle?c[0]:utilPictures.getPicStyle(h.picStyle),h.bgColor=null==h.bgColor?"rgba(255,255,255,1)":h.bgColor,h.children=null==h.children?[]:h.children,r.setImages(h.children),e.authError="",e.choosePic=function(){return h.children.length>=6?void(e.authError="最多可选择6张图片"):void i.open({windowClass:"console img_console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1,type:"p",count:h.children.length,elemDef:o}}}}).result.then(function(e){$.each(e.selectedImages,function(e,t){r.addImages({src:t.src,desc:"",height:t.height,width:t.width})})},function(){})},e.ok=function(){return console.log(h),0===h.children.length?void(e.authError="请选择图片"):(h.picStyle=h.picStyle.value,o.properties=h,void e.$close(h))},e.cancel=function(){e.$dismiss()},e.$on("currentImage.update",function(t,n){e.currentImageIndex=n}),e.$on("images.add",function(e,t){h.children=t}),e.$on("images.update",function(e,t){h.children=t})}]).factory("picturesService",["$rootScope","fileService",function(e,t){var n,i,r={},o=[];return r.setJcrop=function(t){e.$broadcast("jcrop.update",t)},r.setImageSize=function(t){e.$broadcast("image.update",t)},r.setCurrentImage=function(t){i=t,e.$broadcast("currentImage.update",t)},r.getCurrentImage=function(){return i},r.addImages=function(t){o.push(t),e.$broadcast("images.add",o)},r.updateImages=function(t,n){o.splice(t,1,n),e.$broadcast("images.update",o)},r.deleteImages=function(t){o.splice(t,1),e.$broadcast("images.update",o)},r.setImages=function(e){return o=e},r.getImages=function(){return o},r.setProperties=function(e){n=e},r.getProperties=function(){return n},r.cropImage=function(n){t.cropImage(n).success(function(t){if(t.success){var i={width:n.w,height:n.h,desc:"",src:t.obj};e.$broadcast("crop.success",i)}else alert(t.msg)}).error(function(){alert("网络连接超时，请稍后重试")})},r}]).directive("eqxPicturesImageCrop",["$compile","picturesService",function(e,t){return{link:function(n,i){var r=$(i),o=$(".pic-preview"),a={width:o.width(),height:o.height()};n.showOperation=!0;var s,c='<div class="operation" ng-show="!showOperation"><a class="quxiao" ng-click="cropCancel()">取消</a><a class="finish" ng-click="cropOk()">完成</a></div>';n.$on("image.update",function(e,t){s={width:t.width,height:t.height}}),n.$on("jcrop.update",function(i,l){o.append(e(c)(n)),n.showOperation=!0,n.$apply();var d=o.children("img"),u={width:d.width(),height:d.height()};r.removeClass("hover").unbind("click").click(function(){var e=t.getImages();0!==e.length&&(n.showOperation=$(this).hasClass("hover"),n.showOperation?($(this).removeClass("hover"),l.release(),l.disable()):($(this).addClass("hover"),l.setSelect([0,0,u.width,u.height]),l.enable()))}),n.cropOk=function(){var e=l.tellSelect();if(!(e.w===a.width&&e.h===a.height||0===e.w&&0===e.h)){var n=s.width/u.width;e.w=parseInt(e.w*n,10),e.h=parseInt(e.h*n,10),e.x=parseInt(e.x*n,10),e.y=parseInt(e.y*n,10),e.x2=parseInt((e.w+e.x)*n,10),e.y2=parseInt((e.h+e.y)*n,10),e.src=d.attr("src").split(PREFIX_FILE_HOST)[1],t.cropImage(e)}},n.cropCancel=function(){n.showOperation=!0,r.removeClass("hover"),l.release(),l.disable()}})}}}]).directive("eqxPicturesImagePreview",["picturesService",function(e){return{link:function(t,n){var i,r,o=$(n),a=$(".pic-preview"),s={width:a.width(),height:a.height()},c=s.width/s.height;o.hide(),o.load(function(){o.show(),r={width:this.width,height:this.height},e.setImageSize(r);var t,n=r.width/r.height;n>c?($(this).css({width:s.width,height:s.width/n}),t={position:"absolute",top:"50%",marginTop:-s.width/n/2}):($(this).css({width:s.height*n,height:s.height}),t={margin:"auto"}),o.Jcrop({keySupport:!1,aspectRatio:c},function(){i=this}),$(".jcrop-holder").css(t),e.setJcrop(i),i.disable()})}}}]).directive("eqxPicturesImageClick",["$compile","picturesService",function(e,t){function n(t,n){$(".pic-preview").html(e('<img eqx-pictures-image-preview ng-src="'+n+'" />')(t))}return{link:function(e,i){var r=$(i);r.click(function(){if(!r.hasClass("hover")){var i=r.index();t.setCurrentImage(i),n(e,$(this).find(".pic-img").attr("src"))}}),r.children(".delete-img").click(function(n){n.stopPropagation(),r.hasClass("hover")&&$(".pic-preview").empty();var i=r.index();
t.deleteImages(i);var o=t.getCurrentImage();o>i?t.setCurrentImage(--o):i===o&&t.setCurrentImage(-1),e.$apply()}),e.$on("crop.success",function(i,o){if(r.hasClass("hover")){var a=PREFIX_FILE_HOST+o.src;n(e,a);var s=r.index();t.updateImages(s,o)}})}}}]),angular.module("scene.create.console.pictures1",["services.file"]).controller("pictures1Ctrl",["$translate","$rootScope","$scope","$modal","picturesCropService","obj",function(e,t,n,i,r,o){function a(e){c.currentImage={index:e,src:p.children[e].src+"?t="+Date.now()}}function s(e,t){$("<img>").attr("src",PREFIX_FILE_HOST+t).load(function(){$.extend(g.items[e],{coordinate:{x:0,y:0,x2:this.width,y2:this.height,w:this.width,h:this.height,src:t,fileType:1,index:e},realSize:{width:this.width,height:this.height}})})}var c=n.imageOption={title:"图集组件",desc:"通过图片裁切可制作超酷图集",showCrop:!1,showLoading:!1,currentImage:{index:-1,src:""}},l=n.cropOption={showItems:!0,imgSrc:o.properties.src,cropItems:[{value:2,ratio:1,desc:"1:1"},{value:3,ratio:4/3,desc:"4:3"},{value:4,ratio:.75,desc:"3:4"},{value:5,ratio:320/486,desc:"标准屏比例"},{value:6,ratio:320/243,desc:"1/2屏比例"},{value:7,ratio:320/162,desc:"1/3屏比例"},{value:8,ratio:-1,desc:"自定义",lock:!1}]};l.currentItem=l.cropItems[0];var d=n.picStyles=utilPictures.getPicStyle(),u=angular.copy(o),p=n.properties=u.properties;p.autoPlay=null==p.autoPlay||p.autoPlay,p.interval=null==p.interval?2e3:p.interval,p.picStyle=null==p.picStyle?d[0]:utilPictures.getPicStyle(p.picStyle),p.bgColor=null==p.bgColor?"rgba(255,255,255,0)":p.bgColor,p.children=null==p.children?[]:p.children,p.children.length>0&&(c.showCrop=!0,a(0));for(var h=0;6>h;h++)p.children[h]?s(h,p.children[h].src):p.children.push({});var g=r.getCoordinateObj();n.cropItemChange=function(e){null==e.lock&&(l.cropItems[6].lock=!1),l.currentItem=e,t.$broadcast("cropItem.change",e)},n.addPictures=function(e,t,n){e.stopPropagation();var r=0;n?$.each(p.children,function(e,t){t.src&&r++}):r=5,i.open({windowClass:"console img_console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1,type:"p",count:r,elemDef:o}}}}).result.then(function(e){c.showCrop=!0;var i=t,r=0,o=p.children.length;if(n)for(;o>i;){if(!p.children[i++].src){var l=e.selectedImages[r++];p.children[i-1]={src:l.src,desc:"",height:l.height,width:l.width},s(i-1,l.src),a(t)}if(r===e.selectedImages.length)break;i===o&&(i=0)}else{var d=e.selectedImages[0];p.children[t]={src:d.src,desc:"",height:d.height,width:d.width},s(t,d.src),a(t)}})},n.setPicturesSize=function(e){var t,n,i,r=e.children[0],a=r.width/r.height;u.css.width||u.css.height?(t=u.css.width/u.css.height,a>t?(n=u.css.width,i=n/a):(i=u.css.height,n=i*a)):(t=2,a>t?(n=320,i=n/a):(i=160,n=i*a)),o.css.width=n,o.css.height=i},n.delPicture=function(e){p.children[e]={},g.items[e]={},e===c.currentImage.index&&(c.currentImage.index=-1,t.$broadcast("image.delete",e))},n.changePicture=function(e){c.currentImage.index!==e&&a(e)},n.ok=function(){return 0===p.children.length?void(c.desc="请选择图片，最多添加6张"):void(r.getCropping()||(c.showLoading=!0,t.$broadcast("cropImage.ok",p)))},n.cancel=function(){n.$dismiss()},n.$on("crop.complete.all",function(e,t){p.picStyle=p.picStyle.value,$.each(t,function(e,t){p.children[t.index]=t});for(var i=angular.copy(p),r=i.children,o=5;o>=0;o--)r[o].src||r.splice(o,1);n.setPicturesSize(i),n.$close(i)}),n.$on("crop.fail",function(){r.setCropping(!1),c.showLoading=!1})}]).factory("picturesCropService",["$rootScope","fileService",function(e,t){var n,i={},r=[],o=!1,a=0,s=0;return i.getCoordinateObj=function(){return n},i.initCoordinateObj=function(){n={ratio:null,items:[]};for(var e=0;6>e;e++)n.items.push({})},i.setCropCount=function(e){e?a=e:a++},i.getCropCount=function(){return a},i.setCropping=function(e){o=e},i.getCropping=function(){return o},i.cropImage=function(n){t.cropImage(n).success(function(t){if(t.success){var i={width:n.w,height:n.h,src:t.map.path,desc:"",index:t.map.index};r.push(i),s++,a===s&&(a=s=0,e.$broadcast("crop.complete.all",angular.copy(r)),r.length=0)}else alert(t.msg),e.$broadcast("crop.fail")}).error(function(){alert("网络连接超时，请稍后重试"),e.$broadcast("crop.fail")})},i.initCoordinateObj(),i}]).directive("eqxPicturesCropPreview",["picturesCropService",function(e){function t(t,i){var r=e.getCoordinateObj();n(i,r),t.$on("$destroy",function(){c=l=d=null,e.initCoordinateObj(),e.setCropping(!1)}),t.$on("cropItem.change",function(e,t){a(t)}),t.$on("image.delete",function(){$(".image_crop").children("div").remove()}),t.$on("cropImage.ok",function(e,n){s(t,n,r)})}function n(e,t){var n=$(".image_crop"),r={width:n.width(),height:n.height()},o=r.width/r.height;e.hide().load(function(){var n={width:this.width,height:this.height};e.removeAttr("style").show();var a,s=n.width/n.height;n.width>r.width||n.height>r.height?s>o?(e.css({width:r.width,height:r.width/s}),a={position:"absolute",top:"50%",marginTop:-r.width/s/2}):(e.css({width:r.height*s,height:r.height}),a={margin:"auto"}):a={position:"absolute",left:"50%",top:"50%",marginLeft:-n.width/2,marginTop:-n.height/2},l={width:e.width(),height:e.height()};var c=e.attr("index");e.attr("src"),$.extend(t.items[c],{displaySize:l}),i(e,t,a,c)})}function i(e,t,n,i){c&&(c.destroy(),c=null);var o=l.width,a=l.height,s=t.items[i].coordinate;s&&(s.w>o&&(s.w=o,s.h=o/t.ratio),s.h>a&&(s.h=a,s.w=a*t.ratio),s.x2=s.x+s.w,s.y2=s.y+s.h);var u;u=d&&-1===d.ratio?0:t.ratio||o/a,e.Jcrop({keySupport:!1,aspectRatio:u,allowSelect:!1,setSelect:s?[s.x,s.y,s.x2,s.y2]:[0,0,o,a],onRelease:function(){this.setOptions({setSelect:[0,0,o,a]})},onSelect:function(){c&&r(i,t)}},function(){c=this,r(i,t)}),$(".jcrop-holder").css(n)}function r(e,t){var n=c.tellSelect();t.ratio=n.w/n.h,$.extend(t.items[e].coordinate,n),$.each(t.items,function(e,n){var i=n.coordinate;i&&o(i,t)})}function o(e,t){var n=e.w/e.h;n>t.ratio?(e.w=e.h*t.ratio,e.x2=e.x+e.w):(e.h=e.w/t.ratio,e.y2=e.y+e.h)}function a(e){d=e;var t,n=l.width,i=l.height;if(-1===e.ratio){var r=c.tellSelect();t=e.lock?{aspectRatio:r.w/r.h,setSelect:[0,0,r.w,r.h]}:{aspectRatio:0,setSelect:[0,0,r.w,r.h]}}else n>i?n=i*e.ratio:i=n/e.ratio,t={aspectRatio:n/i,setSelect:[0,0,n,i]};c.setOptions(t)}function s(t,n,i){var r=[];$.each(i.items,function(t,n){var a=n.coordinate,s=n.realSize;if(a&&s)if(o(a,i),Math.ceil(s.width/s.height*100)!==Math.ceil(a.w/a.h*100)){if(n.displaySize){var c=s.width/n.displaySize.width;a.w=Math.ceil(a.w*c),a.h=Math.ceil(a.h*c),a.x=Math.ceil(a.x*c),a.y=Math.ceil(a.y*c)}else{var l=a.w/a.h,d=s.width/s.height;d>l?(a.w=Math.ceil(s.height*l),a.h=s.height):(a.w=s.width,a.h=Math.ceil(s.width/l))}a.x+a.w>n.realSize.width&&(a.w=s.width-a.x),a.y+a.h>n.realSize.height&&(a.h=s.height-a.y),a.w===s.width&&a.h===s.height||0===a.w||0===a.h?r.push({src:a.src,desc:"",height:a.h,width:a.w}):(delete a.x2,delete a.y2,e.setCropping(!0),e.cropImage(a),e.setCropCount())}else r.push({src:a.src,desc:"",height:a.h,width:a.w})}),0===e.getCropCount()&&(n.picStyle=n.picStyle.value,n.children=r,t.setPicturesSize(n),t.$close(n))}var c,l,d;return{link:t}}]),angular.module("scene.create.console.radio.checkbox",[]),angular.module("scene.create.console.radio.checkbox").directive("stopPropagation",function(){return function(e,t){t.bind("keydown",function(e){e.stopPropagation()})}}),angular.module("scene.create.console.radio.checkbox").controller("RadioCheckboxConsoleCtrl",["$translate","$scope","$timeout","localizedMessages","obj","ModalService",function(e,t,n,i,r,o){function a(e){var t=$("#optionGroupContainer"),n=t.find(".option-group").eq(e),i=72,r=n.position().top;r>i&&t.scrollTop(t.scrollTop()+(r-i))}var s=JSON.parse(r.choices);t.model={title:r.title,type:r.type,options:s.options,required:r.properties.required},t.buttons=[{id:1,btnStyle:{backgroundColor:"#08a1ef",height:"30px","line-height":"30px",borderWidth:"1px",borderStyle:"solid",borderColor:"#08a1ef",color:"rgb(255, 255, 255)"},properties:{titleStyle:{backgroundColor:"#08a1ef",color:"#ffffff"},optionStyle:{borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:"#08a1ef"}}},{id:2,btnStyle:{backgroundColor:"#fff",height:"30px","line-height":"30px",borderWidth:"1px",borderStyle:"solid",borderColor:"#fff",color:"rgb(0, 0, 0)"},properties:{titleStyle:{backgroundColor:"#fff",color:"#000"},optionStyle:{borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:"#fff"}}},{id:3,btnStyle:{backgroundColor:"#f6b223",height:"30px","line-height":"30px",borderWidth:"1px",borderStyle:"solid",borderColor:"#f6b223",color:"rgb(255, 255, 255)"},properties:{titleStyle:{backgroundColor:"#f6b223",color:"#ffffff"},optionStyle:{borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:"#f6b223"}}},{id:4,btnStyle:{backgroundColor:"#333",height:"30px","line-height":"30px",borderWidth:"1px",borderStyle:"solid",borderColor:"#333",color:"rgb(255, 255, 255)"},properties:{titleStyle:{backgroundColor:"#333",color:"#ffffff"},optionStyle:{borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:"#333"}}},{id:5,btnStyle:{backgroundColor:"#a0d86b",height:"30px","line-height":"30px",borderWidth:"1px",borderStyle:"solid",borderColor:"#a0d86b",color:"rgb(255, 255, 255)"},properties:{titleStyle:{backgroundColor:"#a0d86b",color:"#ffffff"},optionStyle:{borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:"#a0d86b"}}},{id:6,btnStyle:{backgroundColor:"#ff6666",height:"30px","line-height":"30px",borderWidth:"1px",borderStyle:"solid",borderColor:"#ff6666",color:"rgb(255, 255, 255)"},properties:{titleStyle:{backgroundColor:"#ff6666",color:"#ffffff"},optionStyle:{borderBottomWidth:"1px",borderBottomStyle:"solid",borderBottomColor:"#ff6666"}}}],angular.forEach(t.buttons,function(e,n){r.properties.titleStyle&&r.properties.titleStyle.backgroundColor==e.properties.titleStyle.backgroundColor&&(t.btnIndex=n)}),t.chooseTabButton=function(e,n){t.model.btnStyle=e.btnStyle,t.btnIndex=n,$.extend(r.css,{borderStyle:e.btnStyle.borderStyle,borderColor:e.btnStyle.borderColor})},t.authError="",t.addNewOption=function(e){t.model.options.length<8?(++s.seq,t.model.options.splice(e+1,0,{id:s.seq,label:"选项"+s.seq}),setTimeout(function(){a(e)})):o.openMsgDialog({msg:"（您可以添加八个选项，每个选项最多请不要超过41字）"})},t.deleteTheOption=function(e){t.model.options.length>1&&o.openConfirmDialog({msg:"您确定要删除内容为“"+t.model.options[e].label+"”的选项？<br/>删除选项后，将导致该选项已收集的数据无法正确地显示。"},function(){t.model.options.splice(e,1)})},t.confirm=function(){return t.model.title&&0!==t.model.title.length?(angular.forEach(t.model.options,function(e){delete e.$$hashKey}),r.choices=JSON.stringify(s),r.properties.required=t.model.required,(t.btnIndex||0===t.btnIndex)&&$.extend(r.properties,t.buttons[t.btnIndex].properties),void t.$close(t.model)):(t.authError="输入框名称不能为空",void $("#radioTitle").focus())},t.cancel=function(){t.$dismiss()}}]),angular.module("scene.create.console.randomevent",["app.directives.responsiveImage"]),angular.module("scene.create.console.randomevent").controller("RandomEventCtrl",["$translate","$scope","$rootScope","randomEventService","$modal","obj",function(e,t,n,i,r,o){o.properties.pics.length?t.picList=o.properties.pics:t.picList=[],t.delImage=function(e){t.picList.splice(e,1)},t.replaceImage=function(e){console.log(e),r.open({windowClass:"console img_console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1,type:"n",count:9,elemDef:o}}}}).result.then(function(n){t.picList[e]=n.selectedImages[0]},function(){})},t.choosePic=function(){return t.picList.length>=10?void(t.authError="最多可选择10张图片"):void r.open({windowClass:"console img_console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1,type:"n",count:t.picList.length,elemDef:o}}}}).result.then(function(e){$.each(e.selectedImages,function(e,n){t.picList.unshift(n)})},function(){})},t.confirm=function(){t.$close(t.picList)},t.cancel=function(){t.$dismiss()}}]).factory("randomEventService",["$rootScope",function(e){var t={};return t}]),angular.module("scene.create.console.rating",["common.directives.inputColor"]),angular.module("scene.create.console.rating").controller("RatingConsoleCtrl",["$translate","$scope","$timeout","localizedMessages","obj",function(e,t,n,i,r){t.model={title:r.title,properties:{icon:r.properties.icon,size:r.properties.size,color:r.properties.color,required:r.properties.required}},t.authError="",t.confirm=function(){return t.model.title&&0!==t.model.title.length?($.extend(!0,r,t.model),void t.$close(t.model)):(t.authError="标题名称不能为空",void $("#ratingTitle").focus())},t.chooseEqfont=function(e){t.model.properties.icon=e},t.cancel=function(){t.$dismiss()}}]),angular.module("scene.create.console.scene-setting-component",["scene.preview"]).controller("SceneSettingComponentController",["$q","$routeParams","$rootScope","$scope","$element","sceneService","MineService","dataService","$sce","$modal","usercenterService","security","pageTplService","i18nNotifications","ModalService","sceneSettingCache","memberHandler","eqADTypeChoice","staticResService","sceneDataParseService","dataCacheService","fileService","storageService",function(e,t,n,i,r,o,a,s,c,l,d,u,p,h,g,f,m,v,y,b,w,E,S){function x(e,t){switch(e){case v.HIDE:i.eqShowType=P.EQHIDE,i.scene.property.eqAdType=v.HIDE,i.scene.property.hideEqAd=!0;break;case v.DEFAULT_BOTTOM:i.eqShowType=P.EQLINK,i.scene.property.eqAdType=v.DEFAULT_BOTTOM,i.scene.property.hideEqAd=!1;break;case v.CUSTOM_BOTTOM:i.eqShowType=P.EQLINK,i.scene.property.eqAdType=v.CUSTOM_BOTTOM,i.scene.property.hideEqAd=!1;break;default:case v.FREEPAGE:i.eqShowType=P.EQFREE,i.scene.property&&(i.scene.property.eqAdType=v.FREEPAGE,i.scene.property.hideEqAd=!1)}t&&(i.$broadcast("changeView",!1),b.changeBottomType(i.eqShowType,i.scene.property.lastPageId,i.scene.property.bottomLabel,i.scene.property.eqAdType))}function T(e){i.isFormerScene&&i.adSpend==m.getPriceByADType(i.scene.property.eqAdType)&&delete i.scene.property.eqAdType,angular.isObject(i.scene.property)&&(i.scene.property=angular.toJson(i.scene.property)),angular.isString(i.scene.type)&&(i.scene.type=parseInt(i.scene.type,10)),i.$parent.scene.bgAudio&&(i.scene.bgAudio=angular.isObject(i.$parent.scene.bgAudio)?JSON.stringify(i.$parent.scene.bgAudio):i.$parent.scene.bgAudio),i.scene.loadingLogo===!1&&delete i.scene.loadingLogo,o.saveSceneSettings(i.scene).then(function(e){200==e.data.code?(h.pushForCurrentRoute("scene.setting.success","notify.success"),console.log(t),i.$parent.sceneSetting.showFlag=!1,i.$parent.sceneSetting.oldBgAudio!=i.scene.bgAudio&&E.saveFilesHistory(JSON.parse(i.scene.bgAudio).id,2).then(function(){w.clear("fileService1")}),i.$parent.sceneSetting.oldBgAudio=i.scene.bgAudio,e.data.obj?angular.copy(e.data.obj,o.getCurrentScene()):angular.copy(i.scene,o.getCurrentScene()),C.resolve(e)):(g.openMsgDialog({msg:e.data.msg},function(){}),angular.isString(i.scene.property)&&(i.scene.property=JSON.parse(i.scene.property)),i.scene.type=""+i.scene.type,C.reject(e))},function(e){i.invalidText=e,C.reject(e)})}i.isVipUser=m.isVipUser,i.oriSceneState=!1,i.sceneState=!1;var C=e.defer();i.setPhoneCtrl=function(){var e=i.scene.pageMode;0===e||1==e||2==e||6==e||7==e||8==e||11==e||12==e?i.phonePageMode="NS":i.phonePageMode="EW"};var I=["101","102","103","104","105","106"];i.scene?(i.scene.accessCode?i.sceneStatue=3:i.sceneStatue=i.scene.status,i.appendActive=!!i.scene.promIds,i.loadingLogo=!!i.scene.loadingLogo,-1==I.indexOf(i.scene.type+"")&&(i.scene.type="101"),i.setPhoneCtrl()):i.$watch("sceneId",function(e,t){e!=t&&(i.scene.accessCode?i.sceneStatue=3:i.sceneStatue=i.scene.status,i.loadingLogo=!!i.scene.loadingLogo,i.appendActive=!!i.scene.promIds,-1==I.indexOf(i.scene.type+"")&&(i.scene.type="101"),i.setPhoneCtrl())}),i.$watch("scene",function(e,t){e!=t&&(i.oldScene=JSON.stringify(i.scene))}),i.closeSetting=function(){JSON.stringify(i.scene)!=i.oldScene?g.openConfirmDialog({msg:"设置内容有变化，是否确认修改"},function(){i.saveSceneSettings(i.scene)},function(){i.sceneSetting.showFlag=!1}):i.sceneSetting.showFlag=!1,eqShow.stopSnowFly&&clearInterval(eqShow.stopSnowFly),eqShow.stopFallingObject&&clearInterval(eqShow.stopFallingObject),eqShow.stopFireworkEffect&&eqShow.stopFireworkEffect()},i.sceneSetting.saveSceneSetting=function(){return C=e.defer(),i.saveSceneSettings(i.scene),C.promise},i.isAllowToAccessLastPageSetting=u.isAllowToAccess(u.accessDef.SCENE_HIDE_LASTPAGE_SETTING),i.isAllowedToAccessNewPageFlip=u.isAllowToAccess(u.accessDef.ACCESS_NEW_PAGEFLIP),(2===u.currentUser.type||21===u.currentUser.type)&&m.initUserMemberDetail();var R={SHARE_SCENE:"shareScene",LOADING_LOGO:"loadingLogo",EQSHOW:"eqShow"};i.eqSceneSettingTabs=R,i.eqSceneSettingCurrent=R.SHARE_SCENE;var P={EQFREE:"eqFree",EQLINK:"eqLink",EQHIDE:"eqHide"};i.eqShowType=P.EQFREE,i.eqADTypeChoice=v,i.switchToAdState=x,i.adSpend=0,i.isFormerScene=!1,i.nextPage=function(){b.app.nextPage(),n.$broadcast("changeView",!1)},i.prePage=function(){b.app.prePage(),n.$broadcast("changeView",!1)},i.showPhoneTitle=!0,i.changeSceneName=function(){b.changeSceneName(i.scene.name)},i.$on("changeView",function(e,t){i.showPhoneTitle=!t}),i.PREFIX_FILE_HOST=PREFIX_FILE_HOST,i.alwaysOpen=!0,i.changeView=function(){n.$broadcast("changeView",!0)},i.changeTagId=function(){i.$parent.scene.tagId&&(i.scene.tagId=i.$parent.scene.tagId,h.pushForCurrentRoute("already.apply.discovery","notify.success"))},i.changeAppendActive=function(e){if(i.oldSceneApplyState.promIds&&(i.scene.promIds!==i.oldSceneApplyState.promIds||!i.appendActive))return i.appendActive=!0,void g.openMsgDialog({msg:"该微课已经参与活动，不可参与其他活动；请复制该微课展示后，再次选择参与活动。"});var t;return e||!i.appendActive||(t=S.get("appendActive"),t&&-1!=t.split(",").indexOf(n.user.id))?(e||i.appendActive||!i.scene.promIds||b.removeActivePage(),e&&(i.appendActive=!0,i.showActiveTip=!1,i.hideActiveTip&&(t=S.get("appendActive"),t?t+=","+n.user.id:t=n.user.id,S.push("appendActive",t))),void(i.appendActive||(i.scene.promIds=null,i.activityPageTpls=[]))):(i.appendActive=!1,void(i.showActiveTip=!0))},i.changeLoop=function(){n.$broadcast("changeView",!1),b.app.setTriggerLoop(i.scene.property.triggerLoop)},i.changePageMode=function(){n.$broadcast("changeView",!1),i.setPhoneCtrl(),b.changeScrollMode(i.scene.pageMode)},i.changeProgess=function(){n.$broadcast("changeView",!1),n.$broadcast("processBar",i.scene.property.slideNumber)},i.changeCode=function(){n.$broadcast("changeView",!1),n.$broadcast("passPanelSwitch",i.scene.isAccessCode)},i.changeLogo=function(){i.loadingLogo=!i.loadingLogo,i.loadingLogo||delete i.scene.loadingLogo,n.$broadcast("showLoading",i.loadingLogo,i.scene.loadingLogo)},i.changeBottomLabel=function(){b.changeBottomType(i.eqShowType,i.scene.property.lastPageId,i.scene.property.bottomLabel,i.scene.property.eqAdType)},i.changeAutoFlip=function(){n.$broadcast("changeView",!1),i.scene.property.autoFlip?b.app.startAutoFlip(i.scene.property.autoFlipTime):b.app.pauseAutoFlip()},i.changeEqshowType=function(){"eqHide"==i.eqShowType&&b.removeLastPage()},i.changeSceneState=function(){return i.oldSceneApplyState.promIds?(1!=i.sceneStatue&&g.openMsgDialog({msg:"该微课已经参与活动，不可以关闭或加密!"}),void(i.sceneStatue=1)):(3==i.sceneStatue?(i.scene.status=1,i.scene.isAccessCode=!0,n.$broadcast("changeView",!1),n.$broadcast("passPanelSwitch",!0)):(i.scene.status=i.sceneStatue,delete i.scene.isAccessCode,delete i.scene.accessCode,n.$broadcast("changeView",!1),n.$broadcast("passPanelSwitch",!1)),void(1!=i.sceneStatue&&(i.scene.isShow=0,i.scene.applyTemplate=0,i.appendActive=!1,i.scene.isTpl=0,i.scene.promIds=null)))},i.$watch("scene.bgAudio",function(e,t){angular.isObject(e)&&angular.isObject(t)?e.url!=t.url&&b.playVideo(e):e!=t&&b.playVideo(e),n.$broadcast("changeView",!1)}),i.openScene=function(e,t){t?o.openScene(e.id).then(function(t){t.data.success&&(e.status=1)}):o.closeScene(e.id).then(function(t){t.data.success&&(e.status=2)})},i.openImageModal=function(){n.$broadcast("changeView",!0),l.open({windowClass:"img_console console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1}}}}).result.then(function(e){return e.width/e.height===1?(i.newCoverImage=e,i.newCoverImage.tmbPath=e.data,i.newCoverImage.path=e.data,i.scene.cover=i.newCoverImage.path,void b.changeSceneCover(i.scene.cover)):void l.open({windowClass:"console seven-contain",templateUrl:"scene/console/imageCrop.tpl.html",controller:"imageCropCtrl",backdrop:"static",resolve:{obj:function(){return{type:"square",properties:{src:e.data},cw:250}}}}).result.then(function(e){var t={width:e.width,height:e.height,data:e.src,type:"imgSrc"};i.newCoverImage=t,i.newCoverImage.tmbPath=t.data,i.newCoverImage.path=t.data,i.scene.cover=i.newCoverImage.path,b.changeSceneCover(i.scene.cover)},function(e){})},function(e){})};var M=null;i.countCharacters=countCharacters,i.saveSceneSettings=function(e){if(i.maxLength30(),!i.scene.name||!i.scene.name.trim())return i.invalidText="noneName",void g.openMsgDialog({msg:"微课标题不能为空！"},function(){});if(i.scene.description||(i.scene.description="微学宝，人人都是微课大师！"),i.scene.property.autoFlip&&!i.scene.property.autoFlipTime)return void(i.invalidText="请选择翻页频率");var t=countCharacters(i.scene.name.trim());if(!(t>48)){if("1"===i.scene.isShow&&!i.scene.tagId)return void g.openMsgDialog({msg:"请选择申请微课的微课类型"},function(){$("#tag").focus()});if(i.scene.property&&i.scene.property.eqAdType==v.CUSTOM_BOTTOM&&(!i.scene.property.bottomLabel||!i.scene.property.bottomLabel.id))return void g.openMsgDialog({msg:"请选择您要使用的自定义底标！"},function(){});if(i.scene.property&&i.scene.property.bottomLabel&&i.scene.property.bottomLabel.name&&countCharacters(i.scene.property.bottomLabel.name)>16)return void g.openMsgDialog({msg:"自定义名称不能超过16个字符"},function(){});if(i.scene.property&&i.scene.property.bottomLabel&&!i.scene.property.bottomLabel.name&&i.scene.property.bottomLabel.url&&"http://"!=i.scene.property.bottomLabel.url)return void g.openMsgDialog({msg:"请输入自定义底标名称"},function(){});if(i.scene.accessCode&&("0"!=i.scene.applyPromotion||"0"!=i.scene.applyTemplate))return void g.openMsgDialog({msg:"申请样例、推荐的微课不能同时设置密码，请修改。"});if(3==i.sceneStatue&&(!i.scene.accessCode||4!=i.scene.accessCode.length))return void g.openMsgDialog({msg:"请输入有效的微课密码！"});if(i.scene.promIds&&i.activityPageTpls.length&&!i.scene.property.activityPageId)return void g.openMsgDialog({msg:"请选择活动尾页！"});if(i.oldSceneApplyState.promIds&&i.scene.property.eqAdType!=v.FREEPAGE)return void g.openMsgDialog({msg:"该微课已选择参加活动，不可以清除微学宝尾页，请重新选择！"});if(i.scene.promIds&&(i.scene.property.eqAdType!=v.FREEPAGE||i.scene.property.adSpend))return void g.openMsgDialog({msg:"该微课已选择清除微学宝尾页，不可以参加活动；请复制该微课展示后，再次选择参与活动。"});if(i.appendActive&&!i.scene.promIds)return void g.openMsgDialog({msg:"请选择活动尾页！"});if(i.scene.property&&i.scene.property.autoFlipTime>60)return void g.openMsgDialog({msg:"自动翻页时间不能超过60秒。"});i.scene.property.eqAdType=parseInt(i.scene.property.eqAdType,10);var n=0;0===n?T(e):n&&n>i.userXd?g.openMsgDialog({msg:'当前选择需要消耗微币<font color="#ff6e6e">'+n+'</font>个<br/>微币余额不足(<font color="#ff6e6e">'+(i.userXd||0)+'</font>个)<span class="get-xd"><a href="http://bbs.e.wesambo.com/forum.php?mod=viewthread&tid=297&extra=page%3D1" target = "_blank">获取微币</a></span>'}):n?g.openConfirmDialog({msg:'当前选择需要消耗微币<font color="#ff6e6e">'+n+'</font>个<br/>微币余额为<font color="#ff6e6e">'+(i.userXd||0)+"</font>个"},function(){T(e)}):T(e)}},i.oldSceneApplyState={applyPromotion:"",applyTemplate:"",promIds:""},i.getSceneDetail=function(){o.getCurrentScenePromise().then(function(){i.scene=angular.copy(o.getCurrentScene()),i.scene.price=""+(i.scene.price||"0"),i.oldSceneApplyState.applyPromotion=i.scene.applyPromotion=""+i.scene.applyPromotion,i.oldSceneApplyState.applyTemplate=i.scene.applyTemplate=""+i.scene.applyTemplate,i.scene.isTpl=""+i.scene.isTpl,i.scene.isShow=i.scene.isShow?""+i.scene.isShow:"0",i.oldSceneApplyState.promIds=i.scene.promIds=i.scene.promIds?parseFloat(i.scene.promIds):null,2==i.scene.pageMode&&(i.scene.pageMode=0),i.scene.property?angular.isString(i.scene.property)&&(i.scene.property=JSON.parse(i.scene.property)):i.scene.property={},M=i.scene.loadingLogo||i.scene.property.loadingLogo,i.scene.property.hasOwnProperty("triggerLoop")||(i.scene.property.triggerLoop=!0),i.scene.property.hasOwnProperty("slideNumber")||(i.scene.property.slideNumber=!0),i.scene.property.autoFlipTime||(i.scene.property.autoFlipTime=3),i.adSpend=i.scene.property.adSpend||0,i.isFormerScene=!1,i.scene.property.hideEqAd?(i.adSpend=m.getPriceByADType(v.HIDE),i.scene.property.eqAdType=v.HIDE,i.eqShowType=P.EQHIDE):i.scene.property.eqAdType?x(i.scene.property.eqAdType):i.scene.createTime<14165028e5?(i.isFormerScene=!0,i.adSpend=m.getPriceByADType(v.HIDE),x(v.HIDE)):i.scene.property.isAdvancedUser?i.scene.property.bottomLabel&&i.scene.property.bottomLabel.id?(i.isFormerScene=!0,i.adSpend=m.getPriceByADType(v.CUSTOM_BOTTOM),x(v.CUSTOM_BOTTOM)):(i.isFormerScene=!0,i.adSpend=m.getPriceByADType(v.DEFAULT_BOTTOM),x(v.DEFAULT_BOTTOM)):(i.adSpend=m.getPriceByADType(v.FREEPAGE),x(v.FREEPAGE)),i.scene.startDate&&i.scene.endDate&&(i.startDate=new Date(i.scene.startDate),i.endDate=new Date(i.scene.endDate),i.alwaysOpen=!1),i.scene.type=""+i.scene.type,f.activitiesPromise.then(function(e){i.activities=e.data.list||[],i.getActivityPageTpl()}),i.scene.bgAudio&&(i.scene.bgAudio=angular.isString(i.scene.bgAudio)?JSON.parse(i.scene.bgAudio):i.scene.bgAudio);var e=i.$watch("$parent.scene.bgAudio",function(e){i.scene.bgAudio=angular.isString(e)?JSON.parse(e):e});i.$on("$destroy",function(){e()})})},i.types=y.getSceneType(),i.tplPrices=[];var _=f.sceneTplPricesPromise.then(function(e){for(var t=0;t<e.data.list.length;t++)"免费"!=e.data.list[t].name&&-1==e.data.list[t].name.indexOf("微币")&&(e.data.list[t].name+="微币");i.tplPrices=e.data.list||[]}),k=[];i.sceneTags=[];var A=f.sceneTagsPromise.then(function(e){i.sceneTags=k=e.data.list||[]});e.all([_,A]).then(function(){i.getSceneDetail()});var L=i.$watch("scene.type",function(e){e&&(i.sceneTags=[],angular.forEach(k,function(t){e==t.bizType&&i.sceneTags.push(t)}))});i.$on("$destroy",function(){L()}),i.pagemodes=[{id:0,name:"上下翻页"},{id:4,name:"左右翻页"},{id:1,name:"上下惯性翻页"},{id:3,name:"左右惯性翻页"},{id:11,name:"上下连续翻页"},{id:5,name:"左右连续翻页"},{id:6,name:"立体翻页"},{id:7,name:"卡片翻页"},{id:8,name:"放大翻页"},{id:9,name:"交换翻页"},{id:10,name:"翻书翻页"},{id:12,name:"掉落翻页"}];var D=[11,12];if(!i.isAllowedToAccessNewPageFlip)for(var z=0;z<i.pagemodes.length;z++)for(var F=0;F<D.length;F++)i.pagemodes[z].id==D[F]&&(i.pagemodes.splice(z,1),z--);i.userXd=0,i.getUserXd=function(){d.getUserXd().then(function(e){i.userXd=e.data.obj||0})},i.getUserXd(),f.pageTplsPromise.then(function(e){e.data.list&&e.data.list.length>0?i.pageTpls=e.data.list:i.pageTpls=[]}),f.bottomPageTplsPromise.then(function(e){e.data.list&&e.data.list.length>0?i.bottomPageTpls=e.data.list:i.bottomPageTpls=[]}),i.chooseLastPage=function(e){i.scene.property.lastPageId=e,x(v.FREEPAGE,!0)},i.chooseCustomBottomLabel=function(e){i.scene.property.bottomLabel||(i.scene.property.bottomLabel={}),i.scene.property.bottomLabel.id=e,x(v.CUSTOM_BOTTOM,!0)},i.maxLength30=function(){if(i.scene.description&&(i.scene.description=i.scene.description.replace(/\n|\r/g," ")),i.scene.description&&i.scene.description.length>30){var e=i.scene.description.replace(/[^\x00-\xff]/g,"xx");if(e.length>60){var t=e.substring(0,60).replace(/xx/g,"中").length;i.scene.description=i.scene.description.substring(0,t)}}},i.maxLength24=function(){if(i.scene.name&&(i.scene.name=i.scene.name.replace(/\n|\r/g," ")),i.scene.name&&i.scene.name.length>24){var e=i.scene.name.replace(/[^\x00-\xff]/g,"xx");if(e.length>48){var t=e.substring(0,48).replace(/xx/g,"中").length;i.scene.name=i.scene.name.substring(0,t)}}},i.uploadLoadingLogo=function(){l.open({windowClass:"img_console console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1}}}}).result.then(function(e){i.scene.loadingLogo=e.data,n.$broadcast("showLoading",i.scene.loadingLogo,e.data)},function(e){})},i.moreActivities=function(){},i.isLoadingLogoAccessible=u.isAllowToAccess(u.accessDef.LOADING_LOGO),i.isTemplatePaymentAccessible=u.isAllowToAccess(u.accessDef.TEMPLATE_PAYMENT),i.cancelSceneSetting=function(){i.$parent.sceneSetting.showFlag=!1},i.fourNumberPassword=function(){i.scene.accessCode&&(i.scene.accessCode=i.scene.accessCode.replace(/\D/g,""),i.scene.accessCode.length>4&&(i.scene.accessCode=i.scene.accessCode.substr(0,4)))},i.isScenePasswordAccessible=u.isAllowToAccess(u.accessDef.SCENE_PASSWORD),i.activityPageTpls=[],i.selectedActivity=null,i.getActivityPageTpl=function(e){if(i.oldSceneApplyState.promIds&&i.scene.promIds!==i.oldSceneApplyState.promIds)return g.openMsgDialog({msg:"该微课已经参与活动，不可参与其他活动；请复制该微课展示后，再次选择参与活动。"}),void(i.scene.promIds=i.oldSceneApplyState.promIds);if(i.scene.promIds){var t=null;angular.forEach(i.activities,function(e){e.id===i.scene.promIds&&(t=e.sceneId,i.selectedActivity=e)}),t&&p.getPageTpls(t).then(function(t){t.data.list&&t.data.list.length>0?(i.activityPageTpls=t.data.list,(!i.scene.property.activityPageId||e)&&(i.activityPageTpls.length?(i.scene.property.activityPageId=i.activityPageTpls[0].id,i.chooseActivityPageTpl(i.scene.property.activityPageId)):i.scene.property.activityPageId=null)):i.activityPageTpls=[]})}else i.activityPageTpls=[],i.scene.property.activityPageId=null},i.chooseActivityPageTpl=function(e){i.scene.property.activityPageId=e,b.replaceActivePage(e)}}]).value("eqADTypeChoice",{HIDE:0,FREEPAGE:1,DEFAULT_BOTTOM:2,CUSTOM_BOTTOM:3}).service("memberHandler",["usercenterService","security","eqADTypeChoice",function(e,t,n){function i(e,t){return/^\d+$/.test(t)?0:e*parseFloat(t)}var r={},o=null;return r.isVipUser="1"!=t.currentUser.type,r.initUserMemberDetail=function(){e.getUserMemberDetail(t.currentUser.id).then(function(e){o=e.data.obj})},r.getCurrentSelectionPrice=function(e,t,i,o){var a=r.getPriceByADType(e.property.eqAdType);a=r.isVipUser&&e.property.eqAdType!=n.HIDE?0:r.getPriceWithMemberPrivilege(a);var s=a-t;return i&&0!==s?s=a:0>s&&(s=0),!o&&e.loadingLogo&&(s+=r.getPriceWithMemberPrivilege(loadingLogo_qi_xd,!0)),s},r.getPriceWithMemberPrivilege=function(e,n){return 2===t.currentUser.type&&t.currentUser.memberType&&(new Date).getTime()<t.currentUser.expiryTime||21===t.currentUser.type?n?i(e,o.loadingLogo||"1.0"):i(e,o.tailPage||"1.0"):e},r.getPriceByADType=function(e){switch(e){case n.HIDE:return QI_AD_XDS;case n.FREEPAGE:return 0;case n.DEFAULT_BOTTOM:return 15;case n.CUSTOM_BOTTOM:return 30}},r}]).service("sceneSettingCache",["sceneService","pageTplService",function(e,t){return{sceneTplPricesPromise:e.getSceneTemplatePrices(),sceneTagsPromise:t.getTagSysListWithType(),pageTplsPromise:t.getPageTpls(1301),bottomPageTplsPromise:t.getPageTpls(1311),activitiesPromise:e.getActivities()}}]).directive("sceneSettingComponent",[function(){return{scope:!0,controller:"SceneSettingComponentController",templateUrl:"scene/console/scene-setting-component.tpl.html",link:function(e,t,n){setTimeout(function(){t.find(".scene-setting-info.fade").addClass("in")})}}}]),angular.module("scene.create.console.setting",["scene.create.console.setting.style","scene.create.console.setting.anim","scene.create.console.setting.trigger"]),angular.module("scene.create.console.setting").directive("styleModal",["sceneService","$compile",function(e,t){return{restrict:"AE",replace:!0,scope:{},templateUrl:"scene/console/setting.tpl.html",link:function(e,t,n){t.bind("keydown",function(e){e.stopPropagation()});var i="style";e.$on("showStylePanel",function(t,n){i=e.activeTab,e.activeTab="",e.$apply(),n&&n.activeTab?e.activeTab=n.activeTab:e.activeTab=i,e.$apply()}),e.activeTab=n.activeTab,e.cancel=function(){$(t).hide()},e.$on("close.style.panel",function(e){t.hide(),$(".edit_area").find(".boom, .boom1").remove()}),e.$on("$locationChangeStart",function(){e.cancel()})},controller:["$scope",function(e){}]}}]),angular.module("scene.create.console.shape",[]).controller("ShapeConsoleCtrl",["$rootScope","$scope","ModalService","obj","shapeService",function(e,t,n,i,r){
function o(e,t){r.getShapeByPage(e,t)}var a=r.svgList;t.currentPage=1,t.totalItems=a.length;var s=t.pageSize=18;t.$watch("currentPage",function(e){t.toPage=e,o(e,s)}),t.confirm=function(){t.$close({type:"rect"})},t.pageChanged=function(e){return 1>e||e>t.totalItems/18+1?void alert("此页超出范围"):void(t.currentPage=e)},t.cancel=function(){t.$dismiss()},t.selectSvg=function(e){var n=r.shapeList[e].type,i=r.shapeList[e].viewBox;t.$close({type:n,viewBox:i})}}]).factory("shapeService",["$rootScope",function(e){var t={},n=t.svgList=[{type:"rect"},{type:"circle"},{type:"diamond"},{type:"octagon"},{type:"triangle-up"},{type:"triangle-down"},{type:"triangle-left"},{type:"triangle-right"},{type:"arrow-up"},{type:"arrow-down"},{type:"arrow-left"},{type:"arrow-right"}];for(var i in eqxiuSvg.SYMBOLS)t.svgList.push({type:"symbols-"+i});return t.shapeList=[],t.getShapeByPage=function(i,r){i*r<=n.length?t.shapeList=n.slice((i-1)*r,r*i):t.shapeList=n.slice((i-1)*r,n.length),e.$broadcast("render.shape.page",t.shapeList)},t}]).directive("renderShapeElement",["shapeService","$compile",function(e,t){function n(n,i,r){function o(i){var r,o,l;$(".svg-panel ul").empty();for(var d=0;d<i.length;d++){var u=$('<li class="svg-element" style="width:100px;height:100px;display:inline-block;position:relative;" ng-click="selectSvg('+d+')"></li>');if(t(u)(n),u.appendTo(".svg-panel ul"),i[d].type.indexOf("symbol")<0)o=document.createElementNS(eqxiuSvg.NAMESPACE,"svg"),o.setAttribute("style","position:absolute;left: 50%;margin-left:-32px;top:50%;margin-top:-32px;"),o.setAttribute("xmlns",eqxiuSvg.NAMESPACE),o.setAttribute("version","1.1"),o.setAttribute("width",a),o.setAttribute("height",c),o.setAttribute("preserveAspectRatio","xMidYMid"),l=eqxiuSvg.ShapeFromType(i[d].type),l.setAttribute("fill","#555"),o.appendChild(l),u.append(o),s=eqxiuSvg.boundingBox(l),r=[Math.round(s.x)||0,Math.round(s.y)||0,Math.round(s.width)||32,Math.round(s.height)||32].join(" "),o.setAttribute("viewBox",r);else{l=eqxiuSvg.ShapeFromType(i[d].type,null,null,d),o='<svg class="svgElement" xmlns="'+eqxiuSvg.NAMESPACE+'" version="1.1" width="'+a+'" height="'+c+'" preserveAspectRatio="none">'+l+"</svg>",u.get(0).innerHTML=o,s=eqxiuSvg.boundingBox($("#path_"+d).get(0)),r=[Math.round(s.x)||0,Math.round(s.y)||0,Math.round(s.width)||32,Math.round(s.height)||32].join(" ");var p=u.find(".svgElement");p.get(0).setAttribute("viewBox",r),p.attr({style:"position:absolute;left: 50%;margin-left:-32px;top:50%;margin-top:-32px;"})}e.shapeList[d].viewBox=r}}var a=(e.svgList,64),c=64;n.$on("render.shape.page",function(e,t){o(t)})}return{restrict:"EA",link:n}}]),angular.module("scene.create.console.soundComponent",["app.directives.addelement"]),angular.module("scene.create.console.soundComponent").controller("SoundComponentConsoleCtrl",["$scope","$timeout","$translate","localizedMessages","obj","$modal",function(e,t,n,i,r,o){e.model={title:r.properties.title,imgSrc:r.properties.imgSrc,sound:r.sound},e.authError="",e.buttons=[{id:1,text:"有惊喜",btnStyle:{width:"100px",backgroundColor:"rgb(244, 113, 31)",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:2,text:"听一听",btnStyle:{width:"100px",backgroundColor:"rgb(253, 175, 7)",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:3,text:"点我听歌",btnStyle:{width:"100px",backgroundColor:"rgb(121, 196, 80)",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:4,text:"点播歌曲",btnStyle:{width:"100px",height:"30px",backgroundColor:"#fff","text-align":"center",border:"1px solid #3FB816","line-height":"30px",color:"rgb(0, 0, 0)"}}],e.openImageModal=function(){o.open({windowClass:"img_console console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1}}}}).result.then(function(t){e.model.title="",e.btnIndex=-1,e.model.btnStyle={width:"115px",height:"115px","line-height":"1",backgroundColor:"transparent"},e.model.imgSrc=r.properties.imgSrc=t.data},function(e){})},angular.forEach(e.buttons,function(t,n){""!==e.model.title&&r.css.backgroundColor&&r.css.backgroundColor==t.btnStyle.backgroundColor&&(e.btnIndex=n)}),e.confirm=function(){return null!=e.model.imgSrc||e.model.title&&0!==e.model.title.length?!e.model.sound||$.isEmptyObject(e.model.sound)?void(e.authError="您还没有选择音效"):(r.sound=e.model.sound,r.properties.title=e.model.title,void e.$close(e.model)):(e.authError="按钮名称不能为空",void $('.form-list input[type="text"].btn-name').focus())},e.openSoundModal=function(){o.open({windowClass:"console img_console",templateUrl:"scene/console/sound.tpl.html",controller:"soundCtrl",resolve:{obj:function(){return{elemDef:r,type:4}}}}).result.then(function(t){e.model.sound=t},function(){})},e.openSoundModal=function(){o.open({windowClass:"console img_console",templateUrl:"scene/console/sound2.tpl.html",controller:"soundCtrl",resolve:{obj:function(){return{elemDef:r,type:4}}}}).result.then(function(t){e.model.sound=t},function(){})},e.cancel=function(){e.$dismiss()},e.chooseTabButton=function(t,n){e.model.title=t.text,e.model.btnStyle=t.btnStyle,e.btnIndex=n,e.model.imgSrc=r.properties.imgSrc=null}}]),angular.module("scene.create.console.sound",["services.file","soundLink"]).controller("soundCtrl",["$rootScope","$scope","$translate","soundService","ModalService","obj","uploaderService","$modal","fileService","dataCacheService",function(e,t,n,i,r,o,a,s,c,l){var d=t.sounds=[],u=t.type=o.type;t.selectSoundError="",t.uploader=a.uploader(o.type,4194304);var p=t.pageSize=10,h=1;t.actionContent=!1,t.pagination={},t.sound={},t.soundLink={src:""};var g=!1;window.localStorage?(g=2==u?localStorage.getItem("musicTag"):localStorage.getItem("soundTag"),"true"==g?t.isMySound=!0:"false"!=g&&g?t.isMySound="history":t.isMySound=!1):t.isMySound=!1,t.alertAction=!0,t.soundAction=!1,t.popSoundAction=function(){t.soundAction=!0},t.closeAction=function(){t.soundAction=!1,f.indexOf(e.user.id)>-1&&(t.alertAction=!1)},t.actionShow=!1;var f=[];if(window.localStorage){var m=localStorage.getItem("setSoundAction");m&&(f=m.split(","),f.indexOf(e.user.id)>-1&&(t.alertAction=!1))}if(t.isCheckbox=function(t){t&&(f.push(e.user.id),localStorage.setItem("setSoundAction",f.join(",")))},4==u&&o.elemDef.sound&&o.elemDef.sound.src&&(t.sound=o.elemDef.sound),2==u&&o.elemDef.bgAudio)if("string"==typeof o.elemDef.bgAudio){var v=JSON.parse(o.elemDef.bgAudio);t.sound=v,v&&v.src&&(t.sound.url=v.src)}else t.sound=o.elemDef.bgAudio,o.elemDef.bgAudio.src&&(t.sound.url=o.elemDef.bgAudio.src);t.$on("uploadfiles.add",function(e){2==t.type?l.clear("mySounds"):l.clear("fileService1"),t.selectTab(!0)}),t.$on("thumbnailList.update",function(e,n){for(var i,r=0;r<t.uploader.queue.length;r++)if(100==t.uploader.queue[r].progress){t.uploader.queue.splice(r,1),i=n,d.unshift(i);for(var o=0;10>o;o++)0===d[r].size?d[r].size=null:d[r].size>0&&d[r].size<1024?d[r].size=d[r].size+" KB":d[r].size>=1024&&(d[r].size=(d[r].size/1024).toPrecision(2)+" MB")}d.length>0&&(t.actionContent=!1),2==t.type?l.clear("mySounds"):l.clear("fileService1")});var y=function(){t.isMySound=!0,t.selectTab(!0)};t.getSounds=function(e){t.toPage=e,4==u?t.isMySound?i.getMySounds(e):t.getSysMusicList(t.sysCatId,e):2==u&&(t.isMySound?i.getMyAudios(e):t.getSysMusicList(t.sysCatId,e))},window.enterSearchSound=function(e){var n=event||window.event||arguments.callee.caller.arguments[0];n&&13==n.keyCode&&(searchVal=document.getElementById("search-value").value,t.toPage=e,4==u?t.isMySound?i.getMySounds(e):t.getSysMusicList(t.sysCatId,e):2==u&&(t.isMySound?i.getMyAudios(e):t.getSysMusicList(t.sysCatId,e)))},t.sysCate=!t.isMySound,t.selectTab=function(e){window.localStorage&&(2==t.type?localStorage.setItem("musicTag",e):localStorage.setItem("soundTag",e)),e?t.sysCate=!1:t.sysCate=!0,t.isMySound=e,"history"==e?t.getHistory():t.getSounds(1)},t.setPageMusic=function(){if(music&&pageNo){var e=PREFIX_URL+"index.php?c=scene&a=bg_music";music.num=parseInt(pageNo),music.sceneId=parseInt(sceneId),$.ajax(e,{type:"post",data:JSON.stringify(music),headers:{"Content-Type":"text/plain; charset=UTF-8"},success:function(e){alert("设置成功"),t.$dismiss()}})}else alert("当前未选择任何音乐")},t.getHistory=function(){c.getFilesHistory(2).then(function(n){n.data.success&&e.$broadcast("sounds.update",n.data,u,t.type)})},t.openConvert=function(){t.track="女",t.trackId=0,$("#convert").modal({show:!0}),$("body *:last").hide(),$("#convertMusic").attr("src")||""==$("#convertMusic").attr("src")||(new_obj=$("<audio id='convertMusic' src='' autoplay>"),$(".container").append(new_obj))},setTimeout(t.openConvert,0),t.playConvertSound=function(){var e=$("#convertVal").val(),n=PREFIX_URL+"index.php?c=Text2audio&a=getaudio&text="+e+"&per="+t.trackId;$("#convertMusic").attr("src",n)},t.setConvertSound=function(){var e=$("#convertVal").val(),n=window.location.href.split("=")[1],i=window.location.href.split("?")[0],r=i.substring(i.length-7),o={};if(""!=e&&n){var a=PREFIX_URL+"index.php?c=Text2audio&a=bacurl&text="+e+"&per="+t.trackId;$.ajax(a,{type:"get",success:function(e){o.num=parseInt(n),o.url=JSON.parse(e).url,o.sceneId=parseInt(r);var i=PREFIX_URL+"index.php?c=scene&a=bg_music";$.ajax(i,{type:"post",data:JSON.stringify(o),headers:{"Content-Type":"text/plain; charset=UTF-8"},success:function(e){alert("设置成功"),t.$dismiss()}})}})}else alert("没有内容可以转换")},t.changeTrack=function(){"女"==t.track?t.track="男":t.track="女",0==t.trackId?t.trackId=1:t.trackId=0},t.clearCurrentMusic=function(){var e=window.location.href.split("=")[1],t=window.location.href.split("?")[0],n=t.substring(t.length-7),i={},r=PREFIX_URL+"index.php?c=scene&a=bg_music";i.num=parseInt(e),i.sceneId=parseInt(n),i.url="",$.ajax(r,{type:"post",data:JSON.stringify(i),headers:{"Content-Type":"text/plain; charset=UTF-8"},success:function(e){alert("清除成功")}})},t.urlLink=function(){s.open({windowClass:"console six-contain",templateUrl:"scene/console/soundLink.tpl.html",controller:"SoundLinkCtrl",resolve:{obj:function(){return o.type}}}).result.then(function(){y()},function(){})},t.isSoundSelected=function(e,t,n){return 2===e?t.id?t.id==n.id:t.url==n.url:4===e?t.id?t.id==n.id:t.src==n.src:void 0},t.selectSound=function(e,n,i){music=e,pageNo=window.location.href.split("=")[1];var r=window.location.href.split("?")[0];sceneId=r.substring(r.length-7),e.url&&"/"==e.url.substr(0,1)&&(e.url=e.url.substr(1,e.url.length)),i?t.sound={}:t.sound=e},t.clearSearchVal=function(){searchVal="",document.getElementById("search-value").value=""},t.playSound=function(t,n){t.stopPropagation(),e.$broadcast("sound.play",d[n])},t.deleteMySound=function(e,n){e.stopPropagation(),r.openConfirmDialog({msg:"确定删除此音乐吗？"},function(){2==t.type?l.clear("mySounds"):l.clear("fileService1"),i.deleteMySound(d[n].id)})},t.clear=function(){music=null,t.sound={}},t.ok=function(){t.sound.url&&"/"==t.sound.url.substr(0,1)&&(t.sound.url=t.sound.url.substr(1,t.sound.url.length));var e,n=t.sound;4==u&&(e=n.src?{name:n.name,src:n.src,id:n.id}:{},t.$close(e)),2==u&&(v=n.url?{url:n.url,name:n.name,id:n.id}:{},t.$close(v))},t.cancel=function(){t.$dismiss()},t.$on("sounds.update",function(e,n,i){if(d.length=0,n.list.length>0){t.actionContent=!1,$.each(n.list,function(e,t){0===t.path.indexOf("http://")&&(t.isValue=!0),t.size<1024&&t.size>0?t.size=t.size+" KB":t.size>=1024?t.size=(t.size/1024).toPrecision(2)+" MB":0===t.size&&(t.size=null),4==i?d.push({id:t.id,name:t.name,src:t.path,isPlaying:!1,size:t.size,isValue:t.isValue}):2==i&&d.push({id:t.id,name:t.name,url:t.path,isPlaying:!1,size:t.size,isValue:t.isValue})});var r=n.map;r&&(t.pagination={totalItems:r.count,pageSize:r.pageSize,currentPage:r.pageNo,numPages:Math.ceil(r.count/r.pageSize)})}else t.pagination.totalItems=0,t.actionContent=!0}),t.$on("mySounds.delete",function(e,n){n===t.sound.id&&(t.sound={}),2==u?i.getMyAudios(t.pagination.currentPage):4==u&&i.getMySounds(t.pagination.currentPage)});var b=function(e){c.getSysMusicCategory(e)};t.$on("sysMusic.update",function(e){t.sysMusicList=c.sysMusicList}),b(u),t.getSysMusicList=function(e,n){t.sysCatId=e,i.getSysMusicList(n,p,u,e)},"history"==t.isMySound?t.getHistory():t.isMySound?4==u?i.getMySounds(h):i.getMyAudios(h):t.getSysMusicList(0,h)}]).factory("soundService",["$rootScope","$modal","fileService","dataCacheService",function(e,t,n,i){var r={};return r.getSysMusicList=function(t,r,o,a){n.getSystemFiles(t,r,o,a).then(function(t){t.data.success?(i.getAsyncUrl()&&(i.push("fileService1",i.getAsyncUrl(),t),i.setAsyncUrl()),e.$broadcast("sounds.update",t.data,o)):alert(t.data.msg)},function(){alert(networkOut)})},r.getMyAudios=function(t){n.getFileByCategory(t,10,"0","2").then(function(t){t.data.success?(i.getAsyncUrl()&&(i.push("mySounds",i.getAsyncUrl(),t),i.setAsyncUrl()),e.$broadcast("sounds.update",t.data,2)):alert(t.data.msg)},function(){alert(networkOut)})},r.getMySounds=function(t){n.getUserFiles(t,10,4,0).then(function(t){t.data.success?(i.getAsyncUrl()&&(i.push("fileService1",i.getAsyncUrl(),t),i.setAsyncUrl()),e.$broadcast("sounds.update",t.data,4)):alert(t.data.msg)},function(){alert(networkOut)})},r.deleteMySound=function(t){n.deleteFile1(t).success(function(n){n.success?e.$broadcast("mySounds.delete",t):alert(n.msg)}).error(function(){alert(networkOut)})},r}]).directive("eqxAudio",function(){function e(e,n){var i={};n.bind("pause",function(){n.attr("src")&&e.$apply(function(){i.isPlaying=!1})}).bind("play",function(){n.attr("src")&&e.$apply(function(){i.isPlaying=!0})});var r=n.get(0);e.$on("sound.play",function(e,n){t(i,n,r),i=n})}function t(e,t,n){var i,r={};r.src=t.src||t.url,i=0===r.src.indexOf("http://")?r.src:PREFIX_FILE_HOST+r.src;var o=i.substr(i.lastIndexOf("/")+1),a=n.src.substr(i.lastIndexOf("/")+1);null==e.id?o==a&&t.isPlaying?n.pause():o!=a||t.isPlaying?(n.src=i,n.play(),e.isPlaying=!1,t.isPlaying=!0):n.play():e.id==t.id&&t.isPlaying?n.pause():e.id!=t.id||t.isPlaying?(n.src=i,n.play(),e.isPlaying=!1,t.isPlaying=!0):n.play()}return{link:e}}).filter("maxLength",function(){return function(e,t){return e?e.length<=t?e:e.substr(0,t)+"…":void 0}}),angular.module("soundLink",["soundLink"]),angular.module("soundLink").controller("SoundLinkCtrl",["$rootScope","$scope","$translate","sceneService","obj",function(e,t,n,i,r){t.authError="",t.soundLink={src:""},t.selectLink=function(){t.sound={}},t.confirm=function(){var e=t.soundLink.src;if(e.length&&e.lastIndexOf(".mp3")!==e.length-4)return void(t.authError="请输入mp3格式的音乐链接");if(0===e.length)return t.authError="链接地址不能为空",void $(".link").focus();var n;t.sound,e&&(n={name:"外链音乐",src:e}),i.soundLink(e,r).then(function(e){200==e.data.code?t.$close(n):(t.authError=e.data.msg,$(".link").focus())})},t.cancel=function(){t.$dismiss()}}]),angular.module("scene.create.console.statistics",[]),angular.module("scene.create.console.statistics").controller("StatisticsConsoleCtrl",["$scope","obj",function(e,t){e.model={title:t.title,properties:{layout:t.properties.layout,size:t.properties.size,color:t.properties.color,icon:t.properties.icon,imgSrc:t.properties.imgSrc}},e.authError="",e.confirm=function(){angular.extend(t,e.model);var n=parseInt(t.css.height,10)||0;e.model.properties.imgSrc&&115>n&&(e.model.btnStyle={width:"320px",height:"115px",lineHeight:"115px",backgroundColor:"transparent"}),"counter-tb"===e.model.properties.layout&&(!e.model.properties.imgSrc&&80>n&&(e.model.btnStyle={height:"80px",lineHeight:"80px"}),e.model.properties.imgSrc&&155>n&&(e.model.btnStyle=e.model.btnStyle||{},e.model.btnStyle.height=e.model.btnStyle.lineHeight="155px")),e.$close(e.model)},e.cancel=function(){e.$dismiss()},e.chooseEqfont=function(t){e.model.properties.icon=t,e.model.properties.imgSrc=null}}]),angular.module("scene.create.console.setting.style",["colorpicker.module","app.directives.style","app.directives.uislider","app.directives.limitInput","services.history"]),angular.module("scene.create.console.setting.style").controller("StyleConsoleCtrl",["$scope","sceneService","historyService","$rootScope",function(e,t,n,i){var r=e.elemDef=t.currentElemDef;delete r.css.borderTopLeftRadius,delete r.css.borderTopRightRadius,delete r.css.borderBottomLeftRadius,delete r.css.borderBottomRightRadius,delete r.css.border;var o=r.css,a=$("#inside_"+e.elemDef.id+" > .element-box");if(e.model={backgroundColor:o.backgroundColor||"",opacity:100-100*o.opacity||0,color:o.color||"#676767",borderWidth:parseInt(o.borderWidth,10)||0,borderStyle:o.borderStyle||"solid",borderColor:o.borderColor||"rgba(0,0,0,1)",paddingBottom:parseInt(o.paddingBottom,10)||0,paddingTop:parseInt(o.paddingTop,10)||0,lineHeight:+o.lineHeight||1,borderRadius:parseInt(o.borderRadius,10)||0,transform:o.transform&&parseInt(o.transform.replace("rotateZ(","").replace("deg)",""),10)||0},e.maxRadius=Math.min(a.outerWidth(),a.outerHeight())/2+10,o.borderRadiusPerc?e.model.borderRadiusPerc=parseInt(o.borderRadiusPerc,10):o.borderRadius?"999px"==o.borderRadius?e.model.borderRadiusPerc=100:(e.model.borderRadiusPerc=parseInt(100*parseInt(o.borderRadius,10)*2/Math.min(a.outerWidth(),a.outerHeight()),10),e.model.borderRadiusPerc>100&&(e.model.borderRadiusPerc=100)):e.model.borderRadiusPerc=0,e.tmpModel={boxShadowDirection:0,boxShadowX:0,boxShadowY:0,boxShadowBlur:0,boxShadowSize:0,boxShadowColor:"rgba(0,0,0,0.5)"},o.boxShadow){var s=o.boxShadow.split(" ");e.tmpModel.boxShadowX=parseInt(s[0],10),e.tmpModel.boxShadowY=parseInt(s[1],10),e.tmpModel.boxShadowDirection=parseInt(o.boxShadowDirection,10)||0,e.tmpModel.boxShadowBlur=parseInt(s[2],10),e.tmpModel.boxShadowColor=s[3],e.tmpModel.boxShadowSize=parseInt(o.boxShadowSize,10)||0}e.clear=function(){e.model={backgroundColor:"",opacity:0,color:"#676767",borderWidth:0,borderStyle:"solid",borderColor:"rgba(0,0,0,1)",paddingBottom:0,paddingTop:0,lineHeight:1,borderRadius:0,transform:0},e.tmpModel={boxShadowDirection:0,boxShadowX:0,boxShadowY:0,boxShadowBlur:0,boxShadowSize:0,boxShadowColor:(o.boxShadowSize,"rgba(0,0,0,0.5)")}},e.$watch("tmpModel",function(t,n){var i={};$.extend(!0,i,e.model),i.borderRadius+="px",i.borderTopLeftRadius=i.borderTopRightRadius=i.borderBottomLeftRadius=i.borderBottomRightRadius=i.borderRadius,i.opacity=(100-e.model.opacity)/100,i.boxShadow=Math.round(e.tmpModel.boxShadowX)+"px "+Math.round(e.tmpModel.boxShadowY)+"px "+e.tmpModel.boxShadowBlur+"px "+e.tmpModel.boxShadowColor,i.boxShadowDirection=e.tmpModel.boxShadowDirection,i.boxShadowSize=e.tmpModel.boxShadowSize,i.transform="rotateZ("+e.model.transform+"deg)",$.extend(!0,r.css,i)},!0),e.$watch("model",function(t,n){e.elemDef.properties instanceof Array&&(e.elemDef.properties={});var i={};if(elemId=e.elemDef.id,document.getElementById(""+elemId).children[0]&&""!=document.getElementById(""+elemId).children[0].style.color){var o=e.elemDef.content.split("color:")[1].split(";")[0];e.model.color=o,document.getElementById(""+elemId).children[0].style.color=""}$.extend(!0,i,e.model),i.borderRadius+="px",i.borderTopLeftRadius=i.borderTopRightRadius=i.borderBottomLeftRadius=i.borderBottomRightRadius=i.borderRadius,i.opacity=(100-e.model.opacity)/100,i.boxShadow=Math.round(e.tmpModel.boxShadowX)+"px "+Math.round(e.tmpModel.boxShadowY)+"px "+e.tmpModel.boxShadowBlur+"px "+e.tmpModel.boxShadowColor,i.boxShadowDirection=e.tmpModel.boxShadowDirection,i.boxShadowSize=e.tmpModel.boxShadowSize,i.transform="rotateZ("+e.model.transform+"deg)",$.extend(!0,r.css,i)},!0)}]).directive("styleInput",["multiCompResize","$rootScope",function(e,t){return{restrict:"AE",link:function(e,n,i){var r=$("#inside_"+e.elemDef.id+" > .element-box");$("#inside_"+e.elemDef.id,"#nr"),e.$watch(function(){return $(n).val()},function(o,a){if(o!=a){if("borderWidth"==i.cssItem){r.css({borderStyle:e.model.borderStyle,borderWidth:$(n).val()});var s={width:r.width(),height:r.height()};if(4==e.elemDef.type){var c=r.find("img"),l=c.width()/c.height(),d=s.width/s.height;l>=d?(c.outerHeight(s.height),c.outerWidth(s.height*l),c.css("marginLeft",-(c.outerWidth()-s.width)/2),c.css("marginTop",0)):(c.outerWidth(s.width),c.outerHeight(s.width/l),c.css("marginTop",-(c.outerHeight()-s.height)/2),c.css("marginLeft",0)),e.elemDef.properties.imgStyle.marginTop=c.css("marginTop"),e.elemDef.properties.imgStyle.marginLeft=c.css("marginLeft"),e.elemDef.properties.imgStyle.width=c.outerWidth(),e.elemDef.properties.imgStyle.height=c.outerHeight()}}if("borderRadius"==i.cssItem&&r.css({borderRadius:e.model.borderRadius}),"opacity"==i.cssItem&&r.css({opacity:(100-$(n).val())/100}),"backgroundColor"==i.cssItem&&r.css({backgroundColor:$(n).val()}),"color"==i.cssItem&&(r.css({color:$(n).val()}),"h"==e.elemDef.type)){var u=r.find("svg");u.find("g").length?u.find("g").attr("fill",$(n).val()):u.children().attr("fill",$(n).val())}"borderStyle"==i.cssItem&&(r.css({borderStyle:e.model.borderStyle}),t.$broadcast("hisChange")),"borderColor"==i.cssItem&&r.css({borderColor:e.model.borderColor}),"padding"==i.cssItem&&r.css({paddingTop:e.model.paddingTop,marginTop:-e.model.paddingBottom}),"lineHeight"==i.cssItem&&r.css({lineHeight:e.model.lineHeight}),"transform"==i.cssItem&&(r.parents("li").css({transform:"rotateZ("+e.model.transform+"deg)"}),t.$broadcast("boxOuter")),"boxShadow"==i.cssItem&&(e.tmpModel.boxShadowX=-Math.sin(e.tmpModel.boxShadowDirection*Math.PI/180)*e.tmpModel.boxShadowSize,e.tmpModel.boxShadowY=Math.cos(e.tmpModel.boxShadowDirection*Math.PI/180)*e.tmpModel.boxShadowSize,r.css({boxShadow:Math.round(e.tmpModel.boxShadowX)+"px "+Math.round(e.tmpModel.boxShadowY)+"px "+e.tmpModel.boxShadowBlur+"px "+e.tmpModel.boxShadowColor}))}})}}}]).directive("angleKnob",function(){return{restrict:"AE",templateUrl:"scene/console/angle-knob.tpl.html",link:function(e,t,n){function i(e,t){var n=Math.sqrt((e-28)*(e-28)+(t-28)*(t-28))/28,i=28+(e-28)/n,r=28+(t-28)/n;a.css({top:Math.round(r),left:Math.round(i)})}function r(e,t){var n=e-28,i=28-t,r=180*Math.atan(n/i)/Math.PI;return t>28&&(r+=180),28>=t&&28>e&&(r+=360),Math.round(r)}var o=$(t).find(".sliderContainer"),a=$(t).find(".sliderKnob");e.$watch(function(){return e.tmpModel.boxShadowDirection},function(e){a.css({top:28-28*Math.cos(e*Math.PI/180),left:28+28*Math.sin(e*Math.PI/180)})}),0!==e.tmpModel.boxShadowDirection&&a.css({top:28-28*Math.cos(e.tmpModel.boxShadowDirection*Math.PI/180),left:28+28*Math.sin(e.tmpModel.boxShadowDirection*Math.PI/180)}),o.bind("mousedown",function(t){t.stopPropagation();var n=o.offset().left,a=o.offset().top;i(t.pageX-n,t.pageY-a);var s=r(t.pageX-n,t.pageY-a);e.tmpModel.boxShadowDirection=s,e.$apply(),$(this).bind("mousemove",function(t){t.stopPropagation(),i(t.pageX-n,t.pageY-a);var o=r(t.pageX-n,t.pageY-a);e.tmpModel.boxShadowDirection=o,e.$apply()}),$(this).bind("mouseup mouseleave",function(e){$(this).unbind("mousemove"),$(this).unbind("mouseup mouseleave")})})}}}),angular.module("scene.create.console.tel",["app.directives.addelement"]),angular.module("scene.create.console.tel").controller("TelConsoleCtrl",["$scope","$timeout","$translate","localizedMessages","obj","$modal",function(e,t,n,i,r,o){e.model={title:r.properties.title,number:r.properties.number,imgSrc:r.properties.imgSrc},e.authError="",e.buttons=[{id:1,text:"一键拨号",btnStyle:{width:"100px",backgroundColor:"rgb(244, 113, 31)",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:2,text:"热线电话",btnStyle:{width:"100px",backgroundColor:"rgb(253, 175, 7)",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:3,text:"拨打电话",btnStyle:{width:"100px",backgroundColor:"rgb(121, 196, 80)",height:"30px","text-align":"center","line-height":"30px",color:"rgb(255, 255, 255)"}},{id:4,text:"一键拨号",btnStyle:{width:"100px",height:"30px",backgroundColor:"#fff","text-align":"center",border:"1px solid #3FB816","line-height":"30px",color:"rgb(0, 0, 0)"}}],e.openImageModal=function(){o.open({windowClass:"img_console console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1}}}}).result.then(function(t){e.model.title="",e.btnIndex=-1,e.model.btnStyle={width:"115px",height:"115px","line-height":"1",backgroundColor:"transparent"},e.model.imgSrc=r.properties.imgSrc=t.data},function(e){})},angular.forEach(e.buttons,function(t,n){""!==e.model.title&&r.css.backgroundColor&&r.css.backgroundColor==t.btnStyle.backgroundColor&&(e.btnIndex=n)}),e.confirm=function(){return null!=e.model.imgSrc||e.model.title&&0!==e.model.title.length?e.model.number&&0!==e.model.title.number?void e.$close(e.model):(e.authError="电话号码不能为空",void $('.form-list input[type="text"].tel-button').focus()):(e.authError="按钮名称不能为空",void $('.form-list input[type="text"].btn-name').focus())},e.cancel=function(){e.$dismiss()},e.chooseTabButton=function(t,n){e.model.title=t.text,e.model.btnStyle=t.btnStyle,e.btnIndex=n,e.model.imgSrc=r.properties.imgSrc=null}}]),angular.module("scene.create.console.adr",[]),angular.module("scene.create.console.adr").controller("AdrConsoleCtrl",["$scope",function(e){e.replaceImage=function(t){if(e.position=$("#position").val(),console.log(e.position),!e.position)return void(e.authError="请输入地址");var n={type:e.position,src:e.position};$("#position").focus()&&(e.authError=null),e.$close(n)},e.cancel=function(){e.$dismiss()}}]),angular.module("scene.create.console.setting.trigger",["colorpicker.module","app.directives.style","app.directives.uislider","app.directives.limitInput","scene.edit.trigger"]),angular.module("scene.create.console.setting.trigger").controller("TriggerConsoleCtrl",["$scope","$rootScope","$translate","sceneService","triggerService","$modal","ModalService","i18nNotifications","security",function(e,t,n,r,o,a,s,c,l){function d(){var t=o.getTrigger(g.id);if(t&&t.sends.length)for(p(t.sends),i=0;i<t.sends.length&&e.triggerEvents[i];i++)i>0?t.sends[i].delay=t.sends[i-1].delay+e.triggerEvents[i].delay:t.sends[i].delay=e.triggerEvents[i].delay;var n;$.each(f,function(e,t){o.clearTrigger(e),n=o.getTrigger(e),n&&n.sends.length&&p(n.sends),n?t.trigger=n:delete t.trigger}),2==e.sendType.value&&(n=o.getTrigger(e.elemDef.id),n&&n.sends.length&&p(n.sends),e.elemDef.properties||(e.elemDef.properties={}),e.elemDef.properties.trigger=n)}function u(){if(!g)return void(e.triggerEvents=[]);var t=o.getTrigger(g.id);if(t&&t.sends.length){p(t.sends),e.triggerEvents=[];var n=angular.copy(t.sends);angular.forEach(n,function(t,r){if(e.triggerEvents.push({}),angular.forEach(t.handles,function(t,n){1!=t.type&&2!=t.type||!t.ids.length?3==t.type&&t.ids.length&&(e.triggerEvents[r]=angular.copy(e.eventTypes[1]),e.triggerEvents[r].type=2):(e.triggerEvents[r]=angular.copy(e.eventTypes[0]),e.triggerEvents[r].type=1)}),r>0)for(i=0;r>i;i++)t.delay-=n[i].delay;e.triggerEvents[r].handles=t.handles,t.delay?e.triggerEvents[r].delay=t.delay:e.triggerEvents[r].delay=0})}e.triggerEvents.length&&$.each(e.triggerEvents,function(e,t){t.triggerElements=[],t.handles&&t.handles.length&&$.each(t.handles,function(e,n){n.ids.length&&$.each(n.ids,function(e,i){t.triggerElements.push({id:i,handleType:n})})})})}function p(e){for(var t=0;t<e.length;t++)"undefined"==typeof e[t].sendIndex&&e[t].hasOwnProperty("sendIndex")&&(e.splice(t,1),t--)}var h=utilTrigger.getSendType();l.isAllowToAccess(l.accessDef.SHAKE_TRIGGER)||delete h.SHAKE,e.sendTypes=h,e.sendType=e.sendTypes.CLICK;var g=e.elemDef=r.currentElemDef,f=r.getElementsMap(),m=(utilTrigger.getHandleType(),r.getSceneObj().obj);if(m&&m.elements.length){e.triggerSources=[];var v=angular.copy(m.elements);$.each(v,function(t,n){("2"==n.type||"4"==n.type||"h"==n.type||"x"==n.type)&&("2"==n.type?n.name="文字":"4"==n.type?n.name="图片":"h"==n.type?n.name="形状":"x"==n.type&&(n.name="多字体"),e.triggerSources.push(n))}),$.each(e.triggerSources,function(e,t){t.name+=e+1})}e.$watch("elemDef",function(t,n){t&&(g=t,$.each(e.triggerSources,function(n,i){i.id==t.id&&(e.sourceElem=i)}))},!0),e.$watch("sendType",function(t){e.triggerEvents=[],1==t.value?g=e.elemDef=r.currentElemDef:2==t.value&&(g=e.elemDef=m),u()},!0),e.eventTypes=[{name:"existElement",value:1,title:"选择界面已有元素",children:[{type:"SHOW",title:"显示"},{type:"HIDE",title:"隐藏"}]},{name:"randomEvent",value:2,title:"随机图片"}],g&&1==e.sendType.value&&(4==g.type?e.triggerOriginal="图片1":"2"==g.type?e.triggerOriginal="文字1":"h"==g.type?e.triggerOriginal="形状1":"x"==g.type&&(e.triggerOriginal="多字体1")),e.selectTriggerOriginal=function(){t.$broadcast("select.trigger.original")},e.triggerEvents=[],e.addTriggerEvent=function(t,n){return e.sourceElem||1!=e.sendType.value?(e.triggerEvents.push({title:t.title,value:t.value,delay:0}),e.triggerEvents.length,void(1==t.value?e.addTriggerItem(e.triggerEvents[n],n):2==t.value&&e.addRandomImg(e.triggerEvents[n],n))):void c.pushForCurrentRoute("select.trigger.source","notify.success")},e.addTriggerItem=function(n,i,r){e.currentTriggerEvent=n,e.currentIndex=i,t.$broadcast("element.triggered.add",n,i)},e.addRandomImg=function(t,n){e.currentTriggerEvent=t,e.currentIndex=n,r.createComp("n")},e.$on("create.randomevent.trigger",function(n,i){t.$broadcast("show.random.trigger",g,i,e.currentIndex)}),e.$on("receive.element.update",function(t,n,i,r,a){e.triggeredElements=[],e.currentTriggerEvent?e.currentTriggerEvent.handles=[]:e.triggerEvents&&(e.triggerEvents[a].handles=[]);var s=o.getTrigger(g.id).sends;s.length&&p(s),angular.forEach(s,function(t,n){e.triggerEvents[a].handles=t.handles}),d(),u()}),e.switchShow=function(e,n){if(e.triggerType)if(1==e.triggerType)var i=e.triggerType=2,r=!1;else var i=e.triggerType=1,r=!0;else if(1==e.handleType.type)var i=e.handleType.type=2,r=!1;else var i=e.handleType.type=1,r=!0;t.$broadcast("switch.triggered.state",r,i,e.id,n)},e.removeTrigger=function(t,n){var i=g.id,r=o.getTrigger(i);if(r&&r.sends){if(p(r.sends),!r.sends[t])return void e.triggerEvents.splice(t,1);o.deleteTriggerBySendIndex(t,i),$.each(r.sends,function(e,t){t.sendIndex=e})}e.triggerEvents.splice(t,1)},e.getTriggerSources=function(t){e.triggerEvents=[],t&&($("#nr").find("#inside_"+t.id).trigger("mousedown"),g=e.elemDef=f[t.id],u())},u(),e.confirm=function(){d(),t.$broadcast("close.style.panel")},e.cancelTriggerElem=function(e,n){var i=g.id;t.$broadcast("cancel.element.trigger",e,i,n),u()},e.editRandomElem=function(){},e.clear=function(){o.resetTrigger(g.id),e.triggerEvents=[]}}]).directive("eqxTrigger",["$compile","$translate","sceneService","triggerService",function(e,t,n,i){function r(e,t,r){var g=n.currentElemDef;e.$watch("sendType",function(t){1==t.value?g=e.elemDef=n.currentElemDef:2==t.value&&(g=e.elemDef=n.getSceneObj().obj)},!0);var f,m=$("#nr");m.find(".edit_area").find("li"),e.$on("element.triggered.add",function(t,n,i){$(".switch-original").remove(),f=$("#inside_"+e.elemDef.id);var r=$('<div class="switch-original">');f.append(r).children(".bar").hide(),o(e,e.elemDef,n,i)}),e.$on("create.trigger.menu",function(t,n,i){if(!n.find(".switch-original").length){var r=a(e,n);u(r,"triggerMenu",i)}}),e.$on("switch.triggered.state",function(t,n,i,r,o){var a=$("#inside_"+r);i.type,n?s(a,e.sendType,p,g.id,r,o):c(a,e.sendType,p,g.id,r,o)}),e.$on("show.random.trigger",function(t,n,r,o){i.getSendIds(p.RANDOMEVENT.value,n.id);var a=utilTrigger.getHandleType().RANDOMEVENT.value;d(e.sendType,a,n.id,r.id,o),i.getTrigger(n.id)}),e.$on("cancel.element.trigger",function(t,i,r,o){if(f=$("#inside_"+i),l(f,e.sendType,p,r,i,o),"n"==h[i].type&&($("#nr").find("#inside_"+i).remove(),n.deleteElement(i)),e.triggerEvents.length)for(var a=0;a<e.triggerEvents.length;a++){var s=!0;if(e.triggerEvents[a].handles)for(var c=0;c<e.triggerEvents[a].handles.length;c++)e.triggerEvents[a].handles[c].ids.length&&(s=!1);s&&(e.triggerEvents.splice(a,1),a--)}}),e.$on("select.trigger.original",function(t){var i=m.find(".edit_area").children("li");$('<div class="mask-trigger">').insertAfter(".edit_area").click(function(){$(this).remove(),i.each(function(){var e=$(this),t=e.attr("ctype"),n=parseInt(e.attr("id").replace("inside_",""),10);(2==t||4==t||"h"==t||"x"==t)&&e.css({"background-color":"","z-index":h[n].css.zIndex})});var t=parseInt($(".switch-original").parent().attr("id").replace("inside_",""),10);
g=e.elemDef=n.currentElemDef=h[t],"4"==g.type?$scope.triggerOriginal="图片1":"2"==g.type?$scope.triggerOriginal="文字1":"h"==g.type?$scope.triggerOriginal="形状1":"x"==g.type&&($scope.triggerOriginal="多字体1"),e.$apply()}),i.each(function(){var e=$(this),t=e.attr("ctype");(2==t||4==t||"h"==t||"x"==t)&&e.css({"background-color":"rgba(255,255,255,0.9)","z-index":10001})})})}function o(t,n,r,o){var a=$("#nr"),s=a.find(".edit_area").children("li");a.find(".mask-trigger").remove(),e('<div class="trigger-elem-list" trigger-elem-list panel-draggable></div>')(t).appendTo(".content"),$('<div class="mask-trigger">').insertAfter("#nr .edit_area");var c;if(i.getTrigger(n.id)&&(c=i.getTrigger(n.id).sends),s.each(function(){var e=$(this),t=e.attr("ctype");(2==t||4==t||"h"==t||"x"==t)&&(e.css({"background-color":"rgba(255,255,255,0.9)","z-index":10001}),c&&c.length&&$.each(c,function(t,n){t!=o&&$.each(n.handles,function(t,n){n.ids.length&&$.each(n.ids,function(t,n){e.attr("id")=="inside_"+n&&e.css({"background-color":"","z-index":""})})})}))}),n){var l=[];$.each(p,function(e,t){if(2!=t.value){var r=i.getSendIds(t.value,n.id);$.each(r,function(e,t){l.push(t)})}}),$.each(l,function(e,t){var n=a.find("#inside_"+t);n.css({"background-color":"","z-index":""})}),$("#comp_setting").css({zIndex:""})}}function a(e,t){var n=e.currentIndex,i=$('<ul id="triggerMenu" class="dropdown-menu" style="min-width: 100px; display: block;" role="menu" aria-labelledby="dropdownMenu1"><li class="trigger-show" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-dengpao1"></div>显示</a></li><li class="trigger-hide" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-dengpao1" style="color: #5F5F5F;"></div>隐藏</a></li><li class="trigger-none" role="presentation"><a role="menuitem" tabindex="-1"><div style="width: 21px;"></div>取消</a></li></ul>').css({position:"absolute","user-select":"none"}),r=$(".edit_area").find(".switch-original"),o=parseInt(r.parent().attr("id").replace("inside_",""),10),a=parseInt(t.attr("id").replace("inside_",""),10);return i.children(".trigger-show").click(function(){s(t,e.sendType,p,o,a,n),i.hide(),e.$apply()}),i.children(".trigger-hide").click(function(){c(t,e.sendType,p,o,a,n),i.hide(),e.$apply()}),i.children(".trigger-none").click(function(){l(t,e.sendType,p,o,a,n),i.hide(),$.each(e.triggerElements,function(e,t){a==t.id&&(t.checked=!1,t.triggerType="")}),e.$apply()}),i}function s(e,t,n,r,o,a){e.children(".boom").length||(e.children(".boom1").remove(),$('<div class="boom">').appendTo(e),i.deleteTrigger(t.value,n.HIDE.value,r,o,a),i.addTrigger(t.value,n.SHOW.value,r,o,a))}function c(e,t,n,r,o,a){e.children(".boom1").length||(e.children(".boom").remove(),$('<div class="boom1">').appendTo(e),i.deleteTrigger(t.value,n.SHOW.value,r,o,a),i.addTrigger(t.value,n.HIDE.value,r,o,a))}function l(e,t,n,r,o,a){e.children(".boom, .boom1").remove(),i.deleteTrigger(t.value,n.SHOW.value,r,o,a),i.deleteTrigger(t.value,n.HIDE.value,r,o,a),i.deleteTrigger(t.value,n.RANDOMEVENT.value,r,o,a)}function d(e,t,n,r,o){i.deleteTrigger(e.value,t,n,r,o),i.addTrigger(e.value,t,n,r,o)}function u(e,t,n){var i=$("#eq_main");$("#"+t).remove(),e.css({left:n.pageX+i.scrollLeft()+15,top:n.pageY+i.scrollTop(),zIndex:10001}).appendTo(i),i.mousemove(function(n){e=$("#"+t),(n.pageX<e.offset().left-20||n.pageX>e.offset().left+e.width()+20||n.pageY<e.offset().top-20||n.pageY>e.offset().top+e.height()+20)&&(e.hide(),$(this).unbind("mousemove"))})}var p=(utilTrigger.getSendType(),utilTrigger.getHandleType()),h=n.getElementsMap();return{restrict:"EA",link:r}}]).directive("leavePanel",function(){function e(e,t,n){t.hover(function(){},function(){e.obj={showTriggerPanel:!1},e.$apply()})}return{restrict:"EA",link:e}}).directive("triggerElemList",["$translate","sceneService","triggerService",function(e,t,n){function i(e,i,o){var a=angular.copy(t.getSceneObj().obj.elements),s=t.getElementsMap(),c={};e.triggerElements=[];var l;1==e.sendType.value?l=e.elemDef.trigger:2==e.sendType.value&&(e.elemDef.properties||(e.elemDef.properties={}),l=e.elemDef.properties.trigger);var d=$("#nr").find(".edit_area").children("li");$.each(a,function(e,t){("2"==t.type||"4"==t.type||"h"==t.type||"x"==t.type)&&(c[t.type]||(c[t.type]=[]),c[t.type].push(t))}),$.each(c,function(t,n){$.each(n,function(t,n){"4"==n.type?n.name="图片":"2"==n.type?n.name="文字":"h"==n.type?n.name="形状":"x"==n.type&&(n.name="多字体"),n.name+=t+1,n.id!=e.elemDef.id&&e.triggerElements.push(n)})}),l&&l.sends&&$.each(l.sends,function(t,n){t!=e.currentIndex&&$.each(n.handles,function(t,n){n.ids.length&&$.each(n.ids,function(t,n){for(var i=0;i<e.triggerElements.length;i++)e.triggerElements[i].id==n&&(e.triggerElements.splice(i,1),i--)})})}),e.changed=function(t){t.checked?(n.deleteTrigger(e.sendType.value,r.HIDE.value,e.elemDef.id,t.id,e.currentIndex),n.addTrigger(e.sendType.value,r.SHOW.value,e.elemDef.id,t.id,e.currentIndex)):(n.deleteTrigger(e.sendType.value,r.SHOW.value,e.elemDef.id,t.id,e.currentIndex),n.deleteTrigger(e.sendType.value,r.HIDE.value,e.elemDef.id,t.id,e.currentIndex))},e.confirmList=function(){$(".mask-trigger").remove(),$(".trigger-list").remove(),e.elemDef&&($(".switch-original").remove(),$("#triggerMenu").hide(),$(".edit_area").find(".boom, .boom1").remove()),d.each(function(){var e=$(this),t=e.attr("ctype"),n=parseInt(e.attr("id").replace("inside_",""),10);(2==t||4==t||"h"==t||"x"==t)&&e.css({"background-color":"","z-index":s[n].css.zIndex})});var t,n=!1;1==e.sendType.value?t=e.elemDef.trigger:2==e.sendType.value&&(e.elemDef.properties||(e.elemDef.properties={}),t=e.elemDef.properties.trigger),t&&t.sends&&t.sends[e.currentIndex]?($.each(t.sends[e.currentIndex].handles,function(e,t){t.ids.length&&(n=!0)}),n||e.triggerEvents.splice(e.currentIndex,1)):e.triggerEvents.splice(e.currentIndex,1)},e.$watch("elemDef",function(t){var n;1==e.sendType.value?n=t.trigger:2==e.sendType.value&&(t.properties||(t.properties={}),n=t.properties.trigger),n&&n.sends&&$.each(n.sends,function(t,n){$.each(n.handles,function(t,n){$.each(n.ids,function(t,i){$.each(e.triggerElements,function(e,t){t.id==i&&(t.checked=!0,t.triggerType=n.type)})})})})},!0)}var r=(utilTrigger.getSendType(),utilTrigger.getHandleType());return{restrict:"EA",templateUrl:"scene/console/triggerelemlist.tpl.html",replace:!1,link:i}}]).directive("highlightElement",function(){function e(e,t,n){var i,r=$("#nr").find("li");setTimeout(function(){t.find(".trigger-elem").hover(function(t){i=$(this).attr("id").substring(8),$.each(r,function(t,n){"inside_"+e.elemDef.id!=$(n).attr("id")&&$(n).css({zIndex:"","background-color":""})}),$("#inside_"+i).css({"z-index":10001,"background-color":"rgba(255,255,255,0.9)"})},function(){$.each(e.triggerElements,function(e,t){$("#inside_"+t.id).css({"z-index":10001,"background-color":"rgba(255,255,255,0.9)"})})})},0)}return{restrict:"EA",link:e}}),angular.module("scene.create.console.video",[]),angular.module("scene.create.console.video").controller("VideoCtrl",["$scope","$timeout","$translate","obj",function(e,t,n,i){function r(e){var t=e.substring(e.indexOf("src=")+4),n=t.substring(t.indexOf("://")+3),i=n.substring(0,n.indexOf("/"));return i.indexOf("v.qq")>=0||i.indexOf("tudou")>=0||i.indexOf("youku")>=0}e.model||(e.model={}),e.authError="",e.model.src=i.properties.src,e.confirm=function(){if(!e.model.src)return $("textarea").focus(),void(e.authError="请输入视频地址");var t=r(e.model.src);return t?void e.$close(e.model.src):($("textarea").addClass("error"),$("textarea").change(function(){$(this).removeClass("error")}),void(e.authError="暂不支持添加此视频！"))},e.cancel=function(){e.$dismiss()}}]),angular.module("scene.create.console.ppt",["angularFileUpload"]),angular.module("scene.create.console.ppt").controller("PptCtrl",["$scope","$routeParams","$http","FileUploader","i18nNotifications","$route","$location",function(e,t,n,i,r,o,a){var s=e.vm={};s.values=[{value:"竖屏导入",way:"0"},{value:"横屏导入",way:"1"}],s.selection=s.values[0];var c=0;s.change=function(e){c=e};var l="index.php?c=upfile&a=upload&bizType=0&fileType=0",d=e.uploader=new i({url:PREFIX_URL+l});d.filters.push({name:"imageFilter",fn:function(e,t){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(n)!==-1}}),d.onWhenAddingFileFailed=function(e,t,n){console.info("onWhenAddingFileFailed",e,t,n)},d.onAfterAddingFile=function(e){console.info("onAfterAddingFile",e)},d.onAfterAddingAll=function(e){console.info("onAfterAddingAll",e)},d.onBeforeUploadItem=function(e){console.info("onBeforeUploadItem",e)},d.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},d.onProgressAll=function(e){console.info("onProgressAll",e)},d.onSuccessItem=function(e,t,n,i){console.info("onSuccessItem",e,t,n,i),console.log(t)},d.onErrorItem=function(e,t,n,i){console.info("onErrorItem",e,t,n,i)},d.onCancelItem=function(e,t,n,i){console.info("onCancelItem",e,t,n,i)},d.onCompleteItem=function(e,t,n,i){console.info("onCompleteItem",e,t,n,i)},d.onCompleteAll=function(){console.info("onCompleteAll")},e.submitImages=function(){for(var i=[],a=[],s=0;s<d.queue.length;s++)a[s]=JSON.parse(d.queue[s]._xhr.response),i.push({url:a[s].obj.path});var l={seceneId:t.sceneId,way:c,obj:i},u=PREFIX_URL+"index.php?c=scene&a=pptsave";return n({withCredentials:!0,method:"POST",url:u,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:l}).then(function(t){200==t.data.code&&(r.pushForCurrentRoute("scene.create.console.ppt.success","notify.success"),d.queue.length=0,e.$dismiss(),o.reload()),400==t.data.code&&r.pushForCurrentRoute("scene.create.console.ppt.error","notify.warning")})},e.cancel=function(){$("console ppt_console").on("hide.bs.modal",function(e){console.log("123245")}),e.$dismiss()}}]),angular.module("scene.create.console.psd",[]),angular.module("scene.create.console.psd").controller("PsdCtrl",["$scope","$routeParams","$http","FileUploader","i18nNotifications","$route","$location","$timeout",function(e,t,n,i,r,o,a,s){e.infoChange=function(){var e=document.getElementById("xinxi"),t=document.getElementById("file-7").files[0].name;console.log(t),e.innerHTML=t},e.cancel=function(){$("console ppt_console").on("hide.bs.modal",function(e){}),e.$dismiss()},e.submitImages=function(){function n(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);document.getElementById("progressNumber").innerHTML=t.toString()+"%";var n=document.getElementById("progressNumber").innerHTML;"100%"==n&&(document.getElementById("jiema").style.display="block")}else document.getElementById("progressNumber").innerHTML="unable to compute"}function i(t){var n=$.parseJSON(t.target.responseText);alert(n.msg),e.$dismiss(),o.reload()}function r(e){var t=$.parseJSON(e.target.responseText);alert(t.msg)}function a(e){var t=$.parseJSON(e.target.responseText);alert(t.msg)}var s=document.getElementById("file-7").files[0],c="index.php?c=scene&a=psd",l=new FormData;l.append("sceneid",t.sceneId),l.append("pageid",sessionStorage.getItem("pageid")),l.append("file",s),sessionStorage.setItem("pageid","");var d=new XMLHttpRequest;d.upload.addEventListener("progress",n,!1),d.addEventListener("load",i,!1),d.addEventListener("error",r,!1),d.addEventListener("abort",a,!1),d.open("post",c,!0),d.send(l)}}]),angular.module("scene.create",["app.directives.editor","services.scene","confirm-dialog","services.modal","app.directives.component","services.pagetpl","save.template","scene.create.console","app.directives.comp.editor","app.directives.addelement","scene.my.upload","services.i18nNotifications","services.history","security.service","scene.edit.select","scene.edit.common","scene.edit.keymap","scene.edit.bg","scene.userGuide","services.staticRes","scene.create.pageTpl","scene.create.hoverElement","scene.preview","services.file"]),angular.module("scene.create").controller("CreateSceneCtrl",["$timeout","$compile","$rootScope","$scope","$routeParams","$route","$location","sceneService","pageTplService","$modal","ModalService","security","$window","i18nNotifications","historyService","panStateTracker","selectService","continueUrl","triggerService","staticResService","dataCacheService","fileService","storageService",function(e,t,n,r,o,a,s,c,l,d,u,p,h,g,f,m,v,y,b,w,E,S,x){function T(){var e=!1;return angular.forEach(r.tpl.obj.elements,function(t){6==(""+t.type).charAt(0)&&(e=!0)}),e}function C(e,t,i,o){sessionStorage.setItem("pageid",r.pages[e-1].id),r.loading=!0,r.pageId=r.pages[e-1].id,c.getSceneByPage(r.pageId,t,i).then(function(o){r.loading=!1,r.tpl=o.data,D=r.tpl.obj.properties,D&&D.trigger&&b.setTrigger(r.tpl.obj.id,D.trigger),delete r.tpl.obj.scene,r.sceneId=r.tpl.obj.sceneId,r.controlView.showBgTag=!1,angular.forEach(r.tpl.obj.elements,function(e,t){3==e.type&&(r.controlView.showBgTag=!0,r.currentBgDef=e)}),D&&(D.image||D.scratch)&&(r.effectName="涂抹"),D&&D.finger&&(r.effectName="指纹"),D&&D.effect&&("money"==D.effect.name?r.effectName="数钱":"snowFly"==D.effect.name?r.effectName="飘雪":"fireWorks"==D.effect.name?r.effectName="烟花":"none"==D.effect.name&&(r.effectName="无")),D&&D.fallingObject&&(r.effectName="环境"),(t||i)&&(s.$$search={},s.search("pageId",++e),r.getPageNames()),r.pageNum=e,$("#nr").empty();var a=angular.copy(r.tpl.obj);a.elements=f.addPage(a.id,a.elements),c.templateEditor.parse({def:r.tpl.obj,appendTo:"#nr",mode:"edit"}),r.originData=JSON.stringify(r.tpl),n.$broadcast("dom.changed")},function(){r.loading=!1})}function I(){g.pushForCurrentRoute("scene.save.success.nopublish","notify.success")}r.loading=!1,r.PREFIX_FILE_HOST=PREFIX_FILE_HOST,r.tpl={},r.originData="";var R,P="",M=21,_=1,k=0,A=!1;if(r.templateType=1,r.controlView={},r.showSearch=!0,r.completeHtml2Canvas=null,r.lastPageTypes=[{name:"微学宝尾页",value:"eqFree"},{name:"微学宝底标",value:"eqLink"},{name:"去掉微学宝展示",value:"eqHide"}],r.pageTpl={},r.isAppEditor=!1,r.tabid="template",r.$watch("user",function(e){if(e)for(var t=0;t<e.roleIdList.length;t++)13==e.roleIdList[t]&&(r.isAppEditor=!0),(4==e.roleIdList[t]||12==e.roleIdList[t]||13==e.roleIdList[t])&&(r.isTplEditor=!0)},!0),r.refreshTpl=function(){k>_&&!A&&(A=!0,r.getPageTpls(++_))},r.showPhone="false"!=x.get("create.phoneView"),r.showPhoneTip="false"!=x.get("create.showPhoneTip"),r.switchPhone=function(){r.showPhone=!r.showPhone,n.$broadcast("switchBox",r.showPhone),x.push("create.phoneView",r.showPhone),x.get("create.showPhoneTip")||(x.push("create.showPhoneTip",!1),r.showPhoneTip=!1)},r.createComp=function(e,t){return r.sceneSetting.showFlag=!1,"6"==e&&T()?void u.openMsgDialog({msg:"当前页面的提交按钮已经存在，请不要重复添加。"}):void c.createComp(e,null,t)},r.$on("hisChange",function(){f.addPageHistory(r.tpl.obj.id,r.tpl.obj.elements)}),l.getPageTagLabel(11001).then(function(e){r.tplFormatList=e.data.list}),l.getPageTagLabel(11003).then(function(e){r.tplInteractionList=e.data.list}),l.getPageTagLabel(11002).then(function(e){r.tplStyleList=e.data.list}),r.getPageTplTypestemp=function(e,t,n,i){l.getPageTplTypestemp(e,t,n,i).then(function(e){if(A=!1,e.data.list&&e.data.list.length>0){_>1?r.pageTpls=r.pageTpls.concat(e.data.list):r.pageTpls=e.data.list,k=Math.ceil(e.data.map.count/M);var t=e.config.url.split("&time")[0];E.contains(t)||(E.push("pageTpl",E.getAsyncUrl(),e),E.setAsyncUrl())}else r.pageTpls=[],k=0})},r.enterPress=function(e){var t=e||window.event;13==t.keyCode&&r.getPageTpls()},r.getPageTpls=function(e){var t="";e||(e=_=1);for(var n in r.pageTpl)"name"!=n&&r.pageTpl[n]&&(t+=r.pageTpl[n]+",");""!==t&&(t=t.substr(0,t.length-1)),r.pageTpl.name&&""!==r.pageTpl.name&&(r.showSearch=!1),r.getPageTplTypestemp(t,r.pageTpl.name,M,e)},r.getPageTpls(),r.resetTplFilter=function(){r.pageTpl.name=null,r.showSearch=!0,r.getPageTpls()},r.support=function(){return(!window.sessionStorage||"false"!==sessionStorage.getItem("checkSuport"))&&(!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/)||navigator.userAgent.match(/Chrome/))&&((!navigator.userAgent.match(/iPad/)||!navigator.userAgent.match(/CriOS/))&&(y.setUrl(s.path()),s.path("scene/support"),!0)))},!r.support()){r.createCompGroup=function(e,t){r.sceneSetting.showFlag=!1,"g101"==e&&T()&&(u.openMsgDialog({msg:"当前页面的提交按钮已经存在，本操作将会删除已添加的按钮。"}),angular.forEach(r.tpl.obj.elements,function(e){6==(""+e.type).charAt(0)&&($("#nr").find("#inside_"+e.id).remove(),v.deleteElement(e.id),c.deleteElement(e.id))})),c.createCompGroup(e,null,t)},r.isRadioCheckboxRatingAccessable=p.isAllowToAccess(p.accessDef.RADIO_CHECKBOX_RATING),r.isInteractionAccessable=p.isAllowToAccess(p.accessDef.INTERACTION),r.isInteractionCounterAccessable=p.isAllowToAccess(p.accessDef.INTERACTION_COUNTER),r.updateCompPosition=c.updateCompPosition,r.updateCompAngle=c.updateCompAngle,r.updateCompSize=c.updateCompSize,r.openAudioModal=c.openAudioModal,r.openTriggerMode=c.openTriggerMode,r.$on("dom.changed",function(e){t($("#nr"))(r),n.$broadcast("boxOuter")});var L=null;r.$on("showCropPanel",function(e,i){var o=$(".content").eq(0);L?(n.$broadcast("changeElemDef",i),L.show()):L=t("<div crop-image></div>")(r),o.append(L)}),r.openPageEffectModal=function(e){var t=angular.copy(e);d.open({windowClass:"console six-contain effect-console",templateUrl:"scene/pageeffect/pageeffect.tpl.html",controller:"pageEffectCtrl",resolve:{properties:function(){return t}}}).result.then(function(e){r.tpl.obj.properties||(r.tpl.obj.properties={}),r.tpl.obj.properties.scratch=null,r.tpl.obj.properties.finger=null,r.tpl.obj.properties.fallingObject=null,r.tpl.obj.properties.effect=null,"无"!=e.name&&(r.tpl.obj.properties[e.value]=e.properties[e.value]),r.effectName=e.name},function(){n.$broadcast("clear.scratch.interval")})};var D,z=null;r.$on("showStylePanel",function(e,n){var i=$(".content").eq(0);z?z.show():"style"==n.activeTab?z=t('<div style-modal active-tab="style"></div>')(r):"anim"==n.activeTab?z=t('<div style-modal active-tab="anim"></div>')(r):"trigger"==n.activeTab&&(z=t('<div style-modal active-tab="trigger"></div>')(r)),i.append(z)}),r.$on("hideStylePanel",function(e){z&&z.hide()}),r.refreshPage=function(e,t){return r.completeHtml2Canvas?void r.completeHtml2Canvas.then(function(){r.refreshPage(e,t)}):(parseInt(t,10),$("#nr").empty(),c.templateEditor.parse({def:r.tpl.obj,appendTo:"#nr",mode:"edit"}),n.$broadcast("dom.changed"),void 0)},r.navTo=function(e,t){sessionStorage.setItem("pageid",e.id),r.controlView.pageList=!0,r.isTplEditor&&(r.pageLabelAll.length=0,r.pageIdTag=e.id,r.getPageTagLabel()),e.id!=r.tpl.obj.id&&(r.setEditableStatus(),r.controlView.showBgTag=!1,r.saveUsedFiles(function(){r.saveScene(null,function(){C(t+1),s.$$search={},s.search("pageId",e.num)})}),m.clear())},r.saveUsedFiles=function(e){var t=[];$.extend(t,r.tpl.obj.elements);for(var n=JSON.parse(r.originData).obj.elements,i=0;i<t.length;i++){var o=t[i];if(o.sound||o.type+""=="3"||o.type+""=="4")for(var a=0;a<n.length;a++){var s=n[a];if(o.id==s.id){o.type+""!="3"&&o.type+""!="4"?!o.sound||s.sound&&s.sound.id==o.sound.id||E.pushUsedFile(2,o.sound.id):o.properties.id!=s.properties.id&&E.pushUsedFile(1,o.properties.id);break}a==n.length-1&&(o.type+""!="3"&&o.type+""!="4"?E.pushUsedFile(2,o.sound.id):E.pushUsedFile(1,o.properties.id))}}var c=E.getUsedFiles();E.clearUsedFiles(),c?S.saveFilesHistory(c.file,c.type).then(function(){e&&e()}):e&&e()},r.stopCopy=function(){copied=!1},r.getOriginPageName=function(e){P=e.name},r.getPageNames=function(){var e=o.sceneId;c.getPageNames(e).then(function(e){r.pages=e.data.list,angular.forEach(r.pages,function(e,t){e.name||(e.name="第"+(t+1)+"页")}),C(s.search().pageId?s.search().pageId:r.pages[0].num)})},r.scene=null,c.getSceneDetail(o.sceneId,n.branchid).then(function(e){r.scene=c.getCurrentScene(),r.sceneSetting.oldBgAudio=r.scene.bgAudio,r.getPageNames()}),r.editableStatus=[],r.setEditableStatus=function(e,t,n){if(e!==undefined)r.editableStatus[e]=t;else for(var i=0;i<r.editableStatus.length;i++)r.editableStatus[i]=!1},r.savePageNames=function(e,t){e.name||(e.name="第"+(t+1)+"页"),r.tpl.obj.name=e.name,P!=e.name&&c.savePageNames(r.tpl.obj).then(function(e){g.pushForCurrentRoute("page.change.success","notify.success")})},r.removeScratch=function(e){e.stopPropagation(),r.tpl.obj.properties.scratch=null,r.tpl.obj.properties.finger=null,r.tpl.obj.properties.fallingObject=null,r.tpl.obj.properties.effect=null},r.$on("text.click",function(n,i){$("#btn-toolbar").remove(),$("body").append(t("<toolbar></toolbar>")(r));var o=$(i).offset().top;e(function(){$("#btn-toolbar").css("top",o-50),$("#btn-toolbar").show(),$("#btn-toolbar").bind("click mousedown",function(e){e.stopPropagation()}),$(i).wysiwyg_destroy(),$(i).wysiwyg(),$(i).trigger("dblclick").focus(),setTimeout(function(){if(window.getSelection){var e=window.getSelection();e.modify("move","left","documentboundary"),e.modify("extend","right","documentboundary")}})})}),r.updatePosition=function(e){var t,n,i=r.tpl.obj.elements,o=[];for(n=0;n<i.length;n++)if("3"==i[n].type){i[n].num=0,o.push(i[n]),i.splice(n,1);break}for(t=0;t<e.length;t++)for(n=0;n<i.length;n++)if(i[n].num==e[t]){i[n].num=t+1,o.push(i[n]),i.splice(n,1);break}r.tpl.obj.elements=o},r.updateEditor=function(){$("#nr").empty(),c.templateEditor.parse({def:r.tpl.obj,appendTo:"#nr",mode:"edit"}),t($("#nr"))(r)};var F=!1;r.saveScene=function(e,t){if(!r.scene.name&&e&&!r.sceneSetting.showFlag)return void u.openMsgDialog({msg:"尚未设置标题，请设置后再执行此操作",btn:"去设置"},function(){r.sceneSetting.showFlag=!0});if(!F){if(r.sceneSetting.showFlag)return void r.sceneSetting.saveSceneSetting().then(function(){r.saveScene(e,t)});if(r.sceneSetting.oldBgAudio!=r.scene.bgAudio)return void c.saveSceneSettings(r.scene).then(function(){S.saveFilesHistory(r.scene.bgAudio?r.scene.bgAudio.id:0,2).then(function(){E.clear("fileService1")}),r.sceneSetting.oldBgAudio=r.scene.bgAudio,r.saveScene(e,t)});if(r.completeHtml2Canvas)return void r.completeHtml2Canvas.then(function(){r.saveScene(e,t)});if(F=!0,r.originData==JSON.stringify(r.tpl))return t&&t(),e&&(!r.scene.publishTime||r.scene.updateTime>r.scene.publishTime?I():g.pushForCurrentRoute("scene.save.success.published","notify.success")),void(F=!1);delete r.tpl.obj.scene,c.resetCss(),c.saveScene(r.tpl.obj).then(function(n){return e&&r.saveUsedFiles(),F=!1,n.data.success?(r.scene.updateTime=(new Date).getTime(),r.originData=angular.toJson(r.tpl),R&&(c.recordTplUsage(R),R=null),t&&t(),void(e&&I())):void alert("保存失败，服务器忙碌请稍后再试。")},function(){F=!1,alert("保存失败，服务器忙碌请稍后再试。")})}},r.publishScene=function(){return r.scene.name||r.sceneSetting.showFlag?2!=r.scene.status||r.allowPublish?r.sceneSetting.showFlag?void r.sceneSetting.saveSceneSetting().then(function(){r.publishScene()}):r.sceneSetting.oldBgAudio!=r.scene.bgAudio?void c.saveSceneSettings(r.scene).then(function(){r.scene.bgAudio?S.saveFilesHistory(r.scene.bgAudio.id,2).then(function(){E.clear("fileService1"),r.sceneSetting.oldBgAudio=r.scene.bgAudio,r.publishScene()}):(r.sceneSetting.oldBgAudio=r.scene.bgAudio,r.publishScene())}):r.completeHtml2Canvas?void r.completeHtml2Canvas.then(function(){r.publishScene()}):!r.allowPublish&&r.scene.publishTime&&r.scene.updateTime<=r.scene.publishTime&&r.originData==angular.toJson(r.tpl)?void s.path("spread/share/"+r.sceneId+"/socialShare"):void r.saveUsedFiles(function(){r.saveScene(null,function(){c.publishScene(r.tpl.obj.sceneId).then(function(e){e.data.success&&(g.pushForNextRoute("scene.publish.success","notify.success"),s.path("spread/share/"+r.sceneId+"/socialShare"))})})}):void u.openConfirmDialog({msg:"当前微课为不允许访问状态，发布微课将重新对外开放访问 ",confirmName:"坚持发布",cancelName:"保存退出"},function(){r.allowPublish=!0,r.publishScene()},function(){r.saveScene(null,function(){s.path("spread/share/"+r.sceneId+"/socialShare")})}):void u.openMsgDialog({msg:"尚未设置标题，请设置后再执行此操作",btn:"去设置"},function(){r.sceneSetting.showFlag=!0})},r.exitScene=function(){JSON.parse(r.originData),s.$$search={},r.originData==angular.toJson(r.tpl)?s.path("main"):u.openConfirmDialog({msg:"是否保存更改内容？",confirmName:"保存",cancelName:"不保存"},function(){r.saveScene(),s.path("main")},function(){s.path("main")})},r.duplicatePage=function(){r.saveScene(null,function(){C(r.pageNum,!1,!0)})},r.insertPage=function(){r.saveUsedFiles(function(){r.saveScene(null,function(){C(r.pageNum,!0,!1)})}),$("#pageList").height()>=360&&e(function(){var e=document.getElementById("pageList");e.scrollTop=e.scrollHeight},200)},r.deletePage=function(e){if(e.stopPropagation(),1!=r.pages.length&&!r.loading){for(r.loading=!0,r.action=!1,i=0;i<r.tpl.obj.elements.length;i++){var t=r.tpl.obj.elements;5==t[i].type.toString()[0]&&(r.action=!0)}console.log(r.pages),r.action===!0?u.openConfirmDialog({msg:"确定删除此页，将同时删除该微课已收集的数据?"},function(){N()}):N()}};var N=function(){c.deletePage(r.tpl.obj.id).then(function(){r.loading=!1,s.$$search={},r.pages.length==r.pageNum?(r.pages.pop(),s.search("pageId",--r.pageNum),C(r.pageNum,!1,!1)):(r.pages.splice(r.pageNum-1,1),s.search("pageId",r.pageNum),C(r.pageNum,!1,!1))},function(){r.loading=!1})};r.removeBG=function(e){var t,i=r.tpl.obj.elements;for(t=0;t<i.length;t++)if(3==i[t].type){i.splice(t,1);var o;for(o=t;o<i.length;o++)i[o].num--;break}n.$broadcast("remove.scene.bg")},r.removeBGAudio=function(e){e.stopPropagation(),r.scene.bgAudio=null},$(".scene_title").on("paste",function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain")||prompt("Paste something..");document.execCommand("insertText",!1,t)}),r.myName=[{name:"我的"}],r.myCompany=[{name:"企业"}],r.creatCompanyTemplate=function(){var e=$.extend(!0,{},r.tpl.obj);if(delete e.scene,n.user){var t=parseInt(n.user.companyTplId,10);t?e.sceneId=t:n.companySceneId?e.sceneId=n.companySceneId:e.sceneId=null,c.saveCompanyTpl(e).then(function(e){e.data.success&&(g.pushForCurrentRoute("companytpl.setting.success","notify.success"),n.companySceneId=e.data.obj,r.getPageTplsByCompanyType())})}else r.myCompanyTpls=[]},n.$on("saveCompanyTemplate",function(){r.creatCompanyTemplate()});var H=null;r.getPageTplsByCompanyType=function(){if(r.myCompanyTpls=[],r.myCompany[0].active=!0,!H)if(n.companySceneId)H=n.companySceneId;else{var e=parseInt(n.user.companyTplId,10);e&&(H=n.companySceneId=e)}H?c.previewScene(H).then(function(e){r.myCompanyTpls=e.data.list,r.tabid="company"}):r.tabid="company"},r.getRecentlyUsedTpls=function(){r.tabid="recentlyUsed",c.recentlyUsedTpls().then(function(e){r.myRecentlyTpls=e.data.list})},r.setTplTab=function(){r.tabid="template"},r.creatMyTemplate=function(){var e=$.extend(!0,{},r.tpl.obj);if(delete e.scene,n.user){console.log("创建我的模板"),console.log(n),console.log(n.user);var t=JSON.parse(n.user.property);t&&t.myTplId?e.sceneId=t.myTplId:n.mySceneId?e.sceneId=n.mySceneId:e.sceneId=null,c.saveMyTpl(e).then(function(e){g.pushForCurrentRoute("mytpl.setting.success","notify.success"),console.log(e.scene),console.log(e.data),n.mySceneId=e.data.obj,r.getPageTplsByMyType()})}else r.myPageTpls=[]},r.$on("saveMyTemplate",function(){r.creatMyTemplate()});var U=null;r.getPageTplsByMyType=function(){if(console.log(n),console.log(n.user),r.myPageTpls=[],r.myName[0].active=!0,!U)if(n.mySceneId)U=n.mySceneId;else{var e=JSON.parse(n.user.property);e&&e.myTplId&&(U=n.mySceneId=e.myTplId)}U?c.previewScene(U).then(function(e){r.myPageTpls=e.data.list,r.tabid="myCollection"}):r.tabid="myCollection"},r.$on("myPageList.update",function(e,t,n,o){if("my-tpl"==t)for(i=0;i<r.myPageTpls.length;i++)r.myPageTpls[i].id==o&&r.myPageTpls.splice(i,1);if("company-tpl"==t)for(i=0;i<r.myCompanyTpls.length;i++)r.myCompanyTpls[i].id==o&&r.myCompanyTpls.splice(i,1)}),r.$on("myPageList.delete",function(e,t,i){"company-tpl"==t&&21==n.user.type&&(i.context.firstElementChild.outerHTML="")});var O={};r.getPageTplsByType=function(e){O[e]?(r.childCatrgoryList=O[e],r.getPageTplTypestemp(r.childCatrgoryList[0].id),childTagCut()):(r.childCatrgoryList=O[e]=w.getPageTpls(e),r.getPageTplTypestemp(r.childCatrgoryList[0].id),childTagCut())};var B={};r.getPageTagLabel=function(e){B[e]?(r.pageLabel=B[e],q()):r.scene&&r.isAppEditor?l.getPageTagLabel(1601).then(function(e){r.pageLabel=B[1601]=e.data.list,q()}):(r.pageLabel=B[e]=w.getPageTpls(e),q())},r.pageLabelAll=[];var j,q=function(e){l.getPageTagLabelCheck(r.pageIdTag).then(function(e){j=e.data.list;for(var t=0;t<r.pageLabel.length;t++){for(var n={id:r.pageLabel[t].id,name:r.pageLabel[t].name},i=0;i<j.length;i++){if(j[i].id===r.pageLabel[t].id){n.ischecked=!0;break}n.ischecked=!1}r.pageLabelAll.push(n)}})};r.exitPageTplPreview=function(){$("#nr").empty(),c.templateEditor.parse({def:r.tpl.obj,appendTo:"#nr",mode:"edit"}),n.$broadcast("dom.changed")},r.insertPageTpl=function(e){r.loading=!0;var t=function(e){c.getSceneTpl(e).then(function(e){r.controlView.showBgTag=!1,r.loading=!1,R=e.data.obj.id,r.tpl.obj.elements=c.getElements(),$("#nr").empty(),f.addPageHistory(r.tpl.obj.id,r.tpl.obj.elements),c.templateEditor.parse({def:r.tpl.obj,appendTo:"#nr",mode:"edit"}),angular.forEach(r.tpl.obj.elements,function(e,t){3==e.type&&(r.controlView.showBgTag=!0,r.currentBgDef=e)}),n.$broadcast("dom.changed")},function(){r.loading=!1})};r.tpl.obj.elements&&r.tpl.obj.elements.length>0?u.openConfirmDialog({msg:"页面模板会覆盖编辑区域已有组件，是否继续？",confirmName:"是",cancelName:"取消"},function(){t(e)}):t(e)},r.chooseThumb=function(){d.open({windowClass:"console img_console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:"0"}}}}).result.then(function(e){r.tpl.obj.properties||(r.tpl.obj.properties={}),r.tpl.obj.properties.thumbSrc=e.data},function(){r.tpl.obj.properties.thumbSrc=null})},$(window).bind("beforeunload",function(){return"请确认您的微课已保存"}),r.$on("$destroy",function(){$(window).unbind("beforeunload"),f.clearHistory(),c.setCopy(!1),utilPictures.clearInterval()}),r.sortableOptions={placeholder:"ui-state-highlight ui-sort-position",containment:"#containment",update:function(e,t){var n=t.item.sortable.dropindex+1,i=r.pages[t.item.sortable.index].id;r.saveScene(null,function(){c.changePageSort(n,i).then(function(e){C(n,!1,!1,!0),s.$$search={},s.search("pageId",n),r.pageNum=n})})}},r.$on("history.changed",function(){r.canBack=f.canBack(r.tpl.obj.id),r.canForward=f.canForward(r.tpl.obj.id)}),r.back=function(){return r.completeHtml2Canvas?void r.completeHtml2Canvas.then(function(){r.back()}):(r.controlView.showBgTag=!1,void c.historyBack())},r.forward=function(){return r.completeHtml2Canvas?void r.completeHtml2Canvas.then(function(){r.forward()}):void c.historyForward()},r.openEffects=function(){r.tpl.obj.properties&&(r.tpl.obj.properties.scratch||r.tpl.obj.properties.finger||r.tpl.obj.properties.fallingObject||r.tpl.obj.properties.effect)||r.openPageEffectModal(r.tpl.obj.properties)},r.openBgPanel=function(){r.controlView.showBgTag||r.createComp("3")},r.openAudioPanel=function(){r.scene.bgAudio||r.openAudioModal()},r.closeOtherPanel=function(e){var t=!r.$eval(e);r.showBackgroundPanel=!1,r.showMusicPanel=!1,r.showEffectsPanel=!1,r.gridGuideSetting.showFlag=!1,r.$broadcast("hideBgOption"),r.showBgOptionPanel=!1,r.$eval(e+"="+t)},r.removeAudio=function(e){r.scene.bgAudio=null},r.sceneSetting={showFlag:!1,oldBgAudio:null},r.settingScene=function(){r.sceneSetting.showFlag=!0},"show"==s.search().openSetting&&e(function(){r.sceneSetting.showFlag=!0},100),r.$on("show.edit.bg",function(e,t){r.controlView.showBgTag=!0,r.currBgSrc=t}),r.gridGuideSetting={showFlag:!1},r.replaceBg=function(e){c.openBgModal(e),$("#nr").find(".wrapper-background").css({animation:"","animation-fill-mode":""})};var X=[];r.showFirstTimeTip=function(e){if(r.sceneSetting.showFlag=!1,"x"==e&&(r.showXiuFontTip=!0,window.localStorage)){var t=localStorage.getItem("setXiuFontAction");t&&(X=t.split(","),X.indexOf(n.user.id)>-1&&(r.showXiuFontTip=!1,c.createComp("x")))}},r.switchShowFontTip=function(e){e&&(X.push(n.user.id),localStorage.setItem("setXiuFontAction",X.join(",")))}}}]).directive("changeColor",function(){return{link:function(e,t,n){t.bind("click",function(){$(t).addClass("current")})}}}).directive("thumbTpl",["sceneService","ModalService",function(e,t){return{scope:{myTpl:"="},replace:!1,template:'<div class="delete-element hint--bottom hint--rounded" ng-click="deleteMyTpl($event)" data-hint="删除此模板"><span class="eqf-scene-delete"></span></div>',
link:function(n,i,r){n.$emit("myPageList.delete",r.id,i),r.noDel&&i.empty(),n.deleteMyTpl=function(o){o.stopPropagation(),t.openConfirmDialog({msg:"确定删除此模板?"},function(){e.deletePage(n.myTpl.id).then(function(){n.$emit("myPageList.update",r.id,i,n.myTpl.id)},function(e){alert("服务器异常!")})})},$('<div class = "tmp-bg"></div>').appendTo(i),e.templateEditor.parse({def:n.myTpl,appendTo:i,mode:"view"}),$(".edit_area",i).css("transform","scale(0.25) translateX(-480px) translateY(-729px)")}}}]).directive("gridGuideSetting",["gridGuide",function(e){return{scope:!0,template:'<div class="grid-guide-setting"><div class="setting-group"><span>网格开关</span><div class="setting-choice"><switch-btn ng-model="config.gridState"></switch-btn></div></div><div class="setting-group" style="height:60px;"><span style="height:24px;">网格颜色</span><div class="color-contain"><input class="color-picker-input" ng-model="grid.color" type="text" /><a class="color-picker" ng-style="{backgroundColor: grid.color}" ng-model="grid.color" colorpicker="rgba" disable="{{gridGuideSetting.showFlag}}"></a></div></div><div class="setting-group"><span>智能参考</span><div class="setting-choice"><switch-btn ng-model="config.guideState"></switch-btn></div></div><div class="setting-group"><span>吸附效果</span><div class="setting-choice"><switch-btn ng-model="config.snapState"></switch-btn></div></div></div>',link:function(e,t){function n(){e.$apply(function(){e.gridGuideSetting.showFlag=!1})}var i=$(document);t.on("$destroy",function(){i.unbind("click",n)}),i.click(n)},controller:["$scope",function(t){t.grid=e.grid,t.guide=e.guide,t.config={gridState:t.grid.getVisable()||"enable",guideState:"false"==t.grid.getGuideState()?"disable":"enable",snapState:"false"==t.grid.getSnapState()?"disable":"enable"},t.$watch("config.gridState",function(e){"enable"===e?(t.$parent.gridGuideSetting.isGridEnabled=!0,t.grid.show()):"disable"===e&&(t.$parent.gridGuideSetting.isGridEnabled=!1,t.grid.hide()),t.grid.setVisable(e)}),t.$watch("grid.color",function(e){e&&(t.grid.paint(),t.grid.setColor(e))}),t.$watch("config.guideState",function(e){"enable"===e?(t.guide.options.enabled=!0,t.grid.setGuideState(!0)):"disable"===e&&(t.guide.options.enabled=!1,t.grid.setGuideState(!1))}),t.$watch("config.snapState",function(e){"enable"===e?(t.guide.options.snap=!0,t.grid.setSnapState(!0)):"disable"===e&&(t.guide.options.snap=!1,t.grid.setSnapState(!1))})}]}}]).directive("converToImage",["selectService",function(e){function t(e,t,n){t.mousedown(function(e){$(".content").trigger("mousedown")})}return{restrict:"EA",link:t}}]).directive("switchBtn",[function(){return{require:"ngModel",restrict:"AE",template:'<div class="switch" ng-click="switch()"><div class="circle-con"><i class="circle"></i></div></div>',link:function(e,t,n,i){var r=t.find(".switch");i.$render=function(){r.toggleClass("switch-open",angular.equals(i.$modelValue,"enable")),r.toggleClass("switch-close",angular.equals(i.$modelValue,"disable"))},r.bind("click",function(){var t=r.hasClass("switch-open");e.$apply(function(){i.$setViewValue(t?"disable":"enable"),i.$render()})})}}}]).directive("pageTplColor",[function(){return{require:"ngModel",restrict:"AE",template:'<em value="1" style="background-color:#ff5448"></em><em value="2" style="background-color:#f2a653"></em><em value="3" style="background-color:#f9ce49"></em><em value=4"" style="background-color:#44cb83"></em><em value="5" style="background-color:#56c6ff"></em><em value="6" style="background-color:#08a1ef"></em><em value="7" style="background-color:#7171ef"></em><em value="8" style="background-color:#cc62c7"></em><em value="9" style="background-color:#7c4611"></em><em value="10" style="background-color:#000000"></em><em value="124" style="border:1px solid #ccd5db;color:#000000;"></em><em style="position:relative;"><em style="background-color:#ff5448;top:0;left:0;"></em><em style="background-color:#f2a653;top:0;left:9px;"></em><em style="background-color:#08a1ef;top:9px;left:0;"></em><em style="background-color:#44cb83;top:9px;left:9px;"></em></em>',link:function(e,t,n,i){function r(){o.unbind("click",r),e.$apply(function(){e.pageTpl.showColorPanel=!1})}for(var o=$(document),a=t.find("> em"),s=0;s<a.length;s++)e.pageTpl.color==$(a[s]).attr("value")&&$(a[s]).addClass("eqf-yes2");t.on("$destroy",function(){o.unbind("click",r),a.unbind("click")}),o.click(r),a.bind("click",function(){r(),i.$setViewValue($(this).attr("value")),"124"==$(this).attr("value")?$(".select-color .tpl-color").css("border","1px solid #ccd5db"):$(".select-color .tpl-color").css("border","none"),$(".select-color .tpl-color").css("background-color",$(this).css("background-color"))})}}}]).directive("loadErr",[function(){return{restrict:"A",link:function(e,t,n){t.bind("error",function(){n.$set("src","assets/images/create/pic.svg"),t.addClass("load-err")})}}}]).directive("closePanel",[function(){return{scope:{pause:"@",model:"@"},restrict:"A",templateUrl:"",link:function(e,t,n,i){function r(t){"false"==e.pause&&t.stopPropagation()}function o(t){e.$apply(function(){e.$eval("$parent."+e.model+"=false")})}var a=$(document);t.click(r),a.click(o),t.on("$destroy",function(){a.unbind("click",o),t.unbind("click")})}}}]),angular.module("scene.create.new",["services.scene","services.staticRes"]),angular.module("scene.create.new").controller("SceneNewCtrl",["$scope","$location","$translate","sceneService","items","ModalService","staticResService",function(e,t,n,i,r,o,a){if(e.scene={name:""},e.scene.types=a.getSceneType(),r){var s=!0;angular.forEach(e.scene.types,function(t,n){if(s){var i=""+r.type;t.value===i?(e.scene.type=t,s=!1):e.scene.type=e.scene.types[0]}})}else e.scene.type=e.scene.types[0];e.create=function(){if(r){var n={id:r.id,type:e.scene.type.value,pageMode:e.scene.pageMode.id,price:r.price};i.createByTpl(n).then(function(e){200==e.data.code?(t.path("scene/create/"+e.data.obj),t.search("pageId",1)):o.openMsgDialog({msg:e.data.msg})},function(e){})}else i.createBlankScene(null,e.scene.type.value,e.scene.pageMode.id).then(function(e){t.path("scene/create/"+e.data.obj),t.search("pageId",1)});e.$close()},e.cancel=function(){e.$dismiss()},e.pagemodes=[{id:2,name:"上下翻页"},{id:1,name:"左右翻页"}],e.scene.pageMode=e.pagemodes[0]}]),function(){angular.module("create.userGuide",[]).controller("CreateUserGuideCtrl",["$rootScope","$scope",function(e,t){if(window.localStorage){var n=JSON.parse(localStorage.getItem("createUserGuide"));n&&n[e.user.id]?t.firstLogin=!1:(t.firstLogin=!0,n=n||{},n[e.user.id]=1,localStorage.setItem("createUserGuide",JSON.stringify(n)))}t.myInterval=-1,t.userGuideSlides=[{image:CLIENT_CDN+"assets/images/scene/user-guide1.png"},{image:CLIENT_CDN+"assets/images/scene/user-guide2.png"},{image:CLIENT_CDN+"assets/images/scene/user-guide3.png"},{image:CLIENT_CDN+"assets/images/scene/user-guide4.png"},{image:CLIENT_CDN+"assets/images/scene/user-guide5.png"},{image:CLIENT_CDN+"assets/images/scene/user-guide6.png"}],t.close=function(){t.firstLogin=!1},t.currentIndex=0;var i=t.$watch("userGuideSlides",function(){angular.forEach(t.userGuideSlides,function(e,n){e.active&&(t.currentIndex=n)})},!0);t.$on("$destroy",i)}])}(),angular.module("scene.edit.bg",["services.scene","services.history"]),angular.module("scene.edit.bg").controller("editBgCtrl",["$scope","$rootScope","sceneService","historyService",function(e,t,n,i){e.cropBg=function(r){e.$broadcast("hide.editbg.panel");var o={type:3,properties:{src:r.properties.imgSrc}};n.openCropModal(o,function(n){t.$broadcast("scene.bg.replace",{type:"imgSrc",src:n.src},r),r.properties.imgSrc=n.src,i.addPageHistory(r.pageId,e.tpl.obj.elements)},function(){})},e.scaleUpBg=function(e){e||(e={}),e.effect={type:"scaleUp",duration:1,blurSize:5}},e.scaleDownBg=function(e){e||(e={}),e.effect={type:"scaleDown",duration:1,blurSize:5}},e.blurBg=function(e){e||(e={}),e.effect={type:"blur",duration:1,blurSize:5}},e.sharpBg=function(e){e||(e={}),e.effect={type:"sharp",duration:1,sharpSize:5}},e.removeBgEffect=function(t){e.currentBgDef.effect=null},e.$on("hideBgOption",function(){e.showBgOptionPanel=!1}),e.switchBgOption=function(t){e.showBgOptionPanel=t}}]),function(){function e(e,t,n,i,r,o,a,s,c){function l(e,n){function i(){u(h)}e.$on("element.delete",function(){h=o.getElements();for(var e=0,t=h.length;t>e;e++){var n=$("#nr").find("#inside_"+h[e]).attr("ctype");if("5"==n.charAt(0)||"a"==n||"r"==n||"c"==n)return void s.openConfirmDialog({msg:"将删除已收集的数据",confirmName:"确定",cancelName:"取消"},i)}u(h)}),e.$on("element.selectall",function(){p()}),e.$on("scene.bg.replace",function(n,i,r){var o=$("#nr .edit_area").parent();e.currentBgDef=r;var a=$(".wrapper-background").get(0);if(a||(a=document.createElement("div"),$(a).prependTo(o).addClass("wrapper-background").css({position:"absolute",width:"100%",height:"100%",backgroundSize:"cover",backgroundPosition:"50% 50%"}).attr("id",r.id)),"imgSrc"==i.type){var s=i.src;a.style.backgroundImage="url("+PREFIX_FILE_HOST+s+")",r.properties.bgColor=null,r.properties.imgSrc=s,r.properties.id=i.id,t.$broadcast("show.edit.bg",s)}else"backgroundColor"==i.type&&(a.style.backgroundImage="none",a.style.backgroundColor=i.color,r.properties.imgSrc=null,r.properties.bgColor=i.color,t.$broadcast("show.edit.bg"))}),e.$on("remove.scene.bg",function(t){$(".wrapper-background").css({backgroundColor:"transparent",backgroundImage:"none"}).removeAttr("id"),e.controlView.showBgTag=!1}),e.$on("delete.random.elem",function(e,t){"n"==g[t].type&&($("#nr").find("#inside_"+t).remove(),r.deleteElement(t))}),e.$on("convert.html.canvas",function(e,t,n){}),e.$on("select.less.id",function(t,n){g[n]&&d(e,g[n],$("#nr #"+n).get(0))}),e.$on("select.less",function(t,n){n&&n.length&&$.each(n,function(t,n){g[n]&&d(e,g[n],$("#nr #"+n).get(0))})})}function d(t,n,i){if("x"==n.type){var r=e.defer();t.completeHtml2Canvas=r.promise;var o=$(i).closest("li").clone();o.appendTo("#nr .edit_area").css({position:"absolute",zIndex:2,opacity:0,transform:""}),setTimeout(function(){var e=o.find(".element-box").get(0),i=o.width(),a=o.height();$(e).attr("style","").css({color:n.css.color,width:i+"px",height:a+"px"}),o.css({transform:""}),html2canvas(e,{width:i,height:a,onrendered:function(e){o.remove();var i=e.toDataURL();n.properties.dataUrl=i,r.resolve(),t.completeHtml2Canvas=null}})},0)}}function u(e){var n=r.getSceneObj(),i=r.getElementsMap();utilTrigger.getHandleType(),a.addPageHistory(n.obj.id,n.obj.elements),$.each(e,function(e,t){c.resetTrigger(parseInt(t,10)),$("#nr").find("#inside_"+t).remove(),r.deleteElement(t)}),$.each(i,function(e,t){c.clearTrigger(e);var n=c.getTrigger(e);n?t.trigger=n:delete t.trigger}),a.addPageHistory(n.obj.id,n.obj.elements),o.clearElements(),t.$broadcast("hideStylePanel"),$("#popMenu").hide()}function p(){o.clearElements();var e=$("#nr").find("ul").find("li");e.children(".bar").show(),e.each(function(e,t){o.addElement($(t).attr("id").split("_")[1])})}var h,g=r.getElementsMap();return{restrict:"EA",link:l}}angular.module("scene.edit.common",["services.scene","services.select","services.history"]).directive("editCommon",["$q","$rootScope","$location","$translate","sceneService","selectService","historyService","ModalService","triggerService",e])}(),function(){function e(e,t,n,i){function r(n,r,o,a){var s=$(document);n.$on("$destroy",function(){s.unbind("keydown")});var c,l={deltaX:0,deltaY:0};s.unbind("keydown").keydown(function(r){if(8==r.keyCode||46==r.keyCode){if($(".modal-dialog").length||$("#pageList").find("input").is(":focus"))return;i.getElements().length&&(r.preventDefault(),e.$broadcast("element.delete"))}if((37==r.keyCode||38==r.keyCode||39==r.keyCode||40==r.keyCode)&&(i.getElements().length&&r.preventDefault(),c||(c=!0,a.compDragStart(l)),37==r.keyCode&&(l.deltaX-=1,a.compDragMove(l)),38==r.keyCode&&(l.deltaY-=1,a.compDragMove(l)),39==r.keyCode&&(l.deltaX+=1,a.compDragMove(l)),40==r.keyCode&&(l.deltaY+=1,a.compDragMove(l))),(r.ctrlKey||r.metaKey)&&65==r.keyCode){if($(".modal-dialog").length)return;if(r.preventDefault(),c)return;c=!0,e.$broadcast("element.selectall")}if((r.ctrlKey||r.metaKey)&&90==r.keyCode&&t.historyBack(),(r.ctrlKey||r.metaKey)&&89==r.keyCode&&t.historyForward(),(r.ctrlKey||r.metaKey)&&67==r.keyCode){if($(".modal-dialog").length)return;t.copyElement()}if((r.ctrlKey||r.metaKey)&&86==r.keyCode){if($(".modal-dialog").length)return;t.getCopy()&&t.pasteElement()}n.$apply()}).unbind("keyup").keyup(function(e){c=!1,(l.deltaX||l.deltaY)&&a.compDragEnd(l),l.deltaX=0,l.deltaY=0,n.$apply()})}return{restrict:"A",link:r,require:"^multiCompDrag"}}angular.module("scene.edit.keymap",["services.scene","services.history","services.select"]).directive("editKeymap",["$rootScope","sceneService","historyService","selectService",e])}(),angular.module("scene.edit.select",["services.history","services.scene"]).controller("selectCtrl",["$scope",function(e){e.pasteOpacity=.3,e.$on("select.more",function(){e.safeApply(function(){e.showSelectPanel=!0})}),e.$on("select.less",function(){e.safeApply(function(){e.showSelectPanel=!1})}),e.$on("copyState.update",function(t,n){e.safeApply(function(){e.pasteOpacity=n?1:.3})})}]).directive("eqxAlignLeft",["selectService","sceneService","historyService","editAreaBorderCollisionDetector","multiCompResize",function(e,t,n,i,r){return{link:function(e,o){o.click(function(){e.$apply(function(){r.initCollisionDetectorWithElements();var e=i.bigDetectionBoxPointA.x;angular.forEach(i.editArea.detectionBoxs,function(n){var i=e-n.startPointA.x;i=i==Math.abs(i)?Math.floor(i):Math.ceil(i);var r={top:n.startPosition.top,left:n.startPosition.left+i};n.element.css("left",r.left),t.updateCompPosition(n.element.attr("id"),r,!0)});var o=t.getSceneObj();n.addPageHistory(o.obj.id,o.obj.elements)})})}}}]).directive("eqxAlignHorizontalCenter",["selectService","sceneService","historyService","editAreaBorderCollisionDetector","multiCompResize",function(e,t,n,i,r){return{link:function(e,o){o.click(function(){e.$apply(function(){r.initCollisionDetectorWithElements();var e=i.bigDetectionBoxPointO.x;angular.forEach(i.editArea.detectionBoxs,function(n){var i=e-n.startPointO.x;i=i==Math.abs(i)?Math.floor(i):Math.ceil(i);var r={top:n.startPosition.top,left:n.startPosition.left+i};n.element.css("left",r.left),t.updateCompPosition(n.element.attr("id"),r,!0)});var o=t.getSceneObj();n.addPageHistory(o.obj.id,o.obj.elements)})})}}}]).directive("eqxAlignRight",["selectService","sceneService","historyService","editAreaBorderCollisionDetector","multiCompResize",function(e,t,n,i,r){return{link:function(e,o){o.click(function(){e.$apply(function(){r.initCollisionDetectorWithElements();var e=i.bigDetectionBoxPointB.x;angular.forEach(i.editArea.detectionBoxs,function(n){var i=e-n.startPointB.x;i=i==Math.abs(i)?Math.floor(i):Math.ceil(i);var r={top:n.startPosition.top,left:n.startPosition.left+i};n.element.css("left",r.left),t.updateCompPosition(n.element.attr("id"),r,!0)});var o=t.getSceneObj();n.addPageHistory(o.obj.id,o.obj.elements)})})}}}]).directive("eqxAlignTop",["selectService","sceneService","historyService","editAreaBorderCollisionDetector","multiCompResize",function(e,t,n,i,r){return{link:function(e,o){o.click(function(){e.$apply(function(){r.initCollisionDetectorWithElements();var e=i.bigDetectionBoxPointA.y;angular.forEach(i.editArea.detectionBoxs,function(n){var i=e-n.startPointA.y;i=i==Math.abs(i)?Math.floor(i):Math.ceil(i);var r={top:n.startPosition.top+i,left:n.startPosition.left};n.element.css("top",r.top),t.updateCompPosition(n.element.attr("id"),r,!0)});var o=t.getSceneObj();n.addPageHistory(o.obj.id,o.obj.elements)})})}}}]).directive("eqxAlignVerticalCenter",["selectService","sceneService","historyService","editAreaBorderCollisionDetector","multiCompResize",function(e,t,n,i,r){return{link:function(e,o){o.click(function(){e.$apply(function(){r.initCollisionDetectorWithElements();var e=i.bigDetectionBoxPointO.y;angular.forEach(i.editArea.detectionBoxs,function(n){var i=e-n.startPointO.y;i=i==Math.abs(i)?Math.floor(i):Math.ceil(i);var r={top:n.startPosition.top+i,left:n.startPosition.left};n.element.css("top",r.top),t.updateCompPosition(n.element.attr("id"),r,!0)});var o=t.getSceneObj();n.addPageHistory(o.obj.id,o.obj.elements)})})}}}]).directive("eqxAlignBottom",["selectService","sceneService","historyService","editAreaBorderCollisionDetector","multiCompResize",function(e,t,n,i,r){return{link:function(e,o){o.click(function(){e.$apply(function(){r.initCollisionDetectorWithElements();var e=i.bigDetectionBoxPointB.y;angular.forEach(i.editArea.detectionBoxs,function(n){var i=e-n.startPointB.y;i=i==Math.abs(i)?Math.floor(i):Math.ceil(i);var r={top:n.startPosition.top+i,left:n.startPosition.left};n.element.css("top",r.top),t.updateCompPosition(n.element.attr("id"),r,!0)});var o=t.getSceneObj();n.addPageHistory(o.obj.id,o.obj.elements)})})}}}]).directive("eqxVerticalAverage",["selectService","sceneService","historyService","editAreaBorderCollisionDetector","multiCompResize",function(e,t,n,i,r){return function(o,a){a.click(function(){var a=e.getElements(),s=a.length;2>s||o.$apply(function(){r.initCollisionDetectorWithElements();var e=i.editArea.detectionBoxs;e.sort(function(e,t){return e.startPointO.y>t.startPointO.y});var o=e[0].startPointO.y,a=e[s-1].startPointO.y,c=(a-o)/(s-1);angular.forEach(e,function(e,n){if(0!==n&&n!=s){var i=o+n*c-e.startPointO.y;i=i==Math.abs(i)?Math.floor(i):Math.ceil(i);var r={top:e.startPosition.top+i,left:e.startPosition.left};e.element.css("top",r.top),t.updateCompPosition(e.element.attr("id"),r,!0)}});var l=t.getSceneObj();n.addPageHistory(l.obj.id,l.obj.elements)})})}}]).directive("eqxHorizontalAverage",["selectService","sceneService","historyService","editAreaBorderCollisionDetector","multiCompResize",function(e,t,n,i,r){return function(o,a){a.click(function(){var a=e.getElements(),s=a.length;2>s||o.$apply(function(){r.initCollisionDetectorWithElements();var e=i.editArea.detectionBoxs;e.sort(function(e,t){return e.startPointO.x>t.startPointO.x});var o=e[0].startPointO.x,a=e[s-1].startPointO.x,c=(a-o)/(s-1);angular.forEach(e,function(e,n){if(0!==n&&n!=s){var i=o+n*c-e.startPointO.x;i=i==Math.abs(i)?Math.floor(i):Math.ceil(i);var r={top:e.startPosition.top,left:e.startPosition.left+i};e.element.css("left",r.left),t.updateCompPosition(e.element.attr("id"),r,!0)}});var l=t.getSceneObj();n.addPageHistory(l.obj.id,l.obj.elements)})})}}]).directive("eqxCopy",["selectService","sceneService",function(e,t){return{link:function(e,n){var i=$(n);i.click(function(){t.copyElement()})}}}]).directive("eqxPaste",["sceneService","historyService",function(e,t){return{link:function(n,i){var r=$(i);r.click(function(){if(e.getCopy()){e.pasteElement();var i=e.getSceneObj();t.addPageHistory(i.obj.id,i.obj.elements),n.$apply()}})}}}]).directive("eqxDeleteMore",["$rootScope",function(e){return{link:function(t,n){var i=$(n);i.click(function(){e.$broadcast("element.delete")})}}}]),angular.module("scene.edit.trigger",[]).factory("triggerService",["$rootScope",function(e){function t(e,t,n,i,r){var a=o(e,t,n,r).ids,s=a.indexOf(i);s>=0||a.push(i)}function n(e,t,n,i,r){var a=p[n];if(a&&a.sends.length){var s=o(e,t,n,r).ids,c=s.indexOf(i);0>c||s.splice(c,1)}}function i(t,n,i,r){var o=c(t,i,r).ids,a=o.indexOf(n);a>=0||(o.push(n),e.$broadcast("receive.element.update",t,n,i,r))}function r(t,n,i,r){var o=c(t,i,r).ids,a=o.indexOf(n);0>a||(o.splice(a,1),e.$broadcast("receive.element.update",t,n,i,r))}function o(e,t,n,i){var r=a(e,n,i).handles,o=l(r,t);if(o)return o;var s={type:t,ids:[]};return r.push(s),s}function a(e,t,n){var i=s(t),r=i.sends,o=d(r,n);if(o)return o;var a={sendIndex:n,delay:0,type:e,handles:[]};return r.push(a),a}function s(e){return p[e]||(p[e]={sends:[],receives:[]}),p[e]}function c(e,t,n){var i=s(t),r=i.receives,o=l(r,e);if(o)return o;var a={type:e,ids:[]};return r.push(a),a}function l(e,t){for(var n=0;n<e.length;n++)if(t==e[n].type)return e[n];return null}function d(e,t){for(var n=0;n<e.length;n++)if(t==e[n].sendIndex)return e[n];return null}var u={},p={};return u.getTrigger=function(e){return p[e]},u.getReceiveIds=function(e,t,n){if("number"!=typeof e||"number"!=typeof t||"number"!=typeof n)return[];var i=o(e,t,n).ids;return angular.copy(i)},u.getSendIds=function(e,t){if("number"!=typeof e||"number"!=typeof t)return[];var n=c(e,t).ids;return angular.copy(n)},u.setTrigger=function(e,t){"number"==typeof e&&"object"==typeof t&&(p[e]=t)},u.addTrigger=function(e,n,r,o,s){"number"==typeof e&&"number"==typeof n&&"number"==typeof r&&"number"==typeof o&&(p[r]&&p[r].sends[s]||a(e,r,s),t(e,n,r,o,p[r].sends[s].sendIndex),i(n,r,o,s))},u.deleteTrigger=function(e,t,i,o,a){"number"==typeof e&&"number"==typeof t&&"number"==typeof i&&"number"==typeof o&&p[i]&&p[i].sends[a]&&(n(e,t,i,o,p[i].sends[a].sendIndex),r(t,i,o,a))},u.clearTrigger=function(e){var t=p[e];if(t){for(var n=!1,i=!1,r=0;r<t.sends.length;r++){if("number"==typeof t.sends[r].sendIndex)for(var o=0;o<t.sends[r].handles.length;o++)if(t.sends[r].handles[o].ids.length){n=!0;break}if(n)break}for(var a=0;a<t.receives.length;a++)if(t.receives[a].ids.length){i=!0;break}n||i||delete p[e]}},u.resetTrigger=function(e){if("number"==typeof e){var t=utilTrigger.getSendType(),n=utilTrigger.getHandleType();for(var i in t)for(var r in n){var o=t[i].value,a=n[r].value,s=c(a,e).ids;s.length&&$.each(s,function(t,n){for(var i=u.getTrigger(n).sends,r=0;r<i.length;r++)"undefined"==typeof i[r].sendIndex&&i[r].hasOwnProperty("sendIndex")&&(i.splice(r,1),r--);var s=n;$.each(i,function(t,n){var i=t;$.each(n.handles,function(t,n){if(n.value,n.ids.length){var c=n.ids;for(r=0;r<c.length;r++)c[r]==e&&u.deleteTrigger(o,a,s,e,i)}})})});var l=u.getTrigger(e);if(l&&l.sends.length)for(var d=0;d<l.sends.length;d++)"undefined"==typeof l.sends[d].sendIndex&&triggerSends[d].hasOwnProperty("sendIndex")?(l.sends.splice(d,1),d--):u.deleteTriggerBySendIndex(d,e)}}},u.deleteTriggerBySendIndex=function(t,n){var i=p[n];if(i&&i.sends.length){for(var r=0;r<i.sends.length;r++)"undefined"==typeof i.sends[r].sendIndex&&triggerSends[r].hasOwnProperty("sendIndex")&&(i.sends.splice(r,1),r--);var o=i.sends[t].type;$.each(i.sends[t].handles,function(i,r){var a=r.type;if(r.ids.length)for(var s=0;s<r.ids.length;s++)e.$broadcast("delete.random.elem",r.ids[s]),u.deleteTrigger(o,a,n,r.ids[s],t),s--}),i.sends.splice(t,1)}},u.getSend=a,u}]),angular.module("scene.create.pageTpl",[]),angular.module("scene.create.pageTpl").controller("PageTplController",["$scope","pageTplService",function(e,t){e.$watch("tpl",function(t){if(e.tplElements=[],t&&t.obj&&t.obj.elements){var n=angular.copy(t.obj.elements);$.each(n,function(t,n){"4"==n.type&&(n.isEditable||(n.isEditable=1),e.tplElements.push(n))})}},!0),e.pageChildLabel=function(){var n,i=[];for(n=0;n<e.pageLabelAll.length;n++)e.pageLabelAll[n].ischecked&&i.push(e.pageLabelAll[n].id);e.tpl.obj.elements&&$.each(e.tplElements,function(t,n){$.each(e.tpl.obj.elements,function(e,t){n.id==t.id&&(-1==n.isEditable?t.isEditable=-1:delete t.isEditable)})}),t.updataChildLabel(i,e.pageIdTag).then(function(){alert("分配成功！"),e.controlView.pageList=!1},function(){})}}]),angular.module("scene.pageeffect.fall",[]),angular.module("scene.pageeffect.fall").controller("fallEffectCtrl",["$scope","$translate",function(e,t){var n=e.properties;e.fallings=[{name:"福字",path:CLIENT_CDN+"assets/images/create/fallings/fuzi1.png",rotate:180,vy:3},{name:"红包",path:CLIENT_CDN+"assets/images/create/fallings/hongbao2.png",rotate:180,vy:3},{name:"绿枫叶",path:CLIENT_CDN+"assets/images/create/fallings/lvfengye.png",rotate:180,vy:3},{name:"星星",path:CLIENT_CDN+"assets/images/create/fallings/xing.png",rotate:180,vy:3},{name:"雪花",path:CLIENT_CDN+"assets/images/create/fallings/snow.png",rotate:0,vy:1}],n&&n.fallingObject?(e.controlView.effectType="fallingObject",e.falling=n.fallingObject,angular.forEach(e.fallings,function(t,n){t.path==e.falling.src.path&&(e.falling.src=t)})):e.falling={src:e.fallings[0],density:2},e.$on("save.falling.effect",function(){n={},n.fallingObject=e.falling,e.$close({properties:n,name:"落物",value:"fallingObject"})})}]),angular.module("scene.pageeffect.finger",[]),angular.module("scene.pageeffect.finger").controller("fingerEffectCtrl",["$scope","$translate",function(e,t){var n,i=e.properties;e.fingerZws=[{name:"粉色指纹",path:CLIENT_CDN+"assets/images/create/fingers/zhiwen1.png"},{name:"白色指纹",path:CLIENT_CDN+"assets/images/create/fingers/zhiwen2.png"},{name:"蓝色指纹",path:CLIENT_CDN+"assets/images/create/fingers/zhiwen3.png"}],e.fingerBackgrounds=[{name:"粉红回忆",path:CLIENT_CDN+"assets/images/create/fingers/bg1.jpg"},{name:"深蓝花纹",path:CLIENT_CDN+"assets/images/create/fingers/bg2.jpg"},{name:"淡绿清新",path:CLIENT_CDN+"assets/images/create/fingers/bg3.jpg"},{name:"深紫典雅",path:CLIENT_CDN+"assets/images/create/fingers/bg4.jpg"},{name:"淡紫水滴",path:CLIENT_CDN+"assets/images/create/fingers/bg5.jpg"},{name:"蓝白晶格",path:CLIENT_CDN+"assets/images/create/fingers/bg6.jpg"},{name:"蓝色水滴",path:CLIENT_CDN+"assets/images/create/fingers/bg7.jpg"},{name:"朦胧绿光",path:CLIENT_CDN+"assets/images/create/fingers/bg8.jpg"},{name:"灰色金属",path:CLIENT_CDN+"assets/images/create/fingers/bg9.jpg"}],i&&i.finger?(e.controlView.effectType="finger",e.finger=i.finger,angular.forEach(e.fingerZws,function(t,n){t.path==e.finger.zwImage.path&&(e.finger.zwImage=t)}),angular.forEach(e.fingerBackgrounds,function(t,n){t.path==e.finger.bgImage.path&&(e.finger.bgImage=t)})):e.finger={zwImage:e.fingerZws[0],bgImage:e.fingerBackgrounds[0]},n=angular.copy(e.finger.bgImage),e.replaceImg=function(t){return t.bgImage?void(n=angular.copy(e.finger.bgImage)):void e.$emit("select.effect.image","finger")},e.$on("replace.effect.image",function(t,i,r){"finger"==r&&(e.finger.bgImage||(e.finger.bgImage={}),e.finger.bgImage.path=PREFIX_FILE_HOST+i.data,e.fingerBackgrounds[0].name||e.fingerBackgrounds.shift(),e.fingerBackgrounds.unshift(e.finger.bgImage),n=angular.copy(e.finger.bgImage))}),e.$on("cancel.effect.replace",function(t,i){"finger"==i&&angular.forEach(e.fingerBackgrounds,function(t,i){n.name?n.name==t.name&&(e.finger.bgImage=t):t.name||(e.finger.bgImage=t)})}),e.$on("save.finger.effect",function(){i={},i.finger=e.finger,e.$close({properties:i,name:"指纹",value:"finger"})})}]).directive("fingerMove",function(){function e(e,t,n){t.css({animation:"move 2s ease 0","animation-iteration-count":"infinite"})}return{restrict:"EA",link:e}}),angular.module("scene.pageeffect.fireworks",[]),angular.module("scene.pageeffect.fireworks").controller("fireWorksCtrl",["$scope","$translate",function(e,t){var n=e.properties;n&&n.effect&&"fireWorks"==n.effect.name&&(e.controlView.effectType="fireWorks",e.controlView.effectIndex=5),e.$on("save.fireworks.effect",function(){n={},n.effect={name:"fireWorks"},e.$close({properties:n,name:"烟花",value:"effect"})})}]),angular.module("common.directives.inputNumber",[]).directive("eqdInputNumber",function(){function e(e,l,d,u){l.on("$destroy",function(){l.unbind("mousedown")});var p="string"==typeof d.min?d.min:-Number.MAX_VALUE,h="string"==typeof d.max?d.max:Number.MAX_VALUE,g="string"==typeof d.unit?d.unit:"px",f="string"==typeof d.step?d.step:"1",m=0;f.indexOf(".")>-1&&(m=f.split(".")[1].length),"px"==g?(u.$parsers.push(t),u.$formatters.push(n)):"deg"==g?(g="",u.$parsers.push(i),u.$formatters.push(r)):"%"==g?(u.$parsers.push(o),u.$formatters.push(a)):u.$parsers.push(s),l.mousedown(function(t){var n,i=parseFloat(l.val())||0,r=t.pageX;c.mousemove(function(t){t.preventDefault(),n=t.pageX-r;var o=+(i+n*f).toFixed(m);o>=p&&h>=o?o+=g:p>o?o=p+g:o>h&&(o=h+g),u.$viewValue!=o&&(u.$setViewValue(o),u.$render(),e.$apply())}),c.mouseup(function(){c.unbind("mousemove mouseup")})}).keydown(function(e){var t=e.keyCode;return!!(t>=48&&57>=t||t>=96&&105>=t||36==t||35==t||37==t||39==t||8==t||46==t)})}function t(e){return e=/-?\d+/.exec(e),e?parseFloat(e)+"px":"0"}function n(e){return/-?\d+/.exec(e)+"px"}function i(e){return e=/\d+/.exec(e),e?"rotateZ("+parseFloat(e)+"deg)":"rotateZ(0)"}function r(e){return/\d+/.exec(e)}function o(e){return e=/\d+/.exec(e),e?e/100+"":"0"}function a(e){return 100*e+"%"}function s(e){return""===e&&(e="0"),parseFloat(e)+""}var c=$(document);return{restrict:"E",require:"ngModel",template:'<input class="eqc-input-number"/>',replace:!0,link:e}}),angular.module("scene.pageeffect.money",[]),angular.module("scene.pageeffect.money").controller("moneyEffectCtrl",["$scope","$translate",function(e,t){var n=e.properties;n&&n.effect&&"money"==n.effect.name?(e.controlView.effectType="money",e.money={tip:n.effect.tip}):e.money={tip:"握紧钱币，数到手抽筋吧"},e.$on("save.money.effect",function(){n={},n.effect={name:"money",tip:e.money.tip},e.$close({properties:n,name:"数钱",value:"effect"})})}]),angular.module("scene.pageeffect.none",[]),angular.module("scene.pageeffect.none").controller("noneEffectCtrl",["$scope","$translate",function(e,t){var n=e.properties;n&&n.effect&&"none"==n.effect.name&&(e.controlView.effectType="none"),e.$on("save.none.effect",function(){n={},n.effect={name:"none"},e.$close({name:"无"})})}]),angular.module("scene.pageeffect.console",["scene.pageeffect.scratch","scene.pageeffect.finger","scene.pageeffect.money","scene.pageeffect.fall","scene.pageeffect.snow","scene.pageeffect.fireworks","scene.pageeffect.none"]),angular.module("scene.pageeffect.console").controller("pageEffectCtrl",["$scope","$rootScope","$modal","$translate","properties","sceneService",function(e,t,n,i,r,o){e.properties=r,e.controlView={},e.effectList=[{type:"scratch",name:"涂抹",src:CLIENT_CDN+"assets/images/create/waterdrop.jpg"},{type:"finger",name:"指纹",src:CLIENT_CDN+"assets/images/create/fingers/zhiwen1.png"},{type:"money",name:"数钱",src:CLIENT_CDN+"assets/images/create/money_thumb1.jpg"},{type:"fallingObject",name:"环境",src:CLIENT_CDN+"assets/images/create/falling.png"},{type:"snowFly",name:"飘雪",src:CLIENT_CDN+"assets/images/create/snowfly.png"},{type:"fireWorks",name:"烟花",src:CLIENT_CDN+"assets/images/create/fireworks.jpg"},{type:"none",name:"无",src:""}],r&&(!r||r.scratch||r.finger||r.fallingObject||r.effect)||(r={},e.controlView.effectType="scratch",e.controlView.effectIndex=0),e.selectEffect=function(t,n){e.controlView.effectType=t.type,e.controlView.effectIndex=n},e.confirm=function(){"scratch"==e.controlView.effectType?e.$broadcast("save.scratch.effect"):"finger"==e.controlView.effectType?e.$broadcast("save.finger.effect"):"money"==e.controlView.effectType?e.$broadcast("save.money.effect"):"fallingObject"==e.controlView.effectType?e.$broadcast("save.falling.effect"):"snowFly"==e.controlView.effectType?e.$broadcast("save.snow.effect"):"fireWorks"==e.controlView.effectType?e.$broadcast("save.fireworks.effect"):"none"==e.controlView.effectType&&e.$broadcast("save.none.effect")},e.$on("select.effect.image",function(e,i){n.open({windowClass:"console img_console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:0}}}}).result.then(function(e){var n={type:3,properties:{src:e.data}};e.height/e.width>=1008/642&&e.height/e.width<=1.578125?t.$broadcast("replace.effect.image",e,i):o.openCropModal(n,function(e){var n={data:e.src};t.$broadcast("replace.effect.image",n,i)},function(){t.$broadcast("cancel.effect.replace",i)})},function(e){t.$broadcast("cancel.effect.replace",i)})}),e.cancel=function(){t.$broadcast("clear.scratch.interval"),e.$dismiss()}}]),angular.module("scene.pageeffect.scratch",["common.directives.inputNumber"]),angular.module("scene.pageeffect.scratch").controller("scratchEffectCtrl",["$scope","$rootScope","$translate","i18nNotifications",function(e,t,n,i){var r,o=e.properties;e.scratches=[{name:"水滴",path:CLIENT_CDN+"assets/images/create/waterdrop.jpg"},{name:"细沙",path:CLIENT_CDN+"assets/images/create/sand.jpg"},{name:"花瓣",path:CLIENT_CDN+"assets/images/create/flowers.jpg"},{name:"金沙",path:CLIENT_CDN+"assets/images/create/goldsand.jpg"},{name:"白雪",path:CLIENT_CDN+"assets/images/create/snowground.jpg"},{name:"模糊",path:CLIENT_CDN+"assets/images/create/mohu.jpg"},{name:"落叶",path:CLIENT_CDN+"assets/images/create/leaves.jpg"},{name:"薄雾",path:CLIENT_CDN+"assets/images/create/smoke.png"
}],o&&(o.image||o.scratch)?(e.controlView.effectType="scratch",(o.image||o.scratch)&&(o.scratch?(e.scratch=o.scratch,o.scratch.percentage.value&&(e.scratch.percentage=o.scratch.percentage.value),o.scratch.opacity||(e.scratch.opacity=.2)):o.image&&(e.scratch={image:o.image,percentage:o.percentage.value},o.tip&&(e.scratch.tip=o.tip),e.scratch.opacity=.2),angular.forEach(e.scratches,function(t,n){e.scratch.image.name==t.name&&(e.scratch.image=t)}),e.scratch.image.name||e.scratches.unshift(e.scratch.image))):e.scratch={image:e.scratches[0],percentage:.15,opacity:.2};var a=e.$watch("scratch.opacity",function(n,i){t.$broadcast("show.scratch.draw",e.scratch)},!0);setTimeout(function(){r=angular.copy(e.scratch.image),t.$broadcast("show.scratch.draw",e.scratch,!1)},0),e.$on("$destroy",function(){a()}),e.replaceImage=function(n){return n.image?(r=angular.copy(e.scratch.image),void t.$broadcast("show.scratch.draw",n,!1)):void e.$emit("select.effect.image","scratch")},e.$on("replace.effect.image",function(n,i,o){"scratch"==o&&(e.scratch.image||(e.scratch.image={}),e.scratch.image.path=PREFIX_FILE_HOST+i.data,e.scratches[0].name||e.scratches.shift(),e.scratches.unshift(e.scratch.image),r=angular.copy(e.scratch.image),t.$broadcast("show.scratch.draw",e.scratch,!1))}),e.$on("cancel.effect.replace",function(t,n){"scratch"==n&&angular.forEach(e.scratches,function(t,n){r.name?r.name==t.name&&(e.scratch.image=t):t.name||(e.scratch.image=t)})}),e.$on("save.scratch.effect",function(){return o={},o.scratch=e.scratch,o.scratch.percentage>1?void i.pushForCurrentRoute("scratch.percentage.overflow","notify.success"):(t.$broadcast("clear.scratch.interval"),void e.$close({properties:o,name:"涂抹",value:"scratch"}))})}]).directive("scratchEffect",function(){function e(e,i,r){var o=new Image;e.$on("show.scratch.draw",function(e,n,i){o.onload=function(){t(this,n)},o.src=n.image.path}),e.$on("change.scratch.opacity",function(e,t){$(".scratch-img").css({opacity:1-parseFloat(t).toFixed(2)})}),e.$on("clear.scratch.interval",function(e){clearInterval(n)})}function t(e,o){n&&clearInterval(n);var a='<canvas class="scratchCanvas" style="position:absolute; top: 0; left: 0;" width="196" height="308"></canvas>',s=$(".scratch-img");s.empty(),s.append(a),i=s.find("canvas").get(0),r=i.getContext("2d"),r.lineCap="round",r.lineJoin="round",r.lineWidth=20,r.globalAlpha=1-parseFloat(o.opacity).toFixed(2),r.drawImage(e,0,0,i.width,i.height),r.globalCompositeOperation="destination-out";var c=130,l=80;n=setInterval(function(){r.moveTo(c,l),c>=70&&140>=l?(r.lineTo(c-2,l+2),r.stroke(),c-=2,l+=2):120>=c&&165>=l?(r.lineTo(c+2,l+1),r.stroke(),c+=2,l+=1):c>=70&&215>=l?(r.lineTo(c-2,l+2),r.stroke(),c-=2,l+=2):(clearInterval(n),t(e,o))},50)}var n,i,r;return{restrict:"EA",link:e}}),angular.module("scene.pageeffect.snow",[]),angular.module("scene.pageeffect.snow").controller("snowEffectCtrl",["$scope","$translate",function(e,t){var n=e.properties;n&&n.effect&&"snowFly"==n.effect.name&&(e.controlView.effectType="snowFly"),e.$on("save.snow.effect",function(){n={},n.effect={name:"snowFly"},e.$close({properties:n,name:"飘雪",value:"effect"})})}]),angular.module("save.template",[]),angular.module("save.template").controller("saveTemplateCtrl",["$scope","$rootScope","security",function(e,t,n){e.btnGroup={selectItem:1,caretSwitch:!1};var i;window.localStorage&&(i=JSON.parse(localStorage.getItem("templateInfo")),i&&i[n.currentUser.id]?e.btnGroup.selectItem=i[n.currentUser.id]:(i=i||{},i[n.currentUser.id]=1,localStorage.setItem("templateInfo",JSON.stringify(i)))),e.btnGroup={selectItem:i[n.currentUser.id],caretSwitch:!1},e.selectedTemplate=function(t){"myTemplate"==t?e.btnGroup.selectItem=2:"companyTemplate"==t&&(e.btnGroup.selectItem=1),window.localStorage&&(i[n.currentUser.id]=e.btnGroup.selectItem,localStorage.setItem("templateInfo",JSON.stringify(i)))},e.openMenu=function(){e.btnGroup.caretSwitch=!e.btnGroup.caretSwitch}}]),angular.module("scene",["scene.create","scene.support","services.scene","services.staticRes","scene.create.new","app.directives.addelement","create.userGuide"]),angular.module("scene").controller("SceneCtrl",["$window","$scope","$rootScope","$location","$translate","sceneService","$modal","ModalService","usercenterService","staticResService",function(e,t,n,i,r,o,a,s,c,l){t.PREFIX_FILE_HOST=PREFIX_FILE_HOST,t.PREFIX_CLIENT_HOST=PREFIX_HOST,t.isActive="scene",t.scene={type:null},t.totalItems=0,t.currentPage=1,t.toPage="",t.tabindex=0,t.childcat=0,t.order="new",t.pageSizeList=11;var d=0;t.pageNoNum=1,t.blankSample=!0,t.pageTplTypesList=[{type:"101",name:"行业"},{type:"102",name:"个人"},{type:"103",name:"企业"},{type:"104",name:"节假"},{},{}],t.getCompanyTpl=function(e,n){t.childcat=1;var i=11;t.childCatrgoryList=[],o.getCompanyTpls(t.pageNoNum,i).then(function(e){e.data.list&&e.data.list.length>0?(t.tpls=e.data.list,t.totalItems=e.data.map.count+1,t.currentPage=e.data.map.pageNo,t.allPageCount=e.data.map.count,t.toPage=""):t.tpls=[]})},t.pageChanged=function(e){return u.targetPage=e,t.pageNoNum=e,t.toPage=e,t.pageNoNum>1?(t.blankSample=!1,t.pageSizeList=12):(t.blankSample=!0,t.pageSizeList=11),1>e||e>t.totalItems/11+1?void alert("此页超出范围"):void(1==t.childcat?t.getCompanyTpl(e,t.pageSizeList):t.getPageTpls(1,u.sceneType,u.tagId,e,t.pageSizeList,u.order))},t.preview=function(e){var t=PREFIX_HOST+"/view.html?sceneId="+e;window.open(t,"_blank")},t.getStyle=function(e){return{"background-image":"url("+PREFIX_FILE_HOST+e+")","background-size":"cover"}},t.userXd=0,c.getUserXd().then(function(e){t.userXd=e.data.obj||0}),t.previewScene=function(e){n.tplObj=e,i.path("/v-"+e.code)},t.createScene=function(e){if(e&&e.price){var n=parseFloat(e.price)||0;n&&n>t.userXd?s.openMsgDialog({msg:'当前选择需要消耗微币<font color="#ff6e6e">'+n+'</font>个<br/>微币余额不足(<font color="#ff6e6e">'+(t.userXd||0)+'</font>个)<span class="get-xd"><a href="http://bbs.e.wesambo.com/forum.php?mod=viewthread&tid=297&extra=page%3D1" target = "_blank">获取微币</a></span>'}):s.openConfirmDialog({msg:'当前选择需要消耗微币<font color="#ff6e6e">'+n+'</font>个<br/>微币余额为<font color="#ff6e6e">'+(t.userXd||0)+"</font>个"},function(){a.open({windowClass:"login-container six-contain",templateUrl:"scene/createNew.tpl.html",controller:"SceneNewCtrl",resolve:{items:function(){return e}}})})}else a.open({windowClass:"login-container six-contain",templateUrl:"scene/createNew.tpl.html",controller:"SceneNewCtrl",resolve:{items:function(){return e}}})},n.tplId&&c.getUserXd().then(function(e){t.userXd=e.data.obj||0}).then(function(){t.createScene(n.tplId)}).then(function(){n.tplId=null}),t.getStyle=function(e){return{"background-image":"url("+PREFIX_FILE_HOST+e+")"}},t.show=function(e){console.log(e.target),$(e.target).children(".cc").css("display","block")},t.pageTplTypes=l.getSceneType(),t.filterTpl=function(e,n){t.selete=!0,e?u.order=1:u.order=2,t.getPageTpls(null,u.sceneType,u.tagId,d,t.pageSizeList,u.order)};var u={sceneType:null,tagId:"",order:"",pageNo:"0",targetPage:""},p={},h=[];t.getPageTplsByType=function(e){u.sceneType=e,t.childcat=e,t.categoryId=0,p[e]?(h=p[e],h.length&&(g(),t.getPageTpls(1,u.sceneType,h[0].id,d,11,u.order))):o.getPageTplTypesTwo(e,e).then(function(n){h=p[e]=n.data.list,h.length&&(g(),t.getPageTpls(1,u.sceneType,h[0].id,d,11,u.order))})};var g=function(){var e,n=null,i=[];for(var r in h)h[r].groupId!==n&&(e=[],n=h[r].groupId,i.push(e)),e.push(h[r]);i.splice(4,1),i.length?t.newArrayGroupCat=i:t.newArrayGroupCat=[]};t.allpage=function(e){u.sceneType=e,t.childcat=0,t.getPageTpls(1,null,null,1,12,u.order),t.newArrayGroupCat=[],t.blankSample=!0},t.freeTplChoice="",t.freeTpl=function(e){t.freeTplChoice=e,t.tplnew(t.order)},t.getPageTpls=function(e,n,i,r,a,s){t.categoryId=i,u.tagId=i;var c=t.freeTplChoice?t.freeTplChoice+"=1":"";o.getPageTpls(e,n,i,r,a,s,c)},t.getPageTpls(1,null,null,1,12),t.$on("getSampleList",function(e){var n=o.scenes;if(n.list&&n.list.length>0){t.tpls=n.list,t.totalItems=n.map.count,t.currentPage=n.map.pageNo,t.allPageCount=n.map.count,t.toPage=n.map.pageNo;for(var i=0;i<t.tpls.length;i++)t.tpls[i].avatar&&(0===t.tpls[i].avatar.indexOf("http://")?t.tpls[i].avatar=t.tpls[i].avatar:t.tpls[i].avatar=PREFIX_FILE_HOST+t.tpls[i].avatar)}else t.tpls=[],t.totalItems=0,t.blankSample=!1}),t.name=null,t.EnterPress=function(e,n){var i=e||window.event;13==i.keyCode&&t.submit(n)},t.searchButton=!0;var f={};t.submit=function(e){t.name=e,o.getPageTpls(1,null,null,d,t.pageSizeList,u.orderby,null,e),t.searchButton=!1,f.refresh=!0},t.changeName=function(e){t.searchButton=!0,""===e&&f.refresh&&o.getPageTpls(1,null,null,d,t.pageSizeList,u.orderby,null,e)},t.clearSearch=function(){t.searchButton=!0,t.name="",o.getPageTpls(1,null,null,d,t.pageSizeList,u.orderby,null)},t.userScene=function(e){o.getPageTpls(1,null,null,d,t.pageSizeList,u.orderby,null,null,e)}}]),angular.module("scene.preview",["services.scene"]),angular.module("scene.preview").directive("sceneView",["sceneService","sceneViewService","sceneDataParseService",function(e,t,n){return{scope:{sceneId:"@",sceneName:"@",sceneCover:"@",sceneDescription:"@"},restrict:"A",templateUrl:"scene/preview.tpl.html",link:function(e,i,r,o){function a(i,o){t.getSceneData(r.sceneId).then(function(r){r.data.success&&(i&&(i=parseInt(i,10)-1,r.data.list[i].elements=o.obj.elements,r.data.list[i].properties=o.obj.properties),e.$parent.scene.property.activityPageId?t.getActivityPage(e.$parent.scene.property.activityPageId).then(function(e){r.data.list.push(e.data.obj),n.parse(r.data)}):n.parse(r.data))})}function s(){d(),i.find(".password-numbers>span").click(l),i.find(".password-operation>span").click(d),i.find(".verifyCode").show()}function c(){i.find(".password-numbers>span").unbind("click"),i.find(".password-operation>span").unbind("click"),i.find(".verifyCode").hide()}function l(t){d($(t.target).text()),4==u.pass.length&&(e.$parent.scene.accessCode==u.pass?c():d())}function d(e){e&&"object"!=typeof e?u.pass+=e:u.pass="",i.find(".password-indicator li").each(function(e,t){e<u.pass.length?$(t).addClass("active"):$(t).removeClass("active")})}var u={play:!1};e.sceneId&&(e.$parent.mginData==angular.toJson(e.$parent.tpl)?a():a(e.$parent.pageNum,$.extend(!0,{},e.$parent.tpl))),e.$watch("sceneId",function(e,t){e!=t&&a()}),i.on("$destroy",function(){utilSound.pause()}),e.$on("changeView",function(e,t){t?i.find(".wechat-share").show():i.find(".wechat-share").hide(),i.find(".loading").hide(),c()}),e.$on("showLoading",function(e,t,n){t?(n?i.find(".loadbg").css({background:"url("+PREFIX_FILE_HOST+n+")","background-size":"70px 42px"}):i.find(".loadbg").css("background",""),i.find(".loading").show(),i.find(".wechat-share").hide()):i.find(".loading").hide(),c()}),e.$on("processBar",function(e,t){t?i.find(".progress").show():i.find(".progress").hide()}),e.$on("passPanelSwitch",function(e,t){t?s():c()}),i.on("$destroy",function(){clearInterval(eqShow.progressInterval),n.app.pauseAutoFlip()})}}}]).factory("sceneViewService",["$http",function(e){var t={};return t.getSceneData=function(t){var n="index.php?c=scene&a=view&id="+t+"&time="+(new Date).getTime();return e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},t.getSelfLastPage=function(t){var n="index.php?c=scene&a=getlastpagebg&id="+t;return e({withCredentials:!0,method:"GET",url:PREFIX_S1_URL+n})},t.getActivityPage=function(t){var n="eqs/trailer/"+t;return e({withCredentials:!0,method:"GET",url:PREFIX_S2_URL+n})},t}]).factory("sceneDataParseService",["sceneViewService","sceneService",function(e,t){function n(t,n){t.obj.property.lastPageId?e.getSelfLastPage(t.obj.property.lastPageId).then(function(e){e.data.obj?(r(t.obj,e.data),t.list.push(e.data.obj),g.lastPage=n[n.length-1],c(n,t)):(i(t.obj),g.lastPage=n[n.length-1],c(n,t))}):(i(t.obj,n),g.lastPage=n[n.length-1],c(n,t))}function i(e,t){var n="http://e.wesambo.com",i='{"id":439882,"pageId":129810,"sceneId":16060,"num":1,"type":"4","isInput":0,"title":null,"content":null,"status":1,"css":{"borderRadius":"10px","borderStyle":"solid","zIndex":"9","borderColor":"rgba(0,0,0,1)","paddingTop":"0px","height":"141","backgroundColor":"","color":"","boxShadow":"0px 0px 0px #333333","borderWidth":"0px","width":"142.13709677419354","left":"92px","paddingBottom":"0px","top":"177px"},"properties":{"height":"100px","imgStyle":{"width":142,"height":142,"marginTop":"-0.5px","marginLeft":"0px"},"width":"100px","src":"group1/M00/BA/DA/yq0KA1Rq8COAAYRjAAKU4OVYum0889.jpg"}}',r='{"id":"","sceneId":"","num":2,"name":null,"properties":null,"elements":[{"id":439880,"pageId":129810,"sceneId":16060,"num":0,"type":"3","isInput":0,"title":null,"content":null,"status":1,"css":{},"properties":{"bgColor":"#E6E9EE"}},{"id":439881,"pageId":129810,"sceneId":16060,"num":1,"type":"2","isInput":0,"title":null,"content":"<div style=\\"text-align: center;\\"><span style=\\"line-height: 1; background-color: initial;\\"><font size=\\"4\\" color=\\"#888888\\"><b>微课名称</b></font></span></div>","status":1,"css":{"height":"65","zIndex":"10","width":"320","left":"0px","top":"77px"},"properties":{}},{"id":439882,"pageId":129810,"sceneId":16060,"num":1,"type":"2","isInput":0,"title":null,"content":"<div class=\\"bottom-logo\\" style=\\"text-align: center;cursor:pointer;height:142px;width:142px;border-radius:10px;\\"><em style=\\"color:white;line-height:142px;font-size:30px;\\" class=\\"eqf-love\\"></em></div>","status":1,"css":{"height":"157","width":"172","left":"77px","top":"170px"},"properties":{}},{"id":439883,"pageId":129810,"sceneId":16060,"num":1,"type":"2","isInput":0,"title":null,"content":"<div style=\\"width:280px;height:1px;background-color:rgba(60,60,60,0.4);cursor:pointer;position:absolute;left:0;-webkit-filter:drop-shadow(0px 1px 0px rgba(60,60,60,0.4));top:12px;\\"></div>","status":1,"css":{"height":"24","width":"280","left":"21px","top":"122px"},"properties":{}},{"id":439885,"pageId":129810,"sceneId":16060,"num":1,"type":"2","isInput":0,"title":null,"content":"<div style=\\"text-align: center;padding-top: 0;\\" id=\\"scenead\\"><span style=\\"font-size: small; line-height: 1; background-color: initial;\\"><a href=\\"'+PREFIX_S1_URL+"index.php?c=scene&a=link&id=16060&amp;url="+encodeURIComponent(n)+'\\" target=\\"_blank\\"><font color=\\"#888888\\">免费创建一个微课？→</font><font color=\\"#23a3d3\\">'+lastpagetext+'</font></a></span></div>","status":1,"css":{"borderRadius":"0px","borderStyle":"solid","height":"30","paddingTop":"0px","borderColor":"rgba(222,220,227,1)","zIndex":"12","boxShadow":"0px 0px 0px rgba(200,200,200,0.6)","color":"","backgroundColor":"rgba(255,255,255,0)","borderWidth":"0px","width":"320","left":"1px","paddingBottom":"20px","top":"420px"},"properties":{"anim":{"type":1,"direction":3,"duration":"1","delay":"0.6"}}}]}';r=r.replace(/id=16060/,"id="+e.id);var o=JSON.parse(r);o.num=t.length+1,e.cover&&"group1/M00/61/8A/yq0KA1T2vYSAEgo7AACovQVgHxk048.jpg"!=e.cover&&(o.elements[2]=JSON.parse(i),o.elements[2].properties.src=e.cover),o.elements[1].content=o.elements[1].content.replace(/微课名称/,e.name?e.name:""),t.push(o)}function r(e,t){var n='{"id":81395,"pageId":"","sceneId":"","num":1,"type":"4","isInput":0,"title":null,"content":null,"status":1,"css":{"borderRadius":"%","borderStyle":"solid","height":"158","zIndex":"1000","paddingTop":"0px","borderColor":"rgba(0,0,0,1)","boxShadow":"0 0px 0px #333333","color":"#000000","backgroundColor":"white","borderWidth":"0px","width":"158","left":"84px","paddingTop":"11px","paddingLeft":"10px","top":"170px"},"properties":{"height":"100px","imgStyle":{"width":139,"height":136,"marginTop":"0px","marginLeft":"0px"},"width":"100px","src":"group1/M00/01/30/yq0JCFQpOR-AOULFAAFBPO1yzBQ984.jpg"}}',i='{"id":439882,"pageId":129810,"sceneId":16060,"num":1,"type":"2","isInput":0,"title":null,"content":"<div class=\\"bottom-logo\\" style=\\"text-align: center;cursor:pointer;height:136px;width:139px;\\"><em style=\\"color:white;line-height:136px;font-size:120px;\\" class=\\"eqf-eqxiu\\"></em></div>","status":1,"css":{"height":"158","width":"158","left":"84px","top":"170px","backgroundColor":"white"},"properties":{}}',r='{"id":81465,"pageId":"","sceneId":"","num":1,"type":"2","isInput":0,"title":null,"content":"<div style=\\"text-align: center;\\"><font color=\\"#ffffff\\" size=\\"3\\">击此处进行编辑</font></div>","status":1,"css":{"zIndex":"102","height":"65","width":"320","left":"0px","top":"70px"},"properties":{}}',o='{"id":2557867,"pageId":129810,"sceneId":16060,"num":1,"type":"2","isInput":0,"title":null,"content":"<div class=\\"logo-shadow1\\" style=\\"text-align: center;cursor:pointer;height:127px;width:220px;transform:rotate(-45deg);-webkit-transform:rotate(-45deg);position:absolute;left:20px;top:56px;\\"></div>","status":1,"css":{"height":"257","width":"257","left":"78px","top":"175px"},"properties":{}}',a='{"id":439883,"pageId":129810,"sceneId":16060,"num":1,"type":"2","isInput":0,"title":null,"content":"<div style=\\"width:280px;height:1px;background-color:rgba(60,60,60,0.4);cursor:pointer;position:absolute;left:0;-webkit-filter:drop-shadow(0px 1px 0px rgba(60,60,60,0.4));top:12px;\\"></div>","status":1,"css":{"height":"24","width":"280","left":"21px","top":"122px"},"properties":{}}';t.obj.sceneId=e.id;for(var s,c=0;c<t.obj.elements.length;c++)"4"!=t.obj.elements[c].type||"group1/M00/A5/5E/yq0KA1QmePmAKr7yAAEByp5jyLc752.jpg"!=t.obj.elements[c].properties.src&&"group1/M00/C5/9D/yq0KA1SH1zuAFgkLAAAFgBR8hJs456.png"!=t.obj.elements[c].properties.src&&"group1/M00/C5/3F/yq0KA1SHp-2AQZZZAAB-7rIaK6I743.png"!=t.obj.elements[c].properties.src&&"group1/M00/C5/9D/yq0KA1SH1zuAeQuFAAAFfUkeXDc110.png"!=t.obj.elements[c].properties.src||(t.obj.elements.splice(c,1),c--),"2"==t.obj.elements[c].type&&(t.obj.elements.splice(c,1),c--);"group1/M00/61/8A/yq0KA1T2vYSAEgo7AACovQVgHxk048.jpg"!=e.cover?(s=JSON.parse(n),s.properties.src=e.cover):s=JSON.parse(i),t.obj.elements.push(s),t.obj.elements.push(JSON.parse(o)),t.obj.elements.push(JSON.parse(a));var l=JSON.parse(r);l.content=l.content.replace(/击此处进行编辑/,e.name),t.obj.elements.push(l);for(var d=0;d<t.obj.elements.length;d++)"2"==t.obj.elements[d].type&&/http:\/\/service.e.wesambo.com\/eqs\/link/.test(t.obj.elements[d].content)&&(t.obj.elements[d].content=t.obj.elements[d].content.replace(/;url=.*com"/,";url="+encodeURIComponent(redirectUrl)+'"'))}function o(t,n){e.getSelfLastPage(t.obj.property.bottomLabel.id).then(function(e){if(e.data.success){var i=n[n.length-1];i.elements||(i.elements=[]),i.elements=i.elements.concat(e.data.obj.elements),c(n,t)}})}function a(e,t){s(e,t),c(t,e)}function s(e,t){var n,i="http://e.wesambo.com",r="微学宝技术支持",o='{"id":480292,"pageId":136042,"sceneId":16060,"num":1,"type":"2","isInput":0,"title":null,"content":"<div style=\\"text-align: center;transform: none;-webkit-animation: fadeIn 2s ease 1s both;-webkit-animation-play-state: initial;\\"><a href=\\"'+PREFIX_S1_URL+"eqs/link?id=16060&amp;url="+encodeURIComponent(i)+'\\" target=\\"_blank\\" style=\\"font-size: x-small;display:block;line-height: 10px;\\"><font color=\\"#ffffff\\">'+r+'</font></a></div>","status":1,"css":{"zIndex":"1000","height":"20","width":"129","left":"97px","top":"418px","backgroundColor":"rgba(0,0,0,0.6)","borderRadius":"20px"},"properties":{"anim":{"type":0,"direction":0,"duration":2,"delay":"0"}}}';o=o.replace(/id=16060/,"id="+e.id),n=t[t.length-1].elements,t[t.length-1].elements||(n=t[t.length-1].elements=[]),n.push(JSON.parse(o))}function c(e,t){var n=t.obj.pageMode;t.obj.property.slideNumber?t.obj.property.slideDisplay="block":t.obj.property.slideDisplay="none",t.obj.property.slideNumber=!0;for(var i={bgAudio:t.obj.bgAudio},r=1;r<=e.length;r++){$('<section class="main-page"><div class="m-img" id="page'+r+'"></div></section>').appendTo(".phone-view"),e.length>1&&($('<section class="u-arrow-bottom"><div class="pre-wrap"><div class="pre-box1"><div class="pre1"></div></div><div class="pre-box2"><div class="pre2"></div></div></div></section>').appendTo("#page"+r),$('<section class="u-arrow-right"><div class="pre-wrap-right"><div class="pre-box3"><div class="pre3"></div></div><div class="pre-box4"><div class="pre4"></div></div></div></section>').appendTo("#page"+r)),1==r&&$(".phone-view .main-page").eq(0).addClass("z-current");var o=r;e[o-1].properties&&!$.isEmptyObject(e[o-1].properties)?e[o-1].properties.image||e[o-1].properties.scratch?addScratchEffect(i,e,o):e[o-1].properties.finger?(f=[],f.push({num:o,finger:e[o-1].properties.finger}),lockEffect(i,e,f,$(".m-img").width(),$(".m-img").height())):e[o-1].properties.fallingObject?fallingObject(e,o):e[o-1].properties.effect?!function(t){window[e[t-1].properties.effect.name].doEffect(i,t,e,renderPage)}(o):renderPage(eqShow,o,e):(renderPage(eqShow,o,e),1==o&&playVideo(i)),r==e.length&&eqxiu.app($(".phone-view"),t.obj.pageMode,e,t)}0===n||1==n||2==n||6==n||7==n||8==n||11==n||12==n?$(".phone-view .u-arrow-right").hide():(3==n||4==n||5==n||9==n||10==n)&&$(".phone-view .u-arrow-bottom").hide()}function l(t){var n=[];$.extend(!0,n,h._pages),g.activePage&&n.push(g.activePage);var o=n.length+1;if(!t){i({name:g.sceneName},n),g.lastPage=n[n.length-1];var a=n[n.length-1];return g.haseLastPage?d(g.lastPageNum,a):($(".phone-view .main-page").last().after('<section class="main-page"><div class="m-img" id="page'+o+'"></div></section>'),g.lastPageNum=o,renderPage(eqShow,g.lastPageNum,n),g.haseLastPage=!0),h.app.changeAppPage(),void h.app.setPageData(n)}e.getSelfLastPage(t).then(function(e){if(e.data.success){if(g.lastPage=e.data.obj,g.haseLastPage){var t={id:"1",name:g.sceneName,cover:g.sceneCover};r(t,e.data),d(g.lastPageNum,e.data.obj),n.push(e.data.obj)}else $(".phone-view .main-page").last().after('<section class="main-page"><div class="m-img" id="page'+o+'"></div></section>'),g.lastPageNum=o,renderPage(eqShow,g.lastPageNum,n.push([e.data.obj])),g.haseLastPage=!0;h.app.changeAppPage(),h.app.setPageData(n)}})}function d(e,n){$("#page"+e).empty(),t.templateEditor.parse({def:n,appendTo:"#page"+e,mode:"view"})}function u(e,t,n,i){var r=0;for(e.length;r<e.length;r++){var o=e[r];if(o.pageId=t.id,n.name&&n.url&&"http://"!=n.url)2==o.type&&o.content.indexOf("e.wesambo.com科技公司")>0&&(o.content=o.content.replace(/e.wesambo.com科技公司/,'<a href="'+PREFIX_S1_URL+"eqs/link?id="+i+"&amp;url="+encodeURIComponent(n.url)+'" target=_blank>'+n.name+"</a>"));else if(n.name)2==o.type&&o.content.indexOf("e.wesambo.com科技公司")>0&&(o.content=o.content.replace(/e.wesambo.com科技公司/,n.name));else if(/微学宝技术支持/.test(o.content)){o.content='<div style="text-align: center;">'+o.content+"</div>";var a={zIndex:"1000",height:"33",width:"129",left:"97px"};$.extend(o.css,a)}else 2==o.type&&o.content&&(o.content="");o.css.zIndex=200}}function p(){h.app.removeLastPage(),h.app.changeAppPage(),g.haseLastPage=!1}var h={};h.app=eqxiu;var g={haseLastPage:!1,sceneName:"",sceneCover:"",lastPage:null,activePage:null,activePageNum:null,lastPageNum:null};h._pages=[],h.parse=function(e){g.activePage=null,e.obj.property&&(e.obj.property=JSON.parse(e.obj.property)||{}),e.obj.name&&(g.sceneName=e.obj.name),e.obj.cover&&(g.sceneCover=e.obj.cover),e.obj.bgAudio&&"string"==typeof e.obj.bgAudio?e.obj.bgAudio=JSON.parse(e.obj.bgAudio):$("#audio_btn").hide();var t=(e.obj.pageMode,e.list);if($.extend(!0,h._pages,e.list),e.obj.property.hideEqAd)c(t,e);else switch(e.obj.property.eqAdType){case 1:g.haseLastPage=!0,n(e,t),g.lastPageNum=t.length+1;break;case 2:a(e,t);break;case 3:o(e,t);break;default:g.haseLastPage=!0,n(e,t)}};var f=[];return h.changeBottomType=function(t,n,i,r){if("eqFree"==t){l(n),h.app.lastPage();var o=h._pages.length;d(o,h._pages[h._pages.length-1])}else if("eqLink"==t){if(g.lastPageNum=null,g.haseLastPage&&(p(),g.lastPage=null),h.app.lastPage(!!g.activePage),2==r){var a=[];$.extend(!0,a,h._pages);var c=a[a.length-1];return c.elements||(c.elements=[]),s(c,a),void d(h._pages.length,c)}if(!i||!i.id)return;e.getSelfLastPage(i.id).then(function(e){if(e.data.success){var t={};$.extend(!0,t,h._pages[h._pages.length-1]),t.elements||(t.elements=[]),u(e.data.obj.elements,t,i,h._pages[0].sceneId),t.elements=t.elements.concat(e.data.obj.elements),d(h._pages.length,t)}})}else g.lastPageNum=null,g.haseLastPage?(p(),g.lastPage=null):d(h._pages.length,h._pages[h._pages.length-1]),h.app.lastPage()},h.removeActivePage=function(){h.app.removeLastPage(g.haseLastPage),h.app.changeAppPage(),h.app.lastPage(),g.activePageNum=null},h.playVideo=function(e){var t={bgAudio:e};e||(t.bgAudio={url:""}),playVideo(t),e||$("#audio_btn").hide()},h.changeScrollMode=function(e){h.app.changeScrollMode(e),0===e||1==e||2==e||6==e||7==e||8==e||11==e||12==e?($(".phone-view .u-arrow-right").hide(),$(".phone-view .u-arrow-bottom").show()):(3==e||4==e||5==e||9==e||10==e)&&($(".phone-view .u-arrow-bottom").hide(),$(".phone-view .u-arrow-right").show())},h.changeSceneName=function(e){g.sceneName=e},h.changeSceneCover=function(e){g.sceneCover=e},h.replaceActivePage=function(t){e.getActivityPage(t).then(function(e){var t,n=[];g.haseLastPage?($.extend(!0,n,h._pages),g.lastPage&&n.push(g.lastPage),n.push(e.data.obj),t=n.length,g.activePage?d(g.activePageNum,e.data.obj):($(".phone-view .main-page").last().prev().after('<section class="main-page"><div class="m-img" id="page'+t+'"></div></section>'),g.activePageNum=t,renderPage(eqShow,g.activePageNum,n)),h.app.setPageData(n),h.app.changeAppPage()):($.extend(!0,n,h._pages),n.push(e.data.obj),t=n.length,g.activePage?d(g.activePageNum,e.data.obj):($(".phone-view .main-page").last().after('<section class="main-page"><div class="m-img" id="page'+t+'"></div></section>'),g.activePageNum=t,renderPage(eqShow,g.activePageNum,n)),h.app.changeAppPage(),h.app.setPageData(n)),g.activePage=e.data.obj})},h}]),angular.module("scene.support",[]),angular.module("scene.support").controller("SupportCtrl",["$location","$scope","$translate","continueUrl",function(e,t,n,i){t.continue=function(){window.sessionStorage&&sessionStorage.setItem("checkSuport",!1),e.path(i.getUrl())},t.setLinkUrl=function(){navigator.language?navigator.language.toLowerCase():navigator.systemLanguage.toLowerCase(),t.download_Chorme="https://www.baidu.com/s?wd=Chrome",t.download_IE="https://www.baidu.com/s?wd=ie11",t.download_360fast="http://chrome.360.cn/",t.download_360="http://se.360.cn/"},t.setLinkUrl()}]).factory("continueUrl",function(){function e(e){n=e}function t(){return n}var n="";return{setUrl:e,getUrl:t}}),function(){angular.module("scene.userGuide",[]).controller("SceneUserGuideCtrl",["$rootScope","$scope",function(e,t){if(window.localStorage){var n=JSON.parse(localStorage.getItem("sceneUserGuide"));n&&n[e.user.id]?t.firstLogin=!1:(t.firstLogin=!0,n=n||{},n[e.user.id]=1,localStorage.setItem("sceneUserGuide",JSON.stringify(n)))}t.currentGuideIndex=0,t.guideLength=5,t.showNextGuide=function(){t.currentGuideIndex+=1,t.guideLength==t.currentGuideIndex&&(t.firstLogin=!1)}}])}(),angular.module("active1",["services.show","services.activity","app.directives.addBanner"]),angular.module("active1").controller("Active1Ctrl",["$rootScope","$http","$scope","$translate","showService","activityService","$location","configSerService",function(e,t,n,i,r,o,a,s){n.pageNo=1,n.pageSize=10,n.childCat="active",n.join=function(e){a.path("/show/active/"+e)},n.attend=function(){e.user?a.path("/main"):n.openLogin()};var c=function(e){o.getActiveList(1,null,e,n.pageSize),n.$on("activeList",function(e,t){n.activeList=t.data.list;for(var i=Date.parse(new Date),r=0;r<n.activeList.length;r++)n.activeList[r].endDate>i?n.activeList[r].join=!0:n.activeList[r].join=!1;n.totalItems=t.data.map.count,n.currentPage=t.data.map.pageNo,n.allPageCount=t.data.map.count,n.toPage=t.data.map.pageNo})};c(n.pageNo),n.pageChanged=function(e){return 1>e||e>n.totalItems/10+1?void alert(i.instant("show.OVER_PAGE_NUMBER")):void c(e)},n.pageCode="active",s.getFriendLinks(n.pageCode).then(function(e){n.friendLinks=e.data.list,n.friendLinks.length>16&&(n.friendLinks.length=16)})}]),angular.module("activeXq",["services.show","services.activity","app.directives.addBanner"]),angular.module("activeXq").controller("ActiveXqCtrl",["$rootScope","$http","$scope","$translate","showService","activityService","$location","$routeParams","configSerService",function(e,t,n,i,r,o,a,s,c){n.PREFIX_FILE_HOST=PREFIX_FILE_HOST,n.PREFIX_CLIENT_HOST=PREFIX_HOST,n.PREFIX_SERVER_HOST=PREFIX_URL,n.pageNo=1,n.pageSize=16,n.activeId=s.id,n.childCat="active",n.totalItems=0,n.join=function(e){a.path("/show/active/"+e)},n.attend=function(){e.user?a.path("/main"):n.openLogin()};var l=function(){o.activitySceneList(n.activeId,1,n.pageNo,4).then(function(e){if(n.recSceneList=e.data.list,e.data.list)for(var t=0;t<n.recSceneList.length;t++)n.recSceneList[t].headImg?0===n.recSceneList[t].headImg.indexOf("http://")?n.recSceneList[t].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png":n.recSceneList[t].headImg=PREFIX_FILE_HOST+CLIENT_CDN+"assets/images/xiaotouxiang.png":n.recSceneList[t].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png"})};l(n.activeId,1,n.pageNo,4);var d=function(){o.activitySceneList(n.activeId,null,n.pageNo,n.pageSize).then(function(e){if(n.sceneList=e.data.list,n.totalItems=e.data.map.count,n.currentPage=e.data.map.pageNo,n.toPage=e.data.map.pageNo,e.data.list)for(var t=0;t<n.sceneList.length;t++)n.sceneList[t].headImg&&0===n.sceneList[t].headImg.indexOf("http://")?n.sceneList[t].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png":n.sceneList[t].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png"})};d(n.activeId,null,n.pageNo,n.pageSize),o.activityMes(n.activeId),n.$on("activeMes",function(e,t){n.activeMes=t.data.obj}),n.pageChanged=function(e){return n.pageNo=e,1>e||e>n.totalItems/16+1?void alert(i.instant("show.OVER_PAGE_NUMBER")):void d(n.activeId,null,e,n.pageSize)},n.pageCode="pro_"+n.activeId,c.getFriendLinks(n.pageCode).then(function(e){n.friendLinks=e.data.list,n.friendLinks.length>16&&(n.friendLinks.length=16)})}]),angular.module("category",["services.show","services.activity","app.directives.addBanner"]),angular.module("category").controller("CategoryCtrl",["$rootScope","$http","$scope","$translate","showService","activityService","$location","$routeParams","security",function(e,t,n,i,r,o,a,s,c){n.recommend=1,n.pageSize=16,o.getActiveList(null,n.recommend,n.pageNo,3),n.$on("activeList",function(e,t){n.activeList=t.data.list}),n.join=function(e){a.path("/show/active/"+e)};var l=s.id;n.bizType=l;var d={};n.getCategoryTpl=function(e){n.childCat=e,d[e]?(n.childCatrgoryList=d[e],n.childCatrgoryList.length&&(u.tagId=n.categoryId=n.childCatrgoryList[0].id,n.getPageTpls(null,n.childCatrgoryList[0].id))):r.getPageTagLabel(e).then(function(t){n.childCatrgoryList=d[e]=t.data.list,n.childCatrgoryList.length&&(u.tagId=n.categoryId=n.childCatrgoryList[0].id,n.getPageTpls(null,n.childCatrgoryList[0].id))})},n.getCategoryTpl(l);var u={sceneType:"",tagId:"",orderBy:null,bizType:"",template:"",pageNo:"1",targetPage:""};n.tplNew=function(e){n.order=e,u.orderBy=e,n.getPageTpls(e,null,u.tagId,u.pageNo,n.pageSize)},n.getPageTpls=function(e,t){t&&(u.tagId=t),n.categoryId=u.tagId,r.getSceneList(u.orderBy,null,u.tagId,u.pageNo,n.pageSize),n.$on("sceneList",function(e,t){n.tpls=t.list,n.totalItems=t.map.total,n.currentPage=t.map.pageNo,n.allPageCount=t.map.count,n.toPage=t.map.pageNo;for(var i=0;i<n.tpls.length;i++)2==n.tpls[i].isTemplate&&(n.tpls[i].isTemplate=!0),n.tpls[i].headImg&&0===n.tpls[i].headImg.indexOf("http://")?n.tpls[i].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png":n.tpls[i].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png"})},n.userTpl=function(t){c.closeLoginDialog(),a.path("/scene"),e.tplId=t},n.pageChanged=function(e){return 1>e||e>n.totalItems/16+1?void alert(i.instant("show.OVER_PAGE_NUMBER")):(u.pageNo=e,void n.getPageTpls(u.orderBy,null,u.tagId,e,n.pageSize))}}]),angular.module("nav",["services.show","services.staticRes"]),angular.module("nav").controller("NavCtrl",["$rootScope","$http","$scope","showService","$location","$routeParams","staticResService",function(e,t,n,i,r,o,a){n.sceneType=a.getSceneType(),angular.forEach(n.sceneType,function(e){e.value===o.id&&(n.$parent.catName=e.name);
}),n.getCategoryPage=function(e,t){r.path("show/category/"+e)};var s=null;n.search=function(e){s=e},n.submit=function(){s?r.path("show/search/"+s):r.path("show")},n.EnterPress=function(e,t){var i=e||window.event;13==i.keyCode&&n.submit(t)}}]),angular.module("app.directives.addBanner",[]).directive("slides2",["configSerService",function(e){return{restrict:"EA",link:function(t,n,i){var r=$(n).find(".slides_container");e.getActivityBanner(i.id).then(function(e){for(var t=e.data.list,o=0;o<t.length;o++){var a=$('<a href="'+t[o].url+'" style="display:block;" target="'+t[o].target+'" ></a>');a.append('<img src="'+t[o].path+'" width="'+i.width+'" height="'+i.height+'" alt="'+t[o].title+'" title="'+t[o].title+'" > '),r.append(a)}$(n).slides({preload:!0,play:5e3,pause:2500,hoverPause:!0})})}}}]),angular.module("show",["services.show","services.activity","app.directives.addBanner"]),angular.module("show").controller("ShowCtrl",["$rootScope","$http","$scope","showService","activityService","$location","configSerService","security",function(e,t,n,i,r,o,a,s){n.PREFIX_FILE_HOST=PREFIX_FILE_HOST,n.PREFIX_CLIENT_HOST=PREFIX_HOST,n.PREFIX_SERVER_HOST=PREFIX_URL,n.pageNo=1,n.pageSize=16,n.recommend=1,n.childCat="index",r.getActiveList(null,n.recommend,n.pageNo,3),n.$on("activeList",function(e,t){n.activeList=t.data.list}),n.join=function(e){o.path("/show/active/"+e)},i.getSceneList(null,n.recommend,null,n.pageNo,n.pageSize),n.$on("sceneList",function(e,t){n.sceneList=t.list;for(var i=0;i<n.sceneList.length;i++)2===n.sceneList[i].isTemplate&&(n.sceneList[i].isTemplate=!0),n.sceneList[i].headImg&&0===n.sceneList[i].headImg.indexOf("http://")?n.sceneList[i].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png":n.sceneList[i].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png"}),n.userTpl=function(t){s.closeLoginDialog(),o.path("/scene"),e.tplId=t},n.pageCode="index",a.getFriendLinks(n.pageCode).then(function(e){n.friendLinks=e.data.list,n.friendLinks.length>16&&(n.friendLinks.length=16)})}]),angular.module("recommend",["services.show"]),angular.module("recommend").controller("RecommendCtrl",["$rootScope","$http","$scope","$translate","showService","security","$location",function(e,t,n,i,r,o,a){n.PREFIX_FILE_HOST=PREFIX_FILE_HOST,n.PREFIX_CLIENT_HOST=PREFIX_HOST,n.PREFIX_SERVER_HOST=PREFIX_URL,n.pageNo=1,n.pageSize=16,n.childCat="recommend",n.order=null;var s=function(e){r.getSceneList(n.order,1,null,e,n.pageSize),n.$on("sceneList",function(e,t){n.recommendList=t.list,n.totalItems=t.map.total,n.currentPage=t.map.pageNo,n.allPageCount=t.map.total,n.toPage=t.map.pageNo;for(var i=0;i<n.recommendList.length;i++)2==n.recommendList[i].isTemplate&&(n.recommendList[i].isTemplate=!0),n.recommendList[i].headImg&&0===n.recommendList[i].headImg.indexOf("http://")?n.recommendList[i].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png":n.recommendList[i].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png"})};s(n.pageNo),n.tplNew=function(e){n.order=e,s(e,1,null,n.pageNo,n.pageSize)},n.userTpl=function(t){o.closeLoginDialog(),a.path("/scene"),e.tplId=t},n.pageChanged=function(e){return 1>e||e>n.totalItems/16+1?void alert(i.instant("show.OVER_PAGE_NUMBER")):void s(e)}}]),angular.module("search",["services.show","services.activity","app.directives.addBanner"]),angular.module("search").controller("SearchCtrl",["$rootScope","$http","$scope","$translate","showService","activityService","$location","$routeParams",function(e,t,n,i,r,o,a,s){var c={name:"",pageNo:1,pageSize:16};n.name=s.name,n.pageNo=1,n.pageSize=16,n.val=n.name,c.name=n.name,n.EnterPress=function(e,t){var i=e||window.event;13==i.keyCode&&n.submit(t)},n.submit=function(e){n.name=e,e?a.path("show/search/"+n.name):a.path("show")};var l=function(e){r.search(e),n.$on("searchList",function(e,t){n.searchList=t.list,n.totalItems=t.map.total,n.currentPage=t.map.pageNo,n.toPage=t.map.pageNo;for(var i=0;i<n.searchList.length;i++)n.searchList[i].headImg&&0===n.searchList[i].headImg.indexOf("http://")?n.searchList[i].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png":n.searchList[i].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png"})};l(c),n.pageChanged=function(e){return 1>e||e>n.totalItems/16+1?void alert(i.instant("show.OVER_PAGE_NUMBER")):(c.pageNo=e,void l(c))}}]),angular.module("services.activity",[]).factory("activityService",["$rootScope","$http",function(e,t){var n={};return n.getActiveList=function(n,i,r,o){var a=PREFIX_S2_URL+"index.php?c=eqs&a=activity_info";return n&&(a+=/\?/.test(a)?"&":"?",a+="joinNum="+n),i&&(a+=/\?/.test(a)?"&":"?",a+="recommend="+i),r&&(a+=/\?/.test(a)?"&":"?",a+="pageNo="+r),o&&(a+=/\?/.test(a)?"&":"?",a+="pageSize="+o),t({withCredentials:!0,method:"GET",url:a}).then(function(t){if(t.data.success){var n=t;e.$broadcast("activeList",n)}})},n.activitySceneList=function(e,n,i,r){var o=PREFIX_S2_URL+"/eqs/activity/scene?promId="+e;return n&&(o+=/\?/.test(o)?"&":"?",o+="recommend="+n),i&&(o+=/\?/.test(o)?"&":"?",o+="pageNo="+i),r&&(o+=/\?/.test(o)?"&":"?",o+="pageSize="+r),t({withCredentials:!0,method:"GET",url:o})},n.activityMes=function(n){var i=PREFIX_S2_URL+"/eqs/activity/info?id="+n;return t({withCredentials:!0,method:"GET",url:i}).then(function(t){if(t.data.success){var n=t;e.$broadcast("activeMes",n)}})},n}]),angular.module("services.configSer",[]).factory("configSerService",["$http",function(e){var t=function(t){var n=PREFIX_S2_URL+"index.php?c=ad&a=friendlinks&pageCode="+t;return e({withCredentials:!0,method:"GET",url:n})},n=function(t){var n=[],r=PREFIX_URL+"index.php?c=statics&a=getMytpl";$.get(r,function(e){for(r="",i=0;i<e.list.length;i++)n.push(e.list[i].name);window.localStorage.setItem("mytpl1",n[0]),window.localStorage.setItem("mytpl2",n[1]),window.localStorage.setItem("mytpl3",n[2])});var o=PREFIX_S2_URL+"index.php?c=eqs&a=banners&pageCode="+t,a=new Date;return o+="&time="+a.getTime(),e({withCredentials:!0,method:"GET",url:o})};return{getFriendLinks:t,getActivityBanner:n}}]),angular.module("services.show",[]).factory("showService",["$rootScope","$http",function(e,t){var n={};return n.getPageTagLabel=function(e){var n="index.php?c=upfile&a=systag&type=2";null!=e&&(n+=(/\?/.test(n)?"&":"?")+"bizType="+e);var i=new Date;return n+=(/\?/.test(n)?"&":"?")+"time="+i.getTime(),t({withCredentials:!0,method:"GET",url:PREFIX_S2_URL+n})},n.getSceneList=function(n,i,r,o,a){var s=PREFIX_S2_URL+"index.php?c=eqs&a=promotion";return n&&(s+=/\?/.test(s)?"&":"?",s+="template="+n),i&&(s+=/\?/.test(s)?"&":"?",s+="recommend="+i),r&&(s+=/\?/.test(s)?"&":"?",s+="tagId="+r),o&&(s+=/\?/.test(s)?"&":"?",s+="pageNo="+o),a&&(s+=/\?/.test(s)?"&":"?",s+="pageSize="+a),t({withCredentials:!0,method:"GET",url:s}).then(function(t){if(t.data.success){var n=t.data;e.$broadcast("sceneList",n)}})},n.search=function(n){var i="index.php?c=eqs&a=search";return t({withCredentials:!0,method:"POST",url:PREFIX_S2_URL+i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(n)}).then(function(t){if(t.data.success){var n=t.data;e.$broadcast("searchList",n)}})},n}]),angular.module("services.visitor",[]).factory("visitorService",["$rootScope","$http",function(e,t){var n={};return n.getRecommendVisitor=function(){var e="showker/recommend";return t({withCredentials:!0,method:"GET",url:PREFIX_S2_URL+e})},n.getVisitorMsg=function(e){var n="showker/detail?userId="+e;return t({withCredentials:!0,method:"GET",url:PREFIX_S2_URL+n})},n.getVisitorList=function(e,n,i,r,o){var a="showker/list";return e&&(a+=/\?/.test(a)?"&":"?",a+="addr="+e),n&&(a+=/\?/.test(a)?"&":"?",a+="pay="+n),i&&(a+=/\?/.test(a)?"&":"?",a+="good="+i),r&&(a+=/\?/.test(a)?"&":"?",a+="pageNo="+r),o&&(a+=/\?/.test(a)?"&":"?",a+="pageSize="+o),t({withCredentials:!0,method:"GET",url:PREFIX_S2_URL+a})},n.getVisitorMesList=function(e,n,i){var r="showker/represent?userId="+e;return n&&(r+=/\?/.test(r)?"&":"?",r+="pageNo="+n),i&&(r+=/\?/.test(r)?"&":"?",r+="pageSize="+i),t({withCredentials:!0,method:"GET",url:PREFIX_S2_URL+r})},n}]),angular.module("visitorXq",["services.visitor"]),angular.module("visitorXq").controller("VisitorXqCtrl",["$rootScope","$http","$scope","$translate","showService","$location","$routeParams","visitorService",function(e,t,n,i,r,o,a,s){n.childCat="visitor",n.pageNo=1,n.pageSize=16,n.serverTag=[],n.cateTag=[],n.payTag=[],n.userId=a.id,n.qqAction=i.instant("show.visitorXq.QQ_LABEL"),n.getUserDetail=function(){s.getVisitorMsg(n.userId).then(function(e){n.visitorMsg=e.data.obj,null===n.visitorMsg.tel&&n.visitorMsg.phone?n.visitorMsg.tel=n.visitorMsg.phone:n.visitorMsg.tel&&n.visitorMsg.phone&&(n.visitorMsg.tel=n.visitorMsg.phone);var t=e.data.obj.tagList;if(t)for(var r=0;r<t.length;r++)"province"==t[r].type?n.serverTag.push({tagId:t[r].tagId,name:t[r].name}):"company_industry"==t[r].type?n.cateTag.push({tagId:t[r].tagId,name:t[r].name}):"payType"==t[r].type&&n.payTag.push({tagId:t[r].tagId,name:t[r].name});n.visitorMsg.headImg&&(0===n.visitorMsg.headImg.indexOf("http://")?n.visitorMsg.headImg=n.visitorMsg.headImg:n.visitorMsg.headImg=PREFIX_FILE_HOST+n.visitorMsg.headImg),null===n.visitorMsg.qq&&(n.qqAction="",$(".qq").addClass("hui"),n.visitorMsg.qq=i.instant("show.visitorXq.NO_QQ_HINT")),null===n.visitorMsg.tel&&($(".phone").addClass("hui"),n.visitorMsg.tel=i.instant("show.visitorXq.NO_TEL")),null===n.visitorMsg.wechat&&($(".weixin").addClass("hui"),n.visitorMsg.wechat=i.instant("show.visitorXq.NO_WECHAT"))})},n.getUserDetail(),n.totalItems=0,n.currentPage=1,n.getUserWorks=function(){s.getVisitorMesList(n.userId,n.pageNo,n.pageSize).then(function(e){n.visitorWorks=e.data.list,n.totalItems=e.data.map.count,n.toPage=e.data.map.pageNo;for(var t=0;t<n.visitorWorks.length;t++)n.visitorWorks[t].headImg&&0===n.visitorWorks[t].headImg.indexOf("http://")?n.visitorWorks[t].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png":n.visitorWorks[t].headImg=CLIENT_CDN+"assets/images/xiaotouxiang.png"})},n.getUserWorks(),n.pageChanged=function(e){return n.pageNo=e,1>e||e>n.totalItems/16+1?void alert(i.instant("show.OVER_PAGE_NUMBER")):void n.getUserWorks(n.userId,e,n.pageSize)}}]),angular.module("visitor",["services.visitor"]),angular.module("visitor").controller("VisitorCtrl",["$rootScope","$http","$scope","$translate","showService","$location","usercenterService","visitorService",function(e,t,n,i,r,o,a,s){n.childCat="visitor",n.visitorId="12",n.pageNo=1,n.pageSize=12,n.visitorXq=function(e){o.path("/show/visitor/"+e)};var c=function(e){a.getAPPlyMessage(e).then(function(t){"province"===e?n.serverLabel=t.data.list:"company_industry"===e?n.cateLabel=t.data.list:"payType"===e&&(n.payLabel=t.data.list)})};c("province"),c("company_industry"),c("payType"),n.getLimitedServeRegion=function(e){return n.serverLabel.indexOf(e)<8},n.getOtherServeRegion=function(e){return n.serverLabel.indexOf(e)>=8&&(n.moreArea=!0),n.serverLabel.indexOf(e)>=8},n.getLimitedCateRegion=function(e){return n.cateLabel.indexOf(e)<11},n.getOtherCateRegion=function(e){return n.cateLabel.indexOf(e)>=11&&(n.moreLabel=!0),n.cateLabel.indexOf(e)>=11},s.getRecommendVisitor().then(function(e){if(n.recommendVisitor=e.data.obj,n.recommendVisitor.represent1){var t=n.recommendVisitor.represent1,i=t.substring(0,t.indexOf("_")),r=t.substring(t.indexOf("_")+1,t.length);n.work1Code=i,n.work1Name=r}if(n.recommendVisitor.represent2){var o=n.recommendVisitor.represent2,a=o.substring(0,o.indexOf("_")),s=o.substring(o.indexOf("_")+1,o.length);n.work2Code=a,n.work2Name=s}if(n.recommendVisitor.represent3){var c=n.recommendVisitor.represent3,l=c.substring(0,c.indexOf("_")),d=c.substring(c.indexOf("_")+1,c.length);n.work3Code=l,n.work3Name=d}n.recommendVisitor.headImg&&(0===n.recommendVisitor.headImg.indexOf("http://")?n.recommendVisitor.headImg=n.recommendVisitor.headImg:n.recommendVisitor.headImg=PREFIX_FILE_HOST+n.recommendVisitor.headImg)});var l={pay:null,addr:null,good:null};n.serverAll="all",n.cateAll="all",n.payAll="all",n.serverWu=function(e,t){n[t]="all","province"==e?(l.addr=null,n.currentServer=null):"company_industry"==e?(l.good=null,n.currentCate=null):"payType"==e&&(l.pay=null,n.currentPay=null),d(l.addr,l.pay,l.good,n.pageNo,n.pageSize)},n.subServer=function(e){n.currentServer=e,n.serverAll=null,l.addr=e.id,d(l.addr,l.pay,l.good,n.pageNo,n.pageSize)},n.subLabel=function(e){n.currentCate=e,n.cateAll=null,l.good=e.id,d(l.addr,l.pay,l.good,n.pageNo,n.pageSize)},n.subPay=function(e){n.currentPay=e,n.payAll=null,l.pay=e.id,d(l.addr,l.pay,l.good,n.pageNo,n.pageSize)},n.totalItems=0;var d=function(){s.getVisitorList(l.addr,l.pay,l.good,n.pageNo,n.pageSize).then(function(e){n.visitorList=e.data.list,n.totalItems=e.data.map.count,n.currentPage=e.data.map.pageNo,n.toPage=e.data.map.pageNo;for(var t=0;t<n.visitorList.length;t++){if(n.visitorList[t].represent1){var i=n.visitorList[t].represent1,r=i.substring(0,i.indexOf("_")),o=i.substring(i.indexOf("_")+1,i.length);n.visitorList[t].represent1Code=r,n.visitorList[t].represent1Name=o}if(n.visitorList[t].represent2){var a=n.visitorList[t].represent2,s=a.substring(0,a.indexOf("_")),c=a.substring(a.indexOf("_")+1,a.length);n.visitorList[t].represent2Code=s,n.visitorList[t].represent2Name=c}if(n.visitorList[t].represent3){var l=n.visitorList[t].represent3,d=l.substring(0,l.indexOf("_")),u=l.substring(l.indexOf("_")+1,l.length);n.visitorList[t].represent3Code=d,n.visitorList[t].represent3Name=u}n.visitorList[t].headImg&&(0===n.visitorList[t].headImg.indexOf("http://")?n.visitorList[t].headImg=n.visitorList[t].headImg:n.visitorList[t].headImg=PREFIX_FILE_HOST+n.visitorList[t].headImg)}})};d(),n.pageChanged=function(e){return n.pageNo=e,1>e||e>n.totalItems/12+1?void alert(i.instant("show.OVER_PAGE_NUMBER")):void d(l,e,n.pageSize)}}]),angular.module("app.spread.console",[]).controller("ApplyConsoleCtrl",["$scope","$rootScope","applyObj","sceneSettingCache","SpreadService","pageTplService",function(e,t,n,i,r,o){e.apply||(e.apply={}),e.applyObj=n,2==n.type?(e.title="申请加入微课",e.description="申请加入微学宝官方微课平台，获取更多朋友的关注",i.sceneTagsPromise.then(function(t){var n=t.data.list||[];e.$watch("applyObj.sceneType",function(t){t&&(e.sceneTags=[],angular.forEach(n,function(n){t==n.bizType&&e.sceneTags.push(n)}))})})):1==n.type?(e.title="申请成为样例",e.description="申请微学宝官方推荐，成为其他用户创建微课的原型样例，还可以赚取微币",4==t.user.type&&i.sceneTplPricesPromise.then(function(t){e.tplPrices=t.data.list||[],e.apply.tplObj=e.tplPrices[0]})):3==n.type?(e.title="加入活动",e.description="与其他高手过招，展示自我深厚的制作功力，有机会获得活动大奖",o.getPageTpls(n.value).then(function(t){e.activityPageTpls=t.data.list||[]})):4==n.type&&(e.title="申请为企业样例");var a,s;e.apply=function(){if(2==n.type){if(!e.apply.showObj)return void(e.authError="请先选择微课类型！");a=e.apply.showObj.id}else if(1==n.type)a=4==t.user.type?e.apply.tplObj.value:0;else if(3==n.type){if(!c)return void(e.authError="请先选择活动尾页！");a=n.id+","+c}r.applyShareWay(n.sceneId,n.type,a)},e.$on("apply.scene.share",function(t,n){n.success?e.$close({value:a,src:s}):(alert(n.msg),e.$dismiss())});var c;e.selectActivePage=function(t){$.each(e.activityPageTpls,function(e,t){t.checked=!1}),t.checked=!0,c=t.id,t.properties&&t.properties.thumbSrc&&(s=t.properties.thumbSrc)},e.cancel=function(){e.$dismiss()}}]),angular.module("spread",["app.directives.pieChart","app.directives.numChangeAnim","spread.tab","app.directives.qrcode","app.directives.switchInput","app.directives.copyButton","app.spread.console"]),angular.module("spread").controller("SpreadCtrl",["$scope","$rootScope","$location","$routeParams","MineService","sceneService","dataService","security",function(e,t,n,i,r,o,a,s){e.viewControl={},e.viewControl.tab=i.tab,e.sceneId=i.sceneId;var c,l=t.branchid;e.$watch("user",function(e){e&&(c=t.user&&t.user.domain?"http://"+t.user.domain:t.PREFIX_CLIENT_HOST,d())},!0),e.getMyScene=d,e.sceneSettings=function(t){t&&t.stopPropagation(),n.path("scene/create/"+e.sceneId).search({pageId:1,openSetting:"show"})};var d=function(){e.sceneDetailPromise=o.getSceneDetail(e.sceneId,l),e.sceneDetailPromise.then(function(t){e.scene=t.data.obj,e.url=e.selectedUrl=c+"/v-"+e.scene.code,e.scene.accessCode?e.sceneStadus="加密访问":1==e.scene.status?e.sceneStadus="开放访问":e.sceneStadus="关闭访问"})};e.showShare=function(t){e.viewControl.tab=t,e.viewControl.subtab||(e.viewControl.subtab="socialShare"),n.path("spread/share/"+i.sceneId+"/socialShare",!1)},e.showStatistics=function(t){e.viewControl.tab=t,n.path("spread/statistics/"+i.sceneId,!1)},e.dataCollect=function(t){e.viewControl.tab=t,n.path("spread/dataCollect/"+i.sceneId,!1)},e.openScene=function(t,n){n?o.openScene(e.scene.id).then(function(t){t.data.success&&(e.scene.status=1)}):o.closeScene(e.scene.id).then(function(t){t.data.success&&(e.scene.status=2)})}}]),angular.module("spread.dataCollect",[]),angular.module("spread.dataCollect").controller("DataCollectCtrl",["$rootScope","$scope","$timeout","dataService","ModalService","i18nNotifications",function(e,t,n,r,o,a){function s(e,n,i){r.getDataBySceneId(e,n,i,u).then(function(e){e.data.list.length>0&&(d=e.data.list.shift().slice(1));for(var n=0;n<e.data.list.length;n++)e.data.list[n].$$id=e.data.list[n][0],e.data.list[n].splice(0,1);if(l.length<1)for(n=0;n<d.length;n++)l.push({title:d[n],selected:!1,id:n});if(t.dataShow.length>0)for(t.dataShowList.length=0,n=0;n<t.dataShow.length;n++)for(var i=0;i<t.dataHeaders.length;i++)t.dataShow[n].id==t.dataHeaders[i].id&&(t.dataHeaders[i].selected=!0);else if(l.length>0&&l.length<8)for(n=0;n<l.length;n++)l[n].selected=!0,isTimeColumnSelected=!0;else if(l.length>7)for(var r=0;8>r;r++)l[r].selected=!0;t.dataList=e.data.list,t.totalItems=e.data.map.count,t.page.currentPage=e.data.map.pageNo,t.toPage=e.data.map.pageNo,c(),t.totalItems<1e3?t.showUp=!1:(t.showUp=!0,g())})}function c(){t.dataShow.length=0;for(var e=0;e<l.length;e++)l[e].selected&&(t.dataShow.push({title:l[e].title,selected:!0,id:l[e].id}),t.dataContain=!0);if(t.dataShow.length<1)t.dataShowList.length=0;else for(var n=0;n<t.dataList.length;n++){var i=t.dataShowList[n]=[];for(i.push(t.dataList[n].$$id),i.$$id=i[0],i.splice(0,1),e=0;e<t.dataShow.length;e++){var r=t.dataShow[e].id;i.push(t.dataList[n][r])}}0===t.dataShow.length?t.dataContain=!1:1==t.dataShow.length?t.tdW="100%":2==t.dataShow.length?t.tdW="50%":3==t.dataShow.length?t.tdW="33.3%":4==t.dataShow.length?t.tdW="25%":5==t.dataShow.length?t.tdW="20%":6==t.dataShow.length?t.tdW="16.5%":7==t.dataShow.length&&(t.tdW="14.5%")}t.totalItems=0,t.page={currentPage:1},t.toPage="",t.dataList=[];var l=t.dataHeaders=[],d=[];t.dataShow=[],t.dataShowList=[];var u=e.branchid;t.branchEdit=!0,t.branchDelete=!0,t.branchExport=!0,n(function(){21==t.user.type&&(t.user.extPermi?(/^([\d,]+,)?1(,[\d,]*)?$/.test(t.user.extPermi)?t.branchEdit=!0:t.branchEdit=!1,/^([\d,]+,)?2(,[\d,]*)?$/.test(t.user.extPermi)?t.branchDelete=!0:t.branchDelete=!1,/^([\d,]+,)?3(,[\d,]*)?$/.test(t.user.extPermi)?t.branchExport=!0:t.branchExport=!1):(t.branchEdit=!1,t.branchDelete=!1,t.branchExport=!1))},100),t.selectHeader=function(e,t,n){c()};var p=PREFIX_S3_URL+"index.php?c=scenedata&a=excel&flag=noheader&id="+t.sceneId+(u?"&user="+u:""),h=PREFIX_S3_URL+"index.php?c=scenedata&a=excel&id="+t.sceneId+(u?"&user="+u:"");t.dataOutNoHeader=function(){location.href=p},t.dataOutNoHeaderPage=function(e,n){var i;i=p+(/\?/.test(p)?"&":"?")+"start="+e+"&end="+n,location.href=i,t.dataPageList=!1},t.dataOutDirect=function(){location.href=h},t.dataOutPage=function(e,n){var i;i=h+(/\?/.test(h)?"&":"?")+"start="+e+"&end="+n,location.href=i,t.dataPageList=!1};var g=function(e,n){t.dataPageNums=[],t.dataPageobg={};for(var i=Math.ceil(t.totalItems/10,16),r=Math.ceil(i/100,16),o=1;r+1>o;o++)t.start=100*(o-1)+1,t.end=100*o,o==r&&(t.end=i),t.dataPageobg={start:t.start,end:t.end},t.dataPageNums.push(t.dataPageobg)};t.dataDelete=function(e,n){var c,l;for(selectIds=[],i=0;i<t.dataShowList.length;i++)t.dataShowList[i].selected&&selectIds.push(t.dataShowList[i].$$id);return selectIds.length?(c={ids:selectIds},l="确认删除选中数据？",void o.openConfirmDialog({msg:l},function(){r.deleteDataBySceneId(t.sceneId,c).then(function(e){200==e.data.code&&(a.pushForCurrentRoute("data.delete.success","notify.success"),t.allSelect.selected=!1,s(t.sceneId,t.page.currentPage,10))})})):void alert("您还没有选择数据")},t.allSelect={selected:!1},t.selectAll=function(){for(var e=0,n=t.dataShowList.length;n>e;e++)t.dataShowList[e].selected=t.allSelect.selected},t.selectData=function(e){e.selected||(t.allSelect.selected=!1)},t.pageChanged=function(e){return 1>e||e>t.totalItems/10+1?void alert("此页超出范围"):(t.allSelect.selected=!1,t.page.currentPage=e,void s(t.sceneId,e,10))},s(t.sceneId,t.page.currentPage,10),t.clickDown=function(){$(".origin-ul").css({height:"auto"})}}]),angular.module("spread.share",["spread.share.subtab"]),angular.module("spread.share").controller("ShareCtrl",["$rootScope","$scope","$routeParams","$location","security",function(e,t,n,i,r){n.subtab&&(t.viewControl.subtab=n.subtab),t.isDomainAccessable=r.isAllowToAccess(r.accessDef.ACCESS_DOMAIN_BIND),t.showSelectSubTab=function(e){t.viewControl.subtab=e,i.path("spread/share/"+t.sceneId+"/"+e,!1)}}]),angular.module("spread.statistics",["services.spread","app.directives.lineChart","app.directives.pieChart","app.directives.numChangeAnim"]),angular.module("spread.statistics").controller("StatisticsCtrl",["$translate","$scope","$location","$routeParams","sceneService","SpreadService","$rootScope","MineService","security","$filter",function(e,t,n,i,r,o,a,s,c,l){t.PREFIX_FILE_HOST=PREFIX_FILE_HOST,t.PREFIX_CLIENT_HOST=PREFIX_HOST,t.PREFIX_SERVER_HOST=PREFIX_URL,t.spreadViewGridOptions={},t.spreadMobileGridOptions={},t.spreadClickGridOptions={},t.sceneDeviceData=[],t.expandWebs=[],t.totalItems=0,t.page={currentPage:1},t.startDay=1,t.toPage="",t.dataPieChart=[],t.pageChanged=function(e){return 1>e||e>t.totalItems/10+1?void alert("此页超出范围"):(t.pageData=t.mapOption.data.slice(10*(e-1),10*e-1),void(t.currentPage=e))};var d=a.branchid;t.isAllowedToAccessExpandWebsite=c.isAllowToAccess(c.accessDef.EXPAND_WEBSITE),t.viewStyle="line",t.dataLineChartDataOption={data:[[],[]],xAxis:[]},t.dataMobileChartOption={data:[[],[],[],[]],xAxis:[]},t.contentDataOption={data:[[],[]],xAxis:[]},t.showLine=function(){t.viewStyle="line"},t.showPie=function(){t.viewStyle="pie"},t.$on("scene.detail",function(n,i,r){t.scene=i,t.scene&&(101==t.scene.type?t.sceneType=e.instant("main.spread.expand.SCENE_TYPE1"):102==t.scene.type?t.sceneType=e.instant("main.spread.expand.SCENE_TYPE2"):103==t.scene.type?t.sceneType=e.instant("main.spread.expand.SCENE_TYPE3"):104==t.scene.type?t.sceneType=e.instant("main.spread.expand.SCENE_TYPE4"):105==t.scene.type&&(t.sceneType=e.instant("main.spread.expand.SCENE_TYPE5")))}),t.devicePie=!1,t.$on("scene.device",function(e,n,i,r,o){0===n.total?t.sceneDeviceData=[]:t.sceneDeviceData=n.data}),t.getDeviceDate=function(e,t,n){o.getDevicePv(e,t,n)},t.$on("scene.data",function(e,n,i,r,o,a){t.stats=n,u(i,r,o,a)});var u=function(e,n,i,r){t.pageView=0,t.spreadClickGridOptions.data=t.stats,t.xAxisData=[],t.viewLineChartData=[],t.dataLineChartData=[],t.dataLineChartFriendGroup=[],t.dataLineChartFriends=[],t.dataLineChartFriend=[],t.dataLineChartOther=[],t.viewLineTel=[],t.viewLineTab=[],t.dataPieChart=[];for(var o=0,a=0,s=0,c=0,l=0,d=0;d<t.stats.length;d++)t.xAxisData.push(t.stats[d].STAT_DATE),t.viewLineChartData.push(t.stats[d].SHOW),t.dataLineChartData.push(t.stats[d].DATA),t.dataLineChartFriendGroup.push(t.stats[d].S_WX_TIMELINE),t.dataLineChartFriends.push(t.stats[d].S_WX_GROUP),t.dataLineChartFriend.push(t.stats[d].S_WX_SINGLE),t.viewLineTel.push(t.stats[d].TEL),t.viewLineTab.push(t.stats[d].LINK),t.dataOthers=t.stats[d].S_MOBILE-t.stats[d].S_WX_TIMELINE-t.stats[d].S_WX_SINGLE-t.stats[d].S_WX_GROUP,t.dataLineChartOther.push(t.dataOthers),t.pageView+=t.stats[d].SHOW,o+=t.stats[d].S_MOBILE,a+=t.stats[d].S_WX_TIMELINE,s+=t.stats[d].S_WX_SINGLE,c+=t.stats[d].S_WX_GROUP;t.spreadMobile=!0,o=1,o>0?(l=o-a-s-c,t.dataPieChart=[{value:a,name:"微信朋友圈"},{value:c,name:"微信群"},{value:s,name:"微信朋友"},{value:l,name:"其他访问"}]):t.spreadMobile=!1,t.dataLineChartDataOption={data:[t.viewLineChartData,t.dataLineChartData],xAxis:t.xAxisData},t.dataMobileChartOption={data:[t.dataLineChartFriendGroup,t.dataLineChartFriends,t.dataLineChartFriend,t.dataLineChartOther],xAxis:t.xAxisData},t.contentDataOption={data:[t.viewLineTel,t.viewLineTab],xAxis:t.xAxisData},$(".myGrid1").height(50*(t.stats.length+1)+1),$(".myGrid1 .ui-grid-viewport").height(50*t.stats.length+1)};if(t.getAllStats=function(e,n,i){t.model={startTime:n,endTime:i},o.getSceneData(e,n,i,d,t.expandId)},t.$on("webs.update",function(e){t.expandWebs=o.expandWebs}),t.viewExpandDetail=function(e,n){t.selectIndex=n,t.expandId=e,t.model?t.getAllStats(t.scene.id,t.model.startTime,t.model.endTime):t.getAllStats(t.scene.id,-6,1)},i.sceneId){o.getWebList(i.sceneId,!0,d);var p=new Date;p=new Date(p.getTime()-864e5),o.queryRegion(i.sceneId,l("date")(p))}t.$on("region.update",function(e,n){for(var i=0;i<n.data.length;i++)(n.data[i].name.indexOf("省")>-1||n.data[i].name.indexOf("市")>-1)&&(n.data[i].name=n.data[i].name.substr(0,n.data[i].name.length-1)),"内蒙古自治区"==n.data[i].name&&(n.data[i].name="内蒙古"),"广西壮族自治区"==n.data[i].name&&(n.data[i].name="广西"),"西藏自治区"==n.data[i].name&&(n.data[i].name="西藏"),"新疆维吾尔自治区"==n.data[i].name&&(n.data[i].name="新疆"),"香港特别行政区"==n.data[i].name&&(n.data[i].name="香港"),"宁夏回族自治区"==n.data[i].name&&(n.data[i].name="宁夏"),"澳门特别行政区"==n.data[i].name&&(n.data[i].name="澳门");if(n.max>0){var r=n.max.toString();n.max=(parseInt(r[0],10)+1)*Math.pow(10,r.length-1)}t.mapOption={data:n.data,maxValue:n.max},t.totalItems=n.data.length,t.totalItems>10?t.pageData=t.mapOption.data.slice(0,9):t.pageData=n.data}),t.changeMap=function(e){if(e!=t.startDay){t.startDay=e;var n=new Date;n=new Date(n.getTime()-864e5*e),o.queryRegion("11858950",l("date")(n))}}}]).directive("eqdMap",["$parse",function(e){return{restrict:"E",scope:{option:"@"},template:'<div class="echartView"></div>',link:function(e,t,n){e.echart=echarts.init(t.find("div")[0],"gray");var i={title:{text:"",subtext:"",x:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",x:"right",data:["pv"]},dataRange:{min:0,max:2500,text:["高","低"],calculable:!0,precision:0},series:[{name:"pv",type:"map",mapType:"china",itemStyle:{normal:{label:{show:!0}},emphasis:{color:"#59c3f9",label:{show:!0}}},data:e.data}]};e.$watch("option",function(t,n){if(t!=n){var r=JSON.parse(t);i.series[0].data=r.data,i.dataRange.max=r.maxValue,e.echart.clear(),e.echart.setOption(i)}})}}}]).directive("eqdLineChart",[function(){return{restrict:"E",scope:{option:"@",legend:"@"},template:'<div class="lineChartView"></div>',link:function(e,t,n){e.echart=echarts.init(t.find("div")[0],"macarons");var i=JSON.parse(n.legend),r={title:{text:"访问次数",x:"center"},legend:{data:i,x:"left"},calculable:!0,tooltip:{trigger:"axis"},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"",type:"line",smooth:!0,itemStyle:{normal:{areaStyle:{type:"default"}}},data:[]}]},o=JSON.parse(n.option);r.xAxis[0].data=o.xAxis;for(var a=1;a<o.data.length;a++)r.series[a]=angular.copy(r.series[0]);for(var s=0;s<o.data.length;s++)r.series[s].name=i[s],r.series[s].data=o.data[s];e.echart.setOption(r),e.$watch("option",function(t,n){if(t!=n){var i=JSON.parse(t);r.xAxis[0].data=i.xAxis;for(var o=0;o<i.data.length;o++)r.series[o].data=i.data[o];e.echart.showLoading(),e.echart.hideLoading(),e.echart.setOption(r,!0)}})}}}]).directive("eqdPieChart",[function(){return{restrict:"E",scope:{data:"@",name:"@"},template:'<div class="pieChartView"></div>',link:function(e,t,n){e.echart=echarts.init(t.find("div")[0],"macarons");for(var i=JSON.parse(n.data),r=[],o=0;o<i.length;o++)r.push(i[o].name);var a={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:r},calculable:!0,series:[{name:n.name,type:"pie",radius:"55%",center:["50%","60%"],data:i}]};e.echart.setOption(a),e.$watch("data",function(t,n){if(t!=n){var i=JSON.parse(t);a.series[0].data=i;for(var r=[],o=0;o<i.length;o++)r.push(i[o].name);a.legend.data=r,e.echart.showLoading(),e.echart.hideLoading(),e.echart.setOption(a)}})}}}]),angular.module("spread.share.domainBind",["services.usercenter","services.i18nNotifications"]),angular.module("spread.share.domainBind").controller("DomainBindCtrl",["$scope","$rootScope","usercenterService","$translate","i18nNotifications",function(e,t,n,i,r){e.showController={},e.goStep=function(t){e.showController.step=t},e.bindDomain=function(){e.showController.agreeBind=!0},e.reApply=function(){e.isShowBindPanel=!0,e.showController.agreeBind=!1};var o=function(){n.getDomain().then(function(t){if(t.data.success)if(e.domainInfo=t.data.obj,e.model.day=t.data.obj.typeList[0],e.typeIndex=0,t.data.obj.id){e.isShowBindPanel=!1,e.domainInfo.ipAddress="202.173.11.90";var n=e.status=t.data.obj.status;1===n?(e.domainMes=i.instant("usercenter.server.DOMAIN_STATUS1"),e.unbind=!1,e.domainInfo.restTime=Math.floor((e.domainInfo.endDate-e.domainInfo.startDate)/864e5)):2===n?(e.domainMes=i.instant("usercenter.server.DOMAIN_STATUS2"),e.unbind=!1):3===n?(e.domainMes=i.instant("usercenter.server.DOMAIN_STATUS3"),e.unbind=!0):4===n?e.domainMes=i.instant("usercenter.server.DOMAIN_STATUS4"):(new Date).getTime()>t.data.obj.endDate&&(e.status=5,e.domainMes=i.instant("usercenter.server.DOMAIN_STATUS5"),e.unbind=!0)}else e.isShowBindPanel=!0})};o(),e.getUserXd=function(){n.getUserXd().then(function(t){t.data.success&&(e.xdCounts=t.data.obj)})},e.getUserXd(),e.model||(e.model={});var a=e.model;e.checkDomainFormat=function(t){return t.url?(e.domainFormatErr="",!0):(e.domainFormatErr=i.instant("usercenter.server.WRITE_DNS"),!1)},e.checkDayFormat=function(t){return t.day?(e.dayFormatErr="",!0):(e.dayFormatErr=i.instant("usercenter.server.WRITE_DATE"),!1)},e.checkAppIdAndSecret=function(t){return t.appId&&!t.secretId?(e.appIdFormatErr=i.instant("usercenter.serverWRITE_APPSECRET"),!1):!t.appId&&t.secretId?(e.appSecretErr=i.instant("usercenter.server.WRITE_APPID"),!1):(e.appIdFormatErr="",e.appSecretErr="",!0)},e.submit=function(){if(e.checkDomainFormat(a)&&e.checkDayFormat(a)&&e.checkAppIdAndSecret(a))if(e.cost=a.day.label,e.xdCounts>=parseInt(e.cost,10)){var t={url:a.url,buyTime:a.day.value,appId:a.appId,secretId:a.secretId};n.bindDomain(t).then(function(t){t.data.success?(alert(i.instant("usercenter.server.DNS_COMMIT")),e.status=2,e.isShowBindPanel=!1,e.domainInfo.ipAddress="202.173.11.90",e.domainInfo.url=a.url):e.actionerror=t.data.msg},function(){alert(i.instant("usercenter.server.SERVER_ERROR"))})}else r.pushForCurrentRoute("xd.insufficient","notify.success")},e.switchDomainType=function(t){e.typeIndex=t}}]),angular.module("spread.share.expandWeb",[]),angular.module("spread.share.expandWeb").controller("ExpandWebCtrl",["$rootScope","$scope","$routeParams","SpreadService","ModalService",function(e,t,n,i,r){var o=e.branchid,a=function(){i.getWebList(t.sceneId,!0,o)};a(),t.$on("webs.update",function(e){t.expandWebs=i.expandWebs||[]}),t.addExpandWeb=function(n){n.unshift({name:t.scene.name+"_扩展"+(n.length+1),url:t.selectedUrl,showCount:0}),e.$broadcast("make.input.focus")},t.deleteWeb=function(e,n){r.openConfirmDialog({msg:"删除后微课原地址无法访问，相应数据无法查看。"},function(){var r={id:n.id,index:e};n.id?i.deleteWeb(r):t.expandWebs.splice(e,1)})};var s;t.recordName=function(e){s=e},t.updateName=function(e){var n={sceneId:t.sceneId,name:e.name};if(e.id){if(s==e.name)return;n.id=e.id}i.updateName(n).then(function(n){n.data.success&&(e.id||(e.id=n.data.obj.id,e.url=t.selectedUrl+"?qrc="+e.id))},function(e){alert("服务器异常！")})},t.qrcodeList=[{type:1,name:"小（256px）",size:256},{type:2,name:"中（512px）",size:512},{type:3,name:"大（1024px）",size:1024}],t.downloadQrcode=function(t){e.$broadcast("download.canvas",t.size)}}]),angular.module("spread.share.siteImport",[]),angular.module("spread.share.siteImport").controller("SiteImportCtrl",["$rootScope","$scope","$routeParams","sceneService",function(e,t,n,i){function r(){t.contentTexts=[{textOne:"以<script>的方式嵌入",textTwo:"该嵌入方式可以自适应高度，推荐使用。",
textThree:"点击“复制代码”后，将代码粘贴至网页HTML期望的位置即可",url:'<script type="text/javascript" src="'+t.selectedUrl+'">',title:"在网页中以script的方式嵌入微课"},{textOne:"以iframe的方式嵌入",textTwo:"该嵌入方式不能自适应高度，请谨慎使用。",textThree:"点击“复制代码”后，将代码粘贴至网页HTML期望的位置即可",url:'<iframe width=322px frameborder=0 height=641px src="'+t.selectedUrl+'"></iframe>',title:"在网页中以iFrame的方式嵌入微课"}]}t.$watch("user",function(n){if(n){var o;o=e.user&&e.user.domain?"http://"+e.user.domain:e.PREFIX_CLIENT_HOST,i.getSceneDetail(t.sceneId).then(function(e){t.url=t.selectedUrl=o+"/v-"+t.scene.code,r()})}},!0)}]),angular.module("spread.share.socialShare",["app.directives.disableKeydown"]),angular.module("spread.share.socialShare").controller("SocialShareCtrl",["$rootScope","$scope","$routeParams","$modal","i18nNotifications","sceneSettingCache","SpreadService","pageTplService",function(e,t,n,i,r,o,a,s){t.obj={},t.qrcodeList=[{type:1,name:"小（256px）",size:256},{type:2,name:"中（512px）",size:512},{type:3,name:"大（1024px）",size:1024}],t.shareList=[{id:1,type:"sina",icon:"eqf-weibo",title:"新浪微博",class:"sina"},{id:2,type:"tencent",icon:"eqf-txweibo",title:"腾讯微博",class:"tencent"},{id:3,type:"qqzone",icon:"eqf-QQzone",title:"qq空间",class:"qqzone"},{id:4,type:"timeline",icon:"eqf-friend",title:"微信朋友圈",class:"timeline"},{id:5,type:"yixin",icon:"eqf-yixin",title:"易信",class:"yixin"},{id:6,type:"tieba",icon:"eqf-tieba",title:"百度贴吧",class:"tieba"},{id:7,type:"laiwang",icon:"eqf-laiwang",title:"来往",class:"laiwang"}],t.downloadQrcode=function(t){e.$broadcast("download.canvas",t.size)};var c=function(){a.getShareWayList(t.sceneId)};c(),t.$on("shareway.update",function(e,n){$.each(t.shareList,function(e,t){$.each(n,function(e,n){n.type==t.id&&1==n.status&&(t.isLighted=!0)})})}),t.activeShareWay=function(e){a.activeShareWay(t.sceneId,e)},t.$on("active.shareway",function(e,n){$.each(t.shareList,function(e,t){n==t.id&&(t.isLighted=!0)})}),t.$watch("scene",function(e,n){e&&(-1==e.status?t.tip="审核被拒绝不能申请":-2==e.status&&(t.tip="审核中不能申请"),o.activitiesPromise.then(function(n){if(t.activities=n.data.list||[],e.promIds){$.each(t.activities,function(n,i){e.promIds==i.id&&(t.obj.selectedActivity=i)});var i=JSON.parse(e.property);s.getPageTpls(t.obj.selectedActivity.sceneId).then(function(e){t.activityPageTpls=e.data.list||[],$.each(t.activityPageTpls,function(e,n){i.activityPageId==n.id&&n.properties&&(t.appliedImgSrc=n.properties.thumbSrc)})})}}),0==e.applyTemplate?t.obj.applySample=!1:1==e.applyTemplate?t.obj.applySample=!0:2==e.applyTemplate||-1==e.applyTemplate,t.obj.publishTime=e.publishTime,0==e.isShow?t.obj.applyShow=!1:1==e.isShow?t.obj.applyShow=!0:2==e.isShow||-1==e.isShow,3==e.isTpl&&(t.obj.applyCompTpl=!0),o.sceneTagsPromise.then(function(n){var i=n.data.list||[];t.sceneTags=[],angular.forEach(i,function(n){e.type==n.bizType&&t.sceneTags.push(n)}),e.tagId&&$.each(t.sceneTags,function(n,i){e.tagId==i.id&&(t.obj.sceneTag=i)})}),o.sceneTplPricesPromise.then(function(n){t.tplPrices=n.data.list||[],$.each(t.tplPrices,function(n,i){e.price==i.value&&(t.obj.tplPrice=i)})}))},!0),t.applyFunc=function(e,n,i,o){if(e){if(2==n&&(1==t.scene.isShow||2==t.scene.isShow))return r.pushForCurrentRoute("already.apply.discovery","notify.success"),void $.each(t.sceneTags,function(e,n){t.scene.type==n.id&&(t.obj.sceneTag=n)});if(1==n&&(1==t.scene.applyTemplate||2==t.scene.applyTemplate))return r.pushForCurrentRoute("already.apply.sample","notify.success"),void $.each(t.tplPrices,function(e,n){t.scene.price==n.value&&(t.obj.tplPrice=n)});if(3==n)return-1==t.scene.status?void r.pushForCurrentRoute("scene.deny.apply","notify.success"):-2==t.scene.status?void r.pushForCurrentRoute("scene.incheck.apply","notify.success"):t.scene.accessCode?void r.pushForCurrentRoute("scene.accessCode.apply","notify.success"):t.scene.promIds?(r.pushForCurrentRoute("already.apply.activity","notify.success"),void $.each(t.activities,function(e,n){t.scene.promIds==n.id&&(t.obj.selectedActivity=n)})):void(window.localStorage&&localStorage.getItem("hideApplyActivityTip")?l(e,n,i,o):t.showApplyTip=!0);l(e,n,i,o)}},t.switchApplyActivityTip=function(e,t,n,i,r){r&&window.localStorage&&localStorage.setItem("hideApplyActivityTip",!0),l(e,t,n,i)},t.$on("apply.scene.share",function(e,t){t.success&&r.pushForCurrentRoute("scene.apply.success","notify.success")});var l=function(e,n,o,a){e&&i.open({windowClass:"console six-contain",templateUrl:"spread/console/apply.tpl.html",controller:"ApplyConsoleCtrl",resolve:{applyObj:function(){return{sceneId:t.sceneId,type:n,value:o,id:a,sceneType:t.scene.type}}}}).result.then(function(e){var i=e.value;r.pushForCurrentRoute("scene.apply.success","notify.success"),2==n?($.each(t.sceneTags,function(e,n){i==n.id&&(t.obj.sceneTag=n)}),t.scene.isShow=1):1==n?($.each(t.tplPrices,function(e,n){i==n.value&&(t.obj.tplPrice=n)}),t.scene.applyTemplate=1):3==n?e.src&&(t.appliedImgSrc=e.src):4==n&&(t.scene.isTpl=3)},function(){2==n?t.obj.applyShow=!1:1==n?t.obj.applySample=!1:3==n?t.obj.selectedActivity=null:4==n&&(t.obj.applyCompTpl=!1)})};t.applyCompTpl=function(e,n){e&&a.applyShareWay(t.sceneId,n)},t.closeActivityModal=function(){t.showApplyTip=!1,t.obj.selectedActivity=null}}]),angular.module("spread.share.subtab",["spread.share.socialShare","spread.share.expandWeb","spread.share.domainBind","spread.share.siteImport"]),angular.module("spread.tab",["spread.share","spread.statistics","spread.dataCollect"]),angular.module("usercenter.branch",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.branch").controller("BranchCtrl",["$rootScope","$scope","$window","$routeParams","usercenterService","security","$modal","ModalService","$location","branch","i18nNotifications","$translate",function(e,t,n,i,r,o,a,s,c,l,d,u){t.originData=t.branch=angular.copy(l),t.dept={},t.depts=[],t.resetDefalt=!1,l?t.resetDefalt=!0:(t.resetDefalt=!1,setTimeout(function(){$("button").css("background-color","#ccc")},0),t.branch={}),t.openResetModal=function(e){a.open({windowClass:"console six-contain",templateUrl:"usercenter/console/resetbranchpass.tpl.html",controller:"ResetBranchPassCtrl",resolve:{branch:function(){return e}}}).result.then(function(){d.pushForCurrentRoute("branch.reset.success","notify.success")},function(){})},t.getDepts=function(){r.getDepts(t.branch.id).then(function(e){if(t.branchPermi.edit=e.data.company_ext[0],t.branchPermi.delete=e.data.company_ext[1],t.branchPermi.export=e.data.company_ext[2],console.log(t.branchPermi),t.depts=e.data.list,t.branch.deptName||t.branch.deptId)for(var n=0;n<t.depts.length;n++)if(t.depts[n].id==t.branch.deptId)return void(t.branch.dept=t.depts[n])},function(){})},t.getDepts(),t.authError="",t.checkDeptFormat=function(e){return e.name?countCharacters(e.name)>30?($(".dept-name").addClass("error"),$(".dept-name").change(function(){$(this).removeClass("error")}),t.deptFormatError=u.instant("usercenter.account.DEPT_ERR2"),!1):(t.deptFormatError="",!0):(t.deptFormatError=u.instant("usercenter.account.DEPT_ERR1"),$(".dept-name").focus(),deptF={},!1)},t.addDept=function(){t.checkDeptFormat(t.dept)&&r.addDept(t.dept).then(function(e){e.data.success&&(t.showAddSec=!1,t.depts.unshift({id:e.data.obj,name:t.dept.name}),d.pushForCurrentRoute("dept.create.success","notify.success"),t.dept={})},function(){t.authError=u.instant("usercenter.account.SERVER_ERROR")})},t.branchPermi={edit:!0,delete:!0,export:!0},t.branch.extPermi&&(/^([\d,]+,)?1(,[\d,]*)?$/.test(t.branch.extPermi)&&(t.branchPermi.edit=!0),/^([\d,]+,)?2(,[\d,]*)?$/.test(t.branch.extPermi)&&(t.branchPermi.delete=!0),/^([\d,]+,)?3(,[\d,]*)?$/.test(t.branch.extPermi)&&(t.branchPermi.export=!0)),t.checkEmailFormat=function(e){return t.branch.loginName?/^[-_a-z0-9\.@]{6,40}$/g.test(t.branch.loginName)?(t.emailFormatError="",!0):(t.emailFormatError=u.instant("usercenter.account.BRANCH_ERR2"),!1):(t.emailFormatError=u.instant("usercenter.account.BRANCH_ERR1"),!1)},t.checkNameFormat=function(e){return e.name?countCharacters(e.name)>30?(t.nameFormatErr=u.instant("usercenter.account.LOGIN_NAME_ERR2"),!1):(t.nameFormatErr="",!0):($(".branch-name").focus(),t.nameFormatErr=u.instant("usercenter.account.LOGIN_NAME_ERR1"),!1)},t.confirm=function(){if(t.checkEmailFormat(t.branch)&&t.checkNameFormat(t.branch)){var e={};t.branch.dept&&(t.branch.deptName=t.branch.dept.name,t.branch.dept.id&&(e.deptId=t.branch.deptId=t.branch.dept.id));var n=[];$.each(t.branchPermi,function(e,t){"edit"==e&&t?n.push("1"):"export"==e&&t?n.push("3"):"delete"==e&&t&&n.push("2")}),t.branch.extPermi=n.join(","),l?($.extend(e,{id:t.branch.id,name:t.branch.name,extPermi:t.branch.extPermi}),r.updateBranch(e).then(function(e){e.data.success&&(t.$close(t.branch),d.pushForCurrentRoute("branch.update.success","notify.success"))},function(e){t.serverError=u.instant("usercenter.account.SERVER_ERROR")})):($.extend(e,{loginName:t.branch.loginName,name:t.branch.name,extPermi:t.branch.extPermi}),r.createBranch(e).then(function(e){e.data.success?(t.branch.id=e.data.obj.id,d.pushForCurrentRoute("branch.create.success","notify.success"),t.$close(t.branch)):t.serverError=e.data.msg},function(e){t.serverError=u.instant("usercenter.account.SERVER_ERROR")}))}},t.cancel=function(){t.$dismiss()}}]),angular.module("usercenter.checkMobil",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.checkMobil").controller("CheckMobileCtrl",["$rootScope","$scope","$window","usercenterService","$modal","ModalService","$location","$timeout","userinfo","i18nNotifications","$translate",function(e,t,n,i,r,o,a,s,c,l,d){function u(){0===p?(t.isCodeAccessiable=!1,t.codeTip=d.instant("usercenter.account.CODE_TIP1"),p=60):(t.isCodeAccessiable=!0,t.codeTip=d.instant("usercenter.account.CODE_TIP2")+"("+p+")",s(function(){p--,u()},1e3))}switch(t.title=c.title,t.userinfo=c,t.userinfo.code="",t.title){case d.instant("usercenter.account.REL_MOBILE"):t.dec=d.instant("usercenter.account.REL_MOBILE_DEC");break;case d.instant("usercenter.account.VALIDATE_MOBILE"):t.dec=d.instant("usercenter.account.VALIDATE_MOBILE_DEC");break;case d.instant("usercenter.account.CHANGE_MOBILE"):t.dec=d.instant("usercenter.account.CHANGE_MOBILE_DEC")}t.checkMobile=function(){return/^1\d{10}$/.test(t.userinfo.phone)?(t.mobileError="",!0):($(".mobile").focus(),t.mobileError=d.instant("usercenter.account.MOBILE_ERROR1"),!1)},t.checkCode=function(){return t.userinfo.code?(t.codeError="",!0):($(".code").focus(),t.codeError=d.instant("usercenter.account.CODE_ERROR"),!1)},t.getCode=function(){t.userinfo.phone?(t.mobileError="",i.relMobileCode(t.userinfo.phone).then(function(e){e.data.success?u():t.relErr=e.data.msg})):(t.mobileError=d.instant("usercenter.account.MOBILE_ERROR2"),$(".mobile").focus())};var p=60;t.relAccount=function(){t.checkMobile()&&t.checkCode()&&(t.mobileError="",t.codeError="",i.relMobile(t.userinfo.phone,t.userinfo.password,t.userinfo.code).then(function(e){e.data.success?o.openMsgDialog({msg:e.data.msg},function(){t.$close(t.userinfo.phone)}):t.relErr=e.data.msg}))},t.cancel=function(){t.$dismiss()}}]),angular.module("usercenter.companyinfo",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.companyinfo").controller("companyInfoCtrl",["$scope","$modal","userinfo","usercenterService","i18nNotifications",function(e,t,n,i,r){e.companyUserInfo={},e.designerUserInfo={},e.companyUserInfo.nick=n.nick,e.type=n.type,e.pid={};var o=function(){i.getDesignerUserInfo().then(function(t){e.designerUserInfo=t.data.obj}),i.getProvince().then(function(t){e.provinces=t.data.obj})},a=function(){i.getCompanyInfo().then(function(t){e.companyUserInfo=t.data.obj})};e.getProvinceInfo=function(t,n){if(e.pid=t,e.name=n,e.cities=[],console.log("a.pid "+e.pid+"11111"),e.pid==undefined)e.cities=[],e.designerUserInfo.proid="",e.designerUserInfo.proname="";else{e.designerUserInfo.proid=e.pid,e.designerUserInfo.proname=e.name;var i=PREFIX_URL+"index.php?c=Designer&a=getcity&pid="+e.pid;$.get(i,function(t){t=JSON.parse(t),e.cities=t,e.$apply(),console.log(e.cities)})}},e.getCityInfo=function(t,n){e.designerUserInfo.cityid=t,e.designerUserInfo.cityname=n,console.log("a.cid "+t),console.log("a.name "+n)},e.clearProvinceInfo=function(){e.$apply(function(){e.designerUserInfo.proid="",e.designerUserInfo.proname=""})},e.clearCityInfo=function(){e.$apply(function(){e.designerUserInfo.cityid="",e.designerUserInfo.cityname=""})},e.checkEmail=function(t){var n=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return t.email&&!n.test(t.email)?(e.authError="请正确填写邮箱",!1):(e.authError="",!0)},2==e.type&&(a(),e.title="企业会员基本信息"),1==e.type||12==e.type&&(e.title="个人用户基本信息"),3==e.type&&(e.title="高级用户基本信息"),22==e.type&&(o(),e.title="设计师基本信息"),e.saveUserInfo=function(t){t.id=n.id,i.saveUserInfo(t).then(function(n){n.data.success&&(e.$close(t),r.pushForCurrentRoute("save.success","notify.success"))})},e.saveCompanyInfo=function(t){return!!e.checkEmail(t)&&(t.nick=e.companyUserInfo.nick,void i.saveCompanyInfo(t).then(function(n){n.data.success?(r.pushForCurrentRoute("account.success","notify.success"),e.$close(t)):e.codeError=n.data.msg}))},e.saveDesignerInfo=function(t){return!!e.checkEmail(t)&&(t.nick=e.designerUserInfo.nick,void i.saveDesignerInfo(t).then(function(n){n.data.success?(r.pushForCurrentRoute("account.success","notify.success"),e.$close(t)):e.codeError=n.data.msg}))},e.cancel=function(){e.$close()},e.invoice=function(){t.open({windowClass:"six-contain",templateUrl:"usercenter/console/invoice.tpl.html",controller:"InvoiceCtrl",scope:e,resolve:{userinfo:function(){return{}}}}).result.then(function(e){},function(){})}}]),angular.module("invitation",["app.directives.copyButton"]),angular.module("invitation").controller("InvitationCtrl",["security","$scope","usercenterService","$translate","$timeout","ModalService","i18nNotifications",function(e,t,n,i,r,o,a){t.tabid="email",t.showUrl=PREFIX_HOST+"/#/home/register?u="+e.currentUser.id,t.url="我做的企业秀，用的是微学宝，免费好用，你试试吧：\r\n"+PREFIX_HOST+"/#/home/register?u="+e.currentUser.id,t.sendEmail=function(e){!t.emailFormatErr&&e&&n.sendEmail({email:e}).then(function(e){e.data.success?a.pushForCurrentRoute("invitation.sendemail.success","notify.success"):a.pushForCurrentRoute("invitation.sendemail.error","notify.warning")})},t.checkEmailFormat=function(e){var n=/^([a-zA-Z0-9]+[_|\_|\.|-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[\.|-]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;n.test(e)?t.emailFormatErr="":t.emailFormatErr="邮件格式不正确"}}]),angular.module("usercenter.invoicelist",[]).controller("GetInvoiceListCtrl",["$scope","usercenterService","$modal","ModalService",function(e,t,n,i){e.pageNo=1,e.pageSize=5,e.obj={};var r=[],o=function(e,n){t.getInvoiceList(e,n)};o(1,5),e.$on("get.invoice.list",function(t,n){e.invoiceList=n.list||[];for(var i=0;i<n.list.length;i++)e.invoiceList[i].totalFee=e.invoiceList[i].totalFee/100,0==n.list[i].payType?e.invoiceList[i].payType="微信支付":1==n.list[i].payType&&(e.invoiceList[i].payType="支付宝支付");e.totalItems=n.map.count,e.currentPage=e.obj.toPage=n.map.pageNo}),e.pageChanged=function(n){t.getInvoiceList(n,e.pageSize)},e.cancel=function(){e.$dismiss()},e.view=!0,e.ok=function(){var t=angular.copy(r);r=[],t.length>0?n.open({windowClass:"six-contain",templateUrl:"usercenter/console/invoice.tpl.html",controller:"InvoiceCtrl",scope:e,resolve:{userinfo:function(){return{view:e.view,orderIds:t}}}}).result.then(function(t){o(1,5),e.switchSelectAll()},function(){}):i.openMsgDialog({msg:"请选择需要开发票的订单列表",btn:"去选择"},function(){})},e.switchSelectAll=function(t){r=[],t?$.each(e.invoiceList,function(e,t){r.push(t.id),t.selected=!0}):$.each(e.invoiceList,function(e,t){t.selected=!1})},e.switchSelect=function(e){e.selected?r.push(e.id):$.each(r,function(t,n){n==e.id&&r.splice(t,1)})}}]),angular.module("usercenter.invoice",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.invoice").controller("InvoiceCtrl",["$scope","usercenterService","$modal","i18nNotifications","userinfo",function(e,t,n,i,r){e.invoiceStatus="",e.changeType=function(t){e.invoiceStatus=t},e.editInfo={isEditable:!0},r.view&&(e.view=r.view,e.editInfo.isEditable=!1,r.orderIds=r.orderIds.join(","));var o=[];e.authError="",e.picture={},e.invoice={receiver:"",phone:"",address:""},e.reset=function(){e.editInfo.isEditable=!0},e.invoiceListPu={invoiceType:1},e.invoiceListzhuan={invoiceType:2};var a=function(){t.getUserInvoice().then(function(t){if(200==t.data.code){t.data.obj&&(e.invoice=t.data.obj),t.data.map.invoiceType?e.invoiceStatus=t.data.map.invoiceType:e.invoiceStatus=1;for(var n=t.data.list,i=0;i<n.length;i++)1==n[i].invoiceType&&(e.invoiceListPu=n[0]),2==n[i].invoiceType&&(e.invoiceListzhuan=n[1],o=n[1].licenseImgsJson.split(","),e.picture={tax:o[0],bank:o[1],people:o[2],mes:o[3]})}})};a(),e.addPictures=function(t){n.open({windowClass:"console img_console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1,count:1}}}}).result.then(function(n){"tax"==t?e.picture.tax=n.data:"bank"==t?e.picture.bank=n.data:"people"==t?e.picture.people=n.data:"mes"==t&&(e.picture.mes=n.data),i.pushForCurrentRoute("upload.success","notify.success")})};var s=function(){return e.picture.tax?e.picture.bank?e.picture.people?!!e.picture.mes||(e.authError="请上传开票信息加盖公章",!1):(e.authError="请上传一般纳税人资质证明",!1):(e.authError="请上传银行许可证",!1):(e.authError="请上传税务登记证",!1)};e.submit=function(n){if(!e.invoice.receiver)return void(e.authError="请填写收件人");if(!e.invoice.phone)return void(e.authError="请填写联系电话");if(!e.invoice.address)return void(e.authError="请填写收货地址");var n={orderIds:r.orderIds,receiver:e.invoice.receiver,address:e.invoice.address,phone:e.invoice.phone};if(1==e.invoiceStatus&&(n.invoiceType=1,n.title=e.invoiceListPu.title),2==e.invoiceStatus){if(!s())return!1;n.invoiceType=2,n.title=e.invoiceListzhuan.title,n.licenseImgsJson=e.picture.tax+","+e.picture.bank+","+e.picture.people+","+e.picture.mes}3==e.invoiceStatus&&(n.invoiceType=3),t.saveOrderInvoice(n).then(function(t){t.data.success&&(e.$close(n),i.pushForCurrentRoute("save.success","notify.success"))})},e.saveUserInvoice=function(n){if(!e.invoice.receiver)return void(e.authError="请填写收件人");if(!e.invoice.phone)return void(e.authError="请填写联系电话");if(!e.invoice.address)return void(e.authError="请填写收货地址");var n={};if(n.invoiceDeliver={receiver:e.invoice.receiver,address:e.invoice.address,phone:e.invoice.phone},n.invoiceList=[],e.invoiceListPu.title&&n.invoiceList.push({invoiceType:e.invoiceListPu.invoiceType,title:e.invoiceListPu.title}),e.invoiceListzhuan.title){if(!e.picture.tax)return void(e.authError="请上传税务登记证");if(!e.picture.bank)return void(e.authError="请上传银行许可证");if(!e.picture.people)return void(e.authError="请上传一般纳税人资质证明");if(!e.picture.mes)return void(e.authError="请上传开票信息加盖公章");var o={invoiceType:e.invoiceListzhuan.invoiceType,title:e.invoiceListzhuan.title,licenseImgsJson:e.picture.tax+","+e.picture.bank+","+e.picture.people+","+e.picture.mes};n.invoiceList.push(o)}t.saveUserInvoice(n).then(function(t){t.data.success&&(r.view?e.editInfo.isEditable=!1:e.$close(n),i.pushForCurrentRoute("save.success","notify.success"))})},e.cancel=function(){e.$close()}}]),angular.module("usercenter.relAccount",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.relAccount").controller("RelAccountCtrl",["$rootScope","$scope","$window","$routeParams","usercenterService","security","$modal","ModalService","$location","userinfo","i18nNotifications","$translate",function(e,t,n,i,r,o,a,s,c,l,d,u){t.user=l,t.bindAccount=function(){return t.user.email?t.user.password?void r.relAccount(l.id,t.user.email,t.user.password).then(function(e){if(200==e.data.code){d.pushForCurrentRoute("email.save.success","notify.success"),/qq/gi.test(t.user.loginName)&&(t.relType="qq"),/weixin/gi.test(t.user.loginName)&&(t.relType="weixin"),/weibo/gi.test(t.user.loginName)&&(t.relType="weibo");var n={type:t.relType,email:angular.copy(t.user.email)};t.$close(n)}else t.relErr=e.data.msg},function(e){t.$dismiss()}):(t.relErr=u.instant("usercenter.account.PASSWORD_ERROR"),void $(".third-pwd").focus()):(t.relErr=u.instant("usercenter.account.ACCOUNT_ERROR"),void $(".third-name").focus())},t.checkUpperCase=function(){/[A-Z]/g.test(t.user.email)&&(t.user.email=t.user.email.toLowerCase(),t.relErr=u.instant("usercenter.account.EMAIL_TIP"))},t.cancel=function(){t.$dismiss()}}]),angular.module("usercenter.relEmail",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.relEmail").controller("RelEmailCtrl",["$rootScope","$scope","$window","$routeParams","usercenterService","security","$modal","ModalService","$location","userinfo","i18nNotifications","$translate",function(e,t,n,i,r,o,a,s,c,l,d,u){switch(t.title=l.title,t.userinfo=l,t.title){case u.instant("usercenter.account.REL_EMAIL"):t.dec=u.instant("usercenter.account.REL_EMAIL_DESC");break;case u.instant("usercenter.account.VALIDATE_EMAIL"):t.dec=u.instant("usercenter.account.VALIDATE_EMAIL_DESC");break;case u.instant("usercenter.account.CHANGE_EMAIL"):t.dec=u.instant("usercenter.account.CHANGE_EMAIL")}t.checkEmailFormat=function(e){var n=/^([a-zA-Z0-9]+[_|\_|\.|-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[\.|-]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return n.test(t.userinfo.email)?(t.emailFormatErr="",!0):(t.emailFormatErr=u.instant("usercenter.account.REL_EMAIL_TIP"),!1)},t.checkPassFormat=function(e){return e.password?(t.passFormatErr="",!0):(t.passFormatErr=u.instant("usercenter.account.PASSWORD_ERROR"),$(".email-pwd").focus(),!1)},t.relEmail=function(e){t.checkEmailFormat(e)&&t.checkPassFormat(e)&&(null==t.userinfo.checkEmail?t.firstRel=!1:t.firstRel=!0,r.relEmail(t.userinfo.email,t.userinfo.password,t.firstRel).then(function(e){200==e.data.code?(t.relErr="",s.openMsgDialog({msg:"申请绑定成功,已向您的邮箱发送验证邮件,请注意查收。"},function(){t.$dismiss()})):(t.firstRel=!0,t.relErr=e.data.msg)},function(e){}))},t.checkUpperCase=function(){/[A-Z]/g.test(t.userinfo.email)&&(t.userinfo.email=t.userinfo.email.toLowerCase(),t.relErr=u.instant("usercenter.account.EMAIL_TIP"))},t.cancel=function(){t.$dismiss()}}]),angular.module("usercenter.relRegisterAccount",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.relRegisterAccount").controller("RelRegisterAccountCtrl",["$rootScope","$scope","$window","$routeParams","usercenterService","security","$modal","ModalService","$location","userinfo","i18nNotifications","localizedMessages","$translate",function(e,t,n,i,r,o,a,s,c,l,d,u,p){t.user=l,t.user.agreement=!0;var h=!1;t.cancel=function(){t.$dismiss("cancel")},t.registerAccount=function(){if(t.userNotExist&&t.checkUsername()&&t.checkPassword()&&t.checkRepeatPassword())if(t.user.password===t.user.repeatPassword&&t.user.agreement){if(h)return;h=!0,r.relAccount(l.id,t.user.email,t.user.password,!0).then(function(e){if(h=!1,200==e.data.code){d.pushForCurrentRoute("email.save.success","notify.success"),/qq/gi.test(t.user.loginName)&&(t.relType="qq"),/weixin/gi.test(t.user.loginName)&&(t.relType="weixin"),/weibo/gi.test(t.user.loginName)&&(t.relType="weibo");var n={type:t.relType,email:angular.copy(t.user.email)};t.$close(n)}else t.relErr=e.data.msg},function(e){h=!1,t.regErr=u.get("register.error.serverError",{exception:x}),t.$dismiss()})}else t.user.password!=t.user.repeatPassword?t.regErr=u.get("register.error.match"):t.regErr=u.get("register.error.agreement")},t.checkUsername=function(){if(t.user.email){if(/^[-_a-z0-9\.@]{6,40}$/g.test(t.user.email))return t.checkUniqueness(t.user.email),!0;t.usernameError=p.instant("usercenter.account.REG_ACCOUNT_ERR2")}else t.usernameError=p.instant("usercenter.account.REG_ACCOUNT_ERR1");return!1},t.checkUniqueness=function(e){o.checkUniqueness(e).success(function(e){t.userNotExist=e.success,t.userNotExist?t.usernameError=null:t.usernameError=p.instant("usercenter.account.REG_ACCOUNT_ERR3")})},t.checkPassword=function(){if(t.user.password){if(/^[a-zA-Z0-9]{6,16}$/g.test(t.user.password))return t.passError=null,!0;t.passError=p.instant("usercenter.account.REG_PWD_ERR2")}else t.passError=p.instant("usercenter.account.REG_PWD_ERR1");return!1},t.checkRepeatPassword=function(){if(t.user.repeatPassword){if(t.user.repeatPassword==t.user.password)return t.rPassError="",!0;t.rPassError=p.instant("usercenter.account.REG_PWD_ERR4")}else t.rPassError=p.instant("usercenter.account.REG_PWD_ERR3");return!1}}]),angular.module("usercenter.branch.reset",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.branch.reset").controller("ResetBranchPassCtrl",["$rootScope","$scope","$window","$routeParams","usercenterService","security","$modal","ModalService","$location","branch","i18nNotifications",function(e,t,n,i,r,o,a,s,c,l,d){t.branch=l,t.reset=function(){r.resetBranchPass(l.id)},t.cancel=function(){t.$dismiss()},t.$on("reset.branch.success",function(){t.$close()})}]),angular.module("usercenter.apply",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.apply").controller("ApplyCtrl",["$rootScope","$scope","usercenterService","$modal","ModalService","i18nNotifications","MineService","userinfo","$translate","$timeout",function(e,t,n,r,o,a,s,c,l,d){function u(){0===I?(t.isCodeAccessiable=!1,t.codeTip="获取验证码",I=60):(t.isCodeAccessiable=!0,t.codeTip="重新发送("+I+")",d(function(){I--,u()},1e3))}t.applyInfo={},t.applyInfo.nick=c.nick,t.invoiceStat=c.invoice,t.actionerror="",t.serverLabel=[],t.cateLabel=[],t.payLabel=[];var p;t.applyXiuke=!0,t.title=c.title,0===c.status||3===c.status?(p=0,t.applyXiuke=!0):(p=1,t.applyXiuke=!1);var h=function(e){n.getAPPlyMessage(e).then(function(n){"province"===e?(t.serverLabel=n.data.list,n.data.list.length>0&&(t.moreArea=!0)):"company_industry"===e?(t.cateLabel=n.data.list,n.data.list.length>0&&(t.moreLabel=!0)):"payType"===e&&(t.payLabel=n.data.list)})};h("province"),h("company_industry"),h("payType"),t.cancel=function(){t.$dismiss()},t.cate_cancel=function(e){for(var n=0;n<t.cateLabel.length;n++)if(t.cateLabel[n].ischecked=!1,t.cateSelected.length>0)for(var i=0;i<t.cateSelected.length;i++)t.cateLabel[n].id===t.cateSelected[i].id&&(t.cateLabel[n].ischecked=!0);t.cateError="",setTimeout(function(){$(e.target).parents(".dropdown.open").trigger("click")})},t.server_cancel=function(e){for(i=0;i<t.serverLabel.length;i++)if(t.serverLabel[i].ischecked=!1,t.serverSelected.length>0)for(k=0;k<t.serverSelected.length;k++)t.serverLabel[i].id===t.serverSelected[k].id&&(t.serverLabel[i].ischecked=!0);setTimeout(function(){$(e.target).parents(".dropdown.open").trigger("click")}),t.serverError=""},t.scene_cancel=function(e){for(i=0;i<t.myShowScene.length;i++)if(t.myShowScene[i].ischecked=!1,t.sceneSelected.length>0)for(k=0;k<t.sceneSelected.length;k++)t.myShowScene[i].id===t.sceneSelected[k].id&&(t.myShowScene[i].ischecked=!0);setTimeout(function(){$(e.target).parents(".dropdown.open").trigger("click")}),t.sceneError=""},t.checkIntroFormat=function(e){return e.shortIntroduction?countCharacters(e.shortIntroduction)>30?(t.introError="简短介绍不能超过30个字符",!1):(t.introError="",!0):(t.introError="请填写简短介绍",!1)},t.checkIntroFormat1=function(e){return e.introduction?countCharacters(e.introduction)>400?(t.introError1="秀客介绍不能超过400个字符",!1):(t.introError1="",!0):(t.introError1="请填写秀客介绍",!1)},n.getUserScene().then(function(e){e.data.list.length>0?t.myShowScene=e.data.list:t.myShowScene=null});var g=[];t.sceneSelected=[],t.sceneSelect=function(e,n,i){return g=[],angular.forEach(t.myShowScene,function(e){e.ischecked&&g.push({code:e.code,name:e.name})}),3!==g.length?(t.sceneError="请选择三个代表作品",!1):(t.sceneSelected=g,t.sceneNull="",void(i&&(setTimeout(function(){$(n.target).parents(".dropdown.open").trigger("click")}),t.sceneError="")))};var f=function(){return 3!==t.sceneSelected.length?(t.sceneNull="请选择三个代表作品",!1):(t.sceneNull="",!0)},m=[],v=[];t.serverSelected=[],t.serverSubmit=function(e,n,i){return m=[],angular.forEach(t.serverLabel,function(e){e.ischecked&&m.push({name:e.name,id:e.id})}),m.length<=0?void(t.serverError="请选择服务地域"):m.length>3?void(t.serverError="服务地域不能超过3个"):(t.serverSelected=m,void(i&&(setTimeout(function(){$(n.target).parents(".dropdown.open").trigger("click")}),t.serverError="",t.serverNull="")))};var y=function(){return t.serverSelected.length<=0||t.serverSelected.length>3?(t.serverNull="请选择1-3个服务地域",!1):(t.serverNull="",!0)},b=[],w=[];t.cateSelected=[],t.queren=function(e,n,i){return b=[],angular.forEach(t.cateLabel,function(e){e.ischecked&&b.push({name:e.name,id:e.id})}),b.length<=0?void(t.cateError="请选择擅长领域"):b.length>3?void(t.cateError="擅长领域不能超过3个"):(t.cateSelected=b,t.cateNull="",void(i&&(setTimeout(function(){$(n.target).parents(".dropdown.open").trigger("click")}),t.cateError="")))};var E=function(){return t.cateSelected.length<=0||t.cateSelected.length>3?(t.cateNull="请选择1-3个擅长领域",!1):(t.cateNull="",!0)},S=[],x=function(){S=[];var e=!1;return angular.forEach(t.payLabel,function(t){t.ischecked&&(S.push(t.id),e=!0)}),S=S.join(","),e?(t.payError="",!0):(t.payError="请选择支付方式",!1)},T=/^[0-9]*$/;t.checkQQFormat=function(e){return e.qq&&!T.test(e.qq)?(t.qqError="qq填写格式错误",!1):e.qq?(t.qqError="",!0):(t.qqError="请填写QQ号码",!1)};var C=function(e){return e.wechat?(t.wechatError="",!0):(t.wechatError="请填写微信号",!1)};t.checkEmailFormat=function(e){var n=/^([a-zA-Z0-9]+[_|\_|\.|-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[\.|-]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return e.email&&!n.test(e.email)?(t.emailError="邮箱格式不正确",!1):e.email?(t.emailError="",!0):(t.emailError="邮箱不能为空",!1)},t.checkCode=function(e){return e.code?(t.codeError="",!0):(t.codeError="请输入手机验证码",!1)},t.getCode=function(e,i){return e.phone?(t.telError="",void n.relMobileCode(e.phone,i).then(function(e){e.data.success?u():t.telError=e.data.msg})):(t.telError="请填写手机号码",!1)};var I=60;t.checkFormFormat=function(e){return!!(t.checkIntroFormat(e)&&t.checkIntroFormat1(e)&&f()&&y()&&E()&&x()&&t.checkQQFormat(e)&&C(e)&&t.checkEmailFormat(e))},t.submit=function(e){if(t.checkFormFormat(e)){for(R&&!R.checkPhone&&1!==R.checkPhone&&t.checkCode(e),v=[],w=[],k=0;k<t.cateSelected.length;k++)w.push(t.cateSelected[k].id);for(_cateSelected2=w.join(","),i=0;i<t.serverSelected.length;i++)v.push(t.serverSelected[i].id);_serverSelected2=v.join(",");var r={shortIntroduction:e.shortIntroduction,introduction:e.introduction,represent1:t.sceneSelected[0].code+"_"+t.sceneSelected[0].name,represent2:t.sceneSelected[1].code+"_"+t.sceneSelected[1].name,represent3:t.sceneSelected[2].code+"_"+t.sceneSelected[2].name,qq:e.qq,wechat:e.wechat,phone:e.phone,email:e.email,addr:_serverSelected2||"",pay:S||"",good:_cateSelected2||"",code:e.code,type:p};n.saveApplyInfo(r).then(function(e){e.data.success?(t.applyInfo=e.data.map.status,a.pushForCurrentRoute("visitor.apply","notify.success"),t.$close(t.applyInfo)):t.authError=e.data.msg})}},t.checkFormFormat2=function(e){return!!(t.checkIntroFormat(e)&&t.checkIntroFormat1(e)&&f()&&y()&&E()&&x()&&t.checkQQFormat(e)&&C(e)&&t.checkEmailFormat(e))},t.reset=function(e){if(t.sceneSelect(),t.serverSubmit(),t.queren(),t.checkFormFormat2(e)){for(w=[],k=0;k<t.cateSelected.length;k++)w.push(t.cateSelected[k].id);for(_cateSelected2=w.join(","),v=[],i=0;i<t.serverSelected.length;i++)v.push(t.serverSelected[i].id);_serverSelected2=v.join(",");var r={nick:t.applyInfo.nick,shortIntroduction:e.shortIntroduction,introduction:e.introduction,represent1:t.sceneSelected[0].code+"_"+t.sceneSelected[0].name,represent2:t.sceneSelected[1].code+"_"+t.sceneSelected[1].name,represent3:t.sceneSelected[2].code+"_"+t.sceneSelected[2].name,qq:e.qq,wechat:e.wechat,email:e.email,addr:_serverSelected2||"",pay:S||"",good:_cateSelected2||"",type:p,phone:e.phone,code:e.code};n.resetApplyInfo(r).then(function(e){e.data.success?(a.pushForCurrentRoute("visitor.apply","notify.success"),t.$close({applyInfoNew:r,status:e.data.map.status})):t.authError=e.data.msg})}},t.showPhone=!0;var R;0!==c.status&&d(function(){n.getVisitorMsg().then(function(e){if(e.data.obj){R=t.applyInfo=e.data.obj;var n=angular.copy(t.applyInfo.phone);R.checkPhone&&1==R.checkPhone&&(t.showPhone=!1,
t.$watch("applyInfo.phone",function(e,i){e&&e!==n?t.showPhone=!0:t.showPhone=!1}));for(var i=R.represent1,r=i.substr(0,i.indexOf("_")),o=R.represent2,a=o.substr(0,o.indexOf("_")),s=R.represent3,c=s.substr(0,s.indexOf("_")),l=0;l<t.myShowScene.length;l++)(t.myShowScene[l].code===r||t.myShowScene[l].code===a||t.myShowScene[l].code===c)&&(t.myShowScene[l].ischecked=!0,t.sceneSelected.push(t.myShowScene[l]));var d=R.tagList;for(l=0;l<d.length;l++){for(var u=0;u<t.serverLabel.length;u++)d[l].tagId===t.serverLabel[u].id&&(t.serverLabel[u].ischecked=!0,t.serverSelected.push({name:d[l].name,id:d[l].tagId}));for(var p=0;p<t.payLabel.length;p++)d[l].tagId===t.payLabel[p].id&&(t.payLabel[p].ischecked=!0);for(var h=0;h<t.cateLabel.length;h++)d[l].tagId===t.cateLabel[h].id&&(t.cateLabel[h].ischecked=!0,t.cateSelected.push({name:d[l].name,id:d[l].tagId}))}}})},1e3),t.invoice=function(){r.open({windowClass:"six-contain",templateUrl:"usercenter/console/invoice.tpl.html",controller:"InvoiceCtrl",scope:t,resolve:{userinfo:function(){return{}}}}).result.then(function(e){},function(){})}}]),angular.module("usercenter.upgrade",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.upgrade").controller("UsercenterupgradeCtrl",["$rootScope","$scope","$window","$translate","usercenterService","security","$modal","ModalService","i18nNotifications","$timeout","user",function(e,t,n,i,r,o,a,s,c,l,d){function u(){0===p?(t.isCodeAccessiable=!1,t.codeTip=i.instant("usercenter.account.CODE_TIP1"),p=60):(t.isCodeAccessiable=!0,t.codeTip=i.instant("usercenter.account.CODE_TIP2")+"("+p+")",l(function(){p--,u()},1e3))}t.companyInfo={id:d.id},t.checkName=function(e){return e.name?countCharacters(e.name)>40?(t.nameError="企业名称不能超过40个字符",!1):(t.nameError="",!0):(t.nameError="请填写企业名称",!1)},t.checkEmail=function(e){var n=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return e.email&&!n.test(e.email)?(t.emailError="请正确填写邮箱",!1):e.email?(t.emailError="",!0):(t.emailError="请填写企业邮箱",!1)},t.checkcontacts=function(e){return e.contacts?countCharacters(e.contacts)>30?(t.contactsError="联系人不能超过30个字符",!1):(t.contactsError="",!0):(t.contactsError="请填写联系人",!1)},t.checkCode=function(e){return e.code?(t.codeError="",!0):(t.codeError="请输入手机验证码",!1)},t.getCode=function(e){return e.mobile?(t.telError="",void r.companyMobile(e.mobile).then(function(e){e.data.success?u():t.telError=e.data.msg})):(t.telError="请填写手机号码",!1)};var p=60;t.checkFormFormat=function(e){return!!(t.checkName(e)&&t.checkEmail(e)&&t.checkcontacts(e)&&t.checkCode(e))},t.upgradeCompanyMessage=function(n){t.checkFormFormat(n)&&r.saveCompanyInfo(n).then(function(i){i.data.success?(c.pushForCurrentRoute("account.success","notify.success"),e.$broadcast("companyState"),t.$close(n.mobile)):t.codeError=i.data.msg})},t.quXiao=function(){t.$dismiss()}}]),angular.module("message",[]),angular.module("message").controller("MessageCtrl",["$scope","$rootScope","usercenterService",function(e,t,n){e.pageSize=10,e.currentPage={msgCurrentPage:1,branchCurrentPage:1},e.getUserMsg=function(t){var i=t;n.getNewMessage(i,e.pageSize).then(function(t){angular.forEach(t.data.list,function(e,t){1==e.bizType?e.type="系统通知":2==e.bizType?e.type="审核通知":3==e.bizType&&(e.type="活动通知")}),e.Msgs=t.data.list,e.msgCount=t.data.map.count,e.msgNumPages=Math.ceil(e.msgCount/e.pageSize)})},e.getUserMsg(e.pageNo),e.$watch("currentPage.msgCurrentPage",function(t,n){t!=n&&(e.getUserMsg(t),e.toPage=t)}),e.pageChanged=function(t,n){e.currentPage[n]=t},e.setRead=function(i){var r=[];angular.forEach(i,function(e,t){1==e.status&&this.push(e.id)},r);var o=r.join();n.setRead(o).then(function(n){200==n.data.code&&(t.$broadcast("minusCount",r.length),e.newMsgCount=0,angular.forEach(i,function(e,t){e.status=2}))})}}]),angular.module("usercenter.request",["services.usercenter","app.directives.qrcode"]),angular.module("usercenter.request").controller("UsercenterrequestCtrl",["$rootScope","$scope","$window","$routeParams","usercenterService","security","$modal","ModalService","$location",function(e,t,n,i,r,o,a,s,c){t.PREFIX_CLIENT_HOST=PREFIX_HOST,t.currentUser=o.currentUser,t.cancel=function(){t.$dismiss()}}]),angular.module("usercenter.account",["usercenter.relEmail"]),angular.module("usercenter.account").controller("UsercenterAccountCtrl",["$location","$rootScope","$scope","$window","usercenterService","$modal","ModalService","i18nNotifications","security","thirdpartyService","$translate","$timeout",function(e,t,n,i,r,o,a,s,c,l,d,u){function p(){n.progress="0",1==n.userinfo.checkEmail&&1==n.userinfo.checkPhone&&(n.redColor=!1,u(function(){n.progress="90"},100)),1!=n.userinfo.checkEmail&&1!=n.userinfo.checkPhone&&(u(function(){n.progress="20"},100),n.redColor=!0),(1!=n.userinfo.checkEmail&&1==n.userinfo.checkPhone||1==n.userinfo.checkEmail&&1!=n.userinfo.checkPhone)&&(n.redColor=!1,u(function(){n.progress="60"},100))}function h(e){e&&(e.state&&/WECHAT_STATE/.test(e.state)?(y={code:e.code,type:"weixin"},l.bindAccountCommon(y)):l.qqBindAccount(e))}n.PREFIX_CLIENT_HOST=PREFIX_HOST,n.XdpageSize=10,n.page={},n.pageChanged=function(e){return 1>e||e>n.branchesCount/10+1?void alert("此页超出范围"):(n.currentPage=e,void n.getBranches(e))},n.getBranches=function(e){r.getBranches(n.XdpageSize,e).then(function(e){e.data.success&&(n.branches=e.data.list,n.branchesCount=e.data.map.count,n.page.currentPage=e.data.map.pageNo,n.toPage=e.data.map.pageNo,n.branchesNumPages=Math.ceil(n.branchesCount/n.XdpageSize),g())},function(){})},n.getBranches(n.pageNo),n.branchName={};var g=function(){var i=e.search().branchid;if(i)for(var r=0;r<n.branches.length;r++)n.branches[r].id==i&&(n.branchName.name=n.branches[r].loginName);else t.branchid="",e.search("branchid",null)};n.$watch("branchid",function(e,t){e!=t&&g()}),n.changeCurrent=function(){t.branchid="",e.search("branchid",null)},n.selectBranch=function(n){t.branchid=n.id,e.path("main"),e.search({branchid:t.branchid})},n.$watch("userinfo",function(e){e&&p()});var f=/^EQS.*qq$/,m=/^EQS.*weixin$/;n.qqShow=!0,n.weixinShow=!0,f.test(c.currentUser.loginName)&&(n.qqShow=!1),m.test(c.currentUser.loginName)&&(n.weixinShow=!1);var v=null;n.goReset=function(){v=o.open({windowClass:"six-contain",templateUrl:"usercenter/tab/reset.tpl.html",controller:"UsercenterAccountCtrl",scope:n}).result.then(function(){v=null},function(){v=null})},n.checkOldPassword=function(){return n.password.old?(n.oldPassError="",!0):(n.oldPassError="原始密码不能为空",!1)},n.checkPassword=function(){if(n.password.newPw){if(/^[a-zA-Z0-9]{6,16}$/g.test(n.password.newPw))return n.passError="",!0;n.passError="密码为6~16个字符(英文字母或数字，区分大小写)"}else n.passError="新密码不能为空";return!1},n.checkRepeatPassword=function(){if(n.password.confirm){if(n.password.confirm==n.password.newPw)return n.rPassError="",!0;n.rPassError="两次密码输入不一致，请重新输入"}else n.rPassError="确认密码不能为空";return!1},n.reset=function(){if(n.checkOldPassword()&&n.checkPassword()&&n.checkRepeatPassword()){if(angular.equals(n.master,n.password))return void(n.authError="请不要重复提交！");n.oldPassError="",n.passError="",n.rPassError="",c.resetPassword(n.password.old,n.password.newPw).then(function(e){e.data.success?(s.pushForCurrentRoute("reset.psw.success","notify.success"),n.master=angular.copy(n.password),n.$close(n.master)):n.oldPassError=e.data.msg})}},n.quXiao=function(){n.$dismiss()},n.manageBranch=function(e){var t=e;if(!e)if(3==c.currentUser.memberType){if(n.branchesCount>=100)return void a.openMsgDialog({msg:"子账号数量已达到限制!"})}else if(2==c.currentUser.memberType){if(n.branchesCount>=50)return void a.openMsgDialog({msg:"子账号数量已达到限制!"})}else if(n.branchesCount>=30)return void a.openMsgDialog({msg:"子账号数量已达到限制!"});o.open({windowClass:"console six-contain branch-contain",templateUrl:"usercenter/console/branch.tpl.html",controller:"BranchCtrl",resolve:{branch:function(){return e}}}).result.then(function(i){e||(e={}),i.dept&&(e.deptId=i.dept.id,e.deptName=i.dept.name),e.name=i.name,e.id=i.id,e.extPermi=i.extPermi,t?n.branchesCount++:(e.loginName=i.loginName,e.status=1,e.regTime=(new Date).getTime(),n.branches.unshift(e),n.branches.length>10&&n.branches.splice(n.branches.length-1,1)),n.$emit("addBranch",e)},function(){})},n.openBranch=function(e,t){r.openBranch(e.id,t).then(function(n){n.data.success&&(t?(e.status=1,s.pushForCurrentRoute("branch.open.success","notify.success")):(e.status=2,s.pushForCurrentRoute("branch.close.success","notify.success")))},function(){alert("服务器异常")})},n.$on("rel.success",function(e,t){s.pushForCurrentRoute("mail.rel.success","notify.success"),"weixin"==t?n.wxRel=!0:"qq"==t&&(n.qqRel=!0)}),n.$watch("currentPage.branchCurrentPage",function(e,t){e!=t&&(n.getBranches(e),n.branchToPage=e)}),n.checkMobile=function(e){o.open({windowClass:"six-contain mobile-contain",templateUrl:"usercenter/console/checkMobile.tpl.html",controller:"CheckMobileCtrl",scope:n,resolve:{userinfo:function(){return{title:e,phone:n.userinfo.phone}}}}).result.then(function(e){n.userinfo.phone=e,n.userinfo.checkPhone=1},function(){})},n.createAccount=function(){n.emailAccount=!1,o.open({windowClass:"six-contain",templateUrl:"usercenter/console/register.tpl.html",controller:"RelRegisterAccountCtrl",scope:n,resolve:{userinfo:function(){return{id:n.userinfo.id}}}}).result.then(function(t){n.userinfo.noRel=null,n.userinfo.loginName=t.email,/qq/gi.test(t.type)&&(n.qqRel=!0),/weixin/gi.test(t.type)&&(n.wxRel=!0),/weibo/gi.test(t.type)&&(n.wbRel=!0),e.search("bindemail",null)},function(){e.search("bindemail",null)})},n.relAccount=function(t){n.emailAccount=!1,o.open({windowClass:"six-contain",templateUrl:"usercenter/console/relAccount.tpl.html",controller:"RelAccountCtrl",scope:n,resolve:{userinfo:function(){return{id:n.userinfo.id}}}}).result.then(function(t){n.userinfo.noRel=null,n.userinfo.loginName=t.email,/qq/gi.test(t.type)&&(n.qqRel=!0),/weixin/gi.test(t.type)&&(n.wxRel=!0),/weibo/gi.test(t.type)&&(n.wbRel=!0),e.search("bindemail",null)},function(){e.search("bindemail",null)})},n.relEmail=function(e){return n.userinfo.noRel?(alert("请先绑定账号"),void n.createAccount()):void o.open({windowClass:"six-contain",templateUrl:"usercenter/console/relEmail.tpl.html",controller:"RelEmailCtrl",scope:n,resolve:{userinfo:function(){return{id:n.userinfo.id,email:n.userinfo.email,checkEmail:n.userinfo.checkEmail,title:e}}}}).result.then(function(){},function(){})},n.verifyEmail=function(){r.verifyEmail().then(function(e){200==e.data.code&&a.openMsgDialog({msg:"申请绑定成功,已向您的邮箱发送验证邮件,请注意查收。"},function(){})},function(e){})},n.bindThirdAccount=function(e){return n.userinfo.noRel?(alert("请先绑定账号"),void n.createAccount()):void l.openThirtyPartyWindow(e)},n.unbindRelation=function(e){l.unbindRelation(e)},n.$on("mail.unbind.success",function(e,t){s.pushForCurrentRoute("mail.unbind.success","notify.success"),"weixin"==t?n.wxRel=!1:"qq"==t&&(n.qqRel=!1)});var y;i.setValue=function(e){n.bindParam=e,h(n.bindParam),n.$apply()},n.emailAccount=!1,n.upgradeCompany=function(){"eqs"==n.userinfo.loginName.substr(0,3)&&null==n.userinfo.email?n.emailAccount=!0:o.open({windowClass:"seven-contain",templateUrl:"usercenter/console/upgrade_company.tpl.html",controller:"UsercenterupgradeCtrl",resolve:{user:function(){return{id:n.userinfo.id}}}}).result.then(function(e){n.userinfo.phone=e,n.userinfo.checkPhone=1,c.currentUser.type=2},function(){})},n.companyMes=!0,n.$on("companyState",function(){n.companyInfo||(n.companyInfo={}),n.companyMes=!1,n.userinfo.type=2})}]),angular.module("usercenter.member",[]),angular.module("usercenter.member").controller("MemberCtrl",["$scope","$modal","usercenterService","ModalService",function(e,t,n,i){e.pageNo=1,e.pageSize=10,e.setUserInfo=function(){if(1==e.currentUser.type||12==e.currentUser.type)e.userType="个人用户";else if(2==e.currentUser.type?e.upgradeInfo="已升级":e.upgradeInfo="免费升级",3==e.currentUser.type)e.userType="高级用户";else if(21==e.currentUser.type)e.userType="企业子用户";else if(4==e.currentUser.type)e.userType="服务商用户";else if(e.userType="企业用户",e.currentUser.memberType){if(e.currentUser.expiryTime){var t=(new Date).getTime();e.currentUser.expiryTime<=t&&(e.currentUser.memberType=null)}1==e.currentUser.memberType?e.userPay="(体验版)":2==e.currentUser.memberType?e.userPay="(高级版)":3==e.currentUser.memberType?e.userPay="(专业版)":4==e.currentUser.memberType&&(e.userPay="(畅享版)")}else e.userPay=""},e.setUserInfo(),e.memberPrivileges=["拥有编辑器组件，适用于个人企业用户，提供全面便捷的推广渠道助力企业自我营销和宣传","拥有编辑器组件，适用于个人企业用户，提供全面便捷的推广渠道助力企业自我营销和宣传","拥有编辑器组件，适用于个人企业用户，提供全面便捷的推广渠道助力企业自我营销和宣传","拥有编辑器组件，适用于个人企业用户，提供全面便捷的推广渠道助力企业自我营销和宣传","拥有编辑器组件，适用于个人企业用户，提供全面便捷的推广渠道助力企业自我营销和宣传","拥有编辑器组件，适用于个人企业用户，提供全面便捷的推广渠道助力企业自我营销和宣传"],e.getXdLog=function(t,i){e.xdType=t,e.currentPage=i,n.getXdlog(t,i,e.pageSize).then(function(t){if(t.data.success){e.xdLogs=t.data.list;for(var n=0;n<e.xdLogs.length;n++)2==e.xdLogs[n].type?e.xdLogs[n].xd="-"+e.xdLogs[n].xd:e.xdLogs[n].xd="+"+e.xdLogs[n].xd;e.totalItems=t.data.map.count,e.currentPage=t.data.map.pageNo,e.toPage=t.data.map.pageNo,e.numPages=Math.ceil(e.totalItems/e.pageSize)}})},e.getXdLog(null,1),e.pageChanged=function(t,n){return 1>n||n>e.numPages&&1!=n?void alert("此页超出范围"):(e.currentPage=n,e.toPage=n,void e.getXdLog(t,n))},e.getXdStatNum=function(){n.getXdStat().then(function(t){e.getXdStat=t.data.map})},e.getXdStatNum(),e.transferXd=function(){t.open({windowClass:"six-contain",templateUrl:"usercenter/transfer.tpl.html",controller:"UsercentertransferCtrl",resolve:{username:function(){return e.userinfo.loginName}}}).result.then(function(){e.getUserXd(),e.getXdlog(),e.getXdStatNum()},function(){})},e.openInvoice=function(){e.openInvoiceListModal()},e.openInvoiceListModal=function(){t.open({windowClass:"console seven-contain",templateUrl:"usercenter/console/invoice-list.tpl.html",controller:"GetInvoiceListCtrl"}).result.then(function(){},function(){})}}]).controller("PayMentCtrl",["$modal","$scope","qrCodeUrl","type","money","usercenterService","method",function(e,t,n,i,r,o,a){t.qrCodeUrl=n,t.money=r,t.type=i,t.paymented=function(){t.$close()},t.cancel=function(){t.$dismiss()},t.getWeChatUrl=function(){t.wechatUrl||("member"==a?o.getCompanyQrCode(i,0).then(function(e){e.data.success&&(t.wechatUrl=e.data.obj)}):o.getPayXdQrCode(i,0).then(function(e){e.data.success&&(t.wechatUrl=e.data.obj)}))}}]),angular.module("usercenter.privilege",[]),angular.module("usercenter.privilege").controller("PrivilegeCtrl",["$location","usercenterService","$scope","$modal","security","ModalService",function(e,t,n,i,r,o){n.tabid="corporateMember",n.$watch(function(){return r.currentUser},function(e){e&&(n.currentUser=e,n.changeMemberType())},!0),n.changeMemberType=function(){if(n.currentUser&&n.currentUser.expiryTime){var e=(new Date).getTime();n.currentUser.expiryTime<=e&&(n.currentUser.memberType=null)}},n.changeMemberType(),n.upgradeAccount=function(e,t){return 1!=n.currentUser.type||n.companyInfo&&0===n.companyInfo.status?1==n.currentUser.type&&n.companyInfo?void o.openMsgDialog({msg:"您不是企业会员,请先申请企业会员后再进行升级！"}):2!=n.currentUser.type?void o.openMsgDialog({msg:"尊敬的用户，您当前账号类型无法升级为企业用户！"}):void i.open({windowClass:"console",templateUrl:"usercenter/upgrade.tpl.html",controller:"UpgradeCtrl",resolve:{type:function(){return e},isRenew:function(){return t}}}).result.then(function(){},function(){}):void("eqs"==n.currentUser.loginName.substr(0,3)&&null==n.currentUser.email?o.openMsgDialog({msg:"第三方账号请先关联账号"}):o.openMsgDialog({msg:"尊敬的用户，请您先申请免费企业用户，通过审核后再次升级",btn:"我知道了"},function(){i.open({windowClass:"seven-contain",templateUrl:"usercenter/console/upgrade_company.tpl.html",controller:"UsercenterupgradeCtrl",resolve:{user:function(){return{id:n.user.id}}}}).result.then(function(){},function(){})},function(){}))},n.cancel=function(){n.$close()},n.upgradeCompany=function(){i.open({windowClass:"seven-contain",templateUrl:"usercenter/console/upgrade_company.tpl.html",controller:"UsercenterupgradeCtrl",resolve:{user:function(){return{id:n.user.id}}}}).result.then(function(){},function(){})}}]).controller("UpgradeCtrl",["$modal","$scope","type","usercenterService","ModalService","security","$location","isRenew",function(e,t,n,i,r,o,a,s){t.confirm=function(){i.getCompanyQrCode(n,1).then(function(a){t.$close();var c,l;if(1==n?(c=s?["99元","450元"]:["99元","499元"],l=[{name:"30天",value:1},{name:"180天",value:6}]):2==n?s?(c=["450元","800元"],l=[{name:"180天",value:1},{name:"365天",value:2}]):(c=["499元","900元"],l=[{name:"180天",value:1},{name:"365天",value:2}]):3==n?s?(c=["1.6万","3万"],l=[{name:"1年",value:1},{name:"2年",value:2}]):(c=["1.9万","3.2万"],l=[{name:"1年",value:1},{name:"2年",value:2}]):s?(c=["1800元","3200元"],l=[{name:"1年",value:1},{name:"2年",value:2}]):(c=["1999元","3600元"],l=[{name:"1年",value:1},{name:"2年",value:2}]),a.data.success){var d=a.data.obj;e.open({windowClass:"console",templateUrl:"usercenter/payment.tpl.html",controller:"PayMentCtrl",resolve:{qrCodeUrl:function(){return d},type:function(){return n},money:function(){return c},method:function(){return"member"},counts:function(){return l}},size:"lg"}).result.then(function(){i.getUserInfo().then(function(e){e.data.success&&(o.currentUser=e.data.obj)}),r.openMsgDialog({msg:"因网络原因，部分用户开通会有延迟",btn:"确定"},function(){t.openInvoice()})},function(){})}else r.openMsgDialog({msg:a.data.msg})})},t.openInvoice=function(){r.openConfirmDialog({msg:"是否开具发票？",confirmName:"是",cancelName:"否"},function(){t.openInvoiceListModal()},function(){a.path("/privilege")})},t.openInvoiceListModal=function(){e.open({windowClass:"console seven-contain",templateUrl:"usercenter/console/invoice-list.tpl.html",controller:"GetInvoiceListCtrl"}).result.then(function(){},function(){})},t.cancel=function(){t.$close()}}]).controller("PayMentCtrl",["$modal","$scope","qrCodeUrl","type","money","usercenterService","method","counts",function(e,t,n,i,r,o,a,s){t.qrCodeUrl=n,t.money=r[0],t.type=i,t.counts=s,t.payWay="alipay",s&&s.length>0&&(t.curentCount=s[0].value);var c={};c["alipay1"+t.curentCount]=n,t.paymented=function(){t.$close()},t.cancel=function(){t.$dismiss()},t.getWeChatUrl=function(e){t.payWay=e;var n=1;return"wechat"==t.payWay&&(n=0),c[t.payWay+""+n+t.curentCount]?void(t.qrCodeUrl=c[t.payWay+""+n+t.curentCount]):void("member"==a?o.getCompanyQrCode(i,n,t.curentCount).then(function(e){e.data.success&&(c[t.payWay+""+n+t.curentCount]=e.data.obj,t.qrCodeUrl=e.data.obj)}):o.getPayXdQrCode(i,n).then(function(e){e.data.success&&(c[t.payWay+""+n+t.curentCount]=e.data.obj,t.qrCodeUrl=e.data.obj)}))},t.setCount=function(e,n){t.curentCount=e,t.money=r[n];var a=1;if("wechat"==t.payWay&&(a=0),c[t.payWay+""+a+t.curentCount])return void(t.qrCodeUrl=c[t.payWay+""+a+t.curentCount]);var s=i,l=e;1==i&&6==e&&(s=2,l=1),o.getCompanyQrCode(s,a,l).then(function(e){e.data.success&&(c[t.payWay+""+a+t.curentCount]=e.data.obj,t.qrCodeUrl=e.data.obj)})}}]),angular.module("usercenter.tab.server",["services.usercenter","services.i18nNotifications"]),angular.module("usercenter.tab.server").controller("ServerTabCtrl",["$scope","$rootScope","usercenterService","$translate",function(e,t,n,i){e.showController={},e.goStep=function(t){e.step=t},e.bindDomain=function(){e.showController.agreeBind=!0},e.reApply=function(){e.isShowBindPanel=!0,e.showController.agreeBind=!1};var r=function(){n.getDomain().then(function(t){if(t.data.success)if(e.domainInfo=t.data.obj,e.model.day=t.data.obj.typeList[0],t.data.obj.id){e.isShowBindPanel=!1,e.domainInfo.ipAddress="202.173.11.90";var n=e.status=t.data.obj.status;1===n?(e.domainMes=i.instant("usercenter.server.DOMAIN_STATUS1"),e.unbind=!1,e.domainInfo.restTime=Math.floor((e.domainInfo.endDate-e.domainInfo.startDate)/864e5)):2===n?(e.domainMes=i.instant("usercenter.server.DOMAIN_STATUS2"),e.unbind=!1):3===n?(e.domainMes=i.instant("usercenter.server.DOMAIN_STATUS3"),e.unbind=!0):4===n?e.domainMes=i.instant("usercenter.server.DOMAIN_STATUS4"):(new Date).getTime()>t.data.obj.endDate&&(e.status=5,e.domainMes=i.instant("usercenter.server.DOMAIN_STATUS5"),e.unbind=!0)}else e.isShowBindPanel=!0})};r(),e.model||(e.model={});var o=e.model;e.checkDomainFormat=function(t){return t.url?(e.domainFormatErr="",!0):(e.domainFormatErr=i.instant("usercenter.server.WRITE_DNS"),!1)},e.checkDayFormat=function(t){return t.day?(e.dayFormatErr="",!0):(e.dayFormatErr=i.instant("usercenter.server.WRITE_DATE"),!1)},e.checkAppIdAndSecret=function(t){return t.appId&&!t.secretId?(e.appIdFormatErr=i.instant("usercenter.serverWRITE_APPSECRET"),!1):!t.appId&&t.secretId?(e.appSecretErr=i.instant("usercenter.server.WRITE_APPID"),!1):(e.appIdFormatErr="",e.appSecretErr="",!0)},e.submit=function(){if(e.checkDomainFormat(o)&&e.checkDayFormat(o)&&e.checkAppIdAndSecret(o))if(e.cost=o.day.label,e.xdCounts>=parseInt(e.cost,10)){var t={url:o.url,buyTime:o.day.value,appId:o.appId,secretId:o.secretId};n.bindDomain(t).then(function(t){t.data.success?(alert(i.instant("usercenter.server.DNS_COMMIT")),e.status=2,e.isShowBindPanel=!1,e.domainInfo.ipAddress="202.173.11.90",e.domainInfo.url=o.url):e.actionerror=t.data.msg},function(){alert(i.instant("usercenter.server.SERVER_ERROR"))})}else e.xiudian=!0}}]),angular.module("app.usercenter.tab",["usercenter.account","usercenter.member","usercenter.trash","usercenter.apply","usercenter.companyinfo","usercenter.invoice","usercenter.invoicelist"]),angular.module("usercenter.trash",[]),angular.module("usercenter.trash").controller("TrashCtrl",["$location","$rootScope","$scope","usercenterService","ModalService","$translate","fileService","MineService","sceneService","dataCacheService",function(e,t,n,i,r,o,a,s,c,l){n.PREFIX_CLIENT_HOST=PREFIX_HOST;var d=t.branchid;n.scene={type:null},n.pageSize=12,n.sceneCurrent={page:"",total:""},n.imageCurrent={page:"",total:""},n.historyTab={page:{}};var u=function(e){n.sceneHistory=e,"scene"==e?n.historyTab={pages:{currentPage:n.sceneCurrent.page,totalItems:n.sceneCurrent.total,pageSize:12}}:n.historyTab={pages:{currentPage:n.imageCurrent.page,totalItems:n.imageCurrent.total,pageSize:21}}};n.getMyScenes=function(e,t){n.sceneHistory=t,s.getMyHistoryScenes(e,n.pageSize,d).then(function(e){if(e.data.list&&e.data.list.length>0){n.myScenes=e.data.list;for(var i=0;i<n.myScenes.length;i++)n.myScenes[i].time=new Date(n.myScenes[i].delTime).getTime()+2592e5,n.myScenes[i].history=Math.round((n.myScenes[i].time-(new Date).getTime())/1e3/60/60/24);n.sceneCurrent.total=e.data.map.count,n.sceneCurrent.page=e.data.map.pageNo}else n.sceneTotalItems=0,n.sceneCurrent.total=0,n.sceneCurrent.page>1?n.getMyScenes(--n.sceneCurrent.page,"scene"):n.myScenes=[];u(t)})},n.getMyScenes(1,"scene"),n.deleteScene=function(e,t){r.openConfirmDialog({msg:"确定彻底删除此微课?"},function(){c.deleteSceneById(e,t).then(function(){n.getMyScenes(n.historyTab.pages.currentPage,"scene")})})},n.revoke=function(e){c.revoke(e).then(function(){n.getMyScenes(n.historyTab.pages.currentPage,"scene")})},n.$on("images.update",function(e,t,i){n.images=t.list;for(var r=0;r<n.images.length;r++)n.images[r].time=new Date(n.images[r].delTime).getTime()+2592e5,n.images[r].history=Math.round((n.images[r].time-(new Date).getTime())/1e3/60/60/24);n.imageCurrent.total=t.map.count,n.imageCurrent.page=t.map.pageNo,u(i)}),n.getImages=function(e,i){n.sceneHistory=i,a.userRecycle(e,21).success(function(e){e.success?t.$broadcast("images.update",e,i):alert(e.msg)}).error(function(){alert("网络连接超时，请稍后重试")})},n.$on("file.delete",function(e){n.getImages(n.historyTab.pages.currentPage,"image")}),n.deleteImg=function(e,t){r.openConfirmDialog({msg:"确定彻底删除此图片?"},function(){n.deleteFile(e,t)})},n.deleteFile=function(e,n){a.deleteFile1(e,n).success(function(e){e.success?t.$broadcast("file.delete"):alert(e.msg)}).error(function(){alert("网络连接超时，请稍后重试")})},n.imageRevoke=function(e){a.fileRevoke(e).success(function(e){e.success?(n.getImages(n.historyTab.pages.currentPage,"image"),l.clear("fileService")):alert(e.msg)}).error(function(){alert("网络连接超时，请稍后重试")})},n.pageChanged=function(e){return 1>e||e>n.historyTab.pages.totalItems/10+1?void alert(o.instant("main.customer.PAGE_OVERFLOW")):void("scene"==n.sceneHistory?n.getMyScenes(e,"scene"):n.getImages(e,"image"))}}]),angular.module("usercenter.transfer",["services.usercenter"]),angular.module("usercenter.transfer").controller("UsercentertransferCtrl",["$rootScope","$scope","$window","$routeParams","usercenterService","security","$modal","ModalService","$location","username","$translate",function(e,t,n,i,r,o,a,s,c,l,d){t.transfer=!0,t.userXd={toUser:"",xdCount:""},t.submit=!1,t.getUserXd=function(){r.getUserXd().then(function(e){e.data.success&&(t.xdCount=e.data.obj)})},t.getUserXd(),t.confirm=function(){t.submit=!0,t.getgiveXd()},t.checkEmailFormat=function(e){return e.toUser?e.toUser==l?(t.mailFormatErr=d.instant("usercenter.userinfo.ACCOUNT_ERROR2"),$(".username").addClass("error"),!1):(t.mailFormatErr="",!0):(t.mailFormatErr=d.instant("usercenter.userinfo.ACCOUNT_ERROR1"),$(".username").focus(),!1)},t.checkXdFormat=function(e){return/^\+?[1-9][0-9]*$/.test(e.xdCount)?t.userXd.xdCount>t.xdCount?(t.xdFormatErr=d.instant("usercenter.userinfo.XD_ERROR2"),!1):(t.xdFormatErr="",!0):(t.xdFormatErr=d.instant("usercenter.userinfo.XD_ERROR1"),!1)},t.getgiveXd=function(){t.checkEmailFormat(t.userXd)&&t.checkXdFormat(t.userXd)&&r.getgiveXd(t.userXd).then(function(e){200==e.data.code?t.$close():1003==e.data.code?t.mailFormatErr=e.data.msg:1010==e.data.code&&(t.xdFormatErr=e.data.msg)})},t.cancel=function(){t.$close()}}]),function(){angular.module("userCenter.userGuide",[]).controller("userCenterGuideCtrl",["$rootScope","$scope","security","$routeParams","$location",function(e,t,n,i,r){function o(e,n){var i=sessionStorage.getItem(l.id);e&&e[l.id]?e[l.id+"_isShow_"+l.type]?t.isFirstLogin=!1:(i||(t.isCompanyVip=n,t.isFirstLogin=!0,sessionStorage.setItem(l.id,!0)),n&&setTimeout(function(){t.isShow()},100)):(t.isFirstLogin=!0,t.isCompanyVip=n,c=c||{},c[l.id]=l.type,c[l.id+"_isShow_"+l.type]="2"==l.type,s(d,c),sessionStorage.setItem(l.id,!0))}function a(e){return window.localStorage?(c=JSON.parse(localStorage.getItem(e)),!!c&&c):null}function s(e,t){return window.localStorage?void localStorage.setItem(d,JSON.stringify(t)):null}var c,l=n.currentUser,d="userCenterGuide",u=null,p=r.path();if("1"==l.type&&p.indexOf("/account")>=0&&(u=a(d),o(u,!1),$("#companyVip").css("background","rgba(0,0,0,0.8")),"2"==l.type&&p.indexOf("/main")>=0){u=a(d),o(u,!0);var h=JSON.parse(localStorage.getItem("loginInfo")),g=JSON.parse(sessionStorage.getItem("emailGuide"));(!h.isShow||g)&&$("#companyVip").css("background","rgba(0,0,0,0.8")}t.showNextGuide=function(){t.isFirstLogin=!1,$("#companyVip").css("background","rgba(0,0,0,0")},t.isShow=function(){c=a(d),c[l.id+"_isShow_"+l.type]=!c[l.id+"_isShow_"+l.type],localStorage.setItem(d,JSON.stringify(c))}}])}(),function(){angular.module("userCenter.userGuideNext",[]).controller("userCenterGuideCtrlNext",["$rootScope","$scope","security","$routeParams","$location",function(e,t,n,i,r){function o(e,n){var i=sessionStorage.getItem(l.id);e&&e[l.id]?e[l.id+"_isShow_"+l.type]?t.isSecondLogin=!1:(i||(t.isCompanyVip=n,t.isSecondLogin=!0,sessionStorage.setItem(l.id,!0)),n&&setTimeout(function(){t.isShow()},100)):(t.isSecondLogin=!0,t.isCompanyVip=n,c=c||{},c[l.id]=l.type,c[l.id+"_isShow_"+l.type]="2"==l.type,s(d,c),sessionStorage.setItem(l.id,!0))}function a(e){return window.localStorage?(c=JSON.parse(localStorage.getItem(e)),!!c&&c):null}function s(e,t){return window.localStorage?void localStorage.setItem(d,JSON.stringify(t)):null}var c,l=n.currentUser,d="userCenterGuideNext",u=null,p=r.path();if("1"==l.type&&p.indexOf("/account")>=0&&(u=a(d),o(u,!1),$("#companyVip").css("background","rgba(0,0,0,0.8")),"2"==l.type&&p.indexOf("/main")>=0){u=a(d),o(u,!0);var h=JSON.parse(localStorage.getItem("loginInfo")),g=JSON.parse(sessionStorage.getItem("emailGuide"));(!h.isShow||g)&&$("#companyVip").css("background","rgba(0,0,0,0.8")}t.showNextGuide=function(){t.isSecondLogin=!1,$("#companyVip").css("background","rgba(0,0,0,0")},t.isShow=function(){c=a(d),c[l.id+"_isShow_"+l.type]=!c[l.id+"_isShow_"+l.type],localStorage.setItem(d,JSON.stringify(c))}}])}(),function(){angular.module("userCenter.userGuideNextNext",[]).controller("userCenterGuideCtrlNextNext",["$rootScope","$scope","security","$routeParams","$location",function(e,t,n,i,r){function o(e,n){var i=sessionStorage.getItem(l.id);e&&e[l.id]?e[l.id+"_isShow_"+l.type]?t.isSecondLoginNext=!1:(i||(t.isCompanyVip=n,t.isSecondLoginNext=!0,sessionStorage.setItem(l.id,!0)),n&&setTimeout(function(){t.isShow()},100)):(t.isSecondLoginNext=!0,t.isCompanyVip=n,c=c||{},c[l.id]=l.type,c[l.id+"_isShow_"+l.type]="1"==l.type,s(d,c),sessionStorage.setItem(l.id,!0))}function a(e){return window.localStorage?(c=JSON.parse(localStorage.getItem(e)),!!c&&c):null}function s(e,t){return window.localStorage?void localStorage.setItem(d,JSON.stringify(t)):null}var c,l=n.currentUser,d="userCenterGuideNextNext",u=null,p=r.path();if("2"==l.type&&p.indexOf("/account")>=0&&(u=a(d),o(u,!1),$("#companyVip").css("background","rgba(0,0,0,0.8")),"1"==l.type&&p.indexOf("/main")>=0){u=a(d),o(u,!0);var h=JSON.parse(localStorage.getItem("loginInfo")),g=JSON.parse(sessionStorage.getItem("emailGuide"));(!h.isShow||g)&&$("#companyVip").css("background","rgba(0,0,0,0.8")}t.showNextGuide=function(){t.isSecondLoginNext=!1,$("#companyVip").css("background","rgba(0,0,0,0")},t.isShow=function(){c=a(d),c[l.id+"_isShow_"+l.type]=!c[l.id+"_isShow_"+l.type],localStorage.setItem(d,JSON.stringify(c))}}])}(),angular.module("usercenter",["usercenter.transfer","usercenter.upgrade","usercenter.request","services.usercenter","services.localizedMessages","security.service","app.directives.addelement","services.modal","usercenter.relAccount","usercenter.branch","services.i18nNotifications","security.thirdparty","usercenter.branch.reset","usercenter.checkMobil","usercenter.relRegisterAccount","userCenter.userGuide","userCenter.userGuideNext","userCenter.userGuideNextNext","app.usercenter.tab","usercenter.privilege"]),angular.module("usercenter").controller("UserCenterCtrl",["$rootScope","$scope","$window","$routeParams","usercenterService","security","$modal","ModalService","$location","$filter","fixnumFilter","i18nNotifications","thirdpartyService","$translate","$timeout",function(e,t,n,i,r,o,a,s,c,l,d,u,p,h,g){t.PREFIX_FILE_HOST=PREFIX_FILE_HOST,t.PREFIX_SERVER_HOST=PREFIX_URL,t.PREFIX_CLIENT_HOST=PREFIX_HOST,t.isActive="usercenter",t.isVendorUser=o.isVendorUser(),t.editInfo={isEditable:!1},t.isDomainAccessable=o.isAllowToAccess(o.accessDef.ACCESS_DOMAIN_BIND),t.isAllowedHistory=o.isAllowToAccess(o.accessDef.USERCENTER_HISTORY),t.isAllowedApply=o.isAllowToAccess(o.accessDef.APPLY_XIUKE),t.password={},t.pageSize=5,t.XdpageNo=1,t.XdtoPage="",t.pageNo=1,t.toPage=t.XdcurrentPage=1,t.branchToPage=1,t.viewControl={tab:i.id},t.showTab=function(e){c.path("/usercenter/"+e,!1),t.viewControl.tab=e},t.currentUser=o.currentUser,t.getUserXd=function(){r.getUserXd().then(function(e){e.data.success&&(t.xdCounts=e.data.obj)})},t.getUserXd(),t.getUserInfo=function(){r.getUserInfo().then(function(e){t.userinfo=e.data.obj,t.master=angular.copy(t.userinfo),t.url="我做的企业秀，用的是微学宝，免费好用，你试试吧：\r\n"+PREFIX_HOST+"/#/home/register?u="+t.userinfo.id;var n=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;"eqs"!=t.userinfo.loginName.substr(0,3)||n.test(t.userinfo.loginName)||(t.userinfo.noRel="未绑定",/(_qq)$/.test(t.userinfo.loginName)&&(t.qqRel=!0),/(_weixin)$/.test(t.userinfo.loginName)&&(t.wxRel=!0),/(_weibo)$/.test(t.userinfo.loginName)&&(t.wbRel=!0)),/qq/gi.test(t.userinfo.relType)&&(t.qqRel=!0),/weixin/gi.test(t.userinfo.relType)&&(t.wxRel=!0),/weibo/gi.test(t.userinfo.relType)&&(t.wbRel=!0),c.search().bindemail&&t.relAccount(),4==t.userinfo.type})},t.getUserInfo(),t.editMessage=function(){var e,n,i;4==t.userinfo.type?(e="usercenter/console/serverinfo.tpl.html",n="ApplyCtrl",i="服务会员基本信息"):(e="usercenter/console/companyinfo.tpl.html",n="companyInfoCtrl"),a.open({windowClass:"six-contain",templateUrl:e,controller:n,scope:t,resolve:{
userinfo:function(){return{nick:t.userinfo.nick,type:t.userinfo.type,id:t.userinfo.id,title:i}}}}).result.then(function(e){4==t.userinfo.type?(t.applyInfo=e.status,t.userinfo.nick=e.applyInfoNew.nick):t.userinfo.nick=e.nick},function(){})},t.copyCode=function(){var e,t;e=$(".invitation-contain span"),t=e.html(),clipboard.setData("text/plain",t)},t.tabid=i.id,t.customerUpload=function(){a.open({windowClass:"img_console console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:1}}}}).result.then(function(n){if(n.width/n.height===1){t.userinfo.headImg=n.data;var i={headImg:n.data,id:t.userinfo.id};return void r.saveUserInfo(i).then(function(i){i.data.success&&(t.editInfo.isEditable=!1,e.$broadcast("headImg.change",n.data))})}a.open({windowClass:"console seven-contain",templateUrl:"scene/console/imageCrop.tpl.html",controller:"imageCropCtrl",backdrop:"static",resolve:{obj:function(){return{type:"square",properties:{src:n.data}}}}}).result.then(function(n){t.userinfo.headImg=n.src;var i={headImg:n.src,id:t.userinfo.id};r.saveUserInfo(i).then(function(n){n.data.success&&(t.editInfo.isEditable=!1,e.$broadcast("headImg.change",n.data.obj.headImg))})},function(e){})},function(e){})},t.domain=function(){a.open({windowClass:"six-contain",templateUrl:"usercenter/tab/domain.tpl.html",controller:"UserCenterCtrl",resolve:{param:function(){return{value:t.domainMess}}}}).result.then(function(){getDomainMess()},function(){})},t.applyShow=function(){a.open({windowClass:"six-contain",templateUrl:"usercenter/console/serverinfo.tpl.html",controller:"ApplyCtrl",backdrop:"static",invoice:!0,resolve:{userinfo:function(){return{status:t.applyInfo,id:t.userinfo.id,title:"申请成为秀客获取服务商账号",invoice:!0}}}}).result.then(function(e){t.applyInfo=e},function(){})},g(function(){("4"==t.userinfo.type||"1"==t.userinfo.type)&&r.getUserStatus().then(function(e){t.applyInfo=e.data.map.status})},300),t.know=function(){t.xiudian=!1},t.buyXd=function(){a.open({windowClass:"console",templateUrl:"?c=pay",controller:"BuyXdController",resolve:{getUserXd:function(){return function(){t.getUserXd(),t.getXdlog(t.XdtoPage)}}}}).result.then(function(){},function(){})}}]).controller("BuyXdController",["$scope","$modal","usercenterService","ModalService","getUserXd",function(e,t,n,i,r){e.confirm=function(){n.getPayXdQrCode(10,1).then(function(n){if(e.$close(),n.data.success){var o=n.data.obj;t.open({windowClass:"console",templateUrl:"usercenter/payment.tpl.html",controller:"PayMentCtrl",resolve:{qrCodeUrl:function(){return o},type:function(){return 10},money:function(){return["500元"]},method:function(){return"buyXd"},counts:function(){}}}).result.then(function(){r()},function(){})}else i.openMsgDialog({msg:n.data.msg})})},e.cancel=function(){e.$close()}}]),angular.module("app.directives.addelement",[]).directive("addElement",["$compile",function(e){return{restrict:"EA",link:function(t,n,i){var r=$("#emailAddress"),o=$("#emailAddress").size()+1;n.bind("click",function(){var n=angular.element('<div><input type="text" id="p_scnt" style="width:100%; height: 30px; margin-top: 15px;" ng-model="attrs.addElement" name="p_scnt_'+o+'" placeholder="Input Value" /></div>');r.append(n);var i=n.find("input");e(i)(t),o++})}}}]).directive("showIcon",["$compile","$timeout","$translate",function(e,t,n){return{restrict:"EA",require:"ngModel",scope:{check:"&callbackFn"},link:function(t,i,r,o){var a,s,c=e('<a><span class = "glyphicon glyphicon-ok-circle" ng-show="enabled" style = "margin-top: 8px; color: #9ad64b; font-size: 15px;"></span></a>')(t);t.update=function(){i[0].blur(),t.check({arg1:{name:o.$name}})},i.bind("focus",function(){a=o.$viewValue,i.parent().after(c),t.enabled=!0,("email"===r.name||"mobile"===r.name||"tel"===r.name)&&(t.enabled=!1),t.$apply()}).bind("blur",function(){t.enabled=!1,s=o.$viewValue;var e=new RegExp(/(\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$/g);if("mobile"===r.name&&s&&!e.test(i.val()))return alert(n.instant("common.PHONE_ERROR")),$('input[name="mobile"]').addClass("error"),void $('input[name="mobile"]').change(function(){$(this).removeClass("error")});if("email"===r.name&&s){var c=new RegExp(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/g);if(!c.test(i.val()))return alert("邮箱格式错误！"),$('input[name="email"]').addClass("error"),void $('input[name="email"]').change(function(){$(this).removeClass("error")})}(s||a)&&a!==s&&t.update(),t.$apply()})}}}]).directive("ngHover",function(){return{restrict:"EA",scope:{resource:"="},link:function(e,t,n){t.hover(function(){e.$apply(function(){e.resource.show=!0})},function(){e.$apply(function(){e.resource.show=!1})})}}}).directive("imgClick",function(){return{restrict:"EA",link:function(e,t,n){$(t).bind("click",function(){$(t).find("img").css("border","4px solid #F60"),$(t).siblings().find("img").css("border",0)})}}}).directive("customFocus",function(){return{restrict:"EA",link:function(e,t,n){$(t).siblings().bind("click",function(){t[0].focus()})}}}).directive("blurChildren",function(){return{restrict:"EA",link:function(e,t,n){$(t).on("click",function(e){(e.target==t[0]||$(e.target).hasClass("badge"))&&$(".blurClass").find("input:visible").blur()})}}}).directive("forbiddenClose",function(){return{restrict:"EAC",link:function(e,t,n){$(t).on("click",function(e){e.stopPropagation()})}}}).directive("customeImage",function(){return{restrict:"EA",link:function(e,t,n){$(t).hover(function(){$("<div><a></a></div>")},function(){})}}}).directive("slides",["configService",function(e){return{restrict:"EA",link:function(t,n,i){var r=$(n).find(".slides_container");e.getBanners().then(function(e){for(var t=e.data.split(","),i=0;i<t.length;i++){var o=[];o.push(t[i].split("|"));for(var a=0;a<o.length;a++)r.append('<img src="'+o[a][0]+'" usemap="#active'+i+'" width="1000px" height="720px" alt="Slide 1">'),o[a][1]&&r.after('<map name="active'+i+'" id="active'+i+'"><area shape="rect" coords="0,0,1000,720" target="_blank" href ="'+o[a][1]+'" /></map>')}$(n).slides({preload:!0,play:5e3,pause:2500,hoverPause:!0})},function(){r.append('<img src="'+CLIENT_CDN+'assets/images/3.jpg" width="1000px" height="720px" alt="Slide 1">'),r.append('<img src="'+CLIENT_CDN+'assets/images/2.jpg" width="1000px" height="720px" alt="Slide 1">'),r.append('<img src="'+CLIENT_CDN+'assets/images/1a.jpg" width="1000px" height="720px" alt="Slide 1">'),$(n).slides({preload:!0,play:5e3,pause:2500,hoverPause:!0})})}}}]).directive("slides3",["configSerService",function(e){return{restrict:"EA",link:function(t,n,i){var r=$(n).find(".slides_container");e.getActivityBanner(i.id).then(function(e){for(var t=e.data.list,o=0;o<t.length;o++){var a=$('<a href="'+t[o].url+'" style="display:block;" target="'+t[o].target+'" ></a>');a.append('<img src="'+t[o].path+'" width="'+i.width+'" height="'+i.height+'" alt="'+t[o].title+'" title="'+t[o].title+'" > '),r.append(a)}$(n).slides({preload:!0,play:5e3,pause:2500,hoverPause:!0})})}}}]).directive("addClass",function(){return{restrict:"EA",link:function(e,t,n){$(t).closest(".textbox-wrap").find("[autofocus]").focus(),$(t).on("blur",function(){$(t).closest(".textbox-wrap").removeClass("focused")}).on("focus",function(){$(t).closest(".textbox-wrap").addClass("focused")})}}}).directive("loadScript",["$http","$timeout","$rootScope",function(e,t,n){return{link:function(t,n,i){var r=function(){t.captchaLoaded=!0};t.$watch(function(){return n[0].getAttribute("src")},function(t,i){t&&e.jsonp(n[0].getAttribute("src")).success(r).error(r)}),t.$on("$destroy",function(){angular.element(".gt_widget").remove()})}}}]),angular.module("app.directives.autoclose",[]).directive("autoClose",["$compile",function(e){return{restrict:"EA",link:function(e,t,n){$(document).click(function(t){return t.target.className,!$(event.target).closest(".drop-area").length&&(e.showObj={showGroup:!1},void e.$apply())})}}}]),angular.module("colorpicker.module",[]).factory("Helper",function(){return{closestSlider:function(e){var t=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;return t.bind(e)("I")?e.parentNode:e},getOffset:function(e,t){for(var n=0,i=0,r=0,o=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)n+=e.offsetLeft,i+=e.offsetTop,t||"BODY"!==e.tagName?(r+=e.scrollLeft,o+=e.scrollTop):(r+=document.documentElement.scrollLeft||e.scrollLeft,o+=document.documentElement.scrollTop||e.scrollTop),e=e.offsetParent;return{top:i,left:n,scrollX:r,scrollY:o}},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}]}}).factory("Color",["Helper",function(e){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var e=this.toRGB();return"rgb("+e.r+","+e.g+","+e.b+")"},rgba:function(){var e=this.toRGB();return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(e,t,n,i){e/=255,t/=255,n/=255;var r,o,a,s;return a=Math.max(e,t,n),s=a-Math.min(e,t,n),r=0===s?null:a===e?(t-n)/s:a===t?(n-e)/s+2:(e-t)/s+4,r=(r+360)%6*60/360,o=0===s?0:s/a,{h:r||1,s:o,b:a,a:i||1}},setColor:function(t){t=t.toLowerCase();for(var n in e.stringParsers)if(e.stringParsers.hasOwnProperty(n)){var i=e.stringParsers[n],r=i.re.exec(t),o=r&&i.parse(r);if(o)return this.value=this.RGBtoHSB.apply(null,o),!1}},setHue:function(e){this.value.h=1-e},setSaturation:function(e){this.value.s=e},setLightness:function(e){this.value.b=1-e},setAlpha:function(e){this.value.a=parseInt(100*(1-e),10)/100},toRGB:function(e,t,n,i){e||(e=this.value.h,t=this.value.s,n=this.value.b),e*=360;var r,o,a,s,c;return e=e%360/60,c=n*t,s=c*(1-Math.abs(e%2-1)),r=o=a=n-c,e=~~e,r+=[c,s,0,0,s,c][e],o+=[s,c,c,s,0,0][e],a+=[0,0,s,c,c,s][e],{r:Math.round(255*r),g:Math.round(255*o),b:Math.round(255*a),a:i||this.value.a}},toHex:function(e,t,n,i){var r=this.toRGB(e,t,n,i);return"#"+(1<<24|parseInt(r.r,10)<<16|parseInt(r.g,10)<<8|parseInt(r.b,10)).toString(16).substr(1)}}}]).factory("Slider",["Helper",function(e){var t={maxLeft:0,maxTop:0,callLeft:null,callTop:null,knob:{top:0,left:0}},n={};return{getSlider:function(){return t},getLeftPosition:function(e){return Math.max(0,Math.min(t.maxLeft,t.left+((e.pageX||n.left)-n.left)))},getTopPosition:function(e){return Math.max(0,Math.min(t.maxTop,t.top+((e.pageY||n.top)-n.top)))},setSlider:function(i,r){var o=e.closestSlider(i.target),a=e.getOffset(o,r);t.knob=o.children[0].style,t.left=i.pageX-a.left-window.pageXOffset+a.scrollX,t.top=i.pageY-a.top-window.pageYOffset+a.scrollY,n={left:i.pageX,top:i.pageY}},setSaturation:function(e,n){t={maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},this.setSlider(e,n)},setHue:function(e,n){t={maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},this.setSlider(e,n)},setAlpha:function(e,n){t={maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"},this.setSlider(e,n)},setKnob:function(e,n){t.knob.top=e+"px",t.knob.left=n+"px"}}}]).directive("colorpicker",["$document","$compile","Color","Slider","Helper",function(e,t,n,i,r){return{scope:{disable:"@"},require:"?ngModel",restrict:"A",link:function(o,a,s,c){var l,d={x:parseInt(s.x,10)||0,y:parseInt(s.y,10)||0},u=s.colorpicker?s.colorpicker:"hex",p=angular.isDefined(s.colorpickerPosition)?s.colorpickerPosition:"bottom",h=!!angular.isDefined(s.colorpickerInline)&&s.colorpickerInline,g=!!angular.isDefined(s.colorpickerFixedPosition)&&s.colorpickerFixedPosition,f=angular.isDefined(s.colorpickerParent)?a.parent():angular.element(document.body),m=!!angular.isDefined(s.colorpickerWithInput)&&s.colorpickerWithInput,v=m?'<input type="text" name="colorpicker-input">':"",y=h?"":'<button type="button" class="close close-colorpicker">&times;</button>',b='<div class="colorpicker dropdown" ng-click="$event.stopPropagation();"><div class="dropdown-menu"><colorpicker-saturation><i></i></colorpicker-saturation><colorpicker-hue><i></i></colorpicker-hue><colorpicker-alpha><i></i></colorpicker-alpha><colorpicker-preview></colorpicker-preview>'+v+y+"</div></div>",w=angular.element(b),E=n,S=w.find("colorpicker-hue"),x=w.find("colorpicker-saturation"),T=w.find("colorpicker-preview"),C=w.find("i");if(t(w)(o),o.disable&&o.$watch("disable",function(e,t){e!=t&&"false"==e&&D()}),m){var $=w.find("input");$.on("mousedown",function(e){e.stopPropagation()}).on("keyup",function(e){var t=this.value;a.val(t),c&&o.$apply(c.$setViewValue(t)),e.stopPropagation(),e.preventDefault()}),a.on("keyup",function(){$.val(a.val())})}var I=function(){e.on("mousemove",P),e.on("mouseup",M)};"rgba"===u&&(w.addClass("alpha"),l=w.find("colorpicker-alpha"),l.on("click",function(e){i.setAlpha(e,g),P(e)}).on("mousedown",function(e){i.setAlpha(e,g),I()})),S.on("click",function(e){i.setHue(e,g),P(e)}).on("mousedown",function(e){i.setHue(e,g),I()}),x.on("click",function(e){i.setSaturation(e,g),P(e)}).on("mousedown",function(e){i.setSaturation(e,g),I()}),g&&w.addClass("colorpicker-fixed-position"),w.addClass("colorpicker-position-"+p),"true"===h&&w.addClass("colorpicker-inline"),f.append(w),c&&(c.$render=function(){a.val(c.$viewValue)},o.$watch(s.ngModel,function(){_()})),a.on("$destroy",function(){w.remove()});var R=function(){try{T.css("backgroundColor",E[u]())}catch(e){T.css("backgroundColor",E.toHex())}x.css("backgroundColor",E.toHex(E.value.h,1,1,1)),"rgba"===u&&(l.css.backgroundColor=E.toHex())},P=function(e){var t=i.getLeftPosition(e),n=i.getTopPosition(e),r=i.getSlider();i.setKnob(n,t),r.callLeft&&E[r.callLeft].call(E,t/100),r.callTop&&E[r.callTop].call(E,n/100),R();var s=E[u]();return a.val(s),c&&o.$apply(c.$setViewValue(s)),m&&$.val(s),!1},M=function(){e.off("mousemove",P),e.off("mouseup",M)},_=function(){E.setColor(a.val()),C.eq(0).css({left:100*E.value.s+"px",top:100-100*E.value.b+"px"}),C.eq(1).css("top",100*(1-E.value.h)+"px"),C.eq(2).css("top",100*(1-E.value.a)+"px"),R()},k=function(){var e,t=r.getOffset(a[0]);return angular.isDefined(s.colorpickerParent)&&(t.left=0,t.top=0),"top"===p?e={top:t.top-147+d.y,left:t.left+d.x}:"right"===p?e={top:t.top+d.y,left:t.left+126+d.x}:"bottom"===p?e={top:t.top+a[0].offsetHeight+2+d.y,left:t.left+d.x}:"left"===p?e={top:t.top+d.y,left:t.left-150+d.x}:"sceneToobar"===p&&(e={top:t.top+d.y-110,left:t.left-150+d.x+40}),{top:e.top+"px",left:e.left+"px"}},A=function(){D()};h===!1?a.on("click",function(){_(),w.addClass("colorpicker-visible").css(k()),e.on("mousedown",A)}):(_(),w.addClass("colorpicker-visible").css(k())),w.on("mousedown",function(e){e.stopPropagation(),e.preventDefault()});var L=function(e){c&&o.$emit(e,{name:s.ngModel,value:c.$modelValue})},D=function(){w.hasClass("colorpicker-visible")&&(w.removeClass("colorpicker-visible"),L("colorpicker-closed"),e.off("mousedown",A))};w.find("button").on("click",function(){D()})}}}]),angular.module("app.directives.rightclick",[]).directive("rightClick",["$compile",function(e){return{restrict:"EA",link:function(t,n,i){var r;$(n).on("contextmenu",function(i){if(i.preventDefault(),r&&r[0]&&r.remove(),"0"==t.categoryId){r=$('<ul class="right-menu dropdown-menu"></ul>'),r.appendTo($(n)),r.css({left:i.pageX-$(n).offset().left,top:i.pageY-$(n).offset().top}).show();for(var o in t.myTags){var a='<li class="tag_list" ng-class="{selected: dropTagIndex == '+o+'}" ng-click="selectTag('+t.myTags[o].id+","+o+')">'+t.myTags[o].name+"</li>",s=e(a)(t);r.append(s)}var c=e('<li class="tag_list add_cate clearfix" style="border-top:1px solid #ccc;margin-bottom:0px;" ng-click="createCategory()"><em>+</em><span>创建分类</span></li>')(t);r.append(c);var l=e('<li class="btn-main" style="width:100%; padding:0px; border: 0;margin:0px;height:25px; line-height:25px;"><a style="height:25px;line-height:25px;text-indent:0;color:#FFF;padding:0px;text-align:center;" ng-click="setCategory('+t.dropTagIndex+","+t.img.id+')">确定</a></li>')(t);r.append(l),$(l).on("click",function(){r.hide()}),$(document).mousemove(function(e){(e.pageX<r.offset().left-20||e.pageX>r.offset().left+r.width()+20||e.pageY<r.offset().top-20||e.pageY>r.offset().top+r.height()+20)&&(r.hide(),$(this).unbind("mousemove"))})}})}}}]),angular.module("app.directives.copyButton",[]).directive("copyButton",["$translate",function(e){return{restrict:"EA",scope:{url:"@"},link:function(e,t,n){var i=new ZeroClipboard(t);i.on("copy",function(e){var t=e.clipboardData;t.setData("text/plain",n.url.replace(PREFIX_HOST,PREFIX_HOST_ARRAY[parseInt(10*Math.random(),10)%4]))}),i.on("ready",function(e){i.on("aftercopy",function(e){alert("复制成功")})})}}}]),angular.module("app.directives.customer",[]).directive("forbiddenListClose",function(){return{restrict:"A",link:function(e,t,n){$(t).click(function(e){return!1})}}}),angular.module("app.directives.dataDraggable",[]).directive("itemDraggable",function(){return{restrict:"A",link:function(e,t,n){$(t).draggable({zIndex:2700,scroll:!1,iframeFix:!1,revert:!1,helper:"clone"})}}}).directive("itemDroppable",function(){return{restrict:"A",link:function(e,t,n){$(t).droppable({hoverClass:"active",out:function(e,t){},drop:function(t,n){delete e.$parent.associateData[n.draggable.parent().attr("item-id")],e.$parent.associateData[$(t.target).attr("item-id")]=n.draggable.attr("item-id");var i=$(t.target).find(".list_darggable");i.length>0&&$(".item-remove-droppable").append(i),n.draggable.css({left:0,top:0}).prependTo(this)}})}}}).directive("itemRemoveDroppable",function(){return{restrict:"A",link:function(e,t,n){$(t).droppable({hoverClass:"active",drop:function(t,n){$(n.draggable).parents(".list-attribute").length>0&&delete e.associateData[$(n.draggable).parents(".list-attribute").attr("item-id")],n.draggable.css({left:0,top:0}).appendTo(this)}})}}}),angular.module("app.directives.disableKeydown",[]).directive("disableEdit",function(){function e(e,t,n){var i={37:"arrow-left",38:"arrow-up",39:"arrow-right",40:"arrow-down",9:"tab",27:"esc"};t.keydown(function(e){i[e.which]||e.preventDefault()})}return{restrice:"EA",link:e}}),angular.module("scene.create.hoverElement",[]).directive("hoverElement",["$translate",function(e){function t(e,t,i){var r;$blinkElement=$('<div class="blink-element"></div>');var o=$("#inside_"+e.id);"4"==o.attr("ctype")?$("#tip_"+e.id).html("图片"):"2"==o.attr("ctype")?$("#tip_"+e.id).html("文字"):"3"==o.attr("ctype")?$("#tip_"+e.id).html("随机图片"):"h"==o.attr("ctype")?$("#tip_"+e.id).html("形状"):"x"==o.attr("ctype")&&$("#tip_"+e.id).html("多字体"),t.hover(function(t){n=$("#inside_"+e.id),n.find(".blink-element").length||$blinkElement.appendTo(n),r=setInterval(function(){$blinkElement.toggleClass("red-border")},1e3)},function(e){$blinkElement.remove(),clearInterval(r)})}var n;return{restrict:"EA",scope:{id:"="},link:t}}]),angular.module("common.directives.inputColor",[]).controller("inputColorCtrl",["$scope","$attrs",function(e,t){e.x=t.x||151,e.y=t.y||-2,e.colorMode=t.colorMode||"rgba"}]).directive("eqdInputColor",function(){return{restrict:"E",templateUrl:"directives/inputColor.tpl.html",replace:!0,controller:"inputColorCtrl",scope:{selectColor:"=",defaultColor:"="}}}),angular.module("app.directives.keymap",["services.scene","services.history","services.select"]).directive("eqxKeymap",["sceneService","historyService","selectService",function(e,t,n){return{restrict:"A",link:function(t){var n=$(document);t.$on("$destroy",function(){n.unbind("keydown")}),n.unbind("keydown").keydown(function(n){if((n.ctrlKey||n.metaKey)&&90==n.keyCode&&e.historyBack(),(n.ctrlKey||n.metaKey)&&89==n.keyCode&&e.historyForward(),(n.ctrlKey||n.metaKey)&&86==n.keyCode){if($("#btn-toolbar").length||$(".modal-dialog").length)return;e.getCopy()&&e.pasteElement()}if((n.ctrlKey||n.metaKey)&&67==n.keyCode){if($("#btn-toolbar").length||$(".modal-dialog").length)return;e.copyElement()}t.$apply()})}}}]),angular.module("app.directives.limitInput",[]).directive("limitInput",function(){return{require:"ngModel",link:function(e,t,n,i){"transform"==n.cssItem&&e.$on("updateTransform",function(t,n,r){r==e.elemDef.id&&(i.$setViewValue(parseInt(n,10)),i.$render())}),"borderRadius"==n.cssItem&&e.$on("updateMaxRadius",function(t,n){e.maxRadius=parseInt(Math.min($(n).outerWidth(),$(n).outerHeight())/2+10,10),e.maxRadius<e.model.borderRadius&&(i.$setViewValue(e.maxRadius),i.$render()),e.$apply()}),e.$watch(function(){return $(t).val()},function(e){+e>n.max&&(i.$setViewValue(n.max),i.$render()),+e<n.min&&(i.$setViewValue(n.min),i.$render())})}}}),angular.module("app.directives.lineChart",[]).directive("lineChart",["$compile",function(e){return{restrict:"EA",link:function(e,t,n){var i,r;e.$watch(function(){return n.data},function(){n.data&&(i=JSON.parse(n.data)),r?(r.destroy(),r=new Chart(t[0].getContext("2d")).Line(i,{scaleFontColor:"#fff"})):r=new Chart(t[0].getContext("2d")).Line(i,{scaleFontColor:"#fff"})})}}}]),angular.module("app.directives.loading",[]).directive("loginLoading",function(){return{restrict:"EA",link:function(e,t,n){e.$on("loginLoading",function(e,n){var i=$('<div class="homeMask" style="position: absolute;width: 100%;top:0;bottom:0;background-color:#ccc;opacity:0.8;">正在跳转，请稍后...</div>');i.appendTo($(t))})}}}),angular.module("app.directives.comp.editor",[]).directive("mapEditor",function(){return{restrict:"AE",templateUrl:"directives/mapeditor.tpl.html",link:function(e,t,n){var i=new BMap.Map("l-map");i.centerAndZoom(new BMap.Point(116.404,39.915),15);var r={onSearchComplete:function(e){if(o.getStatus()==BMAP_STATUS_SUCCESS){for(var t=[],n=0;n<e.getCurrentNumPois();n++)t.push(e.getPoi(n).title+", "+e.getPoi(n).address);document.getElementById("r-result").innerHTML=t.join("<br/>")}}},o=new BMap.LocalSearch(i,r);e.searchAddress=function(){o.search(e.address)}}}}),angular.module("app.directives.notification",[]).directive("notificationFadeout",["i18nNotifications",function(e){return{restrict:"EA",link:function(t,n,i){var r=$(n);r.fadeOut(4e3,function(){e.remove(t.notification)})}}}]),angular.module("app.directives.pageTplTypes",[]).directive("pageTplTypes",["pageTplService",function(e){return{restrict:"EA",replace:!0,templateUrl:"directives/page-tpl-types.tpl.html",link:function(t,n,i){e.getPageTplTypes().then(function(e){e.data.list&&e.data.list.length>0?t.pageTplTypes=e.data.list:t.pageTplTypes=[]})}}}]),angular.module("app.directives.pieChart",[]).directive("pieChart",["$compile",function(e){return{restrict:"EA",link:function(e,t,n){var i,r;e.$watch(function(){return n.data},function(){n.data&&(r=JSON.parse(n.data)),i?(i.destroy(),i=new Chart(t[0].getContext("2d")).Pie(r)):i=new Chart(t[0].getContext("2d")).Pie(r)})}}}]),angular.module("app.directives.qrcode",[]).directive("qrCode",function(){return{restrict:"A",scope:{qrUrl:"@"},link:function(e,t,n){e.$watch("qrUrl",function(e,n){$("canvas",t).length>0&&$("canvas",t).remove(),e&&(e=e.replace(PREFIX_HOST,PREFIX_HOST_ARRAY[parseInt(10*Math.random(),10)%4]),$(t).qrcode({render:"canvas",width:180,height:180,text:e+(/\?/.test(e)?"&":"?")+"eqrcode=1"}))})}}}).directive("qrCodeSize",function(){return{restrict:"A",scope:{qrUrl:"@"},link:function(e,t,n){var i=parseInt(n.qrCodeSize,10);e.$watch("qrUrl",function(e,n){$("canvas",t).length>0&&$("canvas",t).remove(),e&&(e=e.replace(PREFIX_HOST,PREFIX_HOST_ARRAY[parseInt(10*Math.random(),10)%4]),$(t).qrcode({render:"canvas",width:i,height:i,text:e+(/\?/.test(e)?"&":"?")+"eqrcode=1"}))})}}}).directive("downloadCanvas",function(){return{restrict:"EA",link:function(e,t,n){e.$on("download.canvas",function(n,i){var r;$.each($(t).find(".qr-size"),function(e,t){$(t).attr("qr-code-size")==i&&(r=$(t).find("canvas").get(0))}),i==$(t).find(".qr-size").attr("qrCodeSize")&&console.log(i);var o=document.createElement("a"),a=document.createEvent("MouseEvents"),s=r.toDataURL("image/png");a.initEvent("click",!0,!0),o.download=e.scene.code+".png",o.href=s,o.dispatchEvent(a)})}}}),angular.module("app.directives.register",[]).directive("qqButton",["$translate",function(e){return{restrict:"EA",scope:{someCtrlFn:"&callbackFn",openid:"=",accesstoken:"="},link:function(t,n,i){QC.Login({btnId:i.id,scope:"all"},function(e,n){var i=e;QC.Login.check()&&QC.Login.getMe(function(e,n){t.openid=e,t.accesstoken=n,t.someCtrlFn({arg1:{openId:e,accessToken:n,type:"qq",userInfo:i}})})},function(t){alert(e.instant("common.register.QQ_SUCCESS"))}),$("#qqLoginBtn a").removeAttr("onclick").click(function(){alert(e.instant("common.register.OTHER_SUCCESS"))})}}}]).directive("wbButton",["$translate",function(e){return{restrict:"EA",link:function(t,n,i){WB2.anyWhere(function(e){e.widget.connectButton({id:"wb_connect_btn",type:"3,2",callback:{login:function(e){},logout:function(){}}})}),$("#wb_connect_btn").removeAttr("onclick").click(function(t){return t.stopPropagation(),t.preventDefault(),alert(e.instant("common.register.WEIBO_SUCCESS")),!1})}}}]),angular.module("app.directives.responsiveImage",[]).directive("responsiveImage",["$compile",function(e){return{restrict:"EA",scope:{file:"="},link:function(e,t,n){"0"!=e.fileType&&(t.find("img").length?$element=t.find("img"):"IMG"==t.get(0).nodeName.toUpperCase()&&($element=t),$element.bind("load",function(){$(this).removeAttr("style");var t=$(this).parent("li").width(),n=$(this).parent("li").height();e.file&&(e.file.shape={width:$(this).width(),height:$(this).height()}),this.width<=t&&this.height<=n?(this.style.top="50%",this.style.marginTop="-"+this.height/2+"px",this.style.left="50%",this.style.marginLeft="-"+this.width/2+"px"):this.width>this.height?(this.style.width=t+"px",this.height=this.height*t/this.width,this.style.top="50%",this.style.marginTop="-"+this.height/2+"px"):(this.style.height=n+"px",this.width=this.width*n/this.height,this.style.left="50%",this.style.marginLeft="-"+this.width/2+"px")}))}}}]),angular.module("common.directives.scroll",[]).directive("eqdScroll",function(){var e={mouseWheel:!0,scrollbars:!0,interactiveScrollbars:!0,click:!0,bounce:!1};return function(t,n,i){n.css({position:"relative",overflow:"hidden"}),delete e.disableMouse,delete e.preventDefaultException,i.preventException&&(e.preventDefaultException={tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT|DIV|SPAN|EM|A|LI|B)$/}),"true"==i.disableMouse&&(e.disableMouse=!0);var r,o=new IScroll(n.get(0),e),a=t.$watch(function(){clearTimeout(r),r=setTimeout(function(){o.refresh()},100)});i.refresh&&(o.on("scrollStart",function(){n.children().on("mousewheel",function(e){o.y<=o.maxScrollY+200&&t.$eval(i.refresh)})}),o.on("scrollEnd",function(){n.children().unbind("mousewheel")})),n.on("$destroy",function(){o.destroy(),o=null,a(),clearTimeout(r)}),t.$on("scroll.refresh."+i.scroll,function(){r=setTimeout(function(){o.refresh()},100)}),t.$on("scroll.scrollTo",function(e,t,n){o.scrollTo(t,n)})}}),angular.module("common.directives.dropDown",[]).directive("eqdSelect",["$rootScope",function(e){function t(t,n){function i(){o.unbind("click",i),a.removeClass("visible")}function r(e){index=e.index(),t.current=t.list[index],a.removeClass("visible")}var o=(tabletCheck(),$(document)),a=n.find(".eqc-drop-down-list"),s=a.find(".iScrollIndicator");n.on("$destroy",function(){o.unbind("click",i)}),t.showList=function(n){return n.stopPropagation(),a.hasClass("visible")?void i():(e.$broadcast("iscroll.refresh."+t.scrollType),$(".eqc-drop-down-list").removeClass("visible"),a.addClass("visible"),o.click(i),void s.click(function(e){e.stopPropagation()}))},t.selectItem=function(e){e.stopPropagation();var t=e.target,n=t.tagName.toLowerCase(),i=$(t);"li"==n?r(i):"div"==n&&(i=i.closest("li"),r(i))}}return{restrict:"E",replace:!0,templateUrl:"directives/select.tpl.html",scope:{list:"=",current:"=",scrollType:"@",fontFamily:"=",isBorder:"@",x:"@"},link:t}}]).controller("SimpleSelectController",["$scope","$element","$attrs","$parse","$timeout",function(e,t,n,i,r){var o=this;e.list=[],e.current=null,o.addSelectChoice=function(t){t.name&&"用途"===t.name&&!t.value&&(t.name=window.localStorage.mytpl1),t.name&&"功能"===t.name&&!t.value&&(t.name=window.localStorage.mytpl2),t.name&&"风格"===t.name&&!t.value&&(t.name=window.localStorage.mytpl3),e.list.push(t)},o.removeSelectChoice=function(t){var n=e.list.indexOf(t);-1!==n&&e.list.splice(n,1)};var a;o.setObjectConfig=function(e){a===undefined&&(a=e)},e.setDefaultSelectedValue=function(){angular.forEach(e.list,function(t){t.value==e.model&&(e.current=t)})};var s=e.$watchCollection("list",function(){e.setDefaultSelectedValue()}),c=e.$watch("current",function(t){t&&e.model!=t.value&&(e.model=t.value,r(function(){n.change&&e.$parent.$eval(n.change)},100))}),l=e.$watch("model",function(t){t&&e.setDefaultSelectedValue()});e.$on("$destroy",function(){s(),c(),l()}),e.$watch("model",function(t,n){t!=n&&angular.forEach(e.list,function(t){t.value==e.model&&(e.current=t)})})}]).directive("eqxSelect",["$compile",function(e){var t='<eqd-select list="list" class="select-contain" current="current"></eqd-select>';return{restrict:"E",scope:{model:"="},controller:"SimpleSelectController",compile:function(n,i){var r=i.class;return n.removeClass(r),function(n,i,o,a){i.append(e(angular.element(t).addClass(r))(n))}}}}]).directive("eqxSelectOption",["$parse","$interpolate",function(e,t){return{restrict:"E",require:"^eqxSelect",compile:function(n,i){var r,o;return i.ngRepeat&&(r=e(i.value),o=t(n.html())),function(e,t,n,i){t.css("display","none");var a;if(r){var s=r(e);i.setObjectConfig(angular.isObject(s)),a={name:o(e),value:s}}else a={name:t.html(),value:e.$parent.$eval(n.value)};i.addSelectChoice(a),t.on("$destroy",function(){i.removeSelectChoice(a)})}}}}]),angular.module("app.directives.numChangeAnim",[]).directive("numChangeAnim",["$filter",function(e){return{restrict:"A",scope:{content:"@"},link:function(t,n,i){function r(e,t){return Math.floor(e+Math.random()*(t-e))}function o(e,t){e=e>0?e:1;for(var n=Math.floor(Math.log10(e)),i=Math.floor(e/Math.pow(10,n)),o=0,a=10,s=function(s){setTimeout(function(){if(10>a)o=s;else{var c=n>s?s:n,l=Math.pow(10,c)*i;l=l.toString().length==e.toString().length?e:l,o=r(o,l)}t(o,9==s)},(s*s+s+2)/2*30)},c=0;a>c;c++)s(c)}function a(t,n){$(t).children("span").text(e("number")(n))}t.$watch("content",function(e){if(e){var t=parseInt(e,10);o(t,function(e,i){a(n,e),i&&(a(n,t),$(n).addClass("heartbeat").css({"animation-duration":"1s"}))})}})}}}]),angular.module("app.directives.style",[]).directive("panelDraggable",function(){return{restrict:"A",link:function(e,t,n){e.$on("$destroy",function(){$(t).draggable(),$(t).draggable("destroy"),t=null}),t.on("$destroy",function(){$(t).draggable(),$(t).draggable("destroy"),t=null}),$(t).draggable(),$(window).bind("resize",function(){$(t).css({left:$(document).width()-444,top:50})})}}}),angular.module("app.directives.switchInput",[]).directive("switchInput",function(){function e(e,t,n){t.hover(function(n){e.obj.showinput=!0;var i=t.find("input");setTimeout(function(){i.focus(),i.select()},0),e.$apply()},function(t){e.obj.showinput=!1,e.$apply()})}return{restrict:"EA",scope:{obj:"="},link:e}}),angular.module("app.directives.component",["services.scene","services.select","scene.create.console.pictures","scene.edit.trigger"]).directive("compDraggable",function(){return{restrict:"A",link:function(e,t,n){e.$on("$destroy",function(){$(t).draggable(),$(t).draggable("destroy"),t=null}),t.on("$destroy",function(){$(t).draggable(),$(t).draggable("destroy"),t=null}),$(t).draggable({revert:!1,stack:".comp-draggable",helper:"panel"==n.compDraggable||"page"==n.compDraggable?"clone":"",appendTo:"parent",containment:"panel"==n.compDraggable||"page"==n.compDraggable?"":"parent",zIndex:1049,opacity:.35,stop:function(e,t){$(e.toElement).one("click",function(e){e.stopImmediatePropagation()});
}})}}}).directive("compDroppable",function(){return{restrict:"A",link:function(e,t,n){e.$on("$destroy",function(){$(t).droppable(),$(t).droppable("destroy"),t=null}),t.on("$destroy",function(){$(t).droppable(),$(t).droppable("destroy"),t=null}),$(t).droppable({accept:".comp-draggable",hoverClass:"drop-hover",drop:function(t,n){if(3!=n.draggable.attr("ctype")){var i={left:n.offset.left-$(this).offset().left+"px",top:n.offset.top-$(this).offset().top+"px"};"panel"==n.draggable.attr("comp-draggable")?e.createComp(n.draggable.attr("ctype"),i):e.updateCompPosition(n.draggable.attr("id"),i)}else e.createComp(3)}})}}}).directive("compSortable",function(){return{restrict:"A",link:function(e,t,n){$(t).sortable({axis:"y",update:function(e,t){}})}}}).directive("compResizable",function(){return{restrict:"A",link:function(e,t,n){$(t).resizable({autoHide:!1,containment:"parent",stop:function(t,n){if("4"==$(n.element).attr("ctype").charAt(0)||"n"==$(n.element).attr("ctype").charAt(0)){var i={width:n.size.width,height:n.size.height,imgStyle:{width:n.element.find("img").width(),height:n.element.find("img").height(),marginTop:n.element.find("img").css("marginTop"),marginLeft:n.element.find("img").css("marginLeft")}};e.updateCompSize(n.element.attr("id"),i)}else e.updateCompSize(n.element.attr("id"),n.size);$(t.toElement).one("click",function(e){e.stopImmediatePropagation()})},resize:function(e,n){var i=$(t).find("img").width()/$(t).find("img").height();if("4"==$(n.element).attr("ctype").charAt(0)||"n"==$(n.element).attr("ctype").charAt(0)){var r=n.size.width/n.size.height,o=n.element.find("img");i>=r?(o.outerHeight(n.size.height),o.outerWidth(n.size.height*i),o.css("marginLeft",-(o.outerWidth()-n.size.width)/2),o.css("marginTop",0)):(o.outerWidth(n.size.width),o.outerHeight(n.size.width/i),o.css("marginTop",-(o.outerHeight()-n.size.height)/2),o.css("marginLeft",0))}else n.element.find(".element").outerWidth(n.size.width),n.element.find(".element").outerHeight(n.size.height)}})}}}).directive("photoDraggable",function(){return{restrict:"A",link:function(e,t,n){e.$on("$destroy",function(){$(t).draggable(),$(t).draggable("destroy"),t=null}),t.on("$destroy",function(){$(t).draggable(),$(t).draggable("destroy"),t=null}),$(t).draggable({revert:!1,helper:"clone",appendTo:".img_list",zIndex:1049,opacity:.35,stop:function(e,t){$(e.toElement).one("click",function(e){e.stopImmediatePropagation()})}})}}}).directive("cropDroppable",function(){return{restrict:"A",link:function(e,t,n){e.$on("$destroy",function(){$(t).droppable(),$(t).droppable("destroy"),t=null}),t.on("$destroy",function(){$(t).droppable(),$(t).droppable("destroy"),t=null}),$(t).droppable({accept:"li",hoverClass:"drop-hover",drop:function(t,n){e.preSelectImage(n.draggable.attr("photo-draggable"))}})}}}).service("Point",function(){function e(e,t){this.x=e,this.y=t}return e.prototype.add=function(t,n){return new e(this.x+t,this.y+n)},e.prototype.middle=function(t){return new e((this.x+t.x)/2,(this.y+t.y)/2)},e.prototype.detectionPointA=function(e){this.x=e.x<this.x?e.x:this.x,this.y=e.y<this.y?e.y:this.y},e.prototype.detectionPointB=function(e){this.x=e.x>this.x?e.x:this.x,this.y=e.y>this.y?e.y:this.y},e}).factory("DetectionBox",["Point",function(e){function t(e){this.element=e,this.init()}return t.prototype.init=function(){var t=this.element.position();this.startPointA=new e(t.left,t.top);var n=this.element.get(0);this.startPosition={top:parseInt(n.style.top,10)||0,left:parseInt(n.style.left,10)||0};var i=/[0-9]*[.]*[0-9]*deg/.exec(n.style.transform||n.style.webkitTransform||n.style.mozTransform||n.style.msTransform||n.style.oTransform||""),r=i&&i.length?i[0]:"0";this.angle=parseInt(r,10),this.radian=2*this.angle*Math.PI/360;var o=this.element.width(),a=this.element.height();this.elementWidth=o,this.elementHeight=a,this.left=this.startPosition.left,this.top=this.startPosition.top,this.ratio=o/a,this.width=Math.abs(o*Math.cos(this.radian))+Math.abs(a*Math.sin(this.radian)),this.height=Math.abs(o*Math.sin(this.radian))+Math.abs(a*Math.cos(this.radian)),this.startPointB=this.startPointA.add(this.width,this.height),this.startPointO=this.startPointA.middle(this.startPointB)},t.prototype.getID=function(){return this.element.attr("id")},t.prototype.measure=function(){return{x:this.startPointA.x,y:this.startPointA.y,width:this.width,height:this.height}},t}]).service("panStateTracker",function(){var e={},t={};return e.clear=function(){t={}},e.register=function(e){t[e.attr("id")]=e},e.isElementHasBeenRegisted=function(e){return!!t[e.attr("id")]},e.remove=function(e){delete t[e.attr("id")]},e.forEach=function(e){angular.forEach(t,e)},e}).controller("MouseCompSelectController",["$scope","$element","Point","DetectionBox","panStateTracker","selectService",function(e,t,n,i,r,o){function a(e,i,r,o,a){t.get(0).style.position="relative",this.startPositionX=e,this.startPositionY=i,this.width=r,this.height=o,this.selectAreaPointA=new n(e,i),this.selectAreaPointB=new n(e+r,i+o),this.startFlag=a,this.selectAreaTemplate=t.find(".edit-area-select-container"),this.selectAreaTemplate.length||(this.selectAreaTemplate=$('<div class="edit-area-select-container"></div>'),t.append(this.selectAreaTemplate));var s=t.offset(),c=$("#nr").offset();this.offset=s,this.containerOffset=c,$(window).resize(function(){angular.extend(s,t.offset()),angular.extend(c,$("#nr").offset())})}t.css("user-select","none");var s=this;s.allComponents=[],s.selectedComponents=[],a.prototype.selectStart=function(e,n){angular.extend(this.offset,t.offset()),angular.extend(this.containerOffset,$("#nr").offset()),s.allComponents=[],r.forEach(function(e){s.allComponents.push(e)}),this.startPositionX=e,this.startPositionY=n,this.startFlag=!0,this.updateSelectedElements()},a.prototype.isSelectStarted=function(){return this.startFlag},a.prototype.selectMove=function(e){this.width=e.clientX-this.startPositionX,this.height=e.clientY-this.startPositionY,this.updateCurrentPosition(),this.width>4&&this.height>4&&(this.updateSelectArea(),this.updateSelectedElements())},a.prototype.selectEnd=function(){this.startPositionX=this.startPositionY=this.width=this.height=0,this.startFlag=!1,this.updateCurrentPosition(),this.updateSelectArea()},a.prototype.getLocalPoint=function(e){return new n(e.x-this.offset.left,e.y-this.offset.top)},a.prototype.updateSelectArea=function(){var e=this.getLocalPoint(this.selectAreaPointA);this.selectAreaTemplate.css("left",e.x),this.selectAreaTemplate.css("top",e.y),this.selectAreaTemplate.height(this.height),this.selectAreaTemplate.width(this.width)},a.prototype.updateCurrentPosition=function(){this.selectAreaPointA.x=this.width>0?this.startPositionX:this.width+this.startPositionX,this.selectAreaPointA.y=this.height>0?this.startPositionY:this.height+this.startPositionY,this.width=Math.abs(this.width),this.height=Math.abs(this.height),this.selectAreaPointB.x=this.selectAreaPointA.x+this.width,this.selectAreaPointB.y=this.selectAreaPointA.y+this.height},a.prototype.updateSelectedElements=function(){s.selectedComponents=[];var e=this,t=o.getElements();angular.forEach(s.allComponents,function(n){var i=n.attr("id").split("_")[1];return e.contains(n)?(n.children(".bar").show(),void(-1===t.indexOf(i)&&o.addElement(i))):(-1!==t.indexOf(i)&&o.deleteElement(i),void n.children(".bar").hide())})},a.prototype.contains=function(e){var t=new i(e),r=new n(this.containerOffset.left+t.startPointO.x,this.containerOffset.top+t.startPointO.y);return r.x>=this.selectAreaPointA.x&&r.x<=this.selectAreaPointB.x&&r.y>=this.selectAreaPointA.y&&r.y<=this.selectAreaPointB.y};var c=new a(0,0,0,0,(!1));t.bind("mousedown",function(e){var t=$(e.target);$("#nr").find(".mask-trigger").length||t.hasClass("comp-resize")||t.parents("li.comp-resize").length||t.hasClass("ui-draggable")||t.parents(".ui-draggable").length||t.parents("#containment").length||t.parents(".create_left").length||($("body").css({"user-select":"none",cursor:"default"}),c.selectStart(e.clientX,e.clientY))}),t.bind("mousemove",function(e){c.isSelectStarted()&&c.selectMove(e)}),t.bind("mouseup",function(){c.isSelectStarted()&&($("body").css({"user-select":"initial",cursor:"default"}),c.selectEnd())})}]).directive("mouseCompSelect",[function(){return{restrict:"A",controller:"MouseCompSelectController"}}]).factory("editAreaBorderCollisionDetector",["DetectionBox","Point",function(e,t){function n(){this.editAreaWidth=320,this.editAreaHeight=486,this.detectionBoxs=[]}function i(){this.editArea=new n}return n.prototype.initDetectBoxWithElements=function(t){this.detectionBoxs=[];var n=this;angular.forEach(t,function(t){n.detectionBoxs.push(new e(t))})},i.prototype.initWithElements=function(e){this.editArea.initDetectBoxWithElements(e),this.initBigDetectionBoxPoints()},i.prototype.initBigDetectionBoxPoints=function(){this.bigDetectionBoxPointA=new t(this.editArea.editAreaWidth,this.editArea.editAreaHeight),this.bigDetectionBoxPointB=new t(0,0),this.minimumWidth=this.editArea.editAreaWidth,this.minimumHeight=this.editArea.editAreaHeight;var e=this;angular.forEach(this.editArea.detectionBoxs,function(t){e.bigDetectionBoxPointA.detectionPointA(t.startPointA),e.bigDetectionBoxPointB.detectionPointB(t.startPointB),e.minimumWidth>t.elementWidth&&(e.minimumWidth=t.elementWidth),e.minimumHeight>t.elementHeight&&(e.minimumHeight=t.elementHeight)});var n=(this.bigDetectionBoxPointA.x+this.bigDetectionBoxPointB.x)/2,i=(this.bigDetectionBoxPointA.y+this.bigDetectionBoxPointB.y)/2;this.bigDetectionBoxPointO=new t(n,i)},i.prototype.refreshBoxInfo=function(){angular.forEach(this.editArea.detectionBoxs,function(e){e.init()}),this.initBigDetectionBoxPoints()},i.prototype.translateIntoProperMoveDelta=function(e){var t={x:e.deltaX,y:e.deltaY};return t},i.prototype.compDragMoveDelta=function(e){return this.translateIntoProperMoveDelta(e)},new i}]).controller("MultiCompDragController",["selectService","$scope","$element","editAreaBorderCollisionDetector","panStateTracker","gridGuide","$rootScope",function(e,t,n,i,r,o,a){r.clear();var s=this;s.selectedComponents=[],s.initCollisionDetectorWithElements=function(){s.selectedComponents=[];var t=$("#nr");angular.forEach(e.getElements(),function(e){s.selectedComponents.push(t.find("#inside_"+e))}),i.initWithElements(s.selectedComponents)},s.isKeyboard=!1,s.compDragStart=function(t){e.getElements().length&&(s.initCollisionDetectorWithElements(),o.guide.start({action:"move"}),s.isKeyboard=!!t,s.isKeyboard||angular.forEach(s.selectedComponents,function(e){e.css("opacity",.35)}))},s.compDragMove=function(t){if(e.getElements().length){var n=i.compDragMoveDelta({deltaX:t.deltaX,deltaY:t.deltaY});!s.isKeyboard&&o.guide.options.snap&&o.guide.enforceGuides(n),angular.forEach(i.editArea.detectionBoxs,function(e){var t="translate3d("+n.x+"px, "+n.y+"px, 0) rotateZ("+e.angle+"deg)";e.element.css("transform",t)}),o.guide.sync(n),a.$broadcast("boxOuter")}},s.compDragEnd=function(n){if(e.getElements().length){angular.forEach(s.selectedComponents,function(e){e.css("opacity",1)});var r=i.compDragMoveDelta({deltaX:n.deltaX,deltaY:n.deltaY});!s.isKeyboard&&o.guide.options.snap&&o.guide.enforceGuides(r);var c=i.editArea.detectionBoxs.length;angular.forEach(i.editArea.detectionBoxs,function(e,n){var i="translate3d(0, 0, 0) rotateZ("+e.angle+"deg)";e.element.css("transform",i);var o={top:e.startPosition.top+r.y,left:e.startPosition.left+r.x};e.element.css("top",o.top),e.element.css("left",o.left),t.updateCompPosition(e.element.attr("id"),o,c-1>n)}),o.guide.stop(),a.$broadcast("boxOuter")}},o.grid.init(n),o.guide.init(n)}]).directive("multiCompDrag",function(){return{restrict:"A",controller:"MultiCompDragController"}}).directive("compDrag",["panStateTracker","$rootScope",function(e,t){return{require:"^multiCompDrag",restrict:"A",link:function(t,n,i,r){if(!e.isElementHasBeenRegisted(n)){if(e.register(n),n.on("$destroy",function(){e.remove(n)}),n.find("img").length){var o=$('<div class="dragTemplate" style="position: absolute;left: 0;top: 0;right: 0;bottom: 0;background-color: #fff;opacity: 0;"></div>');o.bind("dblclick",function(){o.siblings(".element").trigger("dblclick")}),n.find(".element-box-contents").append(o)}var a=new Hammer(n.find(".element-box-contents").get(0));a.get("pan").set({threshold:0}),a.on("panstart",function(e){return!$(".edit_area").find(".switch").length&&(!n.hasClass("inside-active")&&(e.preventDefault(),e.srcEvent.preventDefault(),$("body").css({"user-select":"none",cursor:"default"}),void r.compDragStart()))}),a.on("panmove",function(e){return e.preventDefault(),!$(".edit_area").find(".switch").length&&(!n.hasClass("inside-active")&&void r.compDragMove(e))}),a.on("panend",function(e){return!$(".edit_area").find(".switch").length&&(!n.hasClass("inside-active")&&(r.compDragEnd(e),$("body").css({"user-select":"initial",cursor:"default"}),void $(e.srcEvent.target).one("click",function(e){return e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),!1})))})}}}}]).directive("compRotate",["$rootScope",function(e){return{restrict:"A",link:function(t,n,i){var r=$(n),o=$('<div class="bar bar-rotate bar-radius">');r.append(o).append('<div class="bar bar-line">');var a,s={},c=new Hammer(o.get(0));c.get("pan").set({threshold:0}),c.on("panstart",function(e){$("body").css({"user-select":"none",cursor:'url("/assets/images/mouserotate.ico"), default'});var t=r.parent();s={x:parseFloat(r.css("left"))+t.offset().left+r.width()/2,y:parseFloat(r.css("top"))+t.offset().top+r.height()/2}}),c.on("panmove",function(t){var n=t.center,i=n.x-s.x,o=n.y-s.y,c=Math.abs(i/o);a=Math.atan(c)/(2*Math.PI)*360,i>0&&0>o?a=360+a:i>0&&o>0?a=180-a:0>i&&o>0?a=180+a:0>i&&0>o&&(a=360-a),a>360&&(a-=360),r.css({transform:"rotateZ("+a+"deg)"}),e.$broadcast("boxOuter")}),c.on("panend",function(n){$("body").css({"user-select":"initial",cursor:"default"}),t.updateCompAngle(r.attr("id"),a),t.$broadcast("updateTransform",a,r.attr("id").split("_")[1]),e.$broadcast("boxOuter")})}}}]).directive("compResize",["selectService","picturesService","triggerService","panStateTracker","multiCompResize","Cursor","gridGuide","$rootScope",function(e,t,n,i,r,o,a,s){function c(e,t,n,i){n.css("cursor",i);var o=new Hammer(n.get(0));o.get("pan").set({threshold:0,direction:Hammer.DIRECTION_ALL}),o.on("panstart",function(){$("body").css({"user-select":"none",cursor:"default"}),r.resizeStart(t),a.guide.start({action:"resize"})}),o.on("panmove",function(e){var n=r.resizeMove(t,i,e);a.guide.sync(n),s.$broadcast("boxOuter")}),o.on("panend",function(){$("body").css({"user-select":"initial",cursor:"default"}),r.resizeEnd(e,t),a.guide.stop(),s.$broadcast("boxOuter")})}return{restrict:"A",link:function(t,n){var i=$('<div class="bar bar-n"><div class="bar-radius"></div></div>'),r=$('<div class="bar bar-s"><div class="bar-radius"></div></div>'),a=$('<div class="bar bar-e"><div class="bar-radius"></div></div>'),s=$('<div class="bar bar-w"><div class="bar-radius"></div></div>'),l=$('<div class="bar bar-ne bar-radius">'),d=$('<div class="bar bar-nw bar-radius">'),u=$('<div class="bar bar-se bar-radius">'),p=$('<div class="bar bar-sw bar-radius">');n.append(i).append(r).append(a).append(s).append(d).append(u).append(p).append(l).unbind("mousedown").mousedown(function(n){var i=!!$("#nr").find(".mask-trigger").length;if(!i){var r=$(this).attr("id").split("_")[1];if(n.ctrlKey||n.shiftKey)"none"!=$(this).children(".bar").first().css("display")?($(this).children(".bar").hide(),e.deleteElement(r)):($(this).children(".bar").show(),e.addElement(r));else{if("none"!=$(this).children(".bar").first().css("display"))return;$(this).children(".bar").show().end().siblings().children(".bar").hide(),e.clearElements(),e.addElement(r)}t.safeApply(function(){})}}),n.find(".element-box").unbind("click").bind("click",function(e){(e.ctrlKey||e.shiftKey)&&e.stopPropagation()}),n.parent().unbind("mousedown").mousedown(function(n){$(n.target).closest("li").length||($(this).children("li").children(".bar").hide(),t.$emit("hideStylePanel"),e.clearElements(),t.safeApply(function(){}))}),c(t,n,a,o.RESIZE_E),c(t,n,s,o.RESIZE_W),c(t,n,i,o.RESIZE_N),c(t,n,r,o.RESIZE_S),c(t,n,l,o.RESIZE_NE),c(t,n,d,o.RESIZE_NW),c(t,n,u,o.RESIZE_SE),c(t,n,p,o.RESIZE_SW)}}}]).service("Cursor",function(){var e={RESIZE_W:"w-resize",RESIZE_E:"e-resize",RESIZE_N:"n-resize",RESIZE_S:"s-resize",RESIZE_SE:"se-resize",RESIZE_SW:"sw-resize",RESIZE_NE:"ne-resize",RESIZE_NW:"nw-resize"};return e}).factory("multiCompResize",["selectService","picturesService","Cursor","editAreaBorderCollisionDetector","sceneService",function(e,t,n,i,r){var o,a,s=1,c=1,l=(i.editArea.editAreaWidth,i.editArea.editAreaHeight,null),d=null,u={};return u.selectedComponents=[],u.initCollisionDetectorWithElements=function(){u.selectedComponents=[];var t=$("#nr");angular.forEach(e.getElements(),function(e){u.selectedComponents.push(t.find("#inside_"+e))}),i.initWithElements(u.selectedComponents)},u.resizeStart=function(){u.initCollisionDetectorWithElements(),l=i.bigDetectionBoxPointA,d=i.bigDetectionBoxPointB,o=i.minimumWidth,a=i.minimumHeight},u.checkTopBorder=function(e,t){return this},u.checkRightBorder=function(e,t){return this},u.checkLeftBorder=function(e,t){return this},u.checkBottomBorder=function(e,t){return this},u.checkMinHeight=function(e,t,n,i){var r=Math.floor(n-i);return e.deltaY*t>r&&(e.deltaY=r*t),this},u.checkMinWidth=function(e,t,n,i){var r=Math.floor(n-i);return e.deltaX*t>r&&(e.deltaX=r*t),this},u.compResizeWithRatio=function(e,t){switch(t){case n.RESIZE_SE:angular.forEach(i.editArea.detectionBoxs,function(t){var n=parseInt(e.deltaY*t.ratio,10),i=e.deltaY,r={deltaX:n,deltaY:i};u.checkRightBorder(r,t.startPointB).checkBottomBorder(r,t.startPointB).checkMinHeight(r,-1,t.elementHeight,c).checkMinWidth(r,-1,t.elementWidth,s),n!==r.deltaX&&(i=r.deltaX/t.ratio,r.deltaY=Math.abs(i)<Math.abs(r.deltaY)?i:r.deltaY),e.deltaY=r.deltaY,e.deltaX=r.deltaX});break;case n.RESIZE_SW:angular.forEach(i.editArea.detectionBoxs,function(t){var n=parseInt(-e.deltaY*t.ratio,10),i=e.deltaY,r={deltaX:n,deltaY:i};u.checkLeftBorder(r,t.startPointA).checkBottomBorder(r,t.startPointB).checkMinHeight(r,-1,t.elementHeight,c).checkMinWidth(r,1,t.elementWidth,s),n!==r.deltaX&&(i=-r.deltaX/t.ratio,r.deltaY=Math.abs(i)<Math.abs(r.deltaY)?i:r.deltaY),e.deltaY=r.deltaY,e.deltaX=r.deltaX});break;case n.RESIZE_NE:angular.forEach(i.editArea.detectionBoxs,function(t){var n=parseInt(-e.deltaY*t.ratio,10),i=e.deltaY,r={deltaX:n,deltaY:i};u.checkTopBorder(r,t.startPointA).checkRightBorder(r,t.startPointB).checkMinHeight(r,1,t.elementHeight,c).checkMinWidth(r,-1,t.elementWidth,s),n!==r.deltaX&&(i=-r.deltaX/t.ratio,r.deltaY=Math.abs(i)<Math.abs(r.deltaY)?i:r.deltaY),e.deltaY=r.deltaY,e.deltaX=r.deltaX});break;case n.RESIZE_NW:angular.forEach(i.editArea.detectionBoxs,function(t){var n=parseInt(e.deltaY*t.ratio,10),i=e.deltaY,r={deltaX:n,deltaY:i};u.checkLeftBorder(r,t.startPointA).checkTopBorder(r,t.startPointA).checkMinHeight(r,1,t.elementHeight,c).checkMinWidth(r,1,t.elementWidth,s),n!==r.deltaX&&(i=r.deltaX/t.ratio,r.deltaY=Math.abs(i)<Math.abs(r.deltaY)?i:r.deltaY),e.deltaY=r.deltaY,e.deltaX=r.deltaX})}return this},u.resizeMove=function(e,t,r){var d={deltaX:r.deltaX,deltaY:r.deltaY},p=null;switch(t){case n.RESIZE_W:u.checkLeftBorder(d,l).checkMinWidth(d,1,o,s),p={x:d.deltaX,y:0,width:-d.deltaX,height:0},angular.forEach(i.editArea.detectionBoxs,function(e){e.element.css({left:e.left+d.deltaX,width:e.elementWidth-d.deltaX})});break;case n.RESIZE_E:p={x:0,y:0,width:d.deltaX,height:0},angular.forEach(i.editArea.detectionBoxs,function(e){e.element.css("width",e.elementWidth+d.deltaX)});break;case n.RESIZE_N:u.checkTopBorder(d,l).checkMinHeight(d,1,a,c),p={x:0,y:d.deltaY,width:0,height:-d.deltaY},angular.forEach(i.editArea.detectionBoxs,function(e){e.element.css({top:e.top+d.deltaY,height:e.elementHeight-d.deltaY})});break;case n.RESIZE_S:p={x:0,y:0,width:0,height:d.deltaY},angular.forEach(i.editArea.detectionBoxs,function(e){e.element.css("height",e.elementHeight+d.deltaY)});break;case n.RESIZE_SE:p={x:0,y:0,width:d.deltaX,height:d.deltaY},angular.forEach(i.editArea.detectionBoxs,function(e){var t=e.elementHeight+d.deltaY,n=t*e.ratio;e.element.css({height:t,width:n})});break;case n.RESIZE_SW:p={x:d.deltaX,y:0,width:-d.deltaX,height:d.deltaY},angular.forEach(i.editArea.detectionBoxs,function(e){var t=e.elementHeight+d.deltaY,n=t*e.ratio;e.element.css({left:e.left-(n-e.elementWidth),height:t,width:n})});break;case n.RESIZE_NE:p={x:0,y:d.deltaY,width:d.deltaX,height:-d.deltaY},angular.forEach(i.editArea.detectionBoxs,function(e){var t=e.elementHeight-d.deltaY,n=t*e.ratio;e.element.css({top:e.top+d.deltaY,height:t,width:n})});break;case n.RESIZE_NW:p={x:d.deltaX,y:d.deltaY,width:-d.deltaX,height:-d.deltaY},angular.forEach(i.editArea.detectionBoxs,function(e){var t=e.elementHeight-d.deltaY,n=t*e.ratio;e.element.css({top:e.top+d.deltaY,left:e.left-(n-e.elementWidth),height:t,width:n})})}return angular.forEach(u.selectedComponents,function(e){u.setChildrenSizeMove(e)}),p},u.setChildrenSizeMove=function(e){var t=e.children(".element-box"),n={width:t.width(),height:t.height()};if("4"==e.attr("ctype").charAt(0)||"n"==e.attr("ctype").charAt(0)){var i=e.find("img"),r=i.width()/i.height(),o=n.width/n.height;r>=o?(i.outerHeight(n.height),i.outerWidth(n.height*r),i.css("marginLeft",-(i.outerWidth()-n.width)/2),i.css("marginTop",0)):(i.outerWidth(n.width),i.outerHeight(n.width/r),i.css("marginTop",-(i.outerHeight()-n.height)/2),i.css("marginLeft",0))}else"p"==e.attr("ctype").charAt(0)?e.find(".fluxslider, .images, .image1, .image2").css({width:n.width,height:n.height}):(e.find(".element").css({width:n.width,height:n.height}),("i"==e.attr("ctype")||"d"==e.attr("ctype"))&&e.find(".comp_counter").css({"line-height":n.height+"px"}))},u.resizeEnd=function(e){angular.forEach(u.selectedComponents,function(t,n){u.setChildrenSizeEnd(e,t,n<u.selectedComponents.length-1),e.$broadcast("updateMaxRadius",t)})},u.setChildrenSizeEnd=function(e,n,i){var o=n.position(),a={width:n.width(),height:n.height(),left:o.left,top:o.top};if(("i"==n.attr("ctype")||"d"==n.attr("ctype"))&&(a.lineHeight=a.height+"px"),"4"==n.attr("ctype").charAt(0)||"n"==n.attr("ctype").charAt(0)){var s=n.find("img"),c={width:a.width,height:a.height,left:a.left,top:a.top,imgStyle:{width:s.width(),height:s.height(),marginTop:s.css("marginTop"),marginLeft:s.css("marginLeft")}};r.updateCompSize(n.attr("id"),c,i)}else if("p"==n.attr("ctype").charAt(0)){var l=t.getProperties();if(!l||!l.children)return;var d=n.find(".slider"),u=d.attr("id");d.empty();for(var p=0;p<l.children.length;p++)d.append('<img src="'+PREFIX_FILE_HOST+l.children[p].src+'">');utilPictures.deleteInterval(u),new flux.slider("#nr #"+u,{autoplay:l.autoPlay,delay:l.interval,pagination:!1,transitions:[utilPictures.getPicStyle(l.picStyle).name],width:a.width,height:a.height,bgColor:l.bgColor,onStartEnd:function(e){utilPictures.addInterval(u,e)}}),r.updateCompSize(n.attr("id"),a,i)}else r.updateCompSize(n.attr("id"),a,i)},u}]).factory("gridGuide",["panStateTracker","DetectionBox","selectService","editAreaBorderCollisionDetector",function(e,t,n,i){var r={init:function(e){this.color=this.getColor()?this.getColor():"rgba(150, 150, 150, 0.2)",this.$container=e,this.render(),setTimeout(function(){"disable"!=r.getVisable()&&r.show()},1)},render:function(){this.domElement=$('<div class="eq-block-grid">'),this.canvasElement=$('<canvas class="eq-block-grid-inner">').appendTo(this.domElement)},show:function(){this.domElement.appendTo(this.$container),this.paint(),this.enabled=!0},hide:function(){this.domElement.remove(),this.enabled=!1},setVisable:function(e){window.localStorage&&localStorage.setItem("sceneGridVisable",e)},getVisable:function(){return window.localStorage?localStorage.getItem("sceneGridVisable"):void 0},setColor:function(e){window.localStorage&&localStorage.setItem("sceneGridColor",e)},getColor:function(){return window.localStorage?localStorage.getItem("sceneGridColor"):void 0},getGuideState:function(){return window.localStorage?localStorage.getItem("sceneGridState"):void 0},setGuideState:function(e){window.localStorage&&localStorage.setItem("sceneGridState",e)},getSnapState:function(){return window.localStorage?localStorage.getItem("sceneSnapState"):void 0},setSnapState:function(e){window.localStorage&&localStorage.setItem("sceneSnapState",e)},paint:function(){var e=320,t=486,n=this.getRows(),i=this.getCols(),r=Math.round(e/i),o=Math.round(t/n),a=(t-o*n)/2;this.canvasElement.css({left:0,top:0}),this.canvasElement.attr({width:e,height:t});var s=this.canvasElement.get(0).getContext("2d");s.clearRect(0,0,e,t);for(var c=1;i>c;c++)s.fillStyle=this.color,s.fillRect(Math.floor(c*r),0,1,t);for(var l=1;n>l;l++)s.fillStyle=this.color,s.fillRect(0,Math.floor(l*o)+a,e,1)},getRows:function(){return 16},getCols:function(){return 10}},o={snap:!r.getSnapState()||r.getSnapState(),action:"move",threshold:1,enabled:!r.getGuideState()||r.getSnapState()},a={init:function(e){this.guides={h:[],v:[]},this.slideBounds={width:320,height:486,x:0,y:0},this.render(),e.append(this.domElement),this.options=o},render:function(){this.domElement=$('<div class="eq-block-guides">')},start:function(i){if(this.options.enabled){this.allBlocks=[],e.forEach(function(e,n){a.allBlocks.push(new t(e))}),this.targetBlocks=[],angular.forEach(n.getElements(),function(e){a.allBlocks.forEach(function(t){t.element.attr("id")=="inside_"+e&&a.targetBlocks.push(t)})}),this.gridLines=[];var s=r.getCols(),c=r.getRows(),l=Math.round(this.slideBounds.width/s),d=Math.round(this.slideBounds.height/c),u=(this.slideBounds.height-d*c)/2;if(r.enabled){for(var p=1;s>p;p++)this.gridLines.push(this.getCenterEdge({x:p*l,y:0,width:0,height:this.slideBounds.height},"grid-col-"+p,"horizontal"));for(var h=1;c>h;h++)this.gridLines.push(this.getCenterEdge({x:0,y:h*d+u,width:this.slideBounds.width,height:0},"grid-row-"+h,"vertical"))}this.gridLines.push(this.getCenterEdge({x:this.slideBounds.width/2,y:0,width:0,height:this.slideBounds.height},"grid-col-center","horizontal")),this.gridLines.push(this.getCenterEdge({x:0,y:this.slideBounds.height/2,width:this.slideBounds.width,height:0},"grid-row-center","vertical")),this.options=$.extend(o,i)}},stop:function(){this.clearGuideElements()},sync:function(e){this.options.enabled&&(this.findGuides(e),this.renderGuides())},findGuides:function(e){e=angular.extend({x:0,y:0,width:0,height:0},e),this.guides.h.length=0,this.guides.v.length=0;var t={x:i.bigDetectionBoxPointA.x+e.x,y:i.bigDetectionBoxPointA.y+e.y,width:i.bigDetectionBoxPointB.x-i.bigDetectionBoxPointA.x+e.width,height:i.bigDetectionBoxPointB.y-i.bigDetectionBoxPointA.y+e.height},n=this.getEdges(t,"target-bounds","resize"===this.options.action);this.combinedBounds=t,this.allBlocks.forEach(function(e){-1===a.targetBlocks.indexOf(e)&&a.compageEdges(n,a.getEdges(e.measure(),e.getID()),a.options.threshold)}),this.gridLines.forEach(function(e){a.compageEdges(n,e,a.options.threshold)}),this.guides.h.sort(function(e,t){return e.distance-t.distance}),this.guides.v.sort(function(e,t){return e.distance-t.distance})},enforceGuides:function(e){if(this.options.enabled){var t=this.options.threshold;this.options.threshold=3,this.findGuides(e),this.options.threshold=t;var n,i=0,r=0;this.guides.h.length&&(n=this.guides.h[0],i=n.compareEdge.x-n.targetEdge.x),this.guides.v.length&&(n=this.guides.v[0],r=n.compareEdge.y-n.targetEdge.y),e.x+=i,e.y+=r}},compageEdges:function(e,t,n){var i;e.h.forEach(function(e){t.h.forEach(function(t){i=Math.abs(e.x-t.x),n>i&&a.guides.h.push({distance:i,targetEdge:e,compareEdge:t})})}),e.v.forEach(function(e){t.v.forEach(function(t){i=Math.abs(e.y-t.y),n>i&&a.guides.v.push({distance:i,targetEdge:e,compareEdge:t})})})},renderGuides:function(){var e=[];this.guides.h.forEach(function(t){e.push(a.renderGuide(t))}),this.guides.v.forEach(function(t){e.push(a.renderGuide(t))}),this.clearGuideElements(e)},renderGuide:function(e){var t=e.targetEdge,n=e.compareEdge,i=$('[data-guide-id="'+n.id+'"]');0===i.length&&(i=$('<div data-guide-id="'+n.id+'">').appendTo(this.domElement),setTimeout(function(){i.addClass("show")},1));var r={top:Math.min(n.bounds.y,this.combinedBounds.y),right:Math.max(n.bounds.x+n.bounds.width,this.combinedBounds.x+this.combinedBounds.width),bottom:Math.max(n.bounds.y+n.bounds.height,this.combinedBounds.y+this.combinedBounds.height),left:Math.min(n.bounds.x,this.combinedBounds.x)};if("number"==typeof n.y){var o="s"===t.direction?-1:0;i.addClass("guide-h"),i.css({top:Math.floor(n.y+o),left:r.left,width:r.right-r.left})}else{var a="e"===t.direction?-1:0;i.addClass("guide-v"),i.css({left:Math.floor(n.x+a),top:r.top,height:r.bottom-r.top})}return n.id},getEdges:function(e,t,n){var i={h:[{id:t+"-h1",bounds:e,x:e.x,offset:0,direction:"w"},{id:t+"-h2",bounds:e,x:e.x+e.width/2,offset:-e.width/2,direction:"hc"},{id:t+"-h3",bounds:e,x:e.x+e.width,offset:-e.width,direction:"e"}],v:[{id:t+"-v1",bounds:e,y:e.y,offset:0,direction:"n"},{id:t+"-v2",bounds:e,y:e.y+e.height/2,offset:-e.height/2,direction:"vc"},{id:t+"-v3",bounds:e,y:e.y+e.height,offset:-e.height,direction:"s"}]};return n&&(i.h.splice(1,1),i.v.splice(1,1)),i},getCenterEdge:function(e,t,n){var i={h:[],v:[]};return"vertical"===n?i.v.push({id:t+"-v2",bounds:e,y:e.y+e.height/2,offset:-e.height/2,direction:t}):i.h.push({id:t+"-h2",bounds:e,x:e.x+e.width/2,offset:-e.width/2,direction:t}),i},clearGuideElements:function(e){var t=this.domElement.find(".guide-v, .guide-h");e&&e.length&&(t=t.filter(function(t,n){return-1===e.indexOf(n.getAttribute("data-guide-id"))})),t.remove()}};return{grid:r,guide:a}}]).directive("pasteElement",["sceneService",function(e){function t(){var t=$('<ul id="pasteMenu" class="dropdown-menu" style="min-width: 100px; display: block;" role="menu" aria-labelledby="dropdownMenu1"><li class="paste" style="text-align:center;" role="presentation"><a role="menuitem" tabindex="-1"><div class="fa fa-paste"></div>&nbsp;&nbsp;粘贴</a></li></ul>').css({position:"absolute","user-select":"none"});return t.find(".paste").on("click",function(){e.pasteElement(),t.hide()}),t}return{restrict:"EA",link:function(n,i,r){var o=$(i);o.on("contextmenu",function(n){if(e.getCopy()){var i=t(),r=$("#eq_main"),o=$("#pasteMenu");o.length>0&&o.remove(),r.append(i),i.css({left:n.pageX+r.scrollLeft()+15,top:n.pageY+r.scrollTop()}).show(),r.mousemove(function(e){var t=$("#pasteMenu");(e.pageX<t.offset().left-20||e.pageX>t.offset().left+t.width()+20||e.pageY<t.offset().top-20||e.pageY>t.offset().top+t.height()+20)&&(t.hide(),$(this).unbind("mousemove"))})}return!1})}}}]).directive("eqxEditDestroy",["selectService",function(e){return{link:function(t,n){n.on("$destroy",function(){e.clearElements(),utilPictures.clearInterval()})}}}]).directive("elementAnim",["selectService",function(e){function t(e,n,i,r){if(n.length&&r<n.length){var o=e.get(0);e.css("animation",""),o.offsetWidth=o.offsetWidth,e.css("animation",i[r]+" "+n[r].duration+"s ease 0s").css("animation-fill-mode","backwards"),e.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){r++,t(e,n,i,r)})}}return{restrict:"EA",link:function(e,n){var i;e.$on("previewCurrentChange",function(e,t){i=i=$("#inside_"+t.elemId+" .element-box");var n=i.get(0);n.offsetWidth=n.offsetWidth,i.css("animation",t.animClasses[t.count]+" "+t.anim.duration+"s ease 0s").css("animation-fill-mode","backwards")}),e.$on("previewAllChanges",function(e,n){i=i=$("#inside_"+n.elemId+" .element-box"),t(i,n.animations,n.animClasses,n.count)})}}}]).directive("outerBox",["DetectionBox","i18nNotifications","storageService",function(e,t,n){return{restrict:"AE",link:function(i,r,o,a){function s(e){"red"==e?(c.show(),c.css("background-color","#ff5548"),r.find(".internal-box").toggleClass("out-warning",!1),isOuter=!0):"yellow"==e?(c.show(),isOuter=!1,c.css("background-color","#F2A653"),d&&r.find(".internal-box").toggleClass("out-warning",!0)):(isOuter=!1,r.find(".internal-box").toggleClass("out-warning",!1),c.hide()),
d&&r.toggleClass("on",isOuter)}var c=$("#warn"),l="";c.click(function(){"red"==l?(t.removeAll(),t.pushForCurrentRoute("outbox.warning","notify.warning")):"yellow"==l&&(t.removeAll(),t.pushForCurrentRoute("outbox.tip","notify.warning"))});var d="false"==n.get("create.phoneView");d||(r.css("border-color","transparent"),r.find(".internal-box").css("border-color","transparent")),i.$on("switchBox",function(e,t){d=!t,t?(r.css("border-color","transparent"),r.find(".internal-box").css("border-color","transparent")):(r.css("border-color",""),r.find(".internal-box").css("border-color",""),s(l))}),i.$on("boxOuter",function(n){for(var r="",o=i.tpl.obj.elements,a=0;a<o.length;a++)if(3!=o[a].type){var c=o[a].id,u=$("#inside_"+c);if(0!=u.length){var p=u.position(),h=new e(u);if(d&&(p.left<-29||p.top<-19||h.startPointB.y>501||h.startPointB.x>345)){r="red";break}(p.left<-1||p.top<-1||h.startPointB.y>486||h.startPointB.x>320)&&(r="yellow")}}l!=r&&("red"==r?(t.removeAll(),t.pushForCurrentRoute("outbox.warning","notify.warning")):"yellow"==r?(t.removeAll(),t.pushForCurrentRoute("outbox.tip","notify.warning")):t.removeAll()),l=r,s(r)})}}}]),angular.module("app.directives.editor",[]).directive("toolbar",["$compile","sceneService",function(e,t){function n(n,r,o){var a=t.currentElemDef;"x"==a.type?(n.showCustomFamilyFont=!0,n.showLinkOption=!1,i(n)):(n.showCustomFamilyFont=!1,n.showLinkOption=!0),r.bind("keydown",function(e){e.stopPropagation()}),n.internalLinks=angular.copy(n.pages),n.internalLink||n.externalLink||(n.internalLink=n.internalLinks[0],n.externalLink="http://");try{n.fontColor=$(a.content).css("color"),n.backgroundColor=$(a.content).css("background-color")}catch(e){}var s=["#000000","#7e2412","#ff5400","#225801","#0c529e","#333333","#b61b52","#f4711f","#3bbc1e","#23a3d3","#888888","#d34141","#f7951e","#29b16a","#97daf3","#cccccc","#ec7c7c","#fdea02","#79c450","#563679","#ffffff","#ffcccc","#d9ef7f","#c3f649"],c=$(".color-menu"),l=$(".bgcolor-menu");$.each(s,function(e,t){c.append($('<li><a dropdown-toggle class="btn" data-edit="foreColor '+t+'" style="background-color: '+t+'"></a></li>'))}),e(c.append($('<li style="position: relative;"><a ng-model="fontColor" ng-click="setSelection()" colorpicker-Position="sceneToobar" class="btn glyphicon glyphicon-remove" colorpicker="rgba" style="background-color: transparent"></a><em style="background-color:#ff5448;position:absolute;height:10px;width:10px;top:0;left:0;z-index:-1"></em><em style="background-color:#f2a653;position:absolute;height:10px;width:10px;top:0;left:10px;z-index:-1"></em><em style="background-color:#08a1ef;position:absolute;height:10px;width:10px;top:10px;left:0;z-index:-1"></em><em style="background-color:#44cb83;position:absolute;height:10px;width:10px;top:10px;left:10px;z-index:-1"></em></li>')))(n),n.$watch("fontColor",function(e,t){e&&e!=t&&document.execCommand("foreColor",0,e)});var d=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,i){return t+t+n+n+i+i});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null};$.each(s,function(e,t){var n=d(t);l.append($('<li><a dropdown-toggle class="btn" data-edit="backColor rgba('+n.r+","+n.g+","+n.b+', 0.3)" style="background-color: rgba('+n.r+","+n.g+","+n.b+', 0.3)"></a></li>'))}),e(l.append($('<li style="position: relative;"><a ng-model="backgroundColor" ng-click="setSelection()" colorpicker="rgba" colorpicker-Position="sceneToobar" class="btn glyphicon glyphicon-remove" style="background-color: transparent"></a><em style="background-color:#ff5448;position:absolute;height:10px;width:10px;top:0;left:0;z-index:-1"></em><em style="background-color:#f2a653;position:absolute;height:10px;width:10px;top:0;left:10px;z-index:-1"></em><em style="background-color:#08a1ef;position:absolute;height:10px;width:10px;top:10px;left:0;z-index:-1"></em><em style="background-color:#44cb83;position:absolute;height:10px;width:10px;top:10px;left:10px;z-index:-1"></em></li>')))(n),n.$watch("backgroundColor",function(e){e&&document.execCommand("backColor",0,e)}),n.setSelection=function(){var e=window.getSelection();e.getRangeAt&&e.rangeCount&&e.getRangeAt(0),e.modify("move","left","documentboundary"),e.modify("extend","right","documentboundary")},a.css.lineHeight=(parseFloat(a.css.lineHeight)||1).toFixed(1),n.increaseLineHeight=function(){var e=window.getSelection(),t=e.focusNode,n=$(t).parents(".element-box");a.css.lineHeight=(parseFloat(a.css.lineHeight)+.1).toFixed(1),n.css("line-height",a.css.lineHeight),$(t.parentNode).focus()},n.decreaseLineHeight=function(){var e=window.getSelection(),t=e.focusNode,n=$(t).parents(".element-box");a.css.lineHeight>.1&&(a.css.lineHeight=(parseFloat(a.css.lineHeight)-.1).toFixed(1),n.css("line-height",a.css.lineHeight)),$(t.parentNode).focus()}}function i(e){var t=utilFont.getFontName(),n=$(".fontname-menu");$.each(t,function(e,t){n.append($('<li class="'+e+'"><a dropdown-toggle class="btn" data-edit="fontName '+e+'"><img src="'+CLIENT_CDN+t.blueSrc+'"/></a></li>')),$("."+e).hover(function(){$(this).find("img").attr("src",CLIENT_CDN+t.src)},function(){$(this).hasClass("selected-font")||$(this).find("img").attr("src",CLIENT_CDN+t.blueSrc)})})}return{restrict:"EA",replace:!0,templateUrl:"directives/toolbar.tpl.html",link:n}}]),angular.module("app.directives.uislider",[]).value("uiSliderConfig",{}).directive("uiSlider",["uiSliderConfig","$timeout",function(e,t){return e=e||{},{require:"ngModel",compile:function(){return function(n,i,r,o){function a(e,t){return t?parseFloat(e):parseInt(e,10)}function s(){i.slider("destroy")}var c=angular.extend(n.$eval(r.uiSlider)||{},e),l={min:null,max:null},d=["min","max","step"],u=!angular.isUndefined(r.useDecimals),p=function(){angular.isArray(o.$viewValue)&&c.range!==!0&&(console.warn("Change your range option of ui-slider. When assigning ngModel an array of values then the range option should be set to true."),c.range=!0),angular.forEach(d,function(e){angular.isDefined(r[e])&&(c[e]=a(r[e],u))}),i.slider(c),p=angular.noop};angular.forEach(d,function(e){r.$observe(e,function(t){t&&(p(),c[e]=a(t,u),i.slider("option",e,a(t,u)),o.$render())})}),r.$observe("disabled",function(e){p(),i.slider("option","disabled",!!e)}),n.$watch(r.uiSlider,function(e){p(),e!==undefined&&i.slider("option",e)},!0),t(p,0,!0),i.bind("slide",function(e,t){o.$setViewValue(t.values||t.value),n.$apply()}),o.$render=function(){p();var e=c.range===!0?"values":"value";c.range||!isNaN(o.$viewValue)||o.$viewValue instanceof Array?c.range&&!angular.isDefined(o.$viewValue)&&(o.$viewValue=[0,0]):o.$viewValue=0,c.range===!0&&(angular.isDefined(c.min)&&c.min>o.$viewValue[0]&&(o.$viewValue[0]=c.min),angular.isDefined(c.max)&&c.max<o.$viewValue[1]&&(o.$viewValue[1]=c.max),o.$viewValue[0]>o.$viewValue[1]&&(l.min>=o.$viewValue[1]&&(o.$viewValue[0]=l.min),l.max<=o.$viewValue[0]&&(o.$viewValue[1]=l.max)),l.min=o.$viewValue[0],l.max=o.$viewValue[1]),i.slider(e,o.$viewValue)},n.$watch(r.ngModel,function(){c.range===!0&&o.$render()},!0),i.bind("$destroy",s);var h=$('<div class="ui-slider-progress-bar"></div>');i.append(h);var g=n.$watch(r.ngModel,function(){setTimeout(function(){h.css("width",$(".ui-slider-handle",i).css("left"))})},!0);i.bind("$destroy",function(){g()})}}}}]).directive("uiSliderT",["$rootScope",function(e){var t=$(document);return{require:"ngModel",template:'<div class="slider-con"></div>',link:function(n,i,r,o){i.on("$destroy",function(){i.unbind("mousedown")});var a="string"==typeof r.min?r.min:-Number.MAX_VALUE,s="string"==typeof r.max?r.max:Number.MAX_VALUE,c="string"==typeof r.step?r.step:1,l=s/100,d="string"==typeof r.max?r.fixed:0;o.$render=function(){i.find(".slider-con").css("width",100*o.$modelValue/s+"%")},i.mousedown(function(i){i.stopPropagation();var u,p=i.offsetX,h=i.pageX,g=function(e){e.stopPropagation(),u=e.pageX-h;var t=+((p+u)*l/c).toFixed(d)*c;t>s?t=+s:a>t&&(t=+a),o.$viewValue!=t&&(o.$setViewValue(t),o.$render(),n.$apply())},f=function(){t.unbind("mouseup",f),t.unbind("mousemove",g),r.hisRecords&&e.$broadcast("hisChange")};t.mousemove(g),t.mouseup(f)}),i.click(function(t){t.stopPropagation(),o.$setViewValue(+(t.offsetX*s/100/c).toFixed(d)*c),o.$render(),n.$apply(),r.hisRecords&&e.$broadcast("hisChange")})}}}]),angular.module("security.authority",[]).factory("authority",["$translate",function(e){var t={GROUP_CUSTOMER:1,SCENE_HIDE_LASTPAGE_SETTING:2,TRANSFER_SCENE:4,SCENE_EDIT_TRIGGER:8,EXPAND_WEBSITE:16,SCENE_EDIT_SOUND:32,ACCESS_NEW_PAGEFLIP:64,COMP_ANIMATION:128,RADIO_CHECKBOX_RATING:256,INTERACTION:512,ACCESS_DOMAIN_BIND:1024,LOADING_LOGO:2048,TEMPLATE_PAYMENT:4096,INTERACTION_COUNTER:8192,SCENE_PASSWORD:16384,USERCENTER_HISTORY:32768,APPLY_XIUKE:65536,SHAKE_TRIGGER:131072},n={1:{code:74045,name:e.instant("common.security.CUSTOM_USER")},2:{code:61439,name:e.instant("common.security.COMPANY_USER")},21:{code:59903,name:e.instant("common.security.COMPANY_USER2")},3:{code:193535,name:e.instant("common.security.SENIOR_USER")},4:{code:128511,name:e.instant("common.security.SERVICE_USER")},12:{code:127999,name:e.instant("common.security.VIP_USER")}};return{accessDef:t,userRoleDef:n}}]),angular.module("security.authorization",["security.service"]).provider("securityAuthorization",{requireAdminUser:["securityAuthorization",function(e){return e.requireAdminUser()}],requireAuthenticatedUser:["securityAuthorization",function(e){return e.requireAuthenticatedUser()}],$get:["security","securityRetryQueue",function(e,t){var n={requireAuthenticatedUser:function(){var i=e.requestCurrentUser().then(function(i){return e.isAuthenticated()?void 0:t.pushRetryFn("unauthenticated-client",n.requireAuthenticatedUser)});return i},requireAdminUser:function(){var i=e.requestCurrentUser().then(function(i){return e.isAdmin()?void 0:t.pushRetryFn("unauthorized-client",n.requireAdminUser)});return i}};return n}]}),angular.module("security",["security.service","security.interceptor","security.login","security.authorization"]),angular.module("security.interceptor",["security.retryQueue"]).factory("securityInterceptor",["$injector","$location","securityRetryQueue","$translate",function(e,t,n){return function(i){return i.then(null,function(r){return 401===r.status&&(i=n.pushRetryFn("unauthorized-server",function(){return e.get("$http")(r.config)})),403===r.status&&(alert("对不起，您没有查看此内容的权限"),t.path("/home")),i})}}]).config(["$httpProvider",function(e){e.responseInterceptors.push("securityInterceptor");var t=[PREFIX_URL+"login",PREFIX_URL+"index.php?c=scene&a=createpage&id=",PREFIX_URL+"m/scene/pageList",PREFIX_URL+"index.php?c=upfile&a=upload",PREFIX_URL+"m/c/group/create",PREFIX_URL+"index.php?c=scene&a=my",PREFIX_URL+"index.php?c=scene&a=syslist",PREFIX_URL+"index.php?c=scene&a=saveSettings",PREFIX_URL+"m/scene/stat"];e.interceptors.push(["$q",function(e){var n=0;return{request:function(r){var o=r.url;for(i=0;i<t.length;i++)0===o.indexOf(t[i])&&($("#loading").show(),n++);return r||e.when(r)},response:function(r){var o=r.config.url;for(i=0;i<t.length;i++)0===o.indexOf(t[i])&&(n--,n||$("#loading").hide());return r||e.when(r)}}}])}]),angular.module("security.login.form",["services.localizedMessages","app.directives.addelement","security.thirdparty"]).controller("LoginFormController",["$scope","$timeout","$window","$translate","security","localizedMessages","$location","$sce","thirdpartyService","dataCacheService",function(e,t,n,i,r,o,a,s,c,l){if(e.user={},e.retrieve={},e.showLogin=!0,e.sendPassword=!1,e.unExist=!1,e.authError=null,e.isValidateCodeLogin=r.isValidateCodeLogin,e.validateCodeSrc=PREFIX_URL+"servlet/validateCodeServlet",e.authReason=null,r.getLoginReason()&&(e.authReason=r.isAuthenticated()?o.get("login.reason.notAuthorized"):"您的账号已在其它地方登录，如非本人操作，请立即修改密码确保账号安全！"),window.localStorage){var d=localStorage.getItem("userEmail");d&&(e.user.email=d)}e.rotate=function(n){$(".modal-content").addClass("flip"),$(".login-form-section").fadeOut(600),t(function(){e.showLogin=!n,$(".login-form-section").fadeIn(0),$(".modal-content").removeClass("flip")},600)},e.login=function(){e.user.rememberAcc&&e.user.email?localStorage.setItem("userEmail",e.user.email):localStorage.removeItem("userEmail"),e.authError=null;var t={username:e.user.email,password:e.user.password,rememberMe:e.user.rememberMe};return!e.isValidateCodeLogin||(t.geetest_challenge=challenge,t.geetest_validate=validate,t.geetest_seccode=seccode,challenge&&validate&&seccode)?e.user.email?e.user.password?void r.login($.param(t)).then(function(t){challenge=null,validate=null,seccode=null,l.clear(),t?(selectorA&&selectorA(".gt_refresh_button").click(),1005===t.code,t.map&&(e.isValidateCodeLogin=t.map.isValidateCodeLogin),e.authReason="",e.authError=t.msg):(e.authError=o.get("login.error.invalidCredentials"),submit=!1)},function(t){e.authError=o.get("login.error.serverError",{exception:t})}):(e.authReason="",void(e.authError="密码不能为空")):(e.authReason="",void(e.authError="邮箱不能为空")):(e.authReason="",void(e.authError="验证码不能为空"))},e.openRegister=function(){a.path("/home/register",!1)},e.clearForm=function(){e.user={}},e.cancelLogin=function(){r.cancelLogin()},e.reset=function(){e.user={},e.retrieve={}};var u="http://api.geetest.com/get.php?gt=1ebc844c9e3a8c23e2ea4b567a8afd2d&time="+(new Date).getTime();e.validateCodeUrl=s.trustAsResourceUrl(u),t(function(){$('input[name="userEmail"]').focus()},300),e.retrievePassword=function(){return e.retrieve.email?submit?challenge&&validate&&seccode?void r.retrievePassword(e.retrieve.email,challenge,validate,seccode).then(function(t){challenge="",validate="",seccode="",200==t.data.code?(e.sendPassword=!0,submit=!1):(selectorA&&selectorA(".gt_refresh_button").click(),1003==t.data.code?e.retrieveError="账号不存在":1005==t.data.code&&(e.retrieveError="验证码错误"))}):void(e.retrieveError="验证码不能为空"):void(e.retrieveError="验证码匹配错误"):void(e.retrieveError="邮箱不能为空")},e.openThirdPatyWindow=function(e){r.cancelLogin(),c.openThirtyPartyWindow(e)}}]),angular.module("security.login.reset",["services.localizedMessages"]).controller("ResetFormController",["$scope","security","localizedMessages","$location","resetKey",function(e,t,n,i,r){e.password={},e.checkPassword=function(){if(e.password.newPw){if(/^[a-zA-Z0-9]{6,16}$/g.test(e.password.newPw))return e.passError=null,!0;e.passError="密码为6~16个字符(英文字母或数字，区分大小写)"}else e.passError="新密码不能为空";return!1},e.checkRepeatPassword=function(){if(e.password.confirm){if(e.password.confirm==e.password.newPw)return e.rPassError="",!0;e.rPassError="两次密码输入不一致，请重新输入"}else e.rPassError="确认密码不能为空";return!1},e.reset=function(){e.checkPassword()&&e.checkRepeatPassword()&&t.resetPassByKey(e.password.newPw,r).then(function(t){200==t.data.code?(alert("修改成功"),e.$close(),i.path("/main").search({})):1011==t.data.code&&(e.authError=t.data.msg)})},e.cancel=function(){e.$dismiss()}}]).directive("equals",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,i){if(i){e.$watch(n.ngModel,function(){r()}),n.$observe("equals",function(e){r()});var r=function(){var e=i.$viewValue,t=n.equals;i.$setValidity("equals",e===t)}}}}}),angular.module("security.login",["security.login.form","security.login.reset","security.login.toolbar"]),angular.module("security.login.toolbar",["services.usercenter"]).directive("loginToolbar",["security","$rootScope","usercenterService","$location",function(e,t,n,i){var r={templateUrl:"security/login/toolbar.tpl.html",restrict:"E",replace:!0,scope:!0,link:function(n,r,o,a){n.PREFIX_FILE_HOST=PREFIX_FILE_HOST,n.isAuthenticated=e.isAuthenticated,n.login=e.showLogin,n.logout=e.logout,n.requestResetPassword=e.requestResetPassword,n.isAdvancedUser=t.isAdvancedUser,n.isEditor=t.isEditor,n.isVendorUser=t.isVendorUser,n.$watch(function(){return e.currentUser},function(e){n.currentUser=e,n.currentUser.headImg?/^http.*/.test(e.headImg)&&(n.headImg=e.headImg):n.headImg=CLIENT_CDN+"assets/images/defaultuser.jpg"}),n.$on("headImg.change",function(e,t){n.currentUser.headImg=t}),n.$on("minusCount",function(e,t){n.count-=t,n.newMsgCount=n.count>9?"9+":n.count}),n.changeCurrent=function(){t.branchid="",i.search("branchid",null),i.path("/usercenter/children")},n.openMsgPanel=function(){!$(".mes_con").hasClass("open")}}};return r}]),angular.module("security.otherregister.form",["services.localizedMessages","app.directives.register"]),angular.module("security.otherregister.form").controller("OtherRegisterFormController",["$scope","$timeout","security","localizedMessages","$location","$http","$window","otherRegisterInfo",function(e,t,n,i,r,o,a,s){e.user={},e.user.agreement=!0,e.getUserDetail=function(){var t={type:"qq",openId:s.openId,accessToken:s.accessToken};n.getUserDetail(t.type,t.openId,t.accessToken).then(function(t){e.otherUserInfo=t.data.obj})},e.getUserDetail()}]),angular.module("security.register.form",["services.localizedMessages","app.directives.register","security.thirdparty"]),angular.module("security.register.form").controller("RegisterFormController",["$scope","$timeout","$translate","security","localizedMessages","$location","$http","$window","thirdpartyService","regMsg",function(e,t,n,i,r,o,a,s,c,l){l?e.user=l:e.user={},e.user.agreement=!0,e.regErr="注册一个有效的账号，更好体验功能";var d=!1;e.openWeibo=function(){alert("新浪微博注册功能即将开放")},e.register=function(){var t={loginName:e.user.email,password:e.user.password};e.userNotExist&&e.checkUsername()&&e.checkPassword()&&e.checkRepeatPassword()&&u&&u.then(function(){if(e.user.password===e.user.repeatPassword&&e.user.agreement){if(d)return;d=!0;var n="";location.hash.indexOf("?")>=0&&(n=location.hash.replace("#/home/register","")),i.register($.param(t),n).then(function(t){d=!1,t&&(e.regErr=t.msg)},function(t){d=!1,e.regErr=r.get("register.error.serverError",{exception:t})})}else e.user.password!=e.user.repeatPassword?e.regErr=r.get("register.error.match"):e.regErr=r.get("register.error.agreement")})};var u=null;e.checkUniqueness=function(t){u=i.checkUniqueness(t).success(function(t){e.userNotExist=t.success,e.userNotExist?e.usernameError=null:e.usernameError="账号已存在，请重新填写"})},e.checkIconUser="",e.checkIconPass="",e.checkIconRePass="",e.checkUsername=function(){if(e.user.email){if(/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(e.user.email))return e.checkUniqueness(e.user.email),!0;e.usernameError="账号为6-40个字符(英文字母或数字，只支持小写)以及-_@.的组合"}else e.usernameError="账号不能为空";return!1},e.checkPassword=function(){if(e.user.password){if(/^[a-zA-Z0-9]{6,16}$/g.test(e.user.password))return e.passError=null,!0;e.passError="密码为6~16个字符(英文字母或数字，区分大小写)"}else e.passError="密码不能为空";return!1},e.checkRepeatPassword=function(){if(e.user.repeatPassword){if(e.user.repeatPassword==e.user.password)return e.rPassError="",!0;e.rPassError="两次密码输入不一致，请重新输入"}else e.rPassError="确认密码不能为空";return!1},e.openLogin=function(){o.path("/home/login",!1)},e.reset=function(){e.user={}},e.openThirdPatyWindow=function(e){i.cancelRegister(),c.openThirtyPartyWindow(e)}}]).controller("BindingController",["$rootScope","$scope","$timeout","security","localizedMessages","$location","$http","$window",function(e,t,n,i,r,o,a,s){t.qq_url="https://graph.qq.com/oauth2.0/authorize?response_type=token&client_id="+client_id+"&redirect_uri="+redirect_uri+"&display=pc",t.weibo_url="https://api.weibo.com/oauth2/authorize?client_id=3508809852&response_type=token&redirect_uri="+PREFIX_HOST}]),angular.module("security.register",["security.register.form","security.otherregister.form"]),angular.module("security.retryQueue",[]).factory("securityRetryQueue",["$q","$log",function(e,t){var n=[],i={onItemAddedCallbacks:[],hasMore:function(){return n.length>0},push:function(e){n.push(e),angular.forEach(i.onItemAddedCallbacks,function(n){try{n(e)}catch(e){t.error("securityRetryQueue.push(retryItem): callback threw an error"+e)}})},pushRetryFn:function(t,n){1===arguments.length&&(n=t,t=undefined);var r=e.defer(),o={reason:t,retry:function(){e.when(n()).then(function(e){r.resolve(e)},function(e){r.reject(e)})},cancel:function(){r.reject()}};return i.push(o),r.promise},retryReason:function(){return i.hasMore()&&n[0].reason},cancelAll:function(){for(;i.hasMore();)n.shift().cancel()},retryAll:function(){for(;i.hasMore();)n.shift().retry()}};return i}]),angular.module("security.service",["security.retryQueue","security.login","security.register","security.authority","ui.bootstrap.modal"]).factory("security",["$rootScope","$http","$q","$location","securityRetryQueue","$modal","ModalService","authority",function(e,t,n,i,r,o,a,s){function c(e){e=e||"/",window.location.href=e}function l(){if(w&&(d(w,!1),w=null),y)throw new Error("Trying to open a dialog that is already open!");y=o.open({windowClass:"login-container",keyboard:!1,templateUrl:"security/login/form.tpl.html",controller:"LoginFormController"}),y.result.then(u,u)}function d(e,t){e.close(t)}function u(e){y=null,e?("/home/login"==i.path()&&i.path("/home",!1),r.retryAll()):(r.cancelAll(),c())}function p(e){if(b)throw new Error("Trying to open a dialog that is already open!");b=o.open({windowClass:"login-container",keyboard:!1,templateUrl:"security/login/reset.tpl.html",controller:"ResetFormController",resolve:{resetKey:function(){return e}}}),b.result.then(function(){b=null},function(){x.currentUser||i.path("/home",!1).search({}),b=null})}function h(e){if(y&&(d(y,!0),y=null),w)throw new Error("Trying to open a dialog that is already open!");w=o.open({windowClass:"login-container",keyboard:!1,templateUrl:"security/register/register.tpl.html",controller:"RegisterFormController",resolve:{regMsg:function(){return e}}}),w.result.then(function(){w=null},function(){"/home/register"==i.path()&&i.path("/home",!1),w=null})}function g(e){if(E)throw new Error("Trying to open a dialog that is already open!");E=o.open({windowClass:"login-container",keyboard:!1,templateUrl:"security/register/otherregister.tpl.html",controller:"OtherRegisterFormController",resolve:{otherRegisterInfo:function(){return e}}})}function f(e){S=e}function m(){return S}function v(){y=null}var y=null,b=null,w=null,E=null;r.onItemAddedCallbacks.push(function(e){r.hasMore()&&x.showLogin()});var S={},x={getLoginReason:function(){return r.retryReason()},showLogin:function(){l()},showRegister:function(e){h(e)},showOtherRegister:function(){g()},getUserDetail:function(e,n,i){var r=PREFIX_URL+"base/relUserInfo?type="+e+"&openId="+n+"&accessToken="+i,o=new Date;return r+="&date="+o.getTime(),t({method:"GET",url:r,withCredentials:!0})},checkUniqueness:function(e){var n=PREFIX_S1_URL+"index.php?c=user&a=checkN&username="+e,i=new Date;return n+="&date="+i.getTime(),t({method:"GET",url:n,withCredentials:!0})},addRegisterInfo:f,getRegisterInfo:m,login:function(e){var n=this,r=t.post(PREFIX_URL+"index.php?c=user&a=login",e,{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});return r.then(function(e){return 200===e.status?(n.isValidateCodeLogin=!1,e.data.success===!0?(d(y,!0),x.requestCurrentUser().then(function(){("/home"==i.path()||"/home/login"==i.path())&&i.path("main")}),e.data):e.data):void x.isAuthenticated()},function(e){x.isAuthenticated()})},closeLoginDialog:v,register:function(e,n){var r=t.post(PREFIX_URL+"index.php?c=user&a=register"+n,e,{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});return r.then(function(e){return 200===e.status?(alert(e.data.msg),void i.path("home/login")):void x.isAuthenticated()},function(e){x.isAuthenticated()})},qqLogin:function(e,t){x.getThirdPartyInfo(e).then(function(n){var i=n.openid,r=(n.client_id,{email:"",password:"",openId:i,accessToken:e,type:"qq",expires:t});x.thirdPartLogin(r)})},thirdPartLogin:function(e){var n=t.post(PREFIX_URL+"index.php?c=otherlogin",$.param(qqRegisterInfo),{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});return n.then(function(e){if(200===e.status){if(e.data.success!==!0)return e.data;("/home"==i.path()||"/home/login"==i.path())&&i.path("main"),x.setLoginSuccess(!0),x.requestCurrentUser(),d(E,!0)}else x.isAuthenticated()},function(e){x.isAuthenticated()})},getThirdPartyInfo:function(e){var t="https://graph.qq.com/oauth2.0/me?access_token="+e;return $.ajax({type:"get",url:t,dataType:"jsonp",jsonp:"jsoncallback",jsonpCallback:"callback",xhrFields:{withCredentials:!0}})},weiChatLogin:function(e){return t.post(PREFIX_URL+"index.php?c=otherlogin&code="+e+"&type=weixin&time="+(new Date).getTime(),{},{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},cancelRegister:function(){w=null,i.path("/home",!1)},hasRel:function(e){w&&d(w,!1);var n=new Date,r=PREFIX_URL+"base/user/hasRel?type="+e.type+"&openId="+e.openId+"&time="+n.getTime(),o=t.get(r,{withCredentials:!0});o.then(function(t){200===t.status?t.data.success===!0?(("/home"==i.path()||"/home/login"==i.path())&&i.path("main"),x.requestCurrentUser()):"未关联账号"==t.data.msg&&g(e):x.isAuthenticated()},function(e){x.isAuthenticated()})},cancelLogin:function(){y=null,i.path("/home",!1)},logout:function(e){t({withCredentials:!0,method:"GET",url:PREFIX_URL+"?c=user&a=logout"}).then(function(t){x.currentUser=null,c(e)},function(){x.currentUser=null,c(e)})},userPromise:null,requestCurrentUser:function(){if(x.isAuthenticated())return n.when(x.currentUser);var e=new Date;return x.userPromise?x.userPromise:(x.userPromise=t.get(PREFIX_URL+"index.php?c=user&a=check&time="+e.getTime(),{withCredentials:!0}).then(function(e){return x.userPromise=null,e.data.success&&(x.currentUser=e.data.obj,(!x.currentUser.roleIdList||x.currentUser.roleIdList.length<=0)&&(x.currentUser.roleIdList=[2])),x.currentUser},function(){x.userPromise=null}),x.userPromise)},resetPassByKey:function(e,n){var i={key:n,newPwd:e};return t.post(PREFIX_URL+"index.php?c=user&a=reset_password",$.param(i),{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},currentUser:null,isAuthenticated:function(){return!!x.currentUser},isLoginSuccess:!1,setLoginSuccess:function(e){x.isLoginSuccess=e},thirdPartyUrl:{weiChatUrl:"https://open.weixin.qq.com/connect/qrconnect?appid=wxc5f1bbae4bb93ced&redirect_uri=http%3A%2F%2Fe.wesambo.com&response_type=code&scope=snsapi_login&state=WECHAT_STATE#wechat_redirect",qqUrl:"https://graph.qq.com/oauth2.0/authorize?response_type=token&client_id="+client_id+"&redirect_uri="+redirect_uri+"&scope=get_user_info",weiboUrl:"https://api.weibo.com/oauth2/authorize?client_id=3508809852&response_type=token&redirect_uri=http://e.wesambo.com"},isAllowToAccess:function(e){if(!x.currentUser)return!1;var t=s.userRoleDef[x.currentUser.type];return!!(t&&(t.code&e)>0)},accessDef:s.accessDef,isEditor:function(){if(!x.currentUser)return!1;var e=x.currentUser.roleIdList;if(!e)return!1;for(var t=0;t<e.length;t++)if("4"==e[t])return!0;return!1},isAdvancedUser:function(){return!(!x.currentUser||"3"!=x.currentUser.type)},isVendorUser:function(){return!(!x.currentUser||"4"!=x.currentUser.type)},requestResetPassword:function(e){p(e)},validateToken:function(e){var n="changepw?token="+e;return t.get(PREFIX_URL+n,{withCredentials:!0})},resetPassword:function(e,n){var i=PREFIX_URL+"index.php?c=Usercenter&a=changePwd",r={oldPwd:e,newPwd:n};return t.post(i,$.param(r),{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},retrievePassword:function(e,n,i,r){var o=PREFIX_URL+"index.php?c=user&a=forget_password",a={email:e,geetest_challenge:n,geetest_validate:i,geetest_seccode:r};return t.post(o,$.param(a),{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})}};return x}]),angular.module("security.thirdparty",["security.service"]).factory("thirdpartyService",["$rootScope","$http","$location","$window","security","$translate","i18nNotifications",function(e,t,n,i,r,o,a){function s(e){var t="https://graph.qq.com/oauth2.0/authorize?",n=client_id,i=["client_id="+n,"redirect_uri="+e,"scope=get_user_info","response_type=token"],r=i.join("&");return l=t+r}function c(e){var t="https://open.weixin.qq.com/connect/qrconnect?",n="wx5a3ca7ea184c3a3b",i=["appid="+n,"redirect_uri="+e,"scope=snsapi_login","response_type=code","state=WECHAT_STATE#wechat_redirect"],r=i.join("&");return d=t+r}var l,d,u={qqUrl:s,wxUrl:c,qqLogin:function(e,t){u.getThirdPartyInfo(e).then(function(n){var i=n.openid,r=(n.client_id,{email:"",password:"",openId:i,accessToken:e,type:"qq",expires:t});u.thirdPartLogin(r)})},thirdPartLogin:function(e){var i=t.post(PREFIX_URL+"index.php?c=otherlogin",$.param(e),{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});return i.then(function(e){if(200===e.status){if(e.data.success!==!0)return e.data;("/home"==n.path()||"/home/login"==n.path())&&n.path("main"),r.setLoginSuccess(!0),r.requestCurrentUser()}else r.isAuthenticated()},function(e){r.isAuthenticated()})},getThirdPartyInfo:function(e){var t="https://graph.qq.com/oauth2.0/me?access_token="+e;return $.ajax({type:"get",url:t,dataType:"jsonp",jsonp:"jsoncallback",jsonpCallback:"callback",xhrFields:{withCredentials:!0}})},weiChatLogin:function(e){return t.post(PREFIX_URL+"index.php?c=otherlogin&code="+e+"&type=weixin&time="+(new Date).getTime(),{},{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},unbindRelation:function(n){var i={type:n},r="m/u/unRelation";t({withCredentials:!0,method:"POST",url:PREFIX_URL+r,data:$.param(i),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(t){t.data.success&&e.$broadcast("mail.unbind.success",n)})},wxBindAccount:function(e){u.bindAccountCommon(e)},qqBindAccount:function(e){u.getThirdPartyInfo(e.access_token).then(function(t){var n=t.openid,i=(t.client_id,{openId:n,accessToken:e.access_token,expires:e.expires_in,type:"qq"});u.bindAccountCommon(i)},function(e){})},bindAccountCommon:function(n){var i="m/u/bind/third";t({withCredentials:!0,method:"POST",url:PREFIX_URL+i,data:$.param(n),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(t){t.data.success?e.$broadcast("rel.success",n.type):a.pushForCurrentRoute("already.bind.error","notify.success",{msg:t.data.msg})},function(e){alert(o.instant("common.security.SERVER_ERROR"))})},openThirtyPartyWindow:function(e){var t,n=redirect_uri;"qq"==e?t=u.qqUrl(n):"weixin"==e&&(t=u.wxUrl(n)),i.open(t,"_blank","width=600,height=600,menubar=no,toolbar=no,location=no,directories=no,status=no,scrollbars=yes,resizable=yes")}};return u}]),angular.module("services.active",[]).factory("activeService",["$rootScope","$http",function(e,t){var n={};return n.getActiveList=function(e,n,i){var r=PREFIX_S1_URL+"eqs/activity/scene";return e&&(r+=/\?/.test(r)?"&":"?",r+="promId="+e),n&&(r+=/\?/.test(r)?"&":"?",r+="pageNo="+n),i&&(r+=/\?/.test(r)?"&":"?",r+="pageSize="+i),t({withCredentials:!0,method:"GET",url:r})},n}]),angular.module("services.breadcrumbs",[]),angular.module("services.breadcrumbs").factory("breadcrumbs",["$rootScope","$location",function(e,t){var n=[],i={};return e.$on("$routeChangeSuccess",function(e,i){var r,o=t.path().split("/"),a=[],s=function(e){return"/"+o.slice(0,e+1).join("/")};for(o.shift(),r=0;r<o.length;r++)a.push({name:o[r],path:s(r)});n=a}),i.getAll=function(){return n},i.getFirst=function(){return n[0]||{}},i}]),angular.module("services.config",[]).factory("configService",["$http",function(e){var t=function(){var t=PREFIX_S2_URL+"index.php?c=ad&a=logo";return e({withCredentials:!0,method:"GET",url:t})},n=function(){var t=PREFIX_S2_URL+"index.php?c=ad&a=banner";return e({withCredentials:!0,method:"GET",url:t})},i=function(){var t=PREFIX_S2_URL+"index.php?c=ad&a=friendlinks";return e({withCredentials:!0,method:"GET",url:t})},r=function(t){var n=PREFIX_S2_URL+"eqs/banners?pageCode="+t;return e({withCredentials:!0,method:"GET",url:n})},o=function(){var t=PREFIX_S2_URL+"index.php?c=ad&a=product";return e({withCredentials:!0,
method:"GET",url:t})},a=function(){var t=JSON_URL+"?c=ad&a=getBanner70";return e({withCredentials:!0,method:"GET",url:t})},s=function(){var t=JSON_URL+"?c=ad&a=getMenu70";return e({withCredentials:!0,method:"GET",url:t})};return{getBanner70:a,getMenu70:s,getLogo:t,getBanners:n,getFriendLinks:i,getActivityBanner:r,getProduct:o}}]),angular.module("services.crud",["services.crudRouteProvider"]),angular.module("services.crud").factory("crudEditMethods",function(){return function(e,t,n,i,r){var o={};return o[e]=t,o[e+"Copy"]=angular.copy(t),o.save=function(){this[e].$saveOrUpdate(i,i,r,r)},o.canSave=function(){return this[n].$valid&&!angular.equals(this[e],this[e+"Copy"])},o.revertChanges=function(){this[e]=angular.copy(this[e+"Copy"])},o.canRevert=function(){return!angular.equals(this[e],this[e+"Copy"])},o.remove=function(){this[e].$id()?this[e].$remove(i,r):i()},o.canRemove=function(){return t.$id()},o.getCssClasses=function(e){var t=this[n][e];return{error:t.$invalid&&t.$dirty,success:t.$valid&&t.$dirty}},o.showError=function(e,t){return this[n][e].$error[t]},o}}),angular.module("services.crud").factory("crudListMethods",["$location",function(e){return function(t){var n={};return n.new=function(){e.path(t+"/new")},n.edit=function(n){e.path(t+"/"+n)},n}}]),function(){function e(e){this.$get=angular.noop,this.routesFor=function(t,n,i){var r=t.toLowerCase(),o="/"+t.toLowerCase();i=i||n,angular.isString(n)&&""!==n&&(r=n+"/"+r),null!==i&&i!==undefined&&""!==i&&(o="/"+i+o);var a=function(e){return r+"/"+t.toLowerCase()+"-"+e.toLowerCase()+".tpl.html"},s=function(e){return t+e+"Ctrl"},c={whenList:function(e){return c.when(o,{templateUrl:a("List"),controller:s("List"),resolve:e}),c},whenNew:function(e){return c.when(o+"/new",{templateUrl:a("Edit"),controller:s("Edit"),resolve:e}),c},whenEdit:function(e){return c.when(o+"/:itemId",{templateUrl:a("Edit"),controller:s("Edit"),resolve:e}),c},when:function(t,n){return e.when(t,n),c},otherwise:function(t){return e.otherwise(t),c},$routeProvider:e};return c}}e.$inject=["$routeProvider"],angular.module("services.crudRouteProvider",["ngRoute"]).provider("crudRoute",e)}(),angular.module("services.dataCache",[]),angular.module("services.dataCache").factory("dataCacheService",["$timeout",function(e){var t={};this.asyncUrl="",t.clear=function(e){window.sessionStorage&&(e||sessionStorage.clear(),delete sessionStorage[e])},t.push=function(e,t,n){if(window.sessionStorage){var i=sessionStorage.getItem(e);i=i?JSON.parse(i):{},i[t]=n,sessionStorage.setItem(e,JSON.stringify(i))}},t.get=function(e,t){if(!window.sessionStorage)return null;var n=sessionStorage.getItem(e);return n?(n=JSON.parse(n),n[t]):null},t.asyncGet=function(t,n){var i=sessionStorage.getItem(t);i=JSON.parse(i);var r=e(function(){return i[n]});return r},t.contains=function(e,t){if(!window.sessionStorage)return!1;var n=sessionStorage[e];return!!n&&(n=JSON.parse(n),!!n[t])},t.setAsyncUrl=function(e){this.asyncUrl=e},t.getAsyncUrl=function(){return this.asyncUrl};var n={photo:[],audio:[]};return t.pushUsedFile=function(e,t){var i;switch(e){case 1:i=n.photo;break;case 2:i=n.audio}i.indexOf(t)>-1||i.push(t)},t.removeUsedFile=function(e,t){var i;switch(e){case 1:i=n.photo;break;case 2:i=n.audio}var r=i.indexOf(t);-1!=r&&i.splice(r,1)},t.getUsedFiles=function(){for(var e=[],t=[],i=0;i<n.photo.length;i++)n.photo[i]&&(e.push(n.photo[i]),t.push(1));for(var r=0;r<n.audio.length;r++){if(!n.audio[r])return;e.push(n.audio[r]),t.push(2)}return 0!==e.length?{file:e.join(","),type:t.join(",")}:void 0},t.clearUsedFiles=function(){n={photo:[],audio:[]}},t}]),angular.module("services.data",[]),angular.module("services.data").factory("dataService",["$http","$rootScope",function(e,t){var n={};return t.branchid,n.getDatas=function(n){var i="index.php?c=scenedata&a=statSum";return n&&(i+=(/\?/.test(i)?"&":"?")+"user="+n),e({withCredentials:!0,method:"GET",url:PREFIX_URL+i}).then(function(e){if(e.data.success){var n=e.data.obj;t.$broadcast("sceneDatas",n)}})},n.getCustomDatas=function(n){var i="index.php?c=custom&a=statSum";return n&&(i+=(/\?/.test(i)?"&":"?")+"user="+n),e({withCredentials:!0,method:"GET",url:PREFIX_URL+i}).then(function(e){if(e.data.success){var n=e.data.obj;t.$broadcast("customDatas",n)}})},n.getDataBySceneId=function(t,n,i,r){n=n||1,i=i||10;var o="index.php?c=scenedata&a=getdata&id="+t+"&pageNo="+n+"&pageSize="+i;r&&(o+=(/\?/.test(o)?"&":"?")+"user="+r);var a=new Date;return o+="&time="+a.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+o})},n.deleteDataBySceneId=function(t,n){var i="index.php?c=scenedata&a=delete&sceneId="+t+"&dataIds="+n.ids;return e({withCredentials:!0,method:"GET",url:PREFIX_URL+i,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.getDataDetail=function(t,n){var i="m/c/detail/"+t;n&&(i+=(/\?/.test(i)?"&":"?")+"user="+n);var r=new Date;return i+=(/\?/.test(i)?"&":"?")+"date="+r.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+i})},n.getDataMessage=function(t){var n="index.php?c=custom&a=newDataScene";t&&(/\?/.test(n),n+="&user="+t);var i=new Date;return/\?/.test(n),n+="&date="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},n.getAllData=function(t,n,i,r){var o="index.php?c=custom&a=getAllData&pageSize=10&pageNo="+t;n&&(o+=(/\?/.test(o)?"&":"?")+"user="+n),r&&(o+=(/\?/.test(o)?"&":"?")+"origin="+r),i&&(o+=(/\?/.test(o)?"&":"?")+"groupId="+i);var a=new Date;return o+=(/\?/.test(o)?"&":"?")+"time="+a.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+o})},n.getProspectDataAccount=function(t){var n="m/c/prospectCount?time="+(new Date).getTime();return t&&(n+=(/\?/.test(n)?"&":"?")+"user="+t),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},n.deleteDataById=function(t){var n="index.php?c=custom&a=delete&id="+t;return e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},n.saveData=function(t,n){var i=n?"m/c/create":"m/c/save";return e({withCredentials:!0,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},url:PREFIX_URL+i,data:t})},n.getSceneField=function(t){var n="index.php?c=custom&a=formField&id="+t,i=new Date;return n+="?time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},n.getPremergeScenes=function(t){var n="index.php?c=custom&a=newDataScene";t&&(n+=(/\?/.test(n)?"&":"?")+"user="+t);var i=new Date;return n+=(/\?/.test(n)?"&":"?")+"time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},n.mergeSceneData=function(t,n){var i="index.php?c=custom&a=imps&id="+t;return e({withCredentials:!0,method:"POST",url:PREFIX_S3_URL+i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(n)})},n.getOrigin=function(t){var n="index.php?c=custom&a=origin";return t&&(n+=(/\?/.test(n)?"&":"?")+"user="+t),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},n.getGroups=function(t){var n="index.php?c=custom&a=grouplist";return t&&(n+=(/\?/.test(n)?"&":"?")+"user="+t),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},n.assignGroup=function(t){var n="m/c/group/set?cIds="+t.cIds+"&gIds="+t.gIds;return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.deleteAssociation=function(t){var n="m/c/group/unset?cId="+t.cId+"&gId="+t.gId;return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.createGroup=function(t){var n="m/c/group/create";return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.deleteCustomer=function(t){var n="index.php?c=custom&a=delete&ids="+t.ids;return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.deleteGroup=function(t){var n={id:t},i="m/c/group/delete";return e({withCredentials:!0,method:"POST",url:PREFIX_URL+i,data:$.param(n),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},n}]),angular.module("services.exceptionHandler",["services.i18nNotifications"]),angular.module("services.exceptionHandler").factory("exceptionHandlerFactory",["$injector",function(e){return function(t){return function(n,i){var r=e.get("i18nNotifications");t(n,i),r.pushForCurrentRoute("error.fatal","error",{},{exception:n,cause:i})}}}]),angular.module("services.exceptionHandler").config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate","exceptionHandlerFactory",function(e,t){return t(e)}])}]),angular.module("services.file",["services.i18nNotifications","services.staticRes"]),angular.module("services.file").factory("fileService",["$rootScope","$http","i18nNotifications","staticResService","dataCacheService",function(e,t,n,i,r){function o(e){var n="m/base/file/recently/used?fileType="+e;return n+=(/\?/.test(n)?"&":"?")+"time="+(new Date).getTime(),t({withCredentials:!0,method:"GET",url:PREFIX_URL+n})}function a(e,n){var i="index.php?c=statics&a=history_save&fileIds="+e+"&fileTypes="+n;return i+=(/\?/.test(i)?"&":"?")+"time="+(new Date).getTime(),t({withCredentials:!0,method:"GET",url:PREFIX_URL+i})}function s(){var e=[{color:"#6366C3"},{color:"#29A1D6"},{color:"#332E42"},{color:"#DBF3FF"},{color:"#434A54"},{color:"#000000"},{color:"#F1F03E"},{color:"#FCF08E"},{color:"#972D53"},{color:"#724192"},{color:"#967BDC"},{color:"#EC87C1"},{color:"#D870AF"},{color:"#F6F7FB"},{color:"#666C78"},{color:"#ABB1BD"},{color:"#CCD0D9"},{color:"#E6E9EE"},{color:"#48CFAE"},{color:"#36BC9B"},{color:"#3BAEDA"},{color:"#50C1E9"},{color:"#AC92ED"},{color:"#4B89DC"},{color:"#4B89DC"},{color:"#5D9CEC"},{color:"#8DC153"},{color:"#ED5564"},{color:"#DB4453"},{color:"#FB6E52"},{color:"#FFCE55"},{color:"#F6BB43"},{color:"#E9573E"},{color:"#9FF592"},{color:"#A0D468"}];return e}function c(t){P.sysCategoryList="1"==t?i.getTpTypes():i.getBgTypes(),e.$broadcast("sysCategory.update")}function l(t){P.sysMusicList="2"==t?i.getAudioTypes():i.getSoundTypes(),e.$broadcast("sysMusic.update")}function d(n){var i="index.php?c=upfile&a=systag&type=11";n&&(i+="&bizType="+n);var o=i,a=r.get("sysTag",i);return a?(P.sysTagList=a.list,void e.$broadcast("sysTag.update")):(i+=(/\?/.test(i)?"&":"?")+"time="+(new Date).getTime(),void t({withCredentials:!0,method:"GET",url:PREFIX_URL+i}).then(function(t){t.data.success&&(P.sysTagList=t.data.list,r.push("sysTag",o,t.data),e.$broadcast("sysTag.update"))}))}function u(e,n,i,o,a,s,c){return e+="pageNo="+(n?n:1),e+="&pageSize="+(i?i:10),e+="&fileType="+o,(a||0===a)&&(e+="&bizType="+a),s&&(e+="&tagId="+s),c&&(e+="&delete=1"),""!=searchVal&&(e+="&key="+searchVal),r.contains("fileService1",e)?r.asyncGet("fileService1",e):(r.setAsyncUrl(e),e+="&time="+Date.now(),t({withCredentials:!0,method:"GET",url:PREFIX_URL+e}))}function p(e,t,n,i,r){var o="index.php?c=upfile&a=syslist&";return u(o,e,t,n,i,r)}function h(e,t,n,i,r){var o="index.php?c=upfile&a=syslist&";m(o,e,t,n,i,r)}function g(e,t,n,i,r,o){var a="index.php?c=upfile&a=userList&";return u(a,e,t,n,i,r,o)}function f(e,t,n,i,r){var o="index.php?c=upfile&a=userList&";m(o,e,t,n,i,r)}function v(n){var i="index.php?c=upfile&a=delete",r={id:n};t({withCredentials:!0,method:"POST",url:PREFIX_URL+i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(r)}).then(function(t){t.data.success&&e.$broadcast("files.delete")})}function y(e,n){var i,r="index.php?c=upfile&a=delete";return i=n?{id:e,backup:n}:{id:e},t({withCredentials:!0,method:"POST",url:PREFIX_URL+r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(i)})}function b(e,n){var i="m/base/file/recycle/list?pageNo="+e+"&pageSize="+n;return t({withCredentials:!0,method:"GET",url:PREFIX_URL+i})}function w(e){var n="m/base/file/revoke?id="+e;return t({withCredentials:!0,method:"GET",url:PREFIX_URL+n})}function E(n){var i="index.php?c=tag&a=create",r={tagName:n};t({withCredentials:!0,method:"POST",url:PREFIX_URL+i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(r)}).then(function(t){P.tagList.push({id:t.data.obj,name:n}),e.$broadcast("tagList.update")},function(e){$scope.authError="创建失败"})}function S(){var n="index.php?c=tag&a=my&time"+(new Date).getTime();t({withCredentials:!0,method:"GET",url:PREFIX_URL+n}).then(function(t){t.data.success&&(P.tagList=t.data.list,e.$broadcast("tagList.update"))})}function x(n,i){var r="index.php?c=tag&a=delete",o={id:n};t({withCredentials:!0,method:"POST",url:PREFIX_URL+r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(o)}).then(function(t){t.data.success&&(P.tagList.splice(i,1),e.$broadcast("tagList.delete"))})}function T(n,i){var r="index.php?c=tag&a=set",o={tagId:n,fileIds:i};t({withCredentials:!0,method:"POST",url:PREFIX_URL+r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(o)}).then(function(t){t.data.success&&e.$broadcast("tag.assign")})}function C(n,i){var r="m/base/file/tag/unset",o={tagId:n,fileIds:i};t({withCredentials:!0,method:"POST",url:PREFIX_URL+r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(o)}).then(function(t){t.data.success&&e.$broadcast("tag.unbind")})}function I(e,n,i,o){var a="index.php?c=upfile&a=syslist";if("0"===i&&"2"===o&&(a="index.php?c=upfile&a=userList&"),a+="&pageNo="+(e?e:1),a+="&pageSize="+(n?n:12),i&&"all"!=i&&(a+="&bizType="+(i?i:-1)),a+="&fileType="+(o?o:-1),r.contains("mySounds",a))return r.asyncGet("mySounds",a);r.setAsyncUrl(a);var s=new Date;return a+="&time="+s.getTime(),t({withCredentials:!0,method:"GET",url:PREFIX_URL+a})}function R(e){var n="index.php?c=page&a=crop";return t({withCredentials:!0,method:"POST",url:PREFIX_URL+n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(e)})}window.m=function(n,i,o,a,s,c){if("0"===a?categoryUrl=PREFIX_URL+"index.php?c=upfile&a=getfiletype&filetype=bgType":"1"===a&&(categoryUrl=PREFIX_URL+"index.php?c=upfile&a=getfiletype&filetype=tpType"),"pure"!=s){if("1"==a&&(o=18),n+="pageNo="+(i?i:1),n+="&pageSize="+(o?o:10),n+="&fileType="+a,(s||0===s)&&(n+="&bizType="+s),c&&(n+="&tagId="+c),""!=searchVal){var l="pageNo="+i;oldSearchPage!=l&&(searchUrl=searchUrl.replace(oldSearchPage,l),oldSearchPage=l),n=searchUrl}var d=r.get("fileService",n);if(d)return P.imgList=d.list,P.totalItems=d.map.count,P.pageNo=d.map.pageNo,void e.$broadcast("imgList.update");var u=n;n+="&time="+Date.now(),t({withCredentials:!0,method:"GET",url:PREFIX_URL+n}).then(function(t){t.data.success&&(P.imgList=t.data.list,P.totalItems=t.data.map.count,P.pageNo=t.data.map.pageNo,r.push("fileService",u,t.data),e.$broadcast("imgList.update"))})}else i*o<=M.length?P.imgList=M.slice((i-1)*o,i*o):P.imgList=M.slice((i-1)*o,M.length),P.totalItems=M.length,P.pageNo=i,e.$broadcast("imgList.update")};var P={pageNo:1,totalItems:0,sysCategoryList:[],getSysCategory:c,sysTagList:[],getSysMusicCategory:l,userRecycle:b,fileRevoke:w,sysMusicList:[],getSysTagByCatId:d,imgList:[],getSystemFiles:p,getUserFiles:g,getSystemFiles1:h,getUserFiles1:f,tagList:[],createTag:E,getTagList:S,deleteTag:x,assignTag:T,unbindTag:C,deleteFile:v,deleteFile1:y,getFileByCategory:I,getBgColorList:s,cropImage:R,getFilesHistory:o,saveFilesHistory:a},M=s();return P}]),angular.module("services.history",[]).factory("historyService",["$rootScope",function(e){var t={},n={},i={};return t.addPage=function(i,r){return n[i]||(n[i]={currentPos:0,inHistory:!1,pageHistory:[]},t.addPageHistory(i,r)),e.$broadcast("history.changed"),JSON.parse(n[i].pageHistory[n[i].currentPos])},t.addPageHistory=function(t,r){i=n[t],i.inHistory&&(i.inHistory=!1,i.pageHistory.length=i.currentPos+1);var o=JSON.stringify(r);o!=i.pageHistory[i.pageHistory.length-1]&&i.pageHistory.push(o),i.currentPos=i.pageHistory.length-1,e.$broadcast("history.changed")},t.clearHistory=function(){n={}},t.canBack=function(e){return i=n[e],i.currentPos>0},t.canForward=function(e){return i=n[e],i.currentPos<i.pageHistory.length-1},t.back=function(t){if(i=n[t],i.pageHistory.length){i.inHistory=!0;var r=0===i.currentPos?i.pageHistory[0]:i.pageHistory[--i.currentPos];return e.$broadcast("history.changed"),JSON.parse(r)}},t.forward=function(t){if(i=n[t],i.pageHistory.length){i.inHistory=!0;var r=i.currentPos==i.pageHistory.length-1?i.pageHistory[i.currentPos]:i.pageHistory[++i.currentPos];return e.$broadcast("history.changed"),JSON.parse(r)}},t}]),angular.module("services.httpRequestTracker",[]),angular.module("services.httpRequestTracker").factory("httpRequestTracker",["$http",function(e){var t={};return t.hasPendingRequests=function(){return e.pendingRequests.length>0},t}]),angular.module("services.i18nNotifications",["services.notifications","services.localizedMessages"]),angular.module("services.i18nNotifications").factory("i18nNotifications",["localizedMessages","notifications",function(e,t){var n=function(t,n,i,r){return angular.extend({message:e.get(t,i),type:e.get(n,i)},r)},i={pushSticky:function(e,i,r,o){return t.pushSticky(n(e,i,r,o))},pushForCurrentRoute:function(e,i,r,o){return t.pushForCurrentRoute(n(e,i,r,o))},pushForNextRoute:function(e,i,r,o){return t.pushForNextRoute(n(e,i,r,o))},getCurrent:function(){return t.getCurrent()},remove:function(e){return t.remove(e)},removeAll:function(){return t.removeAll()}};return i}]),angular.module("services.localizedMessages",[]).factory("localizedMessages",["$interpolate","I18N.MESSAGES",function(e,t){var n=function(e,t){return e||"?"+t+"?"};return{get:function(i,r){var o=t[i];return o?e(o)(r):n(o,i)}}}]),angular.module("services.mine",[]),angular.module("services.mine").factory("MineService",["$http","$rootScope",function(e,t){var n={};return n.getMyScenes=function(i,r,o,a,s,c){var l;l=i?"index.php?c=scene&a=my&type="+i:"index.php?c=scene&a=my",a&&(l+="&branchid="+a),null==r&&(r=1);var d={showData:s,pageNo:r,pageSize:o,user:a,name:c};return l+=(/\?/.test(l)?"&":"?")+"time="+(new Date).getTime(),e({withCredentials:!0,method:"POST",url:PREFIX_URL+l,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(d)}).then(function(e){200==e.data.code&&(n.scenes=e.data,t.$broadcast("get.my.scene.list"))})},n.deleteSceneById=function(t,n){var i="index.php?c=scene&a=delscene&id="+t;return n&&(i+="&backup="+n),e({withCredentials:!0,method:"GET",url:PREFIX_URL+i})},n.getMyHistoryScenes=function(t,n,i){var r="m/scene/recycle/list";return r+="?pageNo="+(t?t:1),r+="&pageSize="+(n?n:12),i&&(r+="&user="+i),r+=(/\?/.test(r)?"&":"?")+"time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+r})},n}]),angular.module("services.modal",["confirm-dialog","message-dialog","bindemail-dialog"]).factory("ModalService",["$modal",function(e){var t={};return t.openBindEmailDialog=function(){e.open({keyboard:!1,backdropClick:!0,windowClass:"confirm-dialog",templateUrl:"dialog/bindemail.tpl.html",controller:"BindEmailDialogCtrl"})},t.openConfirmDialog=function(t,n,i){e.open({backdrop:"static",keyboard:!1,backdropClick:!1,windowClass:"confirm-dialog",templateUrl:"dialog/confirm.tpl.html",controller:"ConfirmDialogCtrl",resolve:{confirmObj:function(){return t}}}).result.then(n,i)},t.openMsgDialog=function(t,n,i){e.open({backdrop:"static",keyboard:!1,backdropClick:!1,windowClass:"message-dialog",templateUrl:"dialog/message.tpl.html",controller:"MessageDialogCtrl",resolve:{msgObj:function(){return t}}}).result.then(n,i)},t}]),angular.module("I18N.MESSAGES",[]).service("I18N.MESSAGES",["$translate","$rootScope",function(e,t){function n(){angular.copy({"notify.success":"success","notify.info":"info","notify.danger":"danger","notify.warning":"warning","notify.tip":"tip","errors.route.changeError":"Route change error","crud.user.save.success":"A user with id '{{id}}' was saved successfully.","crud.user.remove.success":"A user with id '{{id}}' was removed successfully.","crud.user.remove.error":"Something went wrong when removing user with id '{{id}}'.","crud.user.save.error":"Something went wrong when saving a user...","crud.project.save.success":"A project with id '{{id}}' was saved successfully.","crud.project.remove.success":"A project with id '{{id}}' was removed successfully.","crud.project.save.error":"Something went wrong when saving a project...","login.reason.notAuthorized":"离开久了，麻烦再登录一次吧！","login.reason.notAuthenticated":"您的账号已在其它地方登录，如非本人操作，请立即修改密码确保账号安全！","login.error.invalidCredentials":"登录失败，请检查邮箱和密码是否正确。","login.error.serverError":"There was a problem with authenticating: {{exception}}.","register.error.serverError":"There was a problem with authenticating: {{exception}}.","login.reset.notmatch":"新密码和重复密码不匹配","register.error.match":"两次输入密码不一致","register.error.agreement":"请先同意注册协议再完成注册","file.bg.pageSize":"12","scene.create.console.ppt.error":"还未上传PPT图片,请重新上传！","scene.create.console.ppt.success":"PPT图片上传成功！","scene.create.console.psd.error":"还未上传psd图片,请重新上传！","scene.create.console.psd.success":"psd图片上传成功！","scene.save.success.published":"微课已保存成功！","scene.save.success.nopublish":"保存成功，还需要发布哦！","scene.save.success.companyTpl":"成功生成企业样例","scene.clear.success.companyTpl":"成功取消企业样例","companytpl.setting.success":"成功生成企业模板","mytpl.setting.success":"成功生成我的模板","scene.publish.success":"微课发布成功","account.success":"提交成功！","branch.open.success":"账号打开成功！","branch.close.success":"账号关闭成功！","dept.create.success":"部门创建成功！","dept.update.success":"修改成功！","branch.create.success":"账号创建成功！","branch.update.success":"账号修改成功！","scene.setting.success":"微课设置成功！","data.assign.success":"分组成功！","data.delete.success":"数据删除成功！","custom.data.delete":"此条客户数据删除成功！","group.delete.success":"分组删除成功！","group.create.success":"分组创建成功！","group.delete.data":"成功从分组内移除","rel.tip":"您的账号还没有绑定邮箱，去用户中心->账号管理，马上绑定","page.change.success":"页面名称修改成功！","email.save.success":"邮箱绑定成功！","reset.psw.success":"密码修改成功！","save.success":"保存成功！","upload.success":"上传成功！","mail.rel.success":"关联成功！","mail.unbind.success":"解除关联成功！","file.assign.success":"分组成功！","already.rel":"此账号已经关联过邮箱","branch.reset.success":"子账号密码重置成功！","already.bind.error":"{{msg}}","reject.crop.image":"不支持裁剪GIF格式图片！","visitor.apply":"信息已经提交审核，审核通过后会更新秀客信息，请耐心等待。","select.trigger.source":"请选择触发源","scratch.percentage.overflow":"涂抹比例不能大于100%","invitation.sendemail.success":"邮件发送成功!","invitation.sendemail.error":"邮件发送失败!","outbox.warning":"红色警告：超出虚线外边框的内容，将无法在手机中被看到","outbox.tip":"橙色警告：超出虚线内边框的内容，在部分老机型手机中将无法看到","already.apply.discovery":"您已申请加入微课，暂时不能再申请！","already.apply.sample":"您已申请过成为样例，暂时不能再申请！","already.apply.activity":"您已申请过成为活动，暂时不能再申请！","scene.apply.success":"申请成功","xd.insufficient":"微币余额不足，去用户中心－>会员服务进行充值","customer.name.overflow":"姓名不能超过50个字符","scene.deny.apply":"审核未通过的微课不能申请活动","scene.incheck.apply":"审核中的微课不能申请活动","scene.accessCode.apply":"加密设置的微课不能加入活动"},i)}var i={};return e("notificationmsg.NOT_AUTHORIZED").then(function(){n()}),t.$on("$translateChangeSuccess",function(){e("notificationmsg.NOT_AUTHORIZED").then(function(){n()})}),i}]),angular.module("services.notifications",[]).factory("notifications",["$rootScope",function(e){var t={STICKY:[],ROUTE_CURRENT:[],ROUTE_NEXT:[]},n={},i=function(e,t){if(!angular.isObject(t))throw new Error("Only object can be added to the notification service");return e.push(t),t};return e.$on("$routeChangeSuccess",function(){t.ROUTE_CURRENT.length=0,t.ROUTE_CURRENT=angular.copy(t.ROUTE_NEXT),t.ROUTE_NEXT.length=0}),n.getCurrent=function(){return[].concat(t.STICKY,t.ROUTE_CURRENT)},n.pushSticky=function(e){return i(t.STICKY,e)},n.pushForCurrentRoute=function(e){return i(t.ROUTE_CURRENT,e)},n.pushForNextRoute=function(e){return i(t.ROUTE_NEXT,e)},n.remove=function(e){angular.forEach(t,function(t){var n=t.indexOf(e);n>-1&&t.splice(n,1)})},n.removeAll=function(){angular.forEach(t,function(e){e.length=0})},n}]),angular.module("services.pagetpl",[]),angular.module("services.pagetpl").factory("pageTplService",["$http","$rootScope","$modal","$q","dataCacheService",function(e,t,n,i,r){var o={};return o.getPageTpls=function(t){var n="index.php?c=scene&a=getpagetpl&type="+t,i=new Date;return n+=(/\?/.test(n)?"&":"?")+"time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},o.getMyTplList=function(t){var n="/index.php?c=scene&a=pagelist&id="+t,i=new Date;return n+=(/\?/.test(n)?"&":"?")+"time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},o.getPageTplTypes=function(){var t="index.php?c=statics&a=getPageTplType",n=new Date;return t+=(/\?/.test(t)?"&":"?")+"time="+n.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+t})},o.getPageTagLabel=function(t){var n="index.php?c=statics&a=tagList&type=1";null!=t&&(n+=(/\?/.test(n)?"&":"?")+"bizType="+t);var i=new Date;return n+=(/\?/.test(n)?"&":"?")+"time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},o.getTagSysListWithType=function(t){var n="index.php?c=upfile&a=systag&type=2";null!=t&&(n+=(/\?/.test(n)?"&":"?")+"bizType="+t);var i=new Date;return n+=(/\?/.test(n)?"&":"?")+"time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},o.getPageTagLabelCheck=function(t){var n="/m/scene/tag/page/list?id="+t,i=new Date;return n+=(/\?/.test(n)?"&":"?")+"time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},o.getPageTplTypestemp=function(t,n,i,o){var a="index.php?c=scene&a=syspagetpl",s=a,c=(new Date,{});return null!=t&&(s+=(/\?/.test(a)?"&":"?")+"tagId="+t,c.tagId=t),n&&(s+=(/\?/.test(a)?"&":"?")+"name="+n,c.name=n),i&&(s+=(/\?/.test(a)?"&":"?")+"pageSize="+i,c.pageSize=i),o&&(s+=(/\?/.test(a)?"&":"?")+"pageNo="+o,c.pageNo=o),r.setAsyncUrl(s),e({withCredentials:!0,method:"POST",url:PREFIX_URL+a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(c)})},o.updataChildLabel=function(t,n){var i="m/scene/tag/page/set/?ids="+t;null!=n&&(i+=(/\?/.test(i)?"&":"?")+"pageId="+n);var r=new Date;return i+=(/\?/.test(i)?"&":"?")+"time="+r.getTime(),e({withCredentials:!0,method:"POST",url:PREFIX_URL+i})},o}]),angular.module("services.sample",[]).factory("sampleService",["$rootScope","$http",function(e,t){var n={};return n.getSamples=function(e,n,i){var r=PREFIX_S2_URL+"index.php?c=scene&a=promotion&recommend=2";return e&&(r+="&type="+e),n&&(r+=/\?/.test(r)?"&":"?",r+="pageNo="+n),i&&(r+=/\?/.test(r)?"&":"?",r+="pageSize="+i),t({withCredentials:!0,method:"GET",url:r})},n.getSamplesPV=function(){var e=PREFIX_S1_URL+"eqs/topThree?time="+(new Date).getTime();return t({withCredentials:!0,method:"GET",url:e})},n}]),angular.module("services.scene",["scene.create.console","services.history","services.select","scene.create.console.pictures","scene.edit.trigger","services.dataCache"]),angular.module("services.scene").factory("sceneService",["$http","$rootScope","$modal","$q","security","$cacheFactory","historyService","selectService","picturesService","ModalService","triggerService","$translate","i18nNotifications","dataCacheService",function(e,t,n,i,r,o,a,s,c,l,d,u,p,h){function g(e){de.splice(de.indexOf(ue[e]),1),delete ue[e]}function f(e){le.obj.elements=e,$("#nr").empty(),ce.parse({def:le.obj,appendTo:"#nr",mode:"edit"});for(var n in e)if(3==e[n].type){var i="";e[n].properties.imgSrc&&(i=e[n].properties.imgSrc),t.$broadcast("show.edit.bg",i);break}t.$broadcast("dom.changed")}function m(e){angular.copy({},ue),$.each(e,function(e,t){ue[t.id]=t})}function v(e,t){var n={},i=$("#nr .edit_area"),r=i.children().last(),o=i.children(".maxIndex"),a=0;if(a=o.length>0?parseInt(o.css("z-index"),10)+1:r.length>0?parseInt(r.css("z-index"),10)+1:101,t)return t.zIndex=a,parseInt(t.top,10)>$("#nr .edit_area").outerHeight()-20&&(t.top=$("#nr .edit_area").outerHeight()-20+"px"),t;var s=$("#nr .edit_area").outerWidth(),c=s;return"v"==e&&(c=50),"4"==e&&(c=80),(5==(""+e).charAt(0)||"6"==e||"r"==e||"c"==e||"a"==e||"ad"==e)&&(c=200),n={top:"100px"},n.zIndex=a,n}function y(e,t,n,i){var r=parseInt(e.css.top,10)+10*pe,o=parseInt(e.css.left,10);r+34>$("#nr .edit_area").outerHeight()?(t.css.top=r+"px",t.css.left=o+10+"px"):(t.css.top=r+34+"px",t.css.left=e.css.left,n==i&&pe++)}function b(){return Math.ceil(1e10*Math.random())}function w(e,t,n){var i,r=b(),o={};if(3==(""+e).charAt(0)){var a,s=[];for(a=0;a<de.length;a++)3==de[a].type&&s.push(de[a]);if(s.length>0)return s[0];o={content:null,css:{},id:r,num:0,pageId:le.obj.id,properties:{bgColor:null,imgSrc:null},sceneId:le.obj.sceneId,title:null,type:3}}return 1==(""+e).charAt(0)&&(o={id:r,properties:{title:u.instant("common.scene.COMMIT")},type:1,pageId:le.obj.id,sceneId:le.obj.sceneId}),8==(""+e).charAt(0)&&(i=v(e,t),$.extend(!0,i,{color:"rgb(255, 255, 255)",width:"100px",height:"40px",lineHeight:"40px",borderWidth:"0",borderStyle:"solid",borderColor:"#ccc",borderRadius:"0",backgroundColor:"rgb(244, 113, 31)"}),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{title:u.instant("common.scene.DIALING"),number:""},sceneId:le.obj.sceneId,title:null,type:8}),"l"==e&&(i=v(e,t),$.extend(!0,i,{color:"rgb(255, 255, 255)",width:"100px",height:"40px",lineHeight:"40px",borderWidth:"0",borderStyle:"solid",borderColor:"#ccc",borderRadius:"0",backgroundColor:"rgb(244, 113, 31)"}),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{title:u.instant("common.scene.BUY")},sceneId:le.obj.sceneId,title:null,type:"l"}),"s"==e&&(i=v(e,t),$.extend(!0,i,{color:"rgb(255, 255, 255)",width:"100px",height:"40px",lineHeight:"40px",borderWidth:"0",borderStyle:"solid",borderColor:"#ccc",borderRadius:"0",backgroundColor:"rgb(244, 113, 31)"}),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{title:u.instant("common.scene.SURPRISE")},sceneId:le.obj.sceneId,title:null,type:"s"}),(2==(""+e).charAt(0)||"x"==(""+e).charAt(0))&&(i=v(e,t),$.extend(!0,i,{width:320,height:38}),o={content:u.instant("common.scene.EDIT_TIP"),css:i,id:r,num:1,pageId:le.obj.id,properties:{},sceneId:le.obj.sceneId,title:null,type:(""+e).charAt(0)}),"x"==(""+e).charAt(0)&&(o.properties={dataUrl:""}),4==(""+e).charAt(0)&&(i=v(e,t),i.width="100px",i.height="100px",o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{width:"100px",height:"100px",src:""},sceneId:le.obj.sceneId,title:null,type:4}),"h"==e&&(i=v(e,t),$.extend(!0,i,{color:"#555",width:"100px",height:"100px"}),o={content:"",css:i,id:r,pageId:le.obj.id,properties:{type:"rect"},sceneId:le.obj.sceneId,title:null,type:"h"}),"m"==(""+e).charAt(0)&&(i=v(e,t),i.width="320px",i.height="240px",o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{width:"400px",height:"300px",src:""},sceneId:le.obj.sceneId,title:null,type:"m"}),5==(""+e).charAt(0)&&(i=v(e,t),i.width="200px",$.extend(!0,i,{color:"#676767",borderWidth:"1",borderStyle:"solid",borderColor:"#08a1ef",borderRadius:"0",backgroundColor:"#ffffff"}),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{placeholder:u.instant("common.scene.NAMED")},isInput:1,sceneId:le.obj.sceneId,title:u.instant("common.scene.NAMED"),type:5}),"r"==e&&(i=v(e,t),i.width="200px",delete i.height,$.extend(!0,i,{color:"#676767",borderWidth:"1",borderStyle:"solid",borderColor:"#08a1ef",borderRadius:"0",backgroundColor:"#ffffff"}),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{titleStyle:{backgroundColor:"#08a1ef",color:"#ffffff"},optionStyle:{borderBottomWidth:"1",borderBottomStyle:"solid",borderBottomColor:"#08a1ef"}},choices:'{"seq":3,"options":[{"id":1,"label":"选项1"},{"id":2,"label":"选项2"},{"id":3,"label":"选项3"}]}',isInput:1,sceneId:le.obj.sceneId,title:"",type:"r"}),"c"==e&&(i=v(e,t),i.width="200px",delete i.height,$.extend(!0,i,{color:"#676767",borderWidth:"1",borderStyle:"solid",borderColor:"#08a1ef",borderRadius:"0",backgroundColor:"#ffffff"}),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{titleStyle:{backgroundColor:"#08a1ef",color:"#ffffff"},optionStyle:{borderBottomWidth:"1",borderBottomStyle:"solid",borderBottomColor:"#08a1ef"}},choices:'{"seq":3,"options":[{"id":1,"label":"选项1"},{"id":2,"label":"选项2"},{"id":3,"label":"选项3"}]}',isInput:1,sceneId:le.obj.sceneId,title:"",type:"c"}),"a"==e&&(i=v(e,t),i.width="200px",delete i.height,
$.extend(!0,i,{color:"#676767",borderWidth:"0",borderStyle:"solid",borderColor:"#ccc",borderRadius:"0",backgroundColor:"#f9f9f9"}),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{icon:"eqf-star",size:"rating-m",color:"#ff9307"},isInput:1,sceneId:le.obj.sceneId,title:"",type:"a"}),"i"==e&&(i=v(e,t),$.extend(!0,i,{width:"200px",height:"55px",lineHeight:"55px",color:"#676767",borderWidth:"0",borderStyle:"solid",borderColor:"#ccc",borderRadius:"0",backgroundColor:"#f9f9f9"}),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{layout:"counter-lr",size:"counter-m",color:"#08a1ef",icon:"eqf-love"},sceneId:le.obj.sceneId,title:"",type:"i"}),"d"==(""+e).charAt(0)&&(i=v(e,t),$.extend(!0,i,{width:"200px",height:"55px",lineHeight:"55px",color:"#676767",borderWidth:"0",borderStyle:"solid",borderColor:"#ccc",borderRadius:"0",backgroundColor:"#f9f9f9"}),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{layout:"counter-lr",size:"counter-m",color:"#08a1ef",icon:"eqf-eye3"},sceneId:le.obj.sceneId,title:"",type:"d"}),6==(""+e).charAt(0)&&(i=v(e,t),i.width="200px",$.extend(!0,i,{color:"#fff",borderRadius:"0",backgroundColor:"#08a1ef"}),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{title:u.instant("common.scene.COMMIT")},sceneId:le.obj.sceneId,title:null,type:6}),"p"==e&&(i=v(e,t),o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{title:u.instant("common.scene.ATLAS")},sceneId:le.obj.sceneId,title:null,type:"p"}),"v"==e&&(i=v(e,t),i.width="48px",i.height="48px",o={content:"",css:i,id:r,num:1,pageId:le.obj.id,properties:{src:""},sceneId:le.obj.sceneId,title:null,type:"v"}),"n"==e&&(i=v(e,t),o={content:"",css:i,id:r,pageId:le.obj.id,properties:{pics:[]},sceneId:le.obj.sceneId,title:null,type:"n"}),n&&$.extend(!0,o,n),de.push(o),ue[o.id]=o,o}function E(e,n,i){var r=ce.wrapComp(n,"edit");$("#nr .edit_area").append(r);for(var o=ce.getInterceptors(),s=0;s<o.length;s++)o[s](r,n);return ce.getEventHandlers()[(""+e).charAt(0)](r,n),i||(a.addPageHistory(le.obj.id,le.obj.elements),t.$broadcast("dom.changed"),r.trigger("mousedown")),r}function S(e,t){var n=[];return"g101"==e&&(n.push(fe("501")),n.push(fe("502")),n.push(fe("503")),n.push(fe("601"))),n}function x(e,n){se.currentElemDef=n;var i=n.css.height||0;$(e).css({"min-height":i,cursor:"text"}),$(e).parents("li").hasClass("inside-active")||($(e).bind("click",function(e){e.stopPropagation()}),$(document).bind("mousedown",function(r){t.$broadcast("convert.html.canvas",n,e),$(e).css({"min-height":"inherit",cursor:"default"}),$("#btn-toolbar").find("input[type=text][data-edit]").blur(),$("#btn-toolbar")&&$("#btn-toolbar").remove(),$(e).unbind("click");var o=n.content;n.content=$(e).html(),o!=n.content&&t.$broadcast("hisChange");var a=parseInt($(e).parent().height(),10);a>i&&(n.css.height=a,$(e).parents("li").height(a)),$(e).parents("li").removeClass("inside-active").css("user-select","none"),$(e).removeAttr("contenteditable"),window.getSelection&&window.getSelection().modify("move","right","line"),$(document).unbind("mousedown")}),$(e).parents("li").addClass("inside-active").css("user-select","text"),t.$broadcast("text.click",e))}function T(e){W(e,function(t){e.properties.src=t.data,e.properties.id=t.id;var n=t.width/t.height,i=$("#"+e.id);if(i.length>0){var r=$("#inside_"+e.id).width(),o=$("#inside_"+e.id).height(),a=r/o;n>=a?(i.outerHeight(o),i.outerWidth(o*n),i.css("marginLeft",-(i.outerWidth()-r)/2),i.css("marginTop",0)):(i.outerWidth(r),i.outerHeight(r/n),i.css("marginTop",-(i.outerHeight()-o)/2),i.css("marginLeft",0)),i.attr("src",PREFIX_FILE_HOST+t.data),e.properties.imgStyle={},e.properties.imgStyle.width=i.outerWidth(),e.properties.imgStyle.height=i.outerHeight(),e.properties.imgStyle.marginTop=i.css("marginTop"),e.properties.imgStyle.marginLeft=i.css("marginLeft")}else t.width>$("#nr .edit_area").width()&&(t.width=$("#nr .edit_area").width(),t.height=t.width/n),t.height>$("#nr .edit_area").height()&&(t.height=$("#nr .edit_area").height(),t.width=t.height*n),e.css.width=t.width,e.css.height=t.height,e.properties.imgStyle={},e.properties.imgStyle.width=t.width,e.properties.imgStyle.height=t.height,e.properties.imgStyle.marginTop="0",e.properties.imgStyle.marginLeft="0",E(e.type,e)},function(){e.properties.src||g(e.id)})}function C(e){me||n.open({windowClass:"console six-contain shape-console",templateUrl:"scene/console/shape.tpl.html",controller:"ShapeConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){var n=$("#"+e.id);if(e.properties.type=t.type,e.properties.viewBox=t.viewBox,n.length){var i=$("#nr").find("#inside_"+e.id);i.remove(),E(e.type,e)}else E(e.type,e)},function(){$("#"+e.id).length||g(e.id)})}function I(e){me||n.open({windowClass:"modal-dialog",templateUrl:"scene/console/adr.tpl.html",controller:"AdrConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){var n=$("#"+e.id);if(e.properties.type=t.type,e.properties.viewBox=t.viewBox,n.length){var i=$("#nr").find("#inside_"+e.id);i.remove(),E(e.type,e)}else E(e.type,e)},function(){$("#"+e.id).length||g(e.id)})}function R(e){n.open({windowClass:"console seven-contain",templateUrl:"scene/console/button.tpl.html",controller:"ButtonConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){e.properties.title=t.title,e.properties.number=t.number,$.extend(!0,e.css,t.btnStyle);var n=$("#"+e.id,$("#nr"));n.length>0&&n.parents("li").remove(),E(e.type,e)},function(){$("#"+e.id).length||g(e.id)})}function P(e){me||(me=n.open({windowClass:"console six-contain",templateUrl:"scene/console/tel.tpl.html",controller:"TelConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,e.properties.title=t.title,e.properties.number=t.number,t.title.replace(/ /g,"&nbsp;"),$.extend(!0,e.css,t.btnStyle),$("#"+e.id).length>0&&$("#"+e.id).parents("li").remove(),E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function M(e){me||(me=n.open({windowClass:"console seven-contain",templateUrl:"scene/console/input.tpl.html",controller:"InputConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,t.type&&(e.type=t.type),e.properties.placeholder=t.title,e.properties.required=t.required,e.title=t.title,$.extend(!0,e.css,t.btnStyle);var n=$("#"+e.id);n.length>0&&n.parents("li").remove(),E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function _(e){me||(me=n.open({windowClass:"console seven-contain",templateUrl:"scene/console/radio-checkbox.tpl.html",controller:"RadioCheckboxConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,e.title=t.title,e.type=t.type;var n=$("#nr").find("#inside_"+e.id);n.length&&n.remove(),E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function k(e){me||(me=n.open({windowClass:"console seven-contain",templateUrl:"scene/console/rating.tpl.html",controller:"RatingConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null;var n=$("#nr").find("#inside_"+e.id);n.length&&n.remove(),E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function A(e){me||(me=n.open({windowClass:"console six-contain",templateUrl:"scene/console/counter.tpl.html",controller:"CounterConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,$.extend(!0,e.css,t.btnStyle),$("#"+e.id).length>0&&$("#"+e.id).parents("li").remove(),E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function L(e){me||(me=n.open({windowClass:"console six-contain",templateUrl:"scene/console/statistics-component.tpl.html",controller:"StatisticsConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,$.extend(!0,e.css,t.btnStyle),$("#"+e.id).length>0&&$("#"+e.id).parents("li").remove(),E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function D(e){me||(me=n.open({windowClass:"console six-contain",templateUrl:"scene/console/link-component.tpl.html",controller:"LinkComponentConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,isNaN(e.properties.url)&&(e.properties.url=PREFIX_S1_URL+"eqs/link?id="+e.sceneId+"&url="+encodeURIComponent(e.properties.url)),$.extend(!0,e.css,t.btnStyle),$("#"+e.id).length>0&&$("#"+e.id).parents("li").remove(),E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function z(e){me||(me=n.open({windowClass:"console six-contain",templateUrl:"scene/console/sound-component.tpl.html",controller:"SoundComponentConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,t.title.replace(/ /g,"&nbsp;"),$.extend(!0,e.css,t.btnStyle),$("#"+e.id).length>0&&$("#"+e.id).parents("li").remove(),E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function F(e){me||(me=n.open({windowClass:"console seven-contain pictures1",backdrop:"static",templateUrl:"scene/console/pictures1.tpl.html",controller:"pictures1Ctrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,e.properties=t;var n=$("#inside_"+e.id);n.length&&n.remove(),E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function N(e,t){var n=ne;O(n,2,function(e){n.bgAudio&&h.pushUsedFile(2,e.id),e.url||e.src?(h.removeUsedFile(2,e.id),n.bgAudio=e):n.bgAudio=null},function(){me=null})}function H(e,t){var n=ne;B(n,2,function(e){n.bgAudio&&h.pushUsedFile(2,e.id),e.url||e.src?(h.removeUsedFile(2,e.id),n.bgAudio=e):n.bgAudio=null},function(){me=null})}function U(e,t){O(e,4,function(t){var n=$("#inside_"+e.id);t.src?(e.sound=t,n.children(".sound").length||$('<div class="sound eqf-music">').click(function(){U(e)}).appendTo(n)):(delete e.sound,n.children(".sound").remove())},function(){me=null})}function O(e,t,i,r){me||(me=n.open({windowClass:"console img_console",templateUrl:"scene/console/sound.tpl.html",controller:"soundCtrl",resolve:{obj:function(){return{elemDef:e,type:t}}}}).result.then(function(e){me=null,i(e)},function(){me=null}))}function B(e,t,i,r){me||(me=n.open({windowClass:"console img_console",templateUrl:"scene/console/sound2.tpl.html",controller:"soundCtrl",resolve:{obj:function(){return{elemDef:e,type:t}}}}).result.then(function(e){me=null,i(e)},function(){me=null}))}function j(e){me||(me=n.open({windowClass:"console six-contain",templateUrl:"scene/console/video.tpl.html",controller:"VideoCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,e.properties.src=t,$("#"+e.id).length||E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function q(e){W(e,function(n){if("imgSrc"==n.type){var i={type:3,properties:{src:n.data,id:n.id}};n.height/n.width>=1008/642&&n.height/n.width<=1.578125?(t.$broadcast("scene.bg.replace",{type:"imgSrc",src:n.data,id:n.id},e),a.addPageHistory(le.obj.id,le.obj.elements)):J(i,function(n){t.$broadcast("scene.bg.replace",{type:"imgSrc",src:n.src,id:n.id},e),a.addPageHistory(le.obj.id,le.obj.elements)},function(){$("#"+e.id).length||g(e.id)})}"backgroundColor"==n.type&&(t.$broadcast("scene.bg.replace",n,e),a.addPageHistory(le.obj.id,le.obj.elements))},function(){$("#"+e.id).length||g(e.id)})}function X(e){me||(me=n.open({windowClass:"console six-contain randomevent-console",templateUrl:"scene/console/randomevent.tpl.html",controller:"RandomEventCtrl",resolve:{obj:function(){return e}}}).result.then(function(n){me=null,n&&0!==n.length&&(e.properties.pics=n,$("#"+e.id).length||E(e.type,e),t.$broadcast("create.randomevent.trigger",e))},function(){me=null,$("#"+e.id).length||g(e.id)}))}function V(e){me||(me=n.open({windowClass:"console ppt_console",templateUrl:"scene/console/ppt.tpl.html",controller:"PptCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,e.properties.src=t,$("#"+e.id).length||E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function G(e){me||(me=n.open({windowClass:"console ppt_console",templateUrl:"scene/console/psd.tpl.html",controller:"PsdCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){me=null,e.properties.src=t,$("#"+e.id).length||E(e.type,e)},function(){me=null,$("#"+e.id).length||g(e.id)}))}function W(e,t,i){if(!me){var r="0";3==e.type&&(r="0"),4==e.type&&(r="1"),me=n.open({windowClass:"console img_console",templateUrl:"scene/console/bg.tpl.html",controller:"BgConsoleCtrl",resolve:{obj:function(){return{fileType:r,elemDef:e}}}}).result.then(function(e){me=null,t(e)},function(e){me=null,i(e)})}}function Y(e,n,i){se.currentElemDef=e,t.$broadcast("showStylePanel",{activeTab:"style"})}function Q(e,n,i){se.currentElemDef=e,t.$broadcast("showStylePanel",{activeTab:"anim"})}function Z(e,n,i){se.currentElemDef=e,t.$broadcast("showStylePanel",{activeTab:"trigger"})}function J(e,t,i){me=n.open({windowClass:"console seven-contain pictures1",templateUrl:"scene/console/imageCrop.tpl.html",controller:"imageCropCtrl",backdrop:"static",resolve:{obj:function(){return e}}}).result.then(function(e){me=null,"function"==typeof t&&t(e)},function(e){me=null,"function"==typeof i&&i(e)})}function K(){$(".content").trigger("mousedown"),se.currentElemDef=null,t.$broadcast("showStylePanel",{activeTab:"trigger"})}function ee(e){e.sceneId=le.obj.sceneId,n.open({windowClass:"console six-contain",templateUrl:"scene/console/link.tpl.html",controller:"LinkConsoleCtrl",resolve:{obj:function(){return e}}}).result.then(function(t){t&&"http://"!=t?(isNaN(t)?e.properties.url=PREFIX_S1_URL+"eqs/link?id="+e.sceneId+"&url="+encodeURIComponent(t):e.properties.url=t,$("#inside_"+e.id).find(".fa-link").removeClass("fa-link").addClass("fa-anchor")):(delete e.properties.url,$("#inside_"+e.id).find(".fa-anchor").removeClass("fa-anchor").addClass("fa-link"))})}function te(e,t){var n=$(".element",e)[0];$(n).mousedown(function(e){$(this).parents("li").hasClass("inside-active")&&e.stopPropagation()}),$(n).bind("contextmenu",function(e){$(this).parents("li").hasClass("inside-active")?e.stopPropagation():$(this).blur()}),$(n).bind("dblclick",function(e){return!$("#nr").find(".mask-trigger").length&&(x(n,t),$("#popMenu").hide(),void e.stopPropagation())}),$(n).bind("keydown",function(e){e.stopPropagation()})}var ne,ie,re,oe,ae,se={},ce=eqShow.templateParser("jsonParser"),le=null,de=null,ue={},pe=($("#nr .edit_area"),0),he=!1;se.historyBack=function(){a.canBack(le.obj.id)&&(de=a.back(le.obj.id),m(de),f(de),t.$broadcast("close.style.panel"))},se.historyForward=function(){a.canForward(le.obj.id)&&(de=a.forward(le.obj.id),m(de),f(de),t.$broadcast("close.style.panel"))};var ge=se.createCompGroup=function(e,n){for(var i=S(e),r=0;r<i.length;r++){var o=w(i[r].type,n,i[r]);n=n?{left:n.left,top:parseInt(n.top,10)+50+"px"}:{left:"60px",top:"150px"},E(i[r].type,o,!0)}a.addPageHistory(le.obj.id,le.obj.elements),t.$broadcast("dom.changed")},fe=function(e,t){var n;return"501"==e&&(n={properties:{placeholder:u.instant("common.scene.NAME")},title:u.instant("common.scene.NAME"),type:501}),"502"==e&&(n={properties:{placeholder:u.instant("common.scene.MOBILE")},title:u.instant("common.scene.MOBILE"),type:502}),"503"==e&&(n={properties:{placeholder:u.instant("common.scene.EMAIL")},title:u.instant("common.scene.EMAIL"),type:503}),"601"==e&&(n={properties:{title:u.instant("common.scene.COMMIT")},type:601}),n};se.createComp=function(e,t,n){var i;if(searchVal="","g"==(""+e).charAt(0))return void ge(e,t);if("9"==(""+e).charAt(0))return void N(i,2);if("q"==(""+e).charAt(0))return void H(i,2);if(i=w(e,t),4==e)return void T(i);if("h"==e)return void C(i);if("m"==e)return void I(i);if(5==e)return void M(i);if(6==e)return void R(i);if(8==e)return void P(i);if(22==e)return void V(i);if("z"==e)return void G(i);if("p"==e)return void F(i);if("v"==e)return void j(i);if(3==e)return void q(i);if("r"==e||"c"==e)return void _(i);if("a"==e)return void k(i);if("i"==e)return n&&(i.properties.icon=n),void A(i);if("d"==e)return n&&(i.properties.icon=n),void L(i);if("l"==e)return void D(i);if("s"==e)return void z(i);if("n"==e)return void X(i);if(2==e||"x"==e||"j"==e){var r=E(e,i);$(".element",r).trigger("dblclick").focus(),setTimeout(function(){if(window.getSelection){var e=window.getSelection();e.modify("move","left","line"),e.modify("extend","right","line")}})}else E(e,i)},se.updateCompPosition=function(e,n,i){for(var r=0;r<de.length;r++)"inside_"+de[r].id==e&&(de[r].css?(de[r].css.left=n.left,de[r].css.top=n.top,i||a.addPageHistory(le.obj.id,de)):(de[r].css=n,i||a.addPageHistory(le.obj.id,de)));t.$$phase||t.$apply()},se.updateCompAngle=function(e,n){for(var i=0;i<de.length;i++)"inside_"+de[i].id==e&&(de[i].css?de[i].css.transform="rotateZ("+n+"deg)":de[i].css={},a.addPageHistory(le.obj.id,de));t.$apply()},se.setCopy=function(e){he=e,t.$broadcast("copyState.update",e)},se.getCopy=function(){return he},se.getPageNames=function(t){var n="index.php?c=scene&a=pagelist&id="+t+"&date="+(new Date).getTime();return e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},se.changePageSort=function(t,n){var i="index.php?c=page&a=pageSort&id="+n+"&pos="+t+"&date="+(new Date).getTime();return e({withCredentials:!0,method:"GET",url:PREFIX_URL+i})},se.updateCompSize=function(e,n,i){for(var r=0;r<de.length;r++)"inside_"+de[r].id==e&&(de[r].css||(de[r].css={}),de[r].css.width=n.width,de[r].css.height=n.height,n.lineHeight&&(de[r].css.lineHeight=n.lineHeight),de[r].css.top=n.top,de[r].css.left=n.left,de[r].properties.width=n.width,de[r].properties.height=n.height,n.imgStyle&&(de[r].properties.imgStyle=n.imgStyle),i||a.addPageHistory(le.obj.id,de));t.$$phase||t.$apply()},se.savePageNames=function(t){var n="index.php?c=page&a=savePageName",i={id:t.id,sceneId:t.sceneId,name:t.name};return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(i)})},se.resetCss=function(){$("#nr .edit_area li").each(function(e,t){var n=ue[t.id.replace(/inside_/g,"")];n&&(n.css||(n.css={}),n.css.zIndex=e)})},se.copyElement=function(){pe=0,ae=le.obj.id;var e=s.getElements(),t=[];$.each(e,function(e,n){t.push(ue[n])}),re=angular.copy(t),oe=angular.copy(t),se.setCopy(!0)},se.isCurrentPageSubmitButtonAlreadyExist=function(){var e=!1;return angular.forEach(le.obj.elements,function(t){6==(""+t.type).charAt(0)&&(e=!0)}),e},se.pasteElement=function(){for(var e=0,n=[],i=se.isCurrentPageSubmitButtonAlreadyExist(),r=0;r<re.length;r++)if(6!==re[r].type&&601!==re[r].type||!i){re[r].pageId=le.obj.id,re[r].id=b(),ae==re[r].pageId?(e++,y(oe[r],re[r],e,re.length)):(pe=0,re[r].css=angular.copy(oe[r].css));var o=angular.copy(re[r]);de.push(o),ue[o.id]=o,n.push(E(o.type,o,!0))}ae=le.obj.id,a.addPageHistory(le.obj.id,le.obj.elements),t.$broadcast("dom.changed"),angular.forEach(s.getElements(),function(e){$("#inside_"+e).children(".bar").hide()}),s.clearElements(),$.each(n,function(e,t){t.children(".bar").show(),s.addElement(t.attr("id").split("_")[1])})},se.openCropModal=function(e,t,n){J(e,t,n)},se.replaceBgImage=function(e,n,i){var r=e;n.style.backgroundImage="url("+PREFIX_FILE_HOST+r+")",i.properties.bgColor=null,i.properties.imgSrc=r,t.$broadcast("show.edit.bg")};var me=null;return utilTrigger.getSendType(),utilTrigger.getHandleType(),se.openTriggerMode=K,ce.addInterceptor(function(e,n,i){function o(){var i=$('<ul id="popMenu" class="dropdown-menu" style="min-width: 150px; display: block;" role="menu" aria-labelledby="dropdownMenu1"><li class="edit" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-write"></div>编辑</a></li><li class="style" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-type"></div>样式</a></li><li class="animation" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-move"></div>动画</a></li><li class="sound" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-music"></div>音效</a></li><li class="trigger" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-chufa"></div>触发</a></li><li class="link" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-link"></div>链接</a></li><li class="copy" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-scene-copy"></div>复制</a></li><li class="cut" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-cut"></div>裁切</a></li><li role="presentation" class="bottom_bar"><a title="置顶"><div class="eqf-top up-all"></div></a><a title="上移一层"><div class="eqf-up up"></div></a><a title="下移一层"><div class="eqf-down down"></div></a><a title="置底"><div class="eqf-under down-all"></div></a><a title="删除"><div class="eqf-scene-delete remove"></div></a></li></ul>').css({position:"absolute","user-select":"none"});return he&&i.find(".copy").after($('<li class="paste" role="presentation"><a role="menuitem" tabindex="-1"><div class="eqf-print"></div>粘贴</a></li>')),i.find(".edit").click(function(t){switch(t.stopPropagation(),n.type.toString().charAt(0)){case"1":break;case"2":x(e.find(".element").get(0),n);break;case"x":x(e.find(".element").get(0),n);break;case"j":x(e.find(".element").get(0),n);break;case"3":break;case"4":T(n);break;case"m":T(n);break;case"h":C(n);break;case"5":M(n);break;case"6":R(n);break;case"7":break;case"8":P(n);break;case"9":break;case"g":break;case"p":F(n);break;case"v":j(n);break;case"r":case"c":_(n);break;case"a":k(n);break;case"l":D(n);break;case"s":z(n);break;case"i":A(n);break;case"d":L(n);break;case"n":X(n)}i.hide()}),i.find(".style").click(function(t){t.stopPropagation(),Y(n,function(t){if(1==n.type)for(var i in n.properties.labels)t.backgroundColor&&(n.properties.labels[i].color.backgroundColor=t.backgroundColor,$(".label_content").css("background-color",t.backgroundColor)),t.color&&(n.properties.labels[i].color.color=t.color,$(".label_content").css("color",t.color));else $(".element-box",e).css(t),$.extend(!0,n.css,t)}),i.hide()}),i.find(".animation").click(function(e){e.stopPropagation(),Q(n,function(e){n.properties.anim=e}),i.hide()}),i.find(".link").click(function(e){e.stopPropagation(),ee(n),i.hide()}),i.find(".remove").click(function(e){e.stopPropagation(),t.$broadcast("element.delete")}),i.find(".sound").click(function(e){e.stopPropagation(),U(n,4),i.hide()}),i.find(".trigger").click(function(e){e.stopPropagation();var t=utilTrigger.getHandleType();$.each(t,function(e,t){d.getSendIds(t.value,n.id)}),Z(n,function(e){n.properties.trigger=e}),i.hide()}),i.find(".down").click(function(t){var n=e.prev();if(!(n.length<=0)){var i=e.css("zIndex");e.css("zIndex",n.css("zIndex")),n.css("zIndex",i),n.before(e)}}),i.find(".up").click(function(t){var n=e.next();if(!(n.length<=0)){var i=e.css("zIndex");e.css("zIndex",n.css("zIndex")),n.css("zIndex",i),n.after(e)}}),i.find(".up-all").click(function(t){var n=e.siblings("li"),i=n.last();i.after(e),e.css("zIndex",n.length+1),n.each(function(e,t){$(t).css("zIndex",e+1)})}),i.find(".down-all").click(function(t){var n=e.siblings("li"),i=n.first();i.before(e),e.css("zIndex",1),n.each(function(e,t){$(t).css("zIndex",e+2)})}),i.find(".copy").click(function(e){e.stopPropagation(),$(".modal-dialog")[0]||se.copyElement(),i.hide()}),i.find(".paste").click(function(e){e.stopPropagation(),$(".modal-dialog")[0]||se.pasteElement(),i.hide()}),i.find(".cut").click(function(e){e.stopPropagation(),J(n,function(){a.addPageHistory(le.obj.id,le.obj.elements)}),i.hide()}),2!=n.type&&4!=n.type&&"h"!=n.type&&"x"!=n.type&&i.find(".trigger").hide(),2!=n.type&&4!=n.type&&5!=n.type&&"h"!=n.type&&"x"!=n.type&&501!=n.type&&502!=n.type&&503!=n.type&&i.find(".sound").hide(),r.isAllowToAccess(r.accessDef.SCENE_EDIT_TRIGGER)||i.find(".trigger").hide(),r.isAllowToAccess(r.accessDef.SCENE_EDIT_SOUND)||i.find(".sound").hide(),4!=n.type&&"h"!=n.type&&"x"!=n.type&&i.find(".link").hide(),4!=n.type&&i.find(".cut").hide(),"p"==n.type&&(i.find(".animation").hide(),i.find(".style").hide()),(6==n.type||601==n.type)&&i.find(".copy").hide(),i}if("view"!=i){n.trigger&&d.setTrigger(n.id,n.trigger);var s=$("#eq_main");n.sound&&$('<div class="sound eqf-music">').click(function(){U(n)}).appendTo(e),e.on("contextmenu",".element-box",function(i){function r(e,t){$("#"+t).remove(),e.css({left:i.pageX+s.scrollLeft()+15,top:i.pageY+s.scrollTop(),zIndex:10001}).appendTo(s),s.mousemove(function(n){e=$("#"+t),(n.pageX<e.offset().left-20||n.pageX>e.offset().left+e.width()+20||n.pageY<e.offset().top-20||n.pageY>e.offset().top+e.height()+20)&&(e.hide(),$(this).unbind("mousemove"))})}if(i.stopPropagation(),"none"!=$(".select-panel").css("display"))return!1;if($("#nr").find(".mask-trigger").length){if(se.currentElemDef&&t.$broadcast("create.trigger.menu",e,i),!$(".edit_area").find(".switch-original").length){var a=$('<div class="switch">');e.append(a).children(".bar").hide()}return!1}$("#comp_setting:visible").length>0&&"p"!=n.type&&(se.currentElemDef=n,t.$broadcast("showStylePanel"));var c=o();return r(c,"popMenu"),!1}),e.on("click",function(t){return t.stopPropagation(),$("#nr").find(".mask-trigger").length?void 0:(Y(n,function(t){if(1==n.type)for(var i in n.properties.labels)t.backgroundColor&&(n.properties.labels[i].color.backgroundColor=t.backgroundColor,$(".label_content").css("background-color",t.backgroundColor)),t.color&&(n.properties.labels[i].color.color=t.color,$(".label_content").css("color",t.color));else $(".element-box",e).css(t),$.extend(!0,n.css,t)}),!1)}),e.attr("title","按住鼠标进行拖动，点击鼠标进行编辑")}}),ce.bindEditEvent("2",function(e,t){te(e,t)}),ce.bindEditEvent("x",function(e,t){te(e,t)}),ce.bindEditEvent("j",function(e,t){te(e,t)}),ce.bindEditEvent("3",function(e,t){}),ce.bindEditEvent("v",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){j(t),$("#popMenu").hide()})}),ce.bindEditEvent("4",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){return!$("#nr").find(".mask-trigger").length&&(T(t),void $("#popMenu").hide())})}),ce.bindEditEvent("m",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){return!$("#nr").find(".mask-trigger").length&&(T(t),void $("#popMenu").hide())})}),ce.bindEditEvent("n",function(e,t){var n=$(".element",e)[0];$(n).bind("dblclick",function(){return!$("#nr").find(".mask-trigger").length&&(X(t),void $("#popMenu").hide())})}),ce.bindEditEvent("h",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){return!$("#nr").find(".mask-trigger").length&&(C(t),void $("#popMenu").hide())})}),ce.bindEditEvent("5",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){M(t),$("#popMenu").hide()})}),ce.bindEditEvent("r",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){_(t),$("#popMenu").hide()})}),ce.bindEditEvent("c",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){_(t),$("#popMenu").hide()})}),ce.bindEditEvent("a",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){k(t),$("#popMenu").hide()})}),ce.bindEditEvent("p",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){F(t),$("#popMenu").hide()}),c.setProperties(t.properties)}),ce.bindEditEvent("6",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){R(t),$("#popMenu").hide()})}),ce.bindEditEvent("8",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){P(t),$("#popMenu").hide()})}),ce.bindEditEvent("l",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){D(t),$("#popMenu").hide()})}),ce.bindEditEvent("s",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){z(t),$("#popMenu").hide()})}),ce.bindEditEvent("i",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){A(t),$("#popMenu").hide()})}),ce.bindEditEvent("d",function(e,t){var n=$(".element",e)[0];$(n).unbind("dblclick"),$(n).bind("dblclick",function(){L(t),$("#popMenu").hide()})}),ce.bindEditEvent("7",function(e,t){var i=$(".element",e)[0];i.addEventListener("click",function(e){me||n.open({windowClass:"",templateUrl:"scene/console/map.tpl.html",controller:"MapConsoleCtrl"}).result.then(function(e){var n=new BMap.Map("map_"+t.id);n.clearOverlays();var i=new BMap.Point(e.lng,e.lat),r=new BMap.Marker(i);n.addOverlay(r);var o=new BMap.Label(e.address,{offset:new BMap.Size(20,(-10))});r.setLabel(o),n.centerAndZoom(i,12),t.properties.pointX=e.lng,t.properties.pointY=e.lat,t.properties.x=e.lng,t.properties.y=e.lat,t.properties.markTitle=e.address})})}),se.templateEditor=ce,se.getTplById=function(t){var n="m/scene/select?id="+t,i=new Date;return n+="&time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},se.createByTpl=function(t){var n=PREFIX_URL+"index.php?c=scene&a=createBySys";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},se.getSceneDetail=function(t,n){var i="index.php?c=scene&a=detail&id="+t;return n&&(i+=(/\?/.test(i)?"&":"?")+"user="+n),ie=e({withCredentials:!0,method:"GET",url:PREFIX_URL+i}),ne=null,ie.then(function(e){""==e.data.obj.bgAudio.url?e.data.obj.bgAudio=null:e.data.obj.bgAudio=e.data.obj.bgAudio,ne=e.data.obj}),ie},se.getCurrentScene=function(){return ne},se.getCurrentScenePromise=function(){return ie},se.saveSceneSettings=function(t){t=angular.copy(t),angular.isObject(t.bgAudio)&&(t.bgAudio=JSON.stringify(t.bgAudio)),t.image=null;var n="index.php?c=scene&a=saveSettings";return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n,headers:{"Content-Type":"text/plain; charset=UTF-8"},data:JSON.stringify(t)})},se.publishScene=function(t){var n="index.php?c=scene&a=publish&id="+t,i=new Date;return n+="&time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},se.closeScene=function(t){var n="index.php?c=scene&a=off&id="+t,i=new Date;return n+="&time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},se.openScene=function(t){var n="index.php?c=scene&a=on&id="+t,i=new Date;return n+="&time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},se.createBlankScene=function(t,n,i){var r={name:t,type:n,pageMode:i},o="index.php?c=scene&a=create";return e({withCredentials:!0,method:"POST",url:PREFIX_URL+o,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(r)})},se.copySceneById=function(t){var n="index.php?c=scene&a=createByCopy&id="+t;return e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},se.deleteSceneById=function(t,n){var i="index.php?c=scene&a=delscene&id="+t;return n&&(i+="&backup="+n),e({withCredentials:!0,method:"GET",url:PREFIX_URL+i})},se.getCoverImages=function(){var t="index.php?c=upfile&a=userList&bizType=99&fileType=1&time="+(new Date).getTime();return e({withCredentials:!0,method:"GET",url:PREFIX_URL+t})},se.revoke=function(t){var n="m/scene/revoke?id="+t+"&time="+(new Date).getTime();return e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},se.getSceneByPage=function(t,n,r){var o="";n||r?(o="index.php?c=scene&a=createpage&id="+t,r&&(o+="&copy=true")):o="index.php?c=scene&a=design&id="+t;var a=i.defer(),s=new Date;return o+=(/\?/.test(o)?"&":"?")+"time="+s.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+o}).then(function(e){a.resolve(e),le=e.data,le.obj.elements||(le.obj.elements=[]),de=le.obj.elements;for(var t=0;de&&t<de.length;t++)ue[de[t].id]=de[t]},function(e){a.reject(e)}),a.promise},se.previewSceneTpl=function(t){var n="index.php?c=scene&a=syspageinfo&id="+t,r=(i.defer(),new Date);return n+=(/\?/.test(n)?"&":"?")+"time="+r.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},se.recentlyUsedTpls=function(){var t="/m/scene/tpl/recently/used";return t+=(/\?/.test(t)?"&":"?")+"time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+t})},se.recordTplUsage=function(t){var n="m/scene/usePageTpl?id="+t;return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n})},se.getSceneTpl=function(t){
var n=o.get("tplCache")?o.get("tplCache"):o("tplCache"),r=i.defer();if(n.get(t)){var a=$.extend(!0,{},n.get(t));a.data.obj.scene&&a.data.obj.scene.bgAudio&&(ne.bgAudio=a.data.obj.scene.bgAudio);for(var s=0;s<a.data.obj.elements.length;s++){var c=a.data.obj.elements[s];c.id=b(),c.sceneId=le.obj.sceneId,c.pageId=le.obj.id}de=a.data.obj.elements;for(var l=0;l<de.length;l++)ue[de[l].id]=de[l];r.resolve(a)}else{var d="index.php?c=scene&a=syspageinfo&id="+t,u=new Date;d+=(/\?/.test(d)?"&":"?")+"time="+u.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+d}).then(function(e){n.put(e.data.obj.id,$.extend(!0,{},e)),e.data.obj.scene&&e.data.obj.scene.bgAudio&&(ne.bgAudio=e.data.obj.scene.bgAudio);for(var t=0;t<e.data.obj.elements.length;t++){var i=e.data.obj.elements[t];i.id=b(),i.sceneId=le.obj.sceneId,i.pageId=le.obj.id}de=e.data.obj.elements;for(var o=0;o<de.length;o++)ue[de[o].id]=de[o];r.resolve(e)},function(e){r.reject(e)})}return r.promise},se.saveScene=function(t){for(var n,i=0;i<t.elements.length;i++)if(2==t.elements[i].type){var r=t.elements[i].css.color;t.elements[i].content.split("color:")[1]&&(n=t.elements[i].content.split("color:")[1].split(";")[0]),r&&"#676767"!=r&&(t.elements[i].content=t.elements[i].content.replace(n,r))}var o="index.php?c=scene&a=savepage";return e({withCredentials:!0,method:"POST",url:PREFIX_URL+o,headers:{"Content-Type":"text/plain; charset=UTF-8"},data:JSON.stringify(t)})},se.deletePage=function(t){var n="index.php?c=scene&a=delPage&id="+t;return e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},se.getBgImages=function(t){var n="m/scene/gallery/"+t,i=new Date;return n+=(/\?/.test(n)?"&":"?")+"time="+i.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+n})},se.createCustomComp=fe,se.openAudioModal=N,se.openBgModal=q,se.getElements=function(){return de},se.getElementsMap=function(){return ue},se.deleteElement=g,se.getSceneObj=function(){return le},se.getTpls=function(t,n,i,r){var o="m/scene/listTpl";null!=t&&(o+=(/\?/.test(o)?"&":"?")+"sceneType="+t),o+=(/\?/.test(o)?"&":"?")+"pageNo="+(n?n:1),o+=(/\?/.test(o)?"&":"?")+"pageSize="+(i?i:12),r&&(o+=(/\?/.test(o)?"&":"?")+"orderBy="+r);var a=new Date;return o+=(/\?/.test(o)?"&":"?")+"time="+a.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+o})},se.getCompanyTpls=function(t,n){var i="/m/scene/tpl/company/list?pageNo="+t+"&pageSize="+n;return e({withCredentials:!0,method:"GET",url:PREFIX_URL+i})},se.createCompanyTpls=function(t){var n="/m/scene/tpl/company/set?id="+t;return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n})},se.clearCompanyTpls=function(t){var n="/m/scene/tpl/company/unset?id="+t;return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n})},se.getPageTpls=function(n,i,r,o,a,s,c,l,d){var u="index.php?c=scene&a=syslist",p=new Date;u+=(/\?/.test(u)?"&":"?")+"time="+p.getTime();var h={tplType:1,bizType:i,tagId:r,order:s,freeTplSetting:c,name:l,createUser:d,pageNo:o?o:1,pageSize:a?a:12};return e({withCredentials:!0,method:"POST",url:PREFIX_URL+u,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(h)}).then(function(e){200==e.data.code&&(se.scenes=e.data,t.$broadcast("getSampleList"))})},se.getPageTplTypesTwo=function(t,n){var i="index.php?c=upfile&a=systag&type=2&bizType="+n,r=new Date;return i+=(/\?/.test(i)?"&":"?")+"time="+r.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+i})},se.saveMyTpl=function(t){var n="index.php?c=user&a=saveMyTpl";return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n,headers:{"Content-Type":"text/plain; charset=UTF-8"},data:JSON.stringify(t)})},se.saveCompanyTpl=function(t){var n="index.php?c=company&a=saveMyTpl";return e({withCredentials:!0,method:"POST",url:PREFIX_URL+n,headers:{"Content-Type":"text/plain; charset=UTF-8"},data:JSON.stringify(t)})},se.previewScene=function(t){var n="index.php?c=user&a=getMyTpl&id="+t,r=new Date;n+=(/\?/.test(n)?"&":"?")+"time="+r.getTime();var a=i.defer();return e({withCredentials:!0,method:"GET",url:PREFIX_URL+n}).then(function(e){for(var t=o.get("tplCache")?o.get("tplCache"):o("tplCache"),n=0;n<e.data.list.length;n++){var i={data:{obj:{elements:e.data.list[n].elements,scene:e.data.obj}}};t.put(e.data.list[n].id,$.extend(!0,{},i))}a.resolve(e)}),a.promise},se.transferScene=function(t,n){var i=PREFIX_URL+"index.php?c=scene&a=transfer";return i+="&loginName="+n,i+="&id="+t,i+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"POST",url:i})},se.getActivities=function(){var t=PREFIX_S1_URL+"eqs/activity?all=1";return e({withCredentials:!0,method:"GET",url:t})},se.getSceneTemplatePrices=function(){var t=PREFIX_URL+"index.php?c=statics&a=scene_template_prices";return e({withCredentials:!0,method:"GET",url:t})},se.soundLink=function(t,n){var i="index.php?c=upfile&a=savewl&url="+t+"&fileType="+n,r=new Date;return i+="&time="+r.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+i})},se}]),angular.module("services.select",[]).factory("selectService",["$rootScope",function(e){var t={},n=[];return t.addElement=function(t){t+="",n.indexOf(t)>=0||(n.push(t),n.length>1&&e.$broadcast("select.more"))},t.deleteElement=function(t){e.$broadcast("select.less.id",t);var i=n.indexOf(t+"");0>i||(n.splice(i,1),0===n.length&&e.$broadcast("close.style.panel"),n.length<=1&&e.$broadcast("select.less"))},t.clearElements=function(){e.$broadcast("select.less",n),n=[]},t.getElements=function(){return n},t}]),angular.module("services.spread",["services.scene"]),angular.module("services.spread").factory("SpreadService",["$http","sceneService","$rootScope",function(e,t,n){var i={},r=function(e){var t=new Date;return t.setDate(t.getDate()+e),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.getTime()};return i.getDataBySceneId=function(t,n,i,r,o,a,s){var c="index.php?c=Stat&id="+t;a&&(c+=(/\?/.test(c)?"&":"?")+"user="+a),s&&(c+=(/\?/.test(c)?"&":"?")+"extId="+s),n&&(c+="&startDate="+n),i&&(c+="&endDate="+i),r&&(c+="&pageSize="+r),o&&(c+="&pageNo="+o);var l=new Date;return c+="&time="+l.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+c})},i.getDevice=function(t,n,i){var r="m/scene/pv/device?id="+t;n&&(r+="&startDate="+n),i&&(r+="&endDate="+i);var o=new Date;return r+="&time="+o.getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+r})},i.getDevicePv=function(e,t,o){var a=r(t),s=r(o);i.getDevice(e,a,s).then(function(t){n.$broadcast("scene.device",t.data.obj,e,a,s)},function(){})},i.getActivities=function(){var t=new Date;return e({withCredentials:!0,method:"GET",url:PREFIX_URL+"m/u/promotion/list?type=pc&time="+t.getTime()})},i.getActivityDetail=function(t){var n=new Date;return e({withCredentials:!0,method:"GET",url:PREFIX_URL+"m/u/promotion?code="+t+"&time="+n.getTime()})},i.updateName=function(t){var n=PREFIX_URL+"m/scene/expand/save";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.branchid,i.getSceneDetail=function(e,i){t.getSceneDetail(e,i).then(function(e){n.$broadcast("scene.detail",e.data.obj,i)},function(){})},i.getSceneData=function(e,t,o,a,s){var c=r(t),l=r(o),d=o-t;i.getDataBySceneId(e,c,l,d,0,a,s).then(function(t){n.$broadcast("scene.data",t.data.list,e,c,l,a)},function(){})},i.expandWebs=[],i.getWebList=function(t,r,o){var a="m/scene/expand/list";t&&(a+=(/\?/.test(a)?"&":"?")+"id="+t),o&&(a+=(/\?/.test(a)?"&":"?")+"user="+o),a+=(/\?/.test(a)?"&":"?")+"showPv="+r,a+=(/\?/.test(a)?"&":"?")+"time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:PREFIX_URL+a}).then(function(e){e.data.success&&(i.expandWebs=e.data.list,n.$broadcast("webs.update"))},function(e){})},i.deleteWeb=function(t){var r=PREFIX_URL+"m/scene/expand/delete";e({withCredentials:!0,method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)}).then(function(e){e.data.success&&(i.expandWebs.splice(t.index,1),n.$broadcast("webs.update"))},function(e){})},i.queryRegion=function(t,i){var r=PREFIX_URL+"m/scene/pv/region?id="+t+"&startDate="+i,o={id:t,startDate:i};e({withCredentials:!0,method:"GET",url:r,data:$.param(o)}).then(function(e){e.data.success&&n.$broadcast("region.update",e.data.obj)})},i.getShareWayList=function(t){var i=PREFIX_URL+"m/scene/social/share/status?id="+t;e({withCredentials:!0,method:"GET",url:i}).then(function(e){e.data.success&&n.$broadcast("shareway.update",e.data.list)})},i.activeShareWay=function(t,i){var r=PREFIX_URL+"m/scene/share?sceneId="+t+"&type="+i;e({withCredentials:!0,method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(e){e.data.success&&n.$broadcast("active.shareway",i)})},i.applyShareWay=function(t,i,r){var o=PREFIX_URL+"m/scene/share/setting/save";t&&(o+=(/\?/.test(o)?"&":"?")+"id="+t),i&&(o+=(/\?/.test(o)?"&":"?")+"type="+i),r&&(o+=(/\?/.test(o)?"&":"?")+"value="+r),e({withCredentials:!0,method:"POST",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(e){e.data.success&&n.$broadcast("apply.scene.share",e.data)})},i}]),angular.module("services.staticRes",[]),angular.module("services.staticRes").factory("staticResService",[function(){var e={},t=[{name:"行业",value:"101"},{name:"个人",value:"102"},{name:"企业",value:"103"},{name:"节假",value:"104"},{},{}];e.getSceneType=function(){return t};var n=[{name:"版式",value:"1101"},{name:"风格",value:"1103"},{name:"互动",value:"1102"}];e.getBigTab=function(){return n};var i={1101:[{id:1,name:"图文",bizType:1101},{id:2,name:"图集",bizType:1101},{id:4,name:"文字",bizType:1101},{id:5,name:"图表",bizType:1101}],1102:[{id:6,name:"报名表",bizType:1102},{id:8,name:"留言",bizType:1102},{id:9,name:"联系",bizType:1102}],1103:[{id:15,name:"黑白",bizType:1103},{id:16,name:"红色",bizType:1103},{id:17,name:"怀旧",bizType:1103},{id:18,name:"现代",bizType:1103},{id:19,name:"扁平化",bizType:1103},{id:120,name:"黄色",bizType:1103},{id:121,name:"绿色",bizType:1103},{id:122,name:"紫色",bizType:1103},{id:123,name:"黑色",bizType:1103},{id:124,name:"白色",bizType:1103},{id:125,name:"其他",bizType:1103},{id:260,name:"English",bizType:1103},{id:262,name:"Android",bizType:1103}]};e.getPageTpls=function(e){return e?i[e]:i[1101].concat(i[1102]).concat(i[1103])};var r=[{id:13178,name:"new",value:"210",remark:"group1/M00/61/89/yq0KA1T2vXqAGI-4AAAWKIt1ceE158.png"},{id:13176,name:"hot",value:"211",remark:"group1/M00/61/89/yq0KA1T2vXqAH3MxAAAdfvrWmmM009.png"},{id:13076,name:"风格",value:"203",remark:"group1/M00/61/89/yq0KA1T2vXqAH3MxAAAdfvrWmmM009.png"},{id:13078,name:"节日",value:"205",remark:"group1/M00/61/89/yq0KA1T2vXqAGI-4AAAWKIt1ceE158.png"},{id:13075,name:"企业",value:"202",remark:"group1/M00/61/89/yq0KA1T2vXqAdp7RAAAOCH36lkY788.png"},{id:13074,name:"行业",value:"201",remark:"group1/M00/61/89/yq0KA1T2vXqARMyQAAASI6ZG0zM493.png"},{id:13077,name:"个人",value:"204",remark:"group1/M00/61/89/yq0KA1T2vXqAIorQAAAVuqdCoU4830.png"},{id:13073,name:"动物",value:"1201",remark:null},{id:13177,name:"动漫",value:"1202",remark:null}];e.getBgTypes=function(){return r};var o=[{id:13100,name:"new",value:"150",remark:"group1/M00/61/89/yq0KA1T2vXqAOVqkAAAX-MAtU0A633.png"},{id:13101,name:"hot",value:"151",remark:"group1/M00/61/89/yq0KA1T2vXqAOVqkAAAX-MAtU0A633.png"},{id:13084,name:"图标",value:"106",remark:"group1/M00/61/89/yq0KA1T2vXqAOVqkAAAX-MAtU0A633.png"},{id:13085,name:"动画",value:"107",remark:"group1/M00/61/89/yq0KA1T2vXqANcAcAAATIr_b2OM515.png"},{id:13083,name:"节日",value:"105",remark:"group1/M00/61/89/yq0KA1T2vXqAGI-4AAAWKIt1ceE158.png"},{id:13081,name:"风格",value:"103",remark:"group1/M00/61/89/yq0KA1T2vXqAH3MxAAAdfvrWmmM009.png"},{id:13080,name:"企业",value:"102",remark:"group1/M00/61/89/yq0KA1T2vXqAdp7RAAAOCH36lkY788.png"},{id:13079,name:"行业",value:"101",remark:"group1/M00/61/89/yq0KA1T2vXqARMyQAAASI6ZG0zM493.png"},{id:13082,name:"个人",value:"104",remark:"group1/M00/61/89/yq0KA1T2vXqAIorQAAAVuqdCoU4830.png"},{id:13086,name:"海外",value:"1101",remark:null}];e.getTpTypes=function(){return o};var a=[];e.getAudioTypes=function(){return a};var s=[];return e.getSoundTypes=function(){return s},e}]),angular.module("services.dataCache").factory("storageService",[function(){var e={};return e.clear=function(){window.localStorage&&localStorage.clear()},e.push=function(e,t){window.localStorage&&localStorage.setItem(e,t)},e.get=function(e){return window.localStorage?localStorage.getItem(e):void 0},e}]),angular.module("services.file.upload",["angularFileUpload","services.file"]).factory("uploaderService",["$rootScope","$http","$interval","FileUploader","fileService","$translate",function(e,t,n,i,r,o){var a,s={};return s.uploader=function(t,r){var s=6;(2==t||4==t)&&(a=PREFIX_URL+"index.php?c=upfile&a=upload&bizType=0&fileType="+t);var c,l=new i({url:a,withCredentials:!0,queueLimit:s,onAfterAddingAll:function(t){e.$broadcast("uploadfiles.add"),l.uploadAll()},onSuccessItem:function(i,r,o,a){function s(){n.cancel(c)}var c=n(function(){var n=null;i.progress>=100&&(n=4==t?{id:r.obj.id,src:r.obj.path,name:r.obj.name,size:r.obj.size}:2==t?{id:r.obj.id,url:r.obj.path,name:r.obj.name,size:r.obj.size}:{tmbPath:r.obj.tmbPath,id:r.obj.id,path:r.obj.path,name:r.obj.name},e.$broadcast("thumbnailList.update",n),s())},100)}}),d=r||3145728;return"0"==t||"1"==t?c="|jpg|png|jpeg|bmp|gif|svg+xml|webp|":("4"==t||"2"==t)&&(c="|wav|mp3|mpeg|"),l.filters.push({name:"imageFilter",fn:function(e,t){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!==c.indexOf(n)}}),l.filters.push({name:"imageSizeFilter",fn:function(e,t){var n=e.size;return n>=d&&alert(o.instant("upload.SIZE_TIP1")+d/1024/1024+o.instant("upload.SIZE_TIP2")),d>n}}),l.filters.push({name:"fileNameFilter",fn:function(e,t){return e.name.length>50&&alert(o.instant("upload.NAME_LENGTH")),e.name.length<=50}}),l},s}]),angular.module("services.usercenter",[]).factory("usercenterService",["$http","$rootScope",function(e,t){var n={};return n.getUserInfo=function(){var t=PREFIX_URL+"index.php?c=user&a=check";return t+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:t})},n.getCompanyScale=function(){var t=PREFIX_URL+"/base/class/company_scale";return t+="?time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:t})},n.getCompanyIndustry=function(){var t=PREFIX_URL+"/base/class/company_industry";return t+="?time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:t})},n.getCompanyInfo=function(){var t=PREFIX_URL+"index.php?c=company&a=info";return t+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:t})},n.getDesignerUserInfo=function(t){var n=PREFIX_URL+"index.php?c=designer&a=userinfo";return n+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:n})},n.getProvince=function(){var t=PREFIX_URL+"index.php?c=Designer&a=getpro";return t+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:t})},n.saveCompanyInfo=function(t){var n=PREFIX_URL+"index.php?c=company&a=save";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.saveDesignerInfo=function(t){var n=PREFIX_URL+"index.php?c=designer&a=save";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.saveUserInfo=function(t){var n=PREFIX_URL+"index.php?c=user&a=save";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.getUserXd=function(){var t=PREFIX_URL+"index.php?c=user&a=xd";return t+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:t})},n.getgiveXd=function(t){var n=PREFIX_URL+"index.php?c=user&a=giveXd";return n+="&toUser="+t.toUser,n+="&xdCount="+t.xdCount,n+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"POST",url:n})},n.getUserInvoice=function(){var t=PREFIX_URL+"m/order/user/invoice";return t+="?time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:t})},n.saveUserInvoice=function(t){var n=PREFIX_URL+"m/order/user/save/invoice";return n+="?time="+(new Date).getTime(),e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"text/plain; charset=UTF-8"},data:JSON.stringify(t)})},n.saveOrderInvoice=function(t){var n=PREFIX_URL+"m/order/invoice/save";return n+="?time="+(new Date).getTime(),e({withCredentials:!0,method:"POST",url:n,data:$.param(t),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},n.getXdlog=function(t,n,i){var r=PREFIX_URL+"index.php?c=user&a=xdlog&pageNo="+n+"&pageSize="+i;return r+="&time="+(new Date).getTime(),t&&(r+=(/\?/.test(r)?"&":"?")+"type="+t),r+=(/\?/.test(r)?"&":"?")+"pageNo="+n,r+=(/\?/.test(r)?"&":"?")+"pageSize="+i,e({withCredentials:!0,method:"POST",url:r})},n.getXdStat=function(){var t=PREFIX_URL+"index.php?c=user&a=XdStat";return t+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:t})},n.relAccount=function(t,n,i,r){var o=PREFIX_URL+"m/u/bind/email?loginName="+n+"&loginPassword="+i;return r&&(o+="&register=1"),o+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"POST",url:o,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.relEmail=function(t,n,i){var r={email:t,pass:n,resend:i},o=PREFIX_URL+"index.php?c=user&a=email";return e({withCredentials:!0,method:"POST",url:o,data:$.param(r),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})},n.verifyEmail=function(){var t=PREFIX_URL+"index.php?c=usercenter&a=verify";return e({withCredentials:!0,method:"GET",url:t,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.relMobile=function(t,n,i){var r=PREFIX_URL+"/m/u/phone/verify?phone="+t+"&pass="+n+"&code="+i;return r+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"POST",url:r,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.relMobileCode=function(t,n){var i=PREFIX_URL+"m/u/bind/user/phone?phone="+t;return n&&(i+="&type="+n),i+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"POST",url:i,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.companyMobile=function(t){var n=PREFIX_URL+"m/u/company/smscode/send?phone="+t;return n+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.setRead=function(t){var n=PREFIX_URL+"m/u/markRead?ids="+t;return n+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.getNewMessage=function(t,n,i,r){var o=PREFIX_URL+"index.php?c=statics&a=msgList&pageNo="+t+"&pageSize="+n;return i&&(o+="&unread="+i),r&&(o+="&system="+r),o+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:o})},n.getBranches=function(t,n){var i=PREFIX_URL+"index.php?c=company&a=subList";return t&&(/\?/.test(i),i+="&pageSize="+t),n&&(/\?/.test(i),i+="&pageNo="+n),/\?/.test(i),i+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:i})},n.getDepts=function(t){var n=PREFIX_URL+"index.php?c=Company&a=taglist&user_id="+t;return n+="&time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:n})},n.addDept=function(t){var n=PREFIX_URL+"index.php?c=Company&a=tagcreate";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.updateBranch=function(t){var n=PREFIX_URL+"index.php?c=Company&a=subsave";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.createBranch=function(t){var n=PREFIX_URL+"index.php?c=Company&a=subcreate";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.openBranch=function(t,n){var i=PREFIX_URL;return i+=n?"index.php?c=Company&a=subturnon&id="+t:"index.php?c=Company&a=subturnoff&id="+t,e({withCredentials:!0,method:"POST",url:i,headers:{"Content-Type":"text/plain; charset=UTF-8"}})},n.getDomain=function(){var t=PREFIX_URL+"m/u/domain";return t+="?time="+(new Date).getTime(),e({withCredentials:!0,method:"GET",url:t})},n.bindDomain=function(t){var n=PREFIX_URL+"m/u/domain/bind";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.resetBranchPass=function(n){var i=PREFIX_URL+"index.php?c=Company&a=resetpwd",r={id:n};e({withCredentials:!0,method:"POST",url:i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(r)}).then(function(e){e.data.success&&t.$broadcast("reset.branch.success")},function(){})},n.saveApplyInfo=function(t){var n=PREFIX_URL+"m/u/showker/apply";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.resetApplyInfo=function(t){var n=PREFIX_URL+"m/u/showker/apply";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.getVisitorMsg=function(){var t=PREFIX_URL+"m/u/showker/detail",n=new Date;return t+="?time="+n.getTime(),e({withCredentials:!0,method:"GET",url:t})},n.getAPPlyMessage=function(t){var n=PREFIX_S2_URL+"showker/tag?type="+t;return e({withCredentials:!0,method:"GET",url:n})},n.getUserScene=function(){var t=PREFIX_URL+"m/u/scene/list",n=new Date;return t+="?time="+n.getTime(),e({withCredentials:!0,method:"GET",url:t})},n.getUserStatus=function(){var t=PREFIX_URL+"m/u/showker/status";return e({withCredentials:!0,method:"GET",url:t})},n.getCompanyQrCode=function(t,n,i){var r=PREFIX_URL+"m/u/pay/member/url?goodsId="+t+"&type="+n;return i&&(r+="&amount="+i),e({withCredentials:!0,method:"GET",url:r})},n.getUserMemberDetail=function(t){var n=PREFIX_URL+"/m/u/member/detail?userId="+t;return e({withCredentials:!0,method:"GET",url:n})},n.getPayXdQrCode=function(t,n){var i=PREFIX_URL+"m/u/pay/xd/url?goodsId="+t+"&type="+n;return e({withCredentials:!0,method:"GET",url:i})},n.sendEmail=function(t){var n=PREFIX_URL+"m/u/invite/user/email";return e({withCredentials:!0,method:"POST",url:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:$.param(t)})},n.getInvoiceList=function(n,i){var r=PREFIX_URL+"m/order/can/invoice/list";i&&(r+=(/\?/.test(r)?"&":"?")+"pageSize="+i),n&&(r+=(/\?/.test(r)?"&":"?")+"pageNo="+n),e({withCredentials:!0,method:"GET",url:r}).then(function(e){e.data.success&&t.$broadcast("get.invoice.list",e.data)})},n}]),angular.module("templates-app",["about.tpl.html","active/active.tpl.html","active/tab/active1.tpl.html","data/edit/canedit.tpl.html","data/edit/canread.tpl.html","data/editData.tpl.html","dialog/bindemail.tpl.html","dialog/confirm.tpl.html","dialog/message.tpl.html","error.tpl.html","error/error.tpl.html","footer.tpl.html","header.tpl.html","help.tpl.html","home/home.tpl.html","main/console/group.tpl.html","main/console/transferscene.tpl.html","main/customer.tpl.html","main/main.tpl.html","main/recSceneList.tpl.html","main/squareSceneList.tpl.html","main/userGuide.tpl.html","my/myscene.tpl.html","my/upload.tpl.html","notifications.tpl.html","reg/agreement.tpl.html","reg/reg.tpl.html","sample/sample.tpl.html","scene/console.tpl.html","scene/console/angle-knob.tpl.html","scene/console/anim.tpl.html","scene/console/audio.tpl.html","scene/console/bg.tpl.html","scene/console/button.tpl.html","scene/console/category.tpl.html","scene/console/counter.tpl.html","scene/console/cropimage.tpl.html","scene/console/fake.tpl.html","scene/console/imageCrop.tpl.html","scene/console/input.tpl.html","scene/console/link-component.tpl.html","scene/console/link.tpl.html","scene/console/map.tpl.html","scene/console/microweb.tpl.html","scene/console/pictures.tpl.html","scene/console/pictures1.tpl.html","scene/console/radio-checkbox.tpl.html","scene/console/randomevent.tpl.html","scene/console/rating.tpl.html","scene/console/scene-setting-component.tpl.html","scene/console/setting.tpl.html","scene/console/shape.tpl.html","scene/console/adr.tpl.html","scene/console/sound-component.tpl.html","scene/console/sound.tpl.html","scene/console/sound2.tpl.html","scene/console/soundLink.tpl.html","scene/console/statistics-component.tpl.html","scene/console/style.tpl.html","scene/console/tel.tpl.html","scene/console/trigger.tpl.html","scene/console/triggerelemlist.tpl.html","scene/console/video.tpl.html","scene/create.tpl.html","scene/createNew.tpl.html","scene/createUserGuide.tpl.html","scene/edit/editbg/editbg.tpl.html","scene/edit/select/select.tpl.html","scene/effect/falling.tpl.html","scene/effect/snowfly.tpl.html","scene/page/page-tpl.tpl.html","scene/pageeffect/fall.tpl.html","scene/pageeffect/finger.tpl.html","scene/pageeffect/fireworks.tpl.html","scene/pageeffect/money.tpl.html","scene/pageeffect/none.tpl.html","scene/pageeffect/pageeffect.tpl.html","scene/pageeffect/scratch.tpl.html","scene/pageeffect/snow.tpl.html","scene/preview.tpl.html","scene/saveTemplate.tpl.html","scene/scene.tpl.html","scene/support/support.tpl.html","scene/tplOption.tpl.html","scene/userGuide.tpl.html","scene/console/ppt.tpl.html","scene/console/psd.tpl.html","show/active/active-xq.tpl.html","show/active/active.tpl.html","show/category/category.tpl.html","show/category/nav.tpl.html","show/index.tpl.html","show/recommend/recommend.tpl.html","show/search/search.tpl.html","show/visitor/visitor-xq.tpl.html","show/visitor/visitor.tpl.html","spread/console/apply.tpl.html","spread/spread.tpl.html","spread/tab/data-collect.tpl.html","spread/tab/share.tpl.html","spread/tab/statistics.tpl.html","spread/tab/subtab/domain-bind.tpl.html","spread/tab/subtab/expand-web.tpl.html","spread/tab/subtab/site-import.tpl.html","spread/tab/subtab/social-share.tpl.html","sysmessage.tpl.html","usercenter/buyXd.tpl.html","usercenter/console/branch.tpl.html","usercenter/console/checkMobile.tpl.html","usercenter/console/companyinfo.tpl.html","usercenter/console/email_fail.tpl.html","usercenter/console/email_succeed.tpl.html","usercenter/console/invitation.tpl.html","usercenter/console/invoice-list.tpl.html","usercenter/console/invoice.tpl.html","usercenter/console/register.tpl.html","usercenter/console/relAccount.tpl.html","usercenter/console/relEmail.tpl.html","usercenter/console/resetbranchpass.tpl.html","usercenter/console/serverinfo.tpl.html","usercenter/console/upgrade_company.tpl.html","usercenter/message.tpl.html","usercenter/payment.tpl.html","usercenter/paymentxd.tpl.html","usercenter/request_reg.tpl.html","usercenter/tab/account.tpl.html","usercenter/tab/children.tpl.html","usercenter/tab/domain.tpl.html","usercenter/tab/member.tpl.html","usercenter/tab/message.tpl.html","usercenter/tab/privilege.tpl.html","usercenter/tab/reset.tpl.html","usercenter/tab/server.tpl.html","usercenter/tab/trash.tpl.html","usercenter/tab/xd.tpl.html","usercenter/transfer.tpl.html","usercenter/upgrade.tpl.html","usercenter/upgradeTip.tpl.html","usercenter/userCenterGuid.tpl.html","usercenter/userCenterGuidNext.tpl.html","usercenter/userCenterGuidNextNext.tpl.html","usercenter/usercenter.tpl.html"])}(window,window.angular);